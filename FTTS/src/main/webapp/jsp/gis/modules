_jsload&&_jsload('map', 'BMap.register(function(cL){if(cL.config&&cL.config.isOverviewMap){return}if(cL.isLoaded()){bk(cL)}else{cL.addEventListener("load",function(){bk(this)})}cL.cityName="\u4e2d\u56fd";var T={};T.enableRequest=true;T.request=function(){if(T.enableRequest){T.enableRequest=false;setTimeout(function(){T._request()},500)}};T._request=function(){var cN=cL.getBounds(),cP=cL.getZoom(),cM=ba.convertLL2MC(cN.getSouthWest()),cO=ba.convertLL2MC(cN.getNorthEast());bb.request(function(cQ){T.enableRequest=true;if(cQ&&cQ.current_city&&cQ.current_city["name"]){cL.cityName=cQ.current_city["name"];aZ(cL)}},{qt:"cen",b:cM.lng+","+cM.lat+";"+cO.lng+","+cO.lat,l:cP},"","",true)};cL.addEventListener("load",function(cM){T.request()});cL.addEventListener("moveend",function(cM){T.request()});cL.addEventListener("zoomend",function(cM){T.request()})});function bk(cL){if(cL.temp.copyadded){return}cL.temp.copyadded=true;var cN=new aH(81,2);if(aA()){if(cL.highResolutionEnabled()){cN.width=148;fontSize="21px"}else{cN.width=72;cN.height=0}}var cM=new am({offset:cN,printable:true});cL.cpyCtrl=cM;aZ(cL);cL.addEventListener("maptypechange",function(){aZ(cL)});cL.addControl(cM);var T=new b1();T._opts={printable:true};cL.addControl(T);cL.addEventListener("resize",function(){if(this.getSize().width>=220&&cL.getSize().height>=100){T.show();cM.setOffset(cN)}else{T.hide();cM.setOffset(new aH(4,2))}});if(cL.getSize().width>=220&&cL.getSize().height>=100){T.show()}else{T.hide();cM.setOffset(new aH(4,2))}if(cL.highResolutionEnabled()){T.setOffset(new aH(3,2))}}function aZ(T){var cR="11px",cQ=T.cityName||"\u4e2d\u56fd",cN=T.getMapType(),cS=["\u5e38\u5dde\u5e02","\u6210\u90fd\u5e02","\u5927\u8fde\u5e02","\u91cd\u5e86\u5e02","\u5357\u4eac\u5e02","\u5357\u660c\u5e02","\u6b66\u6c49\u5e02"],cM=[],cP,cO="color:#fff;font-size:"+cR+";text-shadow:0 1px 3px black";switch(cN){case BMAP_SATELLITE_MAP:case BMAP_HYBRID_MAP:cM=[\'<span style="\'+cO+\'">&copy; 2013 Baidu - Data &copy; \'];cM.push(\'<a target="_blank" href="http://www.navinfo.com/" style="\'+cO+\'">NavInfo</a> &amp; \');for(var cL in cS){if(cS[cL]==cQ){cP=true;break}}if(cP){cM.push(\'<a target="_blank" href="http://www.yootu.com/" style="\'+cO+\'">yootu</a>\')}else{cM.push(\'<a target="_blank" href="http://www.cennavi.com.cn/" style="\'+cO+\'">CenNavi</a>\')}cM.push(\' &amp; <a target="_blank" href="http://www.365ditu.com/" style="\'+cO+\'">\u9053\u9053\u901a</a>\');cM.push(" , Image &copy; DigitalGlobe & </span>");cM.push(\'<a href="http://www.chinasiwei.com" target="_blank" style="\'+cO+\'">chinasiwei</a>\');break;case BMAP_PERSPECTIVE_MAP:cM=[\'<span style="\'+cO+\'">&copy; 2013 Baidu - Data &copy; </span>\',\'<a href="http://o.cn" target="_blank" style="color:#fff;font-size:\'+cR+\';text-shadow:0 1px 3px black">\u90fd\u5e02\u5708</a>\'];break;default:cM=[\'<span style="font-size:\'+cR+\'">&copy; 2013 Baidu&nbsp;- Data &copy; \'];cM.push(\'<a target="_blank" href="http://www.navinfo.com/">NavInfo</a> &amp; \');for(var cL in cS){if(cS[cL]==cQ){cP=true;break}}if(cP){cM.push(\'<a target="_blank" href="http://www.yootu.com/">yootu</a>\')}else{cM.push(\'<a target="_blank" href="http://www.cennavi.com.cn/">CenNavi</a>\')}cM.push(\' &amp; <a target="_blank" href="http://www.365ditu.com/">\u9053\u9053\u901a</a>\');cM.push("</span>");break}cM=cM.join("");}function b1(T){this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new aH(1,0);this.IMG_URL=cc.imgPath+(aA()?"copyright_logo_s.png":"copyright_logo.png")}b1.prototype=new cp();b1.prototype.initialize=function(cL){this._map=cL;var cM=aa("div");cM.style.height="32px";var T=aa("a",{title:"\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b\u6b64\u533a\u57df",target:"_blank",href:"http://map.baidu.com/?sr=1"});T.style.outline="none";if(a8.browser.ie==6){T.innerHTML="<div style=\'cursor:pointer;width:77px;height:32px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+this.IMG_URL+")\'></div>"}else{T.innerHTML="<img style=\'border:none;width:77px;height:32px\' src=\'"+this.IMG_URL+"\' />"}if(aA()){if(this._map.highResolutionEnabled()){cM.style.height="50px";T.href="#";this.IMG_URL=cc.imgPath+"copyright_logo_hd.png";T.innerHTML="<img style=\'border:none;width:136px;height:50px\' src=\'"+this.IMG_URL+"\' />"}else{cM.style.height="25px";T.href="#";T.innerHTML="<img style=\'border:none;width:68px;height:25px\' src=\'"+this.IMG_URL+"\' />"}}cM.appendChild(T);return cM};a8.extend(bz.prototype,{_draw:function(){this._bind()},_bind:function(){var T=this;T._watchSize=function(){var cM=T.getSize();if(T.width!=cM.width||T.height!=cM.height){var cO=new aH(T.width,T.height);var cQ=new bg("onbeforeresize");cQ.size=cO;T.dispatchEvent(cQ);T._updateCenterPoint((cM.width-T.width)/2,(cM.height-T.height)/2);T.maskLayer.style.width=(T.width=cM.width)+"px";T.maskLayer.style.height=(T.height=cM.height)+"px";var cN=new bg("onresize");cN.size=cM;T.dispatchEvent(cN);var cL=parseInt(T.platform.style.left)||0;var cP=parseInt(T.platform.style.top)||0;if(T.currentOperation!=0&&(T.offsetX!=cL||T.offsetY!=cP)){T._setPlatformPosition(cL,cP)}}};a8.on(T.maskLayer,"mouseover",function(cL){T.dispatchEvent(new bg("onmouseover"))});a8.on(T.maskLayer,"mouseout",function(cL){T.dispatchEvent(new bg("onmouseout"))})},_setPlatformPosition:function(T,cN,cL,cM){if(isNaN(T)||isNaN(cN)){return}if(this.offsetX==T&&this.offsetY==cN){return}this._updateCenterPoint(this.offsetX-T,this.offsetY-cN,cL);T=Math.round(T);cN=Math.round(cN);this.offsetX=T;this.offsetY=cN;this.platform.style.left=T+"px";this.platform.style.top=cN+"px";this.maskLayer.style.left=-T+"px";this.maskLayer.style.top=-cN+"px";if(cM!=false){this.dispatchEvent(new bg("onmoving"))}},panTo:function(cL,cN){if(!(cL instanceof cd)){return}var cM=this.pointToPixel(cL);var T=Math.round(this.width/2);var cO=Math.round(this.height/2);cN=cN||{};if(Math.abs(T-cM.x)>this.width||Math.abs(cO-cM.y)>this.height||cN.noAnimation){this._panTo(T-cM.x,cO-cM.y,cL)}else{this._panBy(T-cM.x,cO-cM.y,{duration:cN.duration})}},_panTo:function(cL,T,cN){var cM=this.temp;if(cM.operating==true){return}if(cM.dragAni){cM.dragAni.stop()}this.dispatchEvent(new bg("onmovestart"));this._setPlatformPosition(this.offsetX+cL,this.offsetY+T,cN);this.dispatchEvent(new bg("onmoveend"))},panBy:function(cL,T,cM){cL=Math.round(cL)||0;T=Math.round(T)||0;cM=cM||{};if(Math.abs(cL)<=this.width&&Math.abs(T)<=this.height&&(!cM.noAnimation)){this._panBy(cL,T)}else{this._panTo(cL,T)}},_panBy:function(cL,T,cO){if(this.temp.operating==true){return}cO=cO||{};this.dispatchEvent(new bg("onmovestart"));var cN=this,cM=cN.temp;cM.pl=cN.offsetX;cM.pt=cN.offsetY;if(cM.tlPan){cM.tlPan.cancel()}if(cM.dragAni){cM.dragAni.stop()}cM.tlPan=new g({fps:cO.fps||cN.config.fps,duration:cO.duration||cN.config.actionDuration,transition:cO.transition||aw.easeInOutQuad,render:function(cP){this.terminative=cN.temp.operating;if(cN.temp.operating){return}cN._setPlatformPosition(cM.pl+Math.ceil(cL*cP),cM.pt+Math.ceil(T*cP))},finish:function(cP){cN.dispatchEvent(new bg("onmoveend"));cN.temp.tlPan=false;if(cN.temp.stopArrow==true){cN.temp.stopArrow=false;if(cN.temp.arrow!=0){cN._arrow()}}}})}});');
﻿_jsload&&_jsload('control', 'a8.extend(L.prototype,{_asyncDraw:function(){if(this._map){this._i(this._map)}},initialize:function(T){cp.prototype.initialize.call(this,T);this._initParam();this._setParam();this._render();this._bind();this._setSliderZoomLv(T.getZoom());this._bindMapEvent(T);return this._container},_initParam:function(){if(this._init){return}this._init=true;this._maxTotalZoomLv=19;this._minZoomLevel=-1;this._maxZoomLevel=-1;this._totalZoomLv=-1;this._sliderInterval=6;this._minBarY=1;this._maxBarY=-1;this._curBarY=-1;this._zoomDom=null;this._zoomBtnDom=null;this._sliderDom=null;this._sliderBaseDom=null;this._cZIndex="1100"},_bindMapEvent:function(cL){var T=this;cL.addEventListener("zoomend",function(cM){if(!T._map){return}T._setSliderZoomLv(T._map.getZoom());if(T._msover){return}if(T._isShowLevelHint){T._hideTimerId=setTimeout(function(){T._hideLevelHint()},1000)}});cL.addEventListener("mousewheel",function(){if(!T._map){return}if(T._map.config.enableWheelZoom&&T._isShowLevelHint){if(T._hideTimerId){clearTimeout(T._hideTimerId);T._hideTimerId=null}T._showLevelHint()}});cL.addEventListener("load",function(cM){if(!T._map){return}T._setSliderZoomLv(T._map.getZoom())});cL.addEventListener("maptypechange",function(cM){if(!T._map){return}T.redraw()});cL.addEventListener("zoomspanchange",function(cM){if(!T._map){return}T.redraw()})},redraw:function(){this._setParam();this.setType(this._opts.type);if(this._map){this._setSliderZoomLv(this._map.getZoom())}},_setParam:function(){var T=this._map.getMapType();this._minZoom=this._map.config.minZoom;this._maxZoom=this._map.config.maxZoom;if(T==BMAP_PERSPECTIVE_MAP||this._minZoom!=T.getMinZoom()||this._maxZoom!=T.getMaxZoom()){this._isShowLevelHint=false}else{this._isShowLevelHint=true}if(this._container){this._container.style.width=this._getControlHeight(0).width+"px"}if(!this._opts.showZoomInfo){this._isShowLevelHint=false}this._totalZoomLv=this._maxZoom-this._minZoom+1;this._maxBarY=this._minBarY+(this._totalZoomLv-1)*this._sliderInterval},_render:function(){cp.prototype._render.call(this);var cM=a8.browser.ie==6?" BMap_ie6":"";var cL=" BMap_stdMpType"+this._opts.type;var cN=this._container;a8.dom.addClass(cN,"BMap_stdMpCtrl");a8.dom.addClass(cN,cM);a8.dom.addClass(cN,cL);cN.innerHTML=this._generateHtml(this._opts.type);this._setSliderBarCursor(a8.browser.opera?"pointer":cc.defaultCursor);this._panBtnContainer=a8.g(cN.children[0]);this._zoomDom=a8.g(cN.children[1]);var T=this._zoomDom;this._btnZoomIn=a8.g(T.children[0]);this._btnZoomOut=a8.g(T.children[1]);this._sliderDom=a8.g(T.children[2]);this._sliderBaseDom=a8.g(T.children[2].children[0]);this._sliderBotDom=a8.g(T.children[2].children[1]);this.setType(this._opts.type)},_setSliderHeight:function(){var cS=this._opts.type;var T=this._getControlHeight(cS);var cQ=T.width;var cL=T.height;var cO=T.zoomHeight;var cR=T.zoomWidth;var cM=T.sliderHeight;var cP=T.sliderCHeight;var cN=(this._maxTotalZoomLv-this._totalZoomLv)*this._sliderInterval;if(this._opts.type==BMAP_NAVIGATION_CONTROL_LARGE){cL=cL-cN>=0?cL-cN:0;cO=cO-cN>=0?cO-cN:0;cM=cM-cN>=0?cM-cN:0}this._container.style.width=cQ+"px";this._container.style.height=cL+"px";this._zoomDom.style.height=cO+"px";this._zoomDom.style.width=cQ+"px";this._btnZoomOut.style.top=cO-21+"px";this._sliderDom.style.height=cM+"px";this._sliderBaseDom.style.height=cM+"px";if(this._opts.type==BMAP_NAVIGATION_CONTROL_ZOOM){this._zoomDom.children[0].style.left=this._zoomDom.children[1].style.left="0"}else{this._zoomDom.children[0].style.left=this._zoomDom.children[1].style.left=""}},_getControlHeight:function(cL){var T=62;if(!this._opts.showZoomInfo||this._map.getMapType()==BMAP_PERSPECTIVE_MAP){T=37}var cM=[{width:T,height:204,zoomHeight:159,zoomWidth:37,sliderHeight:120,sliderCHeight:120},{width:37,height:97,zoomHeight:42,zoomWidth:37,sliderHeight:0,sliderCHeight:0},{width:37,height:57,zoomHeight:0,zoomWidth:0,sliderHeight:0,sliderCHeight:0},{width:22,height:42,zoomHeight:42,zoomWidth:18,sliderHeight:0,sliderCHeight:0}];return cM[cL]},_generateHtml:function(){var T=[];T.push(this._generatePanHtml());T.push(this._generateZoomContainerHtml());return T.join("")},_generatePanHtml:function(){var T=\'<div class="BMap_stdMpPan"><div class="BMap_button BMap_panN" title="\u5411\u4e0a\u5e73\u79fb"></div><div class="BMap_button BMap_panW" title="\u5411\u5de6\u5e73\u79fb"></div><div class="BMap_button BMap_panE" title="\u5411\u53f3\u5e73\u79fb"></div><div class="BMap_button BMap_panS" title="\u5411\u4e0b\u5e73\u79fb"></div><div class="BMap_stdMpPanBg BMap_smcbg"></div></div>\';return T},_generateZoomContainerHtml:function(){var T=\'<div class="BMap_stdMpZoom">\'+this._generateZoomHtml()+this._generateSliderHtml()+this._generateZoomBalloonHtml()+"</div>";return T},_generateZoomHtml:function(){var T=\'<div class="BMap_button BMap_stdMpZoomIn" title="\u653e\u5927\u4e00\u7ea7"><div class="BMap_smcbg"></div></div><div class="BMap_button BMap_stdMpZoomOut" title="\u7f29\u5c0f\u4e00\u7ea7"><div class="BMap_smcbg"></div></div>\';return T},_generateSliderHtml:function(){var T=\'<div class="BMap_stdMpSlider"><div class="BMap_stdMpSliderBgTop"><div class="BMap_smcbg"></div></div><div class="BMap_stdMpSliderBgBot"></div><div class="BMap_stdMpSliderMask" title="\u653e\u7f6e\u5230\u6b64\u7ea7\u522b"></div><div class="BMap_stdMpSliderBar" title="\u62d6\u52a8\u7f29\u653e"><div class="BMap_smcbg"></div></div></div>\';return T},_generateZoomBalloonHtml:function(){var T=\'<div class="BMap_zlHolder"><div class="BMap_zlSt"><div class="BMap_smcbg"></div></div><div class="BMap_zlCity"><div class="BMap_smcbg"></div></div><div class="BMap_zlProv"><div class="BMap_smcbg"></div></div><div class="BMap_zlCountry"><div class="BMap_smcbg"></div></div></div>\';return T},_getElementByClassNamePattern:function(cO){var cN=this._getElementByClassNamePattern;if(typeof(cN.cache)==="undefined"){cN.cache=me._container.getElementsByTagName("*")}var cL=cN.cache,cM=null,T=cL.length,cP=null;for(cM=0;cM<T;++cM){cP=cL[cM];if(cP.className.toString().match(cO)){return cP}}throw Error(String(cO)+" Not found!")},setType:function(T){if(aK(T)&&T>=BMAP_NAVIGATION_CONTROL_LARGE&&T<=BMAP_NAVIGATION_CONTROL_ZOOM){this._opts.type=T}else{this._opts.type=BMAP_NAVIGATION_CONTROL_LARGE}if(!this._map||!this._container){return}var cL=this._container;cL.className=cL.className.replace(/BMap_stdMpType[0-3]*/,"BMap_stdMpType"+this._opts.type);this._setSliderHeight();if(T!=BMAP_NAVIGATION_CONTROL_LARGE){a8.dom.removeClass(cL.children[1].children[2],"hvr")}this.setAnchor(this._opts.anchor)},getType:function(){return this._opts.type},_bind:function(){var cR=this;var cQ=cR._container;a8.on(this._zoomDom,"mouseover",function(){if(!cR._isShowLevelHint){return}cR._msover=true;if(cR._hideTimerId){clearTimeout(cR._hideTimerId);cR._hideTimerId=null}cR._showLevelHint()});a8.on(this._zoomDom,"mouseout",function(){if(!cR._isShowLevelHint){return}if(cR._hideTimerId){clearTimeout(cR._hideTimerId)}cR._msover=false;cR._hideTimerId=setTimeout(function(){cR._hideLevelHint();cR._hideTimerId=null},1000)});a8.on(cQ.children[0],"mouseover",function(){cR._hideLevelHint(true)});a8.on(cQ.children[0].children[0],"click",function(){cR._panBy(0,Math.round(cR._map.height/3))});a8.on(cQ.children[0].children[1],"click",function(){cR._panBy(Math.round(cR._map.width/3),0)});a8.on(cQ.children[0].children[2],"click",function(){cR._panBy(-Math.round(cR._map.width/3),0)});a8.on(cQ.children[0].children[3],"click",function(){cR._panBy(0,-Math.round(cR._map.height/3))});a8.on(cQ.children[0].children[0],"mouseover",function(){cR._panBtnContainer.style.backgroundPosition="0 -44px"});a8.on(cQ.children[0].children[1],"mouseover",function(){cR._panBtnContainer.style.backgroundPosition="0 -176px"});a8.on(cQ.children[0].children[2],"mouseover",function(){cR._panBtnContainer.style.backgroundPosition="0 -88px"});a8.on(cQ.children[0].children[3],"mouseover",function(){cR._panBtnContainer.style.backgroundPosition="0 -132px"});a8.on(cR._panBtnContainer,"mouseout",function(){cR._panBtnContainer.style.backgroundPosition="0 0"});var cO=cQ.children[1].children;a8.on(cO[0],"click",function(){cR._zoomIn()});a8.on(cO[1],"click",function(){cR._zoomOut()});for(var cM=0;cM<5;cM++){a8.on(cQ.children[0].children[cM],"mouseup",function(cT){if((cR._map.currentOperation&bn.stdMapCtrlDrag)==0&&(cR._map.currentOperation&bn.drag)==0){aP(cT)}});a8.on(cQ.children[0].children[cM],"contextmenu",function(cT){cC(cT)});a8.on(cQ.children[0].children[cM],"click",function(cT){cC(cT)})}a8.on(cO[0],"mouseup",function(cT){if((cR._map.currentOperation&bn.stdMapCtrlDrag)==0&&(cR._map.currentOperation&bn.drag)==0){aP(cT)}});a8.on(cO[1],"mouseup",function(cT){if((cR._map.currentOperation&bn.stdMapCtrlDrag)==0&&(cR._map.currentOperation&bn.drag)==0){aP(cT)}});a8.on(cO[0],"contextmenu",function(cT){cC(cT)});a8.on(cO[1],"contextmenu",function(cT){cC(cT)});var cS=cQ.children[1].children[2].children[2];a8.on(cS,"mouseup",function(cT){if((cR._map.currentOperation&bn.stdMapCtrlDrag)==0&&(cR._map.currentOperation&bn.drag)==0){aP(cT)}});a8.on(cO[0],"click",function(cT){aP(cT)});a8.on(cO[1],"click",function(cT){aP(cT)});a8.on(cO[0],"mouseover",function(){cO[0].style.backgroundPosition="0 -243px"});a8.on(cO[0],"mouseout",function(){if((cR._map.currentOperation&bn.stdMapCtrlDrag)==0){cO[0].style.backgroundPosition="0 -221px"}});a8.on(cO[1],"mouseover",function(){cO[1].style.backgroundPosition="0 -287px"});a8.on(cO[1],"mouseout",function(){if((cR._map.currentOperation&bn.stdMapCtrlDrag)==0){cO[1].style.backgroundPosition="0 -265px"}});a8.on(cS,"click",function(cT){aP(cT)});var cP=cQ.children[1].children[2].children[3];a8.on(cP,"mouseup",function(cT){if(cT.button==2){aP(cT)}});a8.on(cP,"contextmenu",function(cT){cC(cT)});a8.on(this._zoomDom.children[3].children[0],"click",function(cT){cR._map.zoomTo(18)});a8.on(this._zoomDom.children[3].children[1],"click",function(cT){cR._map.zoomTo(12)});a8.on(this._zoomDom.children[3].children[2],"click",function(cT){cR._map.zoomTo(8)});a8.on(this._zoomDom.children[3].children[3],"click",function(cT){cR._map.zoomTo(4)});a8.on(cS,"mousedown",function(cU){cU=window.event||cU;var cT=cU.layerY||cU.offsetY||0;var cV=0;cV=(cR._maxZoom+1)-Math.round(cR._totalZoomLv*parseFloat(cT/(cR._totalZoomLv*cR._sliderInterval)));cR._map.zoomTo(cV)});a8.on(cP,"mouseover",function(){a8.dom.addClass(cP,"h")});a8.on(cP,"mouseout",function(){if((cR._map.currentOperation&bn.stdMapCtrlDrag)==0){a8.dom.removeClass(cP,"h")}});var cN=function(cT){var cT=window.event||cT;if(cT.button==2){return}if((a8.browser.ie&&cT.button!=1)){return}if(cP.setCapture){cP.setCapture()}cR._map.currentOperation|=bn.stdMapCtrlDrag;cR._bind.my=cT.pageY||cT.clientY||0;if(!a8.browser.opera){cR._setSliderBarCursor(cc.draggingCursor)}a8.on(document,"mousemove",T);a8.on(document,"mouseup",cL);aP(cT);return cC(cT)};var T=function(cU){if((cR._map.currentOperation&bn.stdMapCtrlDrag)!=0){var cU=window.event||cU;var cV=cU.pageY||cU.clientY;var cT=cR._curBarY+cV-cR._bind.my;if(cT<cR._minBarY){cT=cR._minBarY}else{if(cT>cR._maxBarY){cT=cR._maxBarY}}cP.style.top=cT+"px";cR._sliderBotDom.style.top=cT+"px";cR._sliderBotDom.style.height=parseInt(cR._sliderBaseDom.style.height)-cT+4+"px"}};var cL=function(cU){if((cR._map.currentOperation&bn.stdMapCtrlDrag)!=0){var cT=a8.g(cP);cR._curBarY=parseInt(cT.style.top);a8.dom.removeClass(cP,"h");cR._map.currentOperation&=~bn.stdMapCtrlDrag;if(cQ&&cP&&cP.releaseCapture){cP.releaseCapture()}if(!a8.browser.opera){cR._setSliderBarCursor(cc.defaultCursor)}var cV=(cR._maxZoom+1)-Math.round(parseFloat(cR._curBarY-cR._minBarY)/parseFloat(cR._maxBarY-cR._minBarY)*(cR._totalZoomLv-1)+1);cR._map.zoomTo(cV);a8.un(document,"mousemove",T);a8.un(document,"mouseup",cL)}};a8.on(cP,"mousedown",cN)},_setSliderBarCursor:function(T){this._container.children[1].children[2].children[3].style.cursor=T},_panBy:function(cL,T){this._map.panBy(cL,T)},_zoomIn:function(){this._map.zoomIn()},_zoomOut:function(){this._map.zoomOut()},_setSliderZoomLv:function(cL){if(!this._container||this.getType()!=BMAP_NAVIGATION_CONTROL_LARGE){return}var T=(this._maxZoom-cL)*this._sliderInterval+this._minBarY;this._curBarY=T>this._maxBarY?this._maxBarY:T<this._minBarY?this._minBarY:T;this._container.children[1].children[2].children[3].style.top=this._curBarY+"px";this._sliderBotDom.style.top=this._curBarY+"px";this._sliderBotDom.style.height=parseInt(this._sliderBaseDom.style.height)-this._curBarY+4+"px"},_hideLevelHint:function(T){if(this._opts.type==0){a8.dom.removeClass(this._container.children[1].children[3],"hvr")}if(T&&this._hideTimerId){clearTimeout(this._hideTimerId);this._hideTimerId=null}},_showLevelHint:function(){if(this._opts.type==0&&this._opts.showZoomInfo){a8.dom.addClass(this._container.children[1].children[3],"hvr")}},show:function(){cp.prototype.show.call(this);if(a8.browser.ie<8){var T=this;setTimeout(function(){T.setType(T._opts.type)},1)}}});a8.extend(am.prototype,{_asyncDraw:function(){if(this._map){this._i(this._map)}},initialize:function(T){cp.prototype.initialize.call(this,T);this._render();this._updateState();this._bind(T);return this._container},_bind:function(cL){var T=this;cL.addEventListener("load",function(cM){T._updateState()});cL.addEventListener("moveend",function(cM){T._updateState()});cL.addEventListener("zoomend",function(cM){T._updateState()});cL.addEventListener("maptypechange",function(){if(T._container){T._container.style.color=T._map.getMapType().getTextColor()}})},_render:function(){cp.prototype._render.call(this);a8.dom.addClass(this._container,"BMap_cpyCtrl");var T=this._container.style;T.cursor="default";T.whiteSpace="nowrap";T.MozUserSelect="none";T.color=this._map.getMapType().getTextColor();T.background="none";T.font="11px/15px "+cc.fontFamily;cp.prototype._setPosition.call(this)},_updateState:function(){if(!this._map||!this._container||this._copyrightCollection.length==0){return}for(var cO=0,cM=this._copyrightCollection.length;cO<cM;cO++){var cL;var T=this._map.getZoom();var cS=this._map.pixelToPoint({x:0,y:0});var cR=this._map.pixelToPoint({x:this._map.width,y:this._map.height});var cQ=new bN(cS,cR);if(this._copyrightCollection[cO].bounds&&cQ.intersects(this._copyrightCollection[cO].bounds)==null){cL=false}else{cL=true}if(cL){if(this._container){var cT=false;for(var cN=0,cP=this._container.children.length;cN<cP;cN++){if(this._container.children[cN].getAttribute("_cid")==this._copyrightCollection[cO].id){cT=true;this._container.children[cN].style.display="inline";if(this._container.children[cN].innerHTML!=this._copyrightCollection[cO].content){this._container.children[cN].innerHTML=this._copyrightCollection[cO].content}break}}if(!cT){this._generateHTML(this._copyrightCollection[cO])}}}else{if(this._container){for(var cN=0;cN<this._container.children.length;cN++){if(this._container.children[cN].getAttribute("_cid")==this._copyrightCollection[cO].id&&this._container.children[cN].style.display!="none"){this._container.children[cN].style.display="none";return}}}}}},addCopyright:function(cM){if(!cM||!aK(cM.id)||isNaN(cM.id)){return}var T={bounds:null,content:""};for(var cL in cM){T[cL]=cM[cL]}var cN=this.getCopyright(cM.id);if(cN){for(var cO in T){cN[cO]=T[cO]}}else{this._copyrightCollection.push(T)}this._updateState()},getCopyright:function(cM){for(var cL=0,T=this._copyrightCollection.length;cL<T;cL++){if(this._copyrightCollection[cL].id==cM){return this._copyrightCollection[cL]}}},getCopyrightCollection:function(){return this._copyrightCollection},removeCopyright:function(cO){var cM;for(var cL=0,T=this._copyrightCollection.length;cL<T;cL++){if(this._copyrightCollection[cL].id==cO){cM=this._copyrightCollection.splice(cL,1);cL--;T=this._copyrightCollection.length}}var cN=this.getDom(cO);if(cN&&cN.parentNode){cN.parentNode.removeChild(cN);cN=null}this._updateState();return cM},_generateHTML:function(T){if(!this._container){return}this._container.innerHTML+="<span _cid=\'"+T.id+"\'>"+T.content+"</span>"},getDom:function(cN){var cM=cp.prototype.getDom.call(this);if(!ch(cN)){return cM}else{if(cM){for(var cL=0,T=cM.children.length;cL<T;cL++){if(cM.children[cL].getAttribute("_cid")==cN){return cM.children[cL]}}}}}});a8.object.extend(cK.prototype,{_asyncDraw:function(){if(this._map){this._i(this._map)}},initialize:function(T){cp.prototype.initialize.call(this,T);this._initParam();this._render();this._bind();this._initOverviewMap();a8.on(this._container,"click",aP);a8.on(this._container,"dblclick",aP);a8.on(this._container,"mousewheel",aP);a8.on(this._container,"mouseup",function(cL){cL=window.event||cL;if(cL.button==2){aP(cL)}});if(window.addEventListener){this._container.addEventListener("DOMMouseScroll",function(cL){aP(cL)},true)}return this._container},_initParam:function(){if(this._init){return}this._init=true;this._omCanvas;this._omMapContainer;this._omView;this._omViewMv;this._omBtn;this._borderWidth=1;this._quad=4;this._overviewMap=null;this._minZoom=-1;this._maxZoom=-1;this._curOMZoomLevel=-1;this._wRatio=1;this._hRatio=1;this._temp={};this._currentOp="";this._overviewInitialized=false},_getCurOMZoomLevel:function(){if(!this._map){return}var T=this._map.zoomLevel;var cL=T-this._opts.zoomInterval;if(cL<this._minZoom){return this._minZoom}else{if(cL>this._maxZoom){return this._maxZoom}else{return cL}}return -1},_render:function(){cp.prototype._render.call(this);var T=a8.browser.ie!=false?" BMap_ie"+a8.browser.ie:"";var cL=this._container;cL.innerHTML=this._generateHTML();a8.dom.addClass(cL,"BMap_omCtrl"+T);this._omCanvas=cL.children[0].children[0];this._omMapContainer=this._omCanvas.children[0];this._omViewMv=this._omCanvas.children[1];this._omViewMvInn=this._omViewMv.children[0];this._omBtn=cL.children[1];this.setSize(this._opts.size);this._omViewMv.style.cursor=cc.defaultCursor},_generateHTML:function(){var T=[\'<div class="BMap_omOutFrame"><div class="BMap_omInnFrame">\',\'<div class="BMap_omMapContainer"></div>\',\'<div class="BMap_omViewMv"><div class="BMap_omViewInnFrame"><div></div></div></div>\',\'</div></div><div class="BMap_omBtn"></div>\'];return T.join("")},_bind:function(){var T=this;a8.on(this._omBtn,"click",function(){T.changeView()});if(a8.browser.ie){a8.on(this._omBtn,"dblclick",function(){T.changeView()})}if(!a8.browser.ie||a8.browser.ie>6){this._omBtn.onmouseover=function(cL){a8.dom.addClass(T._omBtn,"hover")};this._omBtn.onmouseout=function(cL){a8.dom.removeClass(T._omBtn,"hover")}}a8.on(this._omViewMv,"mousedown",function(cL){if(T._omViewMv&&ch(T._omViewMv._drag)&&T._omViewMv._drag=="true"){return}cL=window.event||cL;if(cL.button==2){return}T._omViewMv._drag="true";var cL=window.event||cL;if(T._omViewMv.setCapture){T._omViewMv.setCapture()}T._bind.iniX=parseInt(aJ(T._omViewMv).left);T._bind.iniY=parseInt(aJ(T._omViewMv).top);T._bind.mx=cL.pageX||cL.clientX;T._bind.my=cL.pageY||cL.clientY;T._bind.i=0;T._bind.j=0;T._setViewMvCursor(cc.draggingCursor);aP(cL);return cC(cL)});a8.on(document,"mousemove",function(cR){if(T._omViewMv&&T._omViewMv._drag=="true"){var cR=window.event||cR;var cL=cR.pageX||cR.clientX;var cS=cR.pageY||cR.clientY;T._bind.curX=T._bind.iniX+cL-T._bind.mx;T._bind.curY=T._bind.iniY+cS-T._bind.my;var cQ=3;T._bind._moveX=0;T._bind._moveY=0;if(T._bind.curX<=0){T._bind._moveX=cQ}if(T._bind.curY<=0){T._bind._moveY=cQ}if(T._bind.curX+T._omViewMv.offsetWidth>=T._overviewMap.width){T._bind._moveX=-cQ}if(T._bind.curY+T._omViewMv.offsetHeight>=T._overviewMap.height){T._bind._moveY=-cQ}T._omViewMv.style.left=T._bind.curX+"px";T._omViewMv.style.top=T._bind.curY+"px";if((T._bind._moveX!=0||T._bind._moveY!=0)&&!T._bind.intervalId){T._bind._mapMoving=true;var cP=T._overviewMap.offsetX;var cN=T._overviewMap.offsetY;var cO=cP+T._bind._moveX;var cM=cN+T._bind._moveY;T._overviewMap._setPlatformPosition(cO,cM);T._bind.intervalId=setInterval(function(){var cU=T._bind._moveX!=0?(T._bind._moveX>0?T._bind.i+=cQ:T._bind.i-=cQ):T._bind.i;var cT=T._bind._moveY!=0?(T._bind._moveY>0?T._bind.j+=cQ:T._bind.j-=cQ):T._bind.j;T._overviewMap._setPlatformPosition(cO+cU,cM+cT)},30)}if(T._bind._moveX==0&&T._bind._moveY==0){clearInterval(T._bind.intervalId);delete T._bind.intervalId;T._bind.i=0;T._bind.j=0}aP(cR);return cC(cR)}});a8.on(document,"mouseup",function(cO){if(T._omViewMv&&T._omViewMv._drag=="true"){T._omViewMv._drag="";T._setViewMvCursor(cc.defaultCursor);if(T._omViewMv.releaseCapture){T._omViewMv.releaseCapture()}if(T._bind.initX==T._bind.curX&&T._bind.initY==T._bind.curY){aP(cO);return cC(cO)}T._currentOp="dragView";T._overviewMap.config.enableMouseDown=false;T._map.temp.operating=true;if(!ch(T._bind.curX)||!ch(T._bind.curY)){return}var cN=T._bind.curX+parseInt(T._omViewMv.style.width)/2+1;var cM=T._bind.curY+parseInt(T._omViewMv.style.height)/2+1;delete T._bind.curX;delete T._bind.curY;var cL=T._overviewMap.pixelToPoint({x:cN,y:cM},T._overviewMap.zoomLevel);T._map.temp.operating=false;if(T._bind._mapMoving==true){clearInterval(T._bind.intervalId);delete T._bind.intervalId;T._bind._mapMoving=false}T._map.temp.operating=true;setTimeout(function(){T._map.temp.operating=false;T._map.panTo(cL)},50);aP(cO);return cC(cO)}})},_initOverviewMap:function(){if(this._overviewInitialized==true){return}var cM=this;var cN=cM._map;cN.addEventListener("resize",function(){if(cM._overviewMap!=null){cM._overviewMap.setCenter(cN.getCenter())}if(cM._omView!=null){cM._omView.setPosition(cN.getCenter());cM._setRatio()}cM.setAnchor(cM._opts.anchor)});if(this._opts.isOpen==false){return}if(!this._binded){cN.addEventListener("loadcode",function(){cM._onMainZoomEnd()});cN.addEventListener("moving",function(){cM._moveView()});cN.addEventListener("moveend",function(cO){cM._onMainMoveEnd(cO)});cN.addEventListener("zoomend",function(cO){cM._onMainZoomEnd(cO)});cN.addEventListener("maptypechange",function(cO){cM._setRatio()});this._binded=true}var T=cN.getCenter();this._minZoom=BMAP_NORMAL_MAP.getMinZoom();this._maxZoom=BMAP_NORMAL_MAP.getMaxZoom();this._curOMZoomLevel=this._getCurOMZoomLevel();this._overviewMap=new bz(this._omMapContainer,{isOverviewMap:true});this._overviewMap.disableDoubleClickZoom();this._overviewMap.centerAndZoom(T,this._curOMZoomLevel);this._omView=new n({point:cN.getCenter(),lineStroke:1,lineColor:"#6688cc"});this._overviewMap.addOverlay(this._omView);this._omView.getContainer().innerHTML=\'<div class="BMap_omViewInnFrame"><div class="BMap_omViewMask"></div></div>\';this._omViewInn=this._omView.getContainer().children[0];var cL=this._omView.getContainer().style;cL.borderLeftColor="#84b0df";cL.borderTopColor="#adcff4";cL.borderRightColor="#274b8b";cL.borderBottomColor="#274b8b";this._setRatio();this._overviewMap.addEventListener("dragend",function(){cM._currentOp="dragMap";cN.panTo(cM._overviewMap.getCenter())});this._overviewMap.addEventListener("moveend",function(){cM._onViewMapMoveEnd()});this._overviewMap.addEventListener("mousedown",function(cO){cM._temp._downX=cO.offsetX;cM._temp._downY=cO.offsetY});this._overviewMap.addEventListener("resize",function(cO){if(cM._map&&cM._overviewMap){cM._overviewMap.setCenter(cM._map.getCenter())}cM._setRatio()});this._overviewInitialized=true},_setViewMvCursor:function(T){this._omViewMv.style.cursor=T},setAnchor:function(cO){cp.prototype.setAnchor.call(this,cO);if(!this._map){return}if(a8.browser.ie){var cR=this._map.width;var cN=this._map.height;var cL=this._opts.size.width;var cP=this._opts.size.height;var cM=this._opts.offset.width;var T=this._opts.offset.height;if(this._opts.isOpen==false){cL=this._btnWidth;cP=this._btnHeight}var cQ=this._container;switch(cO){case BMAP_ANCHOR_TOP_RIGHT:cQ.style.right="auto";cQ.style.left=cR-cL-cM+"px";break;case BMAP_ANCHOR_BOTTOM_LEFT:cQ.style.bottom="auto";cQ.style.top=cN-cP-T+"px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:cQ.style.bottom="auto";cQ.style.right="auto";cQ.style.top=cN-cP-T+"px";cQ.style.left=cR-cL-cM+"px";break;default:break}}this._setQuad();this._redraw()},changeView:function(){this.changeView._running=true;this._opts.isOpen=!this._opts.isOpen;if(!this._container){this.changeView._running=false;return}var cP=this._container;var T=this._opts.size.width;var cM=this._opts.size.height;var cO=this._btnWidth;var cL=this._btnHeight;var cN=this;if(!this._opts.isOpen){this.changeView._preBtnTop=this._omBtn.style.top;this.changeView._preBtnLeft=this._omBtn.style.left;new g({fps:25,duration:120,transition:aw.easeInCubic,render:function(cQ){cP.style.width=(T-Math.ceil((T-cO)*cQ))+"px";cP.style.height=(cM-Math.ceil((cM-cL)*cQ))+"px";if(a8.browser.ie){cN._omBtn.style.top=(cN._quad==3||cN._quad==4)?parseInt(cP.style.height)-cL+"px":"0";cN._omBtn.style.left=(cN._quad==1||cN._quad==4)?parseInt(cP.style.width)-cO+"px":"0";if(cN._opts.anchor>=0&&cN._opts.anchor<=BMAP_ANCHOR_BOTTOM_RIGHT){if(cN._quad==3||cN._quad==4){cP.style.top=cN._map.height-parseInt(cP.style.height)-cN._opts.offset.height+"px"}if(cN._quad==1||cN._quad==4){cP.style.left=cN._map.width-parseInt(cP.style.width)-cN._opts.offset.width+"px"}}}cN.dispatchEvent(new bg("onviewchanging"))},finish:function(){if(a8.browser.ie){cN._omBtn.style.left="0";cN._omBtn.style.top="0";if(cN._opts.anchor>=0&&cN._opts.anchor<=BMAP_ANCHOR_BOTTOM_RIGHT){if(cN._quad==3||cN._quad==4){cP.style.top=cN._map.height-cN._btnHeight-cN._opts.offset.height+"px"}if(cN._quad==1||cN._quad==4){cP.style.left=cN._map.width-cN._btnWidth-cN._opts.offset.width+"px"}}}cN._redraw();a8.dom.addClass(cN._omBtn,"BMap_omBtnClosed");var cQ=new bg("onviewchanged");cQ.isOpen=cN._opts.isOpen;cN.dispatchEvent(cQ);cN.changeView._running=false}})}else{if(this._overviewInitialized==false){this._initOverviewMap()}new g({fps:40,duration:120,transition:aw.easeOutCubic,render:function(cQ){cP.style.width=(Math.ceil(T*cQ))+"px";cP.style.height=(Math.ceil(cM*cQ))+"px";if(a8.browser.ie){cN._omBtn.style.top=(cN._quad==3||cN._quad==4)?parseInt(cP.style.height)-cL+"px":"0";cN._omBtn.style.left=(cN._quad==1||cN._quad==4)?parseInt(cP.style.width)-cO+"px":"0";if(cN._opts.anchor>=0&&cN._opts.anchor<=BMAP_ANCHOR_BOTTOM_RIGHT){if(cN._quad==3||cN._quad==4){cP.style.top=cN._map.height-parseInt(cP.style.height)-cN._opts.offset.height+"px"}if(cN._quad==1||cN._quad==4){cP.style.left=cN._map.width-parseInt(cP.style.width)-cN._opts.offset.width+"px"}}}cN.dispatchEvent(new bg("onviewchanging"))},finish:function(){if(cN._opts.anchor>=0&&cN._opts.anchor<=BMAP_ANCHOR_BOTTOM_RIGHT){if(a8.browser.ie){if(cN._quad==3||cN._quad==4){cP.style.top=cN._map.height-cM-cN._opts.offset.height+"px"}if(cN._quad==1||cN._quad==4){cP.style.left=cN._map.width-T-cN._opts.offset.width+"px"}}}cN._redraw();cN._setBtnPosition();a8.dom.removeClass(cN._omBtn,"BMap_omBtnClosed");var cQ=new bg("onviewchanged");cQ.isOpen=cN._opts.isOpen;cN.dispatchEvent(cQ);cN.changeView._running=false}})}},_setRatio:function(){if(!this._map){return}var cQ=this._map.zoomLevel;var cS=this._map.pixelToPoint({x:0,y:0},cQ);var cN=this._map.pixelToPoint({x:this._map.width,y:this._map.height},cQ);var cL=this._overviewMap.pixelToPoint({x:0,y:0},this._curOMZoomLevel);var cM=this._overviewMap.pixelToPoint({x:this._overviewMap.width,y:this._overviewMap.height},this._curOMZoomLevel);this._wRatio=(cN.lng-cS.lng)/(cM.lng-cL.lng);this._hRatio=(cN.lat-cS.lat)/(cM.lat-cL.lat);if(this._wRatio>=1||this._hRatio>=1){this._omViewMv.style.display="none";this._omView.hide()}else{var cO=parseInt(this._overviewMap.width);var T=parseInt(this._overviewMap.height);var cR=Math.round(cO*this._wRatio);var cP=Math.round(T*this._hRatio);if(this._map.getMapType()==BMAP_PERSPECTIVE_MAP){cP=T*0.35}this._omView.show();this._omView.setDimension(cR,cP);this._omViewMv.style.display=""}this._setOMViewMvPos()},_setOMViewMvPos:function(){if(!this._omView||!this._omView.getContainer()){return}if(this._wRatio>=1||this._hRatio>=1){this._omViewMv.style.display="none";return}var cL=this._omView.getContainer().style;this._omViewMv.style.display="";this._omViewMv.style.width=cL.width;this._omViewMv.style.height=cL.height;var T=parseInt(cL.width)-2;var cM=parseInt(cL.height)-2;T=T<0?0:T;cM=cM<0?0:cM;this._omViewMvInn.style.width=T+"px";this._omViewMvInn.style.height=cM+"px";this._omViewInn.style.width=this._omViewMvInn.style.width;this._omViewInn.style.height=this._omViewMvInn.style.height;this._omViewMv.style.left=parseInt(cL.left)+this._overviewMap.offsetX+"px";this._omViewMv.style.top=parseInt(cL.top)+this._overviewMap.offsetY+"px"},setSize:function(cM){if(!(cM instanceof aH)){cM=new aH(150,150)}var cL=cM.width;var cN=cM.height;cL=cL>0?cL:150;cN=cN>0?cN:150;cM.width=cL;cM.height=cN;this._opts.size=cM;if(!this._container){return}if(this.changeView._running==true){var T=arguments;var cO=this;setTimeout(function(){T.callee.call(cO,cM)},120);return}N(this._container,[cL,cN]);var cO=this;setTimeout(function(){if(cO._overviewMap&&cO._map){cO._overviewMap.setCenter(cO._map.getCenter())}},100);this.setAnchor(this._opts.anchor);this.dispatchEvent(new bg("resize"))},setOffset:function(T){if(!(T instanceof aH)){return}cp.prototype.setOffset.call(this,T);if(!this._container){return}if(T.width!=0||T.height!=0){a8.dom.addClass(this._container,"withOffset")}else{a8.dom.removeClass(this._container,"withOffset")}},_redraw:function(){if(!this._omCanvas){return}var cM=this._opts.size.width;var cP=this._opts.size.height;var cR=this._opts.padding;var T=this._borderWidth;var cN=0;var cQ=0;var cL=0;var cO=0;this._omCanvas.style.left=this._omCanvas.style.top=this._omCanvas.style.right=this._omCanvas.style.bottom="auto";this._omBtn.style.left=this._omBtn.style.top=this._omBtn.style.right=this._omBtn.style.bottom="auto";if(this._opts.offset.width==0&&this._opts.offset.height==0){switch(this._opts.anchor){case BMAP_ANCHOR_TOP_LEFT:this._omCanvas.style.left="0px";this._omCanvas.style.top="0px";break;case BMAP_ANCHOR_TOP_RIGHT:this._omCanvas.style.left=cR+"px";this._omCanvas.style.top="0px";break;case BMAP_ANCHOR_BOTTOM_LEFT:this._omCanvas.style.top=cR+"px";this._omCanvas.style.left="0px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:this._omCanvas.style.top=cR+"px";this._omCanvas.style.left=cR+"px";break;default:break}cN=cM-T;cQ=cP-T;cL=cN-cR-2*T;cO=cQ-cR-2*T;if(a8.browser.ie&&document.compatMode=="BackCompat"){cN=cN+1;cQ=cQ+1;cL=cL+2;cO=cO+2}}else{this._omCanvas.style.left=this._omCanvas.style.top=this._omCanvas.style.right=this._omCanvas.style.bottom=cR+"px";cN=cM-2*T;cQ=cP-2*T;cL=cN-2*cR-2*T;cO=cQ-2*cR-2*T;if(this._opts.offset.width!=0||this._opts.offset.height!=0){a8.dom.addClass(this._container,"withOffset")}if(a8.browser.ie&&document.compatMode=="BackCompat"){cN=cN+2;cQ=cQ+2;cL=cL+2;cO=cO+2}}if(cN>0&&cQ>0){N(this._container.children[0],[cN,cQ])}if(cL>0&&cO>0){N(this._omCanvas,[cL,cO])}this._setBtnPosition();a8.dom.removeClass(this._omBtn,"BMap_omBtnClosed");if(!this._opts.isOpen){this._container.style.width=this._btnWidth+"px";this._container.style.height=this._btnHeight+"px";if(a8.browser.ie){this.changeView._preBtnTop=this._omBtn.style.top;this.changeView._preBtnLeft=this._omBtn.style.left;this._omBtn.style.left="0";this._omBtn.style.top="0"}a8.dom.addClass(this._omBtn,"BMap_omBtnClosed")}},_setQuad:function(){var cL=this._container;if(!cL){return}var T=this._quad;switch(this._opts.anchor){case BMAP_ANCHOR_TOP_LEFT:this._quad=2;break;case BMAP_ANCHOR_TOP_RIGHT:this._quad=1;break;case BMAP_ANCHOR_BOTTOM_LEFT:this._quad=3;break;case BMAP_ANCHOR_BOTTOM_RIGHT:this._quad=4;break;default:break}a8.dom.removeClass(cL,"quad"+T);a8.dom.addClass(cL,"quad"+this._quad)},_setBtnPosition:function(){if(!a8.browser.ie){switch(this._quad){case 2:this._omBtn.style.top="0";this._omBtn.style.left="0";break;case 1:this._omBtn.style.top="0";this._omBtn.style.right="0";break;case 4:this._omBtn.style.bottom="0";this._omBtn.style.right="0";break;case 3:this._omBtn.style.bottom="0";this._omBtn.style.left="0";break;default:break}}else{var cN=this._btnWidth;var cL=this._btnHeight;var T=this._opts.size.width;var cM=this._opts.size.height;this._omBtn.style.left="auto";this._omBtn.style.top="auto";this._omBtn.style.right="auto";this._omBtn.style.bottom="auto";switch(this._quad){case 2:this._omBtn.style.left="0px";this._omBtn.style.top="0px";break;case 1:this._omBtn.style.left=T-cN+"px";this._omBtn.style.top="0px";break;case 4:this._omBtn.style.top=cM-cL+"px";this._omBtn.style.left=T-cN+"px";break;case 3:this._omBtn.style.left="0px";this._omBtn.style.top=cM-cL+"px";break;default:break}}},_moveView:function(){if(this._omView){this._omView.setPosition(this._map.getCenter())}},_onMainMoveEnd:function(T){switch(this._currentOp){case"dragMap":this._setOMViewMvPos();this._currentOp="";break;case"dragView":this._omViewMv.style.display="none";this._overviewMap.panTo(this._map.getCenter(),{duration:90});this._currentOp="";break;default:if(this._overviewMap){this._overviewMap.panTo(this._map.getCenter(),{duration:90})}break}},_onMainZoomEnd:function(){if(!this._overviewMap){return}var T=this;T._curOMZoomLevel=T._getCurOMZoomLevel();setTimeout(function(){T._overviewMap.centerAndZoom(T._map.getCenter(),T._curOMZoomLevel);T._omView.setPosition(T._map.getCenter());T._setRatio()},100)},_onViewMapMoveEnd:function(){if(this._currentOp!="dragMap"){this._setOMViewMvPos();this._overviewMap.config.enableMouseDown=true}},remove:function(){cp.prototype.remove.call(this);this._omCanvas=null;this._omMapContainer=null;this._omView=null;this._omViewInn=null;this._omViewMv=null;this._omViewMvInn=null;this._omBtn=null;this._overviewInitialized=false;this._overviewMap=null},isOpen:function(){if(!this._container){return false}return this._opts.isOpen}});function N(cM,T){var cL=cM.style;cL.width=T[0]+"px";cL.height=T[1]+"px"}a8.object.extend(bK.prototype,{_asyncDraw:function(){if(this._map){this._i(this._map)}},initialize:function(T){cp.prototype.initialize.call(this,T);this._render();this._setParam();this._updateScale();this._bind(T);return this._container},_setParam:function(){this._numberArray={us:[5280*5000,5280*2500,5280*2000,5280*1000,5280*500,5280*200,5280*100,5280*50,5280*25,5280*20,5280*10,5280*5,5280*2,5280,2000,1000,500,200,100,50,20,10,5],metric:[10000000,5000000,2000000,1000000,500000,200000,100000,50000,25000,20000,10000,5000,2000,1000,500,200,100,50,20,10,5,2,1]}},_bind:function(cL){var T=this;cL.addEventListener("zoomend",function(){T._updateScale()});cL.addEventListener("moveend",function(){T._updateScale()});cL.addEventListener("maptypechange",function(){T.setColor(T._map.getMapType().getTextColor())})},_render:function(){cp.prototype._render.call(this);a8.dom.addClass(this._container,"BMap_scaleCtrl");this._container.innerHTML=this._generateHTML();this.setColor(this._map.getMapType().getTextColor());this._scaleText=this._container.children[0];cp.prototype._setPosition.call(this)},_generateHTML:function(){var cL=cc.imgPath+"mapctrls.png";var T=\'<div class="BMap_scaleTxt" unselectable="on"></div><div class="BMap_scaleBar BMap_scaleHBar"><img style="border:none" src="\'+cL+\'"/></div><div class="BMap_scaleBar BMap_scaleLBar"><img style="border:none" src="\'+cL+\'"/></div><div class="BMap_scaleBar BMap_scaleRBar"><img style="border:none" src="\'+cL+\'"/></div>\';return T},setColor:function(T){this._opts.color=T+"";if(!this._container){return}this._container.children[0].style.backgroundColor="transparent";this._container.children[0].style.color=T;for(var cM=1,cL=this._container.children.length;cM<cL;cM++){this._container.children[cM].style.backgroundColor=T}},setUnit:function(T){this._opts.unit=this._units[T]&&this._units[T].name||this._opts.unit;if(!this._map){return}this._updateScale()},_setScaleText:function(cL,T){this._scaleText.innerHTML=cL+"&nbsp;"+T},_updateScale:function(){if(!this._map||!this._container){return}var cL=10;var cO=new cd(this._map.getCenter().lng,this._map.getCenter().lat+cL);var cP=Math.abs(this._map.pointToPixel(this._map.getCenter()).y-this._map.pointToPixel(cO).y);var cT=ba.getDistanceByLL(this._map.getCenter(),cO)/cP;if(cT==0||isNaN(cT)){return}var cR=this._convertUnit(cT,this._opts.unit);var T=0;var cM=this._units[this._opts.unit].incon;var cQ=this._map.getZoom();var cN=this._numberArray[this._opts.unit][this._map.getZoom()-1];T=cN/cR;var cS=cN>=cM?this._units[this._opts.unit].u2:this._units[this._opts.unit].u1;if(cN>=cM){cN=Math.round(cN/cM)}this._setScaleText(cN,cS);if(Math.round(T)%2!=0&&a8.browser.ie==6){T=T+1}this._container.style.width=Math.round(T)+"px";if(this._map.mapType==BMAP_PERSPECTIVE_MAP){this._container.style.width=Math.round(T)*3+"px";this._setScaleText(cN*3,cS)}},_convertUnit:function(T,cL){cL=cL||"metric";if(this._units[cL]){return T*this._units[cL].conv}return T}});a8.extend(aL.prototype,{_asyncDraw:function(){if(this._map){this._i(this._map)}},initialize:function(T){this._initParams();cp.prototype.initialize.call(this,T);cp.prototype._render.call(this);cp.prototype._setPosition.call(this);switch(this._opts.type){case BMAP_MAPTYPE_CONTROL_DROPDOWN:this._createBtnsDropDown();break;default:this._createBtnsDefault()}this._bind();this._draw();return this._container},_initParams:function(){this._mapTypeRel=[[BMAP_HYBRID_MAP,BMAP_SATELLITE_MAP,true]];this._btnDoms=[];this._lblDoms=[]},_createBtnsDefault:function(){var cL=this._opts.mapTypes;for(var cN=0;cN<cL.length;cN++){if(!this._isMapTypeExist(this._getParentMapType(cL[cN]))){this._createNormalBtn(cL[cN],cN)}}for(var cN=0;cN<cL.length;cN++){if(this._isMapTypeExist(this._getParentMapType(cL[cN]))){this._createLabelBtn(cL[cN],cN)}}var cM=this._btnDoms[0];cM.firstChild.style.borderRadius="3px 0 0 3px";var T=this._btnDoms[this._btnDoms.length-1];T.firstChild.style.borderRight="1px solid #8ba4dc";if(cM==T){T.firstChild.style.borderRadius="3px"}else{T.firstChild.style.borderRadius="0 3px 3px 0"}this._container.style.whiteSpace="nowrap";this._container.style.cursor="pointer"},_isMapTypeExist:function(cL){for(var T=0;T<this._opts.mapTypes.length;T++){if(this._opts.mapTypes[T]==cL){return true}}return false},_getParentMapType:function(cL){for(var T=0;T<this._mapTypeRel.length;T++){if(this._mapTypeRel[T][0]==cL){return this._mapTypeRel[T][1]}}return null},_getInputCheckedInfo:function(cL){for(var T=0;T<this._mapTypeRel.length;T++){if(this._mapTypeRel[T][0]==cL){return this._mapTypeRel[T][2]}}return false},_createNormalBtn:function(cQ,cM){var cP=this;var cN=aa("div");cw(cN);var cO=cN.style;cO.boxShadow="2px 2px 3px rgba(0, 0, 0, 0.35)";cO.borderLeft="1px solid #8ba4dc";cO.borderTop="1px solid #8ba4dc";cO.borderBottom="1px solid #8ba4dc";cO.background="white";cO.padding="2px 6px";cO.font="12px "+cc.fontFamily;cO.lineHeight="1.3em";cO.textAlign="center";cO.whiteSpace="nowrap";cN.innerHTML=cQ.getName();cN.title=cQ.getTips();cN.onclick=function(){cP._map.setMapType(cP._getProperMapType(cQ))};var cL=aa("div");cw(cL);var T=cL.style;if(a8.browser.ie){T.styleFloat="left"}else{T.cssFloat="left"}cL.appendChild(cN);this._btnDoms[cM]=cL;if(!this._btnDoms[cM+1]){this._container.appendChild(cL)}else{this._container.insertBefore(cL,this._btnDoms[cM+1])}},_createLabelBtn:function(cM,cQ){var cR=this._getParentMapType(cM);var cO=this._getMapTypeIndex(cR);var cL=this._btnDoms[cO];var cS=this;cL.onmouseover=function(){if((cS._map.getMapType()==cR||cS._map.getMapType()==cM)&&this._labelDom){if(this._hideLabelTimer){clearTimeout(this._hideLabelTimer);this._hideLabelTimer=null}if(this._labelDom){a8.dom.show(this._labelDom)}}};cL.onmouseout=function(){var cV=this;if(this._hideLabelTimer){clearTimeout(this._hideLabelTimer);this._hideLabelTimer=null}this._hideLabelTimer=setTimeout(function(){if(cV._labelDom){a8.dom.hide(cV._labelDom)}},1000)};cL.onmousedown=function(){if(this._hideLabelTimer){clearTimeout(this._hideLabelTimer);this._hideLabelTimer=null}if(this._labelDom){a8.dom.show(this._labelDom)}};cL._childMapType=cM;var cU=aa("div");cw(cU);labelContainerStyle=cU.style;labelContainerStyle.position="absolute";labelContainerStyle.top=this._btnDoms[cO].offsetHeight+"px";var cP=this.getAnchor();if(this._getBtnNum()==1){if(cP==BMAP_ANCHOR_TOP_LEFT||cP==BMAP_ANCHOR_BOTTOM_LEFT){labelContainerStyle.left="0"}else{labelContainerStyle.right="0"}}else{if(cO==0||cO!=this._btnDoms.length-1){var T=0,cT=0;while(cT<cO){if(this._btnDoms[cT]){T+=this._btnDoms[cT].offsetWidth}cT++}labelContainerStyle.left=T+"px"}else{labelContainerStyle.right="0"}}labelContainerStyle.zIndex="-1";labelContainerStyle.display="none";var cN=this._getInputCheckedInfo(cM)?\'checked="checked"\':"";cU.innerHTML=\'<div title="\'+cM.getTips()+\'" style="border-right:1px solid #8ba4dc;border-bottom:1px solid #8ba4dc;border-left:1px solid #8ba4dc;background:white;font:12px \'+cc.fontFamily+\';padding:0 8px 0 6px;line-height:1.6em;box-shadow:2px 2px 3px rgba(0, 0, 0, 0.35)"><span \'+cN+\'" class="BMap_checkbox"></span><label style="vertical-align: middle; cursor: pointer;">\'+(cM.getLabelText()||cM.getName())+"</label></div>";cU.onclick=function(){cS._map.setMapType(cS._getProperMapType(cM))};cU.onmouseover=function(cV){if(cL._hideLabelTimer){clearTimeout(cL._hideLabelTimer);cL._hideLabelTimer=null}a8.dom.show(this);aP(cV)};cU.onmouseout=function(){var cV=this;if(cL._hideLabelTimer){clearTimeout(cL._hideLabelTimer);cL._hideLabelTimer=null}cL._hideLabelTimer=setTimeout(function(){if(cV){a8.dom.hide(cV)}},1000)};cL._lblDom=this._lblDoms[cQ]=cU;cL.appendChild(cU);cL._labelDom=cU},_createBtnsDropDown:function(){var cN=aa("div");cw(cN);cN.title="\u66f4\u6539\u5730\u56fe\u7c7b\u578b";var cP=cN.style;cP.font="bold 12px/1.5em "+cc.fontFamily;cP.background="#fff";cP.boxShadow="2px 2px 3px rgba(0, 0, 0, 0.35)";cP.padding="0 6px";cP.border="1px solid #8ba4dc";cN.innerHTML=\'<span style="float:right;font-family:\'+cc.fontFamily+\'">\u25bc</span>\'+this._map.getMapType().getName();this._mainBtn=cN;var cL=aa("div");cw(cL);dropDownStyle=cL.style;dropDownStyle.position="relative";dropDownStyle.zIndex="-1";dropDownStyle.background="#fff";dropDownStyle.display="none";dropDownStyle.borderLeft=dropDownStyle.borderRight=dropDownStyle.borderBottom="1px solid #8ba4dc";var T=this._opts.mapTypes;for(var cM=0;cM<T.length;cM++){if(!this._isMapTypeExist(this._getParentMapType(T[cM]))){this._createNormalBtnDropDown(T[cM],cM,cL)}}var cO=aa("div");cO.style.borderTop="1px solid rgb(220, 220, 220)";cO.style.margin="1px 4px";cL.appendChild(cO);for(var cM=0;cM<T.length;cM++){if(this._isMapTypeExist(this._getParentMapType(T[cM]))){this._createLabelBtnDropDown(T[cM],cM,cL)}}this._container.style.width="85px";this._container.style.whiteSpace="nowrap";this._container.style.cursor="pointer";this._container.appendChild(cN);this._container.appendChild(cL);cN._dropDownContainer=cL;cN.onclick=function(){if(this._hideDropDownTimer){clearTimeout(this._hideDropDownTimer);this._hideDropDownTimer=null}if(this._dropDownContainer){this._dropDownContainer.style.display=this._dropDownContainer.style.display=="none"?"":"none"}};cN.onmouseout=function(){if(this._hideDropDownTimer){clearTimeout(this._hideDropDownTimer);this._hideDropDownTimer=null}var cQ=this;this._hideDropDownTimer=setTimeout(function(){if(cQ._dropDownContainer){a8.dom.hide(cQ._dropDownContainer)}},1000)};cL.onmouseover=function(){if(cN._hideDropDownTimer){clearTimeout(cN._hideDropDownTimer);cN._hideDropDownTimer=null}a8.dom.show(this)};cL.onmouseout=function(){if(cN._hideDropDownTimer){clearTimeout(cN._hideDropDownTimer);cN._hideDropDownTimer=null}cN._hideDropDownTimer=setTimeout(function(){if(cN._dropDownContainer){a8.dom.hide(cN._dropDownContainer)}},1000)}},_createNormalBtnDropDown:function(cP,cM,T){var cL=aa("div");cw(cL);var cO=cL.style;cO.color="#000";cO.font="12px/1.6em "+cc.fontFamily;cO.background="#fff";cO.padding="1px 6px";if(a8.browser.ie<8){cO.zoom="1"}cL.innerHTML=cP.getName();cL.title=cP.getTips();var cN=this;cL.onclick=function(){cN._map.setMapType(cN._getProperMapType(cP))};T.appendChild(cL);this._btnDoms[cM]=cL},_createLabelBtnDropDown:function(cN,cQ,T){var cM=aa("div");cw(cM);var cT=cM.style;cT.font="12px/1.6em "+cc.fontFamily;cT.padding="1px 0 1px 4px";cT.whiteSpace="nowrap";cM.title=cN.getTips();var cO=this._getInputCheckedInfo(cN)?\'checked="checked"\':"";cM.innerHTML="<span "+cO+\' class="BMap_checkbox"></span><label style="vertical-align:middle;cursor:pointer">\'+(cN.getLabelText()||cN.getName())+"</label>";var cS=this;cM.onclick=function(){cS._map.setMapType(cS._getProperMapType(cN))};T.appendChild(cM);this._lblDoms[cQ]=cM;var cR=this._getParentMapType(cN);var cP=this._getMapTypeIndex(cR);var cL=this._btnDoms[cP];cL._childMapType=cN;cL._lblDom=cM},_getBtnNum:function(){var T=0;for(var cL=0;cL<this._btnDoms.length;cL++){if(this._btnDoms[cL]){T++}}return T},_getMapTypeIndex:function(cL){for(var T=0;T<this._opts.mapTypes.length;T++){if(this._opts.mapTypes[T]==cL){return T}}return -1},_getProperMapType:function(cM){for(var T=0;T<this._mapTypeRel.length;T++){if(this._mapTypeRel[T][0]==cM&&this._map.getMapType()==cM&&this._isMapTypeExist(this._mapTypeRel[T][1])){return this._mapTypeRel[T][1]}if(this._mapTypeRel[T][1]==cM){var cN=this._lblDoms[this._getMapTypeIndex(this._mapTypeRel[T][0])];if(cN){var cL=cN.getElementsByTagName("span")[0];if(cL.checked==""){b2.dom.removeClass(cL,"checked");return cM}else{return this._mapTypeRel[T][0]}}}}return cM},_renderSelBtn:function(cL){var T=cL.style;T.background="#8ea8e0";T.color="#fff";T.fontWeight="bold"},_renderUnSelBtn:function(cL){var T=cL.style;T.background="#fff";T.color="#000";T.fontWeight=""},_bind:function(){var T=this;T._map.addEventListener("onmaptypechange",function(cL){T._draw()})},_draw:function(){switch(this._opts.type){case BMAP_MAPTYPE_CONTROL_DROPDOWN:this._drawDropDown();break;default:this._drawDefault()}},_drawDefault:function(){var cM=this._map.getMapType();for(var T=0;T<this._opts.mapTypes.length;T++){var cL=null;if(!this._btnDoms[T]){continue}if(cM==this._opts.mapTypes[T]){this._renderSelBtn(this._btnDoms[T].children[0]);if(this._btnDoms[T]._childMapType&&this._btnDoms[T]._lblDom){cL=this._btnDoms[T]._lblDom.getElementsByTagName("span")[0];cL.checked="";b2.dom.removeClass(cL,"checked")}}else{if(this._btnDoms[T]._childMapType==cM){this._renderSelBtn(this._btnDoms[T].children[0]);var cN=this._btnDoms[T]._lblDom;cL=cN.getElementsByTagName("span")[0];if(cN){cL.checked="checked";b2.dom.addClass(cL,"checked")}}else{this._renderUnSelBtn(this._btnDoms[T].children[0]);if(this._btnDoms[T]._lblDom){a8.dom.hide(this._btnDoms[T]._lblDom);clearTimeout(this._btnDoms[T]._hideLabelTimer);this._btnDoms[T]._hideLabelTimer=null}}}}},_drawDropDown:function(){var cP=this._map.getMapType();var cM=false;var cL=false;for(var cN=0;cN<this._opts.mapTypes.length;cN++){var cO=null;if(cP==this._opts.mapTypes[cN]&&this._btnDoms[cN]){cM=true;this._mainBtn.innerHTML=\'<span style="float:right;font-family:\'+cc.fontFamily+\'">\u25bc</span>\'+this._map.getMapType().getName();var T=this._btnDoms[cN];if(T&&T._childMapType&&T._lblDom){a8.dom.show(T._lblDom);cO=T._lblDom.getElementsByTagName("span")[0];cO.checked="";b2.dom.removeClass(cO,"checked")}}else{if(this._btnDoms[cN]&&this._btnDoms[cN]._childMapType==cP){cL=true;this._mainBtn.innerHTML=\'<span style="float:right;font-family:\'+cc.fontFamily+\'">\u25bc</span>\'+this._getParentMapType(cP).getName();var cQ=this._btnDoms[cN]._lblDom;if(cQ){a8.dom.show(cQ);cO=cQ.getElementsByTagName("span")[0];cO.checked="checked";b2.dom.addClass(cO,"checked")}}else{if(this._btnDoms[cN]){var cQ=this._btnDoms[cN]._lblDom;if(cQ){a8.dom.hide(cQ)}}}}}if(!cM&&!cL){this._mainBtn.innerHTML=\'<span style="float:right;font-family:\'+cc.fontFamily+\'">\u25bc</span>\'+this._map.getMapType().getName()}},remove:function(){this._btnDoms=this._lblDoms=[];this._mainBtn=null;cp.prototype.remove.call(this)}});');
_jsload&&_jsload('marker', 'a8.extend(Y.prototype,{initialize:function(T){this.map=T;this._addDom();this._bind();if(this._menu){this._menu.initialize(this.map,this)}this.domElement.guid=this.guid;a8.lang.Class.call(this,this.guid);if(!this._visible){a8.dom.hide(this.domElement)}return this.domElement},_bind:function(){if(!this.domElement){return}var T=this;var cM=this.map;function cL(cR,cQ){var cP=cR.srcElement||cR.target;var cO=cR.clientX||cR.pageX;var cT=cR.clientY||cR.pageY;if(cR&&cQ&&cO&&cT&&cP){var cS=a8.dom.getPosition(cM.container);var cN=cG();cQ.pixel=new bu(cO-cS.left+cN[1],cT-cS.top+cN[0]);cQ.point=cM.pixelToPoint(cQ.pixel);return cQ}else{return cQ}}a8.on(this.domElement,"mouseover",function(cN){if(!T._dragstarted){T.dispatchEvent(cL(cN,new bg("onmouseover").inherit(cN)))}});a8.on(this.domElement,"mouseout",function(cN){if(!T._dragstarted){T.dispatchEvent(cL(cN,new bg("onmouseout").inherit(cN)))}});if(T._config.clickable){a8.on(this.domElement,"touchstart",function(cN){T._bind._touchStartPos=new bu(cN.changedTouches[0].clientX,cN.changedTouches[0].clientY)});a8.on(this.domElement,"touchend",function(cP){var cO=aE(),cN=new bu(cP.changedTouches[0].clientX,cP.changedTouches[0].clientY);if(Math.abs(cN.x-T._bind._touchStartPos.x)>10||Math.abs(cN.y-T._bind._touchStartPos.y)>10){T._bind._touchStartPos=null;return}T.dispatchEvent(cL(cP,new bg("onclick").inherit(cP)));if(cO-T._dblclickTime<T.map.config.clickInterval){T.dispatchEvent(cL(cP,new bg("ondblclick").inherit(cP)))}T._dblclickTime=cO});a8.on(this.domElement,"click",function(cO){var cN=cO.srcElement||cO.target;while(cN){if(cN==T.domElement){if(!(T instanceof ad)||T instanceof ad&&(!T._lastPt||T._lastPt&&T.getPosition().equals(T._lastPt))){T.dispatchEvent(cL(cO,new bg("onclick").inherit(cO)))}break}else{if(T.map&&T.map.infoWindowDoms&&cN==T.map.infoWindowDoms.popDom){break}}cN=cN.parentNode}});a8.on(this.domElement,"dblclick",function(cN){T.dispatchEvent(cL(cN,new bg("ondblclick").inherit(cN)));co(cN)});if(!a8.browser.firefox||a8.browser.firefox<4){a8.on(this.domElement,"contextmenu",function(cN){T.dispatchEvent(cL(cN,new bg("onrightclick").inherit(cN)))})}}a8.on(this.domElement,"mousedown",function(cN){if(T instanceof ad){T._lastPt=T.getPosition()}T.dispatchEvent(cL(cN,new bg("onmousedown").inherit(cN)))});a8.on(this.domElement,"mouseup",function(cN){T.dispatchEvent(cL(cN,new bg("onmouseup").inherit(cN)));if(a8.browser.firefox>=4&&cN.button==2&&T._config.clickable){T.dispatchEvent(cL(cN,new bg("onrightclick").inherit(cN)))}})},hide:function(){if(this._visible==false){return}this._visible=false;bG.prototype.hide.call(this);if(this.infoWindow&&this.infoWindow.overlay&&this.infoWindow.overlay==this){this.closeInfoWindow()}},show:function(){if(this._visible==true){return}this._visible=true;bG.prototype.show.call(this)},setConfig:function(cL){if(!cL){return}for(var T in cL){if(typeof(this._config[T])==typeof(cL[T])){this._config[T]=cL[T]}}},setZIndex:function(T){var cL=this;cL.zIndex=T;cL._updateDomZIndex()},_updateDomZIndex:function(){var cL=this,T;if(ch(cL.zIndex)){T=cL.zIndex}else{T=0;if(cL.map&&cL.getPosition()){var cM=cL.getPosition()?cL.getPosition().lat:0;T=bG.getZIndex(cM)+(cL._config.baseZIndex||0)}}if(cL.domElement){cL.domElement.style.zIndex=T}},addContextMenu:function(T){this._menu=T;if(this.map){T.initialize(this.map,this)}},removeContextMenu:function(){this._menu.remove();this._menu=null}});var bj=new M(cc.imgPath+"marker_red_hd.png",new aH(47,50),{anchor:new aH(20,50),infoWindowAnchor:new aH(20,0)});var ah=3;var bx=4;ad.TOP_ZINDEX=bG.getZIndex(-90)+1000000;ad.DRAG_ZINDEX=ad.TOP_ZINDEX+1000000;ad._getAnimationName=function(cM){if(ad._cssAniNames[cM]){return ad._cssAniNames[cM]}var cN=ad._cssAniNames[cM]=["BMap_"+Math.round(Math.random()*10000),"BMap_"+Math.round(Math.random()*10000)];var T=b0[cM];var cL=ad._styleElement;if(!cL){cL=ad._styleElement=aa("style",{type:"text/css"});document.getElementsByTagName("head")[0].appendChild(cL)}cL.textContent+=ad._generateAniCSS(T.iconAnis,cN[0])+ad._generateAniCSS(T.shadowAnis,cN[1]);return ad._cssAniNames[cM]};ad._generateAniCSS=function(cM,cL){var T=["@-webkit-keyframes "+cL+" {\\n"];a8.array.each(cM,function(cN){T.push(cN.percent*100,"% { ");T.push("-webkit-transform: translate(",cN.translate[0],"px,",cN.translate[1],"px); ");T.push("-webkit-animation-timing-function: ",cN.timingFunc,"; ");T.push("}\\n")});T.push("}\\n");return T.join("")};ad._addDragCrossImg=function(cL,T){if(!ad._dragCrossImg){ad._dragCrossImg=aa("img",{src:cc.imgPath+"drag_cross.png",width:13,height:9});ad._dragCrossImg.style.position="absolute";if(a8.browser.ie==6){delete ad._dragCrossImg;var cN=ad._dragCrossImg=aa("div");var cM=cN.style;cM.position="absolute";cM.width="13px";cM.height="9px";cM.filter=\'progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image,src="\'+cc.imgPath+\'drag_cross.png")\'}}var cM=ad._dragCrossImg.style;cM.left=cL.width-6+"px";cM.top=cL.height-5+"px";T.appendChild(ad._dragCrossImg)};ad._removeDragCrossImg=function(){if(ad._dragCrossImg&&ad._dragCrossImg.parentNode){ad._dragCrossImg.parentNode.removeChild(ad._dragCrossImg)}};ad._cssAniNames=[];ad._aniEndHandler=function(){this.style.WebkitAnimation=""};a8.extend(ad.prototype,{initialize:function(T){this._initParam();Y.prototype.initialize.call(this,T);if(!this._visible){a8.dom.hide(this.siblingElement)}if(T.highResolutionEnabled()&&this._config.icon==au){this._config.icon=bj}this.setPosition(this.point);this.setIcon(this._config.icon);this.setShadow(this._config.shadow);if(this._config.label&&this._cfgLabelEvent){this._config.label.addEventListener("remove",this._cfgLabelEvent)}this.setLabel(this._config.label);this.setTitle(this._config.title);this._initDrag();return this.domElement},_initParam:function(){if(this._init){return}this._init=true;this.domElement=null;this.shadowElement=null;this.siblingElement=null;this.iconDom=null;this._isDragging=false},_addDom:function(){var T=this.map.getPanes();this.domElement=at(T.markerMouseTarget,this._msTargetRender());this.siblingElement=at(T.markerPane,this._markerRender());this.siblingElement.guid=this.guid},_msTargetRender:function(){var T=[\'<span class="BMap_Marker BMap_noprint" unselectable="on" \'];T.push(this._config.title?\'title="\'+this._config.title+\'"\':\'"\');T.push(\' style="position:absolute;padding:0;margin:0;border:0;width:0;height:0;-moz-user-select:none;\');T.push(this._config.clickable?"cursor:pointer;":"");T.push("background:url("+cc.imgPath+"blank.gif);");T.push("width:"+this._config.icon.size.width+"px;");T.push("height:"+this._config.icon.size.height+"px;");T.push(\'"></span>\');return T.join("")},_markerRender:function(){var T=[\'<span class="BMap_Marker" unselectable="on" \'];T.push(\'style="position:absolute;padding:0;margin:0;border:0;\');T.push(\'width:0;height:0;-moz-user-select:none"></span>\');return T.join("")},_shadowRender:function(){var T=[\'<span unselectable="on" \'];T.push(\'style="position:absolute;padding:0;margin:0;border:0;\');T.push(\'width:0;height:0;-moz-user-select:none"></span>\');return T.join("")},draw:function(){if(!this.domElement){return}var T=this._getPixPos();this.domElement.style.left=T[0].x+"px";this.domElement.style.top=T[0].y+"px";if(this.siblingElement){this.siblingElement.style.left=T[0].x+"px";this.siblingElement.style.top=T[0].y+"px"}if(this.shadowElement){this.shadowElement.style.left=T[1].x+"px";this.shadowElement.style.top=T[1].y+"px"}if(this.infoWindow!=null&&this.infoWindow.isOpen()){this.infoWindow.setPosition()}this._updateDomZIndex()},_getPixPos:function(){var cP=this._config.offset||new aH(0,0);var T=this._config.icon.anchor||new aH(0,0);var cL=this.map.pointToOverlayPixel(this.getPosition());var cO=new bu(cL.x+cP.width-T.width,cL.y+cP.height-T.height);var cN=[cO];if(this._config.shadow){var cQ=this._config.shadow.anchor||new aH(0,0),cM=new bu(cL.x+cP.width-cQ.width,cL.y+cP.height-cQ.height);cN[1]=cM}return cN},_draw:function(){if(this.map){this.domElement=this.initialize(this.map);if(this._animation){this.setAnimation(this._animation);delete this._animation}}else{delete this._animation}},remove:function(){this.setAnimation(null);if(this.siblingElement&&this.siblingElement.parentNode){this.siblingElement.parentNode.removeChild(this.siblingElement)}if(this.shadowElement&&this.shadowElement.parentNode){this.shadowElement.parentNode.removeChild(this.shadowElement)}if(this.infoWindow&&this.infoWindow.overlay&&this.infoWindow.overlay===this){this.closeInfoWindow();this.infoWindow=null}this.siblingElement=null;this.shadowElement=null;this.iconDom=null;this.shadowDom=null;if(this._config.label){var T=this._config.label;T.removeEventListener("remove",this._cfgLabelEvent);a8.lang.decontrol(T.guid);T.setMarker(null);T.domElement=null;T=this._config.label=null}Y.prototype.remove.call(this)},hide:function(){Y.prototype.hide.call(this);if(this.domElement){a8.dom.hide(this.domElement)}if(this.siblingElement){a8.dom.hide(this.siblingElement)}if(this.shadowElement){a8.dom.hide(this.shadowElement)}},show:function(){Y.prototype.show.call(this);if(this.domElement){a8.dom.show(this.domElement)}if(this.siblingElement){a8.dom.show(this.siblingElement)}if(this.shadowElement){a8.dom.show(this.shadowElement)}},setIcon:function(cM){if(!(cM instanceof M)){return}this._config.icon=cM;if(!this.map||!this.domElement||!this.siblingElement){return}var cO=this.map;try{if(this.iconDom){this.siblingElement.removeChild(this.iconDom);this.iconDom=null}this.domElement.style.width=cM.size.width+"px";this.domElement.style.height=cM.size.height+"px"}catch(cN){}if(this._config.icon){var T=this.iconDom=aa("div");var cL=T.style;cL.position="absolute";cL.padding=cL.margin="0";cL.width=cM.size.width+"px";cL.height=cM.size.height+"px";cL.overflow="hidden";T.innerHTML=cM.getHTML();T.galleryImg=false;this.siblingElement.appendChild(this.iconDom)}this.draw()},setShadow:function(cL){if(!(cL instanceof M)){return}this._config.shadow=cL;if(!this.map||!this.domElement||!this.siblingElement){return}if(!this.shadowElement){this.shadowElement=at(this.map.getPanes().markerShadow,this._shadowRender())}var cN=this.map;try{if(this.shadowDom){this.shadowElement.removeChild(this.shadowDom);this.shadowDom=null}this.shadowElement.style.width=cL.size.width+"px";this.shadowElement.style.height=cL.size.height+"px"}catch(cM){}if(this._config.shadow){var cO=this.shadowDom=aa("div");var T=cO.style;T.position="absolute";T.padding=T.margin="0";T.width=cL.size.width+"px";T.height=cL.size.height+"px";T.overflow="hidden";cO.innerHTML=cL.getHTML();cO.galleryImg=false;this.shadowElement.appendChild(this.shadowDom)}this.draw()},setLabel:function(T){if(!(T instanceof ag)){return}this._config.label=T;var cM=this;if(!this._config.label._binded){this._config.label._binded=true;this._cfgLabelEvent=function(){cM._config.label=null};this._config.label.addEventListener("remove",this._cfgLabelEvent)}if(!this.map){return}T._i(this.map);if(T.domElement){this.siblingElement.appendChild(T.domElement)}else{T.domElement=at(this.domElement,T.render());T.domElement.guid=T.guid}var cL=T.domElement.style;cL.left=(T._config.offset.width)+"px";cL.top=(T._config.offset.height)+"px";T.setMarker(this)},_initDrag:function(){if(!this.domElement||this.domElement._binded){return}this.domElement._binded=true;var cQ=this.map,cN=this,T=0,cR=0,cM=0,cP={x:0,y:0};function cO(cT,cS){cS.pixel=cT.pixel;cS.point=cT.point;return cS}function cL(cU){var cT=cU.clientX,cS=cU.clientY;if(cU.changedTouches){cT=cU.changedTouches[0].clientX;cS=cU.changedTouches[0].clientY}return new bu(cT,cS)}this.dragStart=function(cU){if(!cN._config.enableDragging){return}if(cU.button==2){return}cN._isDragging=true;var cT=cQ.pointToPixel(cN.point);var cS=cL(cU);T=cS.x-cT.x;cR=cS.y-cT.y;cM=aE();cN.map.temp._draggingMarker=cN;a8.on(document,"mousemove",cN.dragIng);a8.on(document,"mouseup",cN.dragEnd);a8.on(document,"touchmove",cN.dragIng);a8.on(document,"touchend",cN.dragEnd);if(cN.domElement&&cN.domElement.setCapture){cN.domElement.setCapture()}cN.domElement.style.cursor=cN._config.draggingCursor;if(cU.type=="touchstart"){aP(cU)}};this.dragIng=function(cW){if(!cN._isDragging){return}var cT=cL(cW);var cU=new bu((cT.x-T),(cT.y-cR));cP=cU;cN._draggingMovePixel=cU;if((cN._config.restrictDraggingArea&&(cU.x>15&&cU.x<cN.map.width-15)&&(cU.y>30&&cU.y<cN.map.height-15))||!cN._config.restrictDraggingArea){var cS=cN.map.pixelToPoint(cU),cV={pixel:cU,point:cS};cN._panByX=cN._panByY=0;if(cU.x<=20||cU.x>=cN.map.width-20||cU.y<=50||cU.y>=cN.map.height-10){if(cU.x<=20){cN._panByX=8}else{if(cU.x>=cN.map.width-20){cN._panByX=-8}}if(cU.y<=50){cN._panByY=8}else{if(cU.y>=cN.map.height-10){cN._panByY=-8}}if(!cN._draggingMoveTimer){cN._draggingMoveTimer=setInterval(function(){cQ.panBy(cN._panByX,cN._panByY,{noAnimation:true});var cX=cQ.pixelToPoint(cN._draggingMovePixel);cN.setPosition(cX)},30)}}else{if(cN._draggingMoveTimer){clearInterval(cN._draggingMoveTimer);cN._draggingMoveTimer=null}cN.setPosition(cS)}if(!cN._dragstarted){cN.dispatchEvent(cO(cV,new bg("ondragstart")));cN._dragstarted=true;if(cN._config.raiseOnDrag){cN.setAnimation(ah);ad._addDragCrossImg(cN._config.icon.anchor,cN.siblingElement)}}cN.dispatchEvent(cO(cV,new bg("ondragging")))}};this.dragEnd=function(cS){if(cN.domElement&&cN.domElement.releaseCapture){cN.domElement.releaseCapture()}cN._isDragging=false;cN.map.temp._draggingMarker=null;a8.un(document,"mousemove",cN.dragIng);a8.un(document,"mouseup",cN.dragEnd);a8.un(document,"touchmove",cN.dragIng);a8.un(document,"touchend",cN.dragEnd);T=cR=0;if(cN._draggingMoveTimer){clearInterval(cN._draggingMoveTimer);cN._draggingMoveTimer=null}if(aE()-cM>=100&&(cP.x>2||cP.y>2)){cN._dragstarted=false;cN.dispatchEvent(cO({pixel:cN.map.pointToPixel(cN.getPosition()),point:cN.getPosition()},new bg("ondragend")));if(cN._config.raiseOnDrag){cN.setAnimation(bx);ad._removeDragCrossImg()}cP.x=cP.y=0}cN._updateDomZIndex();if(cN.domElement){cN.domElement.style.cursor=cN._config.clickable?"pointer":""}};a8.on(this.domElement,"mousedown",this.dragStart);a8.on(this.domElement,"touchstart",this.dragStart)},setPosition:function(T){if(T instanceof cd){this.point=this._config.point=new cd(T.lng,T.lat);this.draw()}},_updateDomZIndex:function(){var cL=this,T;if(cL._isDragging==true){T=ad.DRAG_ZINDEX}else{if(cL._config.isTop==true){T=ad.TOP_ZINDEX+(cL._addi||0)}else{if(ch(cL.zIndex)){T=cL.zIndex}else{T=0;if(cL.map&&cL.getPosition()){T=bG.getZIndex(cL.getPosition().lat)+cL._config.baseZIndex}}}}if(cL.domElement){cL.domElement.style.zIndex=T}if(cL.siblingElement){cL.siblingElement.style.zIndex=T}},setTop:function(cL,T){this._config.isTop=!!cL;if(cL){this._addi=T||0}this._updateDomZIndex()},setTitle:function(T){this._config.title=T+"";if(this.domElement){this.domElement.title=this._config.title}},setOffset:function(T){if(!(T instanceof aH)){return}this._config.offset=T;this.setPosition(this.getPosition())},setAnimation:function(cM){if(!this.iconDom){return}this._clearAnimation(cM!=null);var T=b0[cM];if(!T){return}var cL=T?T.options.useJS:false;(!aA()||cL)?this._execJSAnimation(cM):this._execCSSAnimation(cM)},_clearAnimation:function(cL){this._clearCSSAni(this.iconDom);this._clearCSSAni(this.shadowDom);if(cL){if(this._aniObj){this._aniObj.stop();this._aniObj=null}this.iconDom.style.top=this.iconDom.style.left="0px";if(this.shadowDom){this.shadowDom.style.top=this.shadowDom.style.left="0px"}}else{if(this._aniObj){var T=this;this._aniObj.setFinishCallback(function(){T._aniObj=null})}}},_execCSSAnimation:function(cL){var T=b0[cL];var cM=ad._getAnimationName(cL);this._setCSSAniStyle(this.iconDom,cM[0],T);this._setCSSAniStyle(this.shadowDom,cM[1],T)},_clearCSSAni:function(T){if(T){T.style.WebkitAnimation="";a8.un(T,"webkitAnimationEnd",ad._aniEndHandler)}},_setCSSAniStyle:function(cM,cL,T){if(cM){a8.on(cM,"webkitAnimationEnd",ad._aniEndHandler);cM.style.WebkitAnimation=cL+" "+T.options.duration+"ms"+(T.options.loop==g.INFINITE?" infinite":"")}},_execJSAnimation:function(cO){var cQ=this.iconDom.style;var T=false;var cN;if(this.shadowDom){T=true;cN=this.shadowDom.style}var cL=b0[cO];var cS=this;var cR=cL.iconAnis.length,cV=cL.options.duration,cU=cS._aniObj=new g({duration:0,delay:g.INFINITE});var cT=cL.iconAnis;var cM=cL.shadowAnis;cQ.top=cT[0].translate[1]+"px";if(T){cN.left=cM[0].translate[0]+"px";cN.top=cM[0].translate[1]+"px"}for(var cP=1;cP<cR;cP++){(function(){var c1=[cT[cP].translate[0]-cT[cP-1].translate[0],cT[cP].translate[1]-cT[cP-1].translate[1]];var c0=[cT[cP-1].translate[0],cT[cP-1].translate[1]];if(T){var cY=[cM[cP].translate[0]-cM[cP-1].translate[0],cM[cP].translate[1]-cM[cP-1].translate[1]];var cX=[cM[cP-1].translate[0],cM[cP-1].translate[1]]}var cZ=aw[cT[cP-1].timingFunc];var cW=function(){};if(cP==cR-1){if(cL.options.loop!=g.INFINITE){cW=function(){cS._aniObj=null}}else{cW=function(){cS._aniObj.start()}}}cU.add(new g({duration:(cL.iconAnis[cP].percent-cT[cP-1].percent)*cV,fps:40,delay:g.INFINITE,transition:cZ,render:function(c2){if(cS.iconDom){cS.iconDom.style.top=c0[1]+Math.round(c2*c1[1])+"px"}if(T&&cS.shadowDom){cS.shadowDom.style.left=cX[0]+Math.round(c2*cY[0])+"px";cS.shadowDom.style.top=cX[1]+Math.round(c2*cY[1])+"px"}},finish:cW}))})()}cU.start()}});var b0={};b0[1]={options:{duration:400},iconAnis:[{percent:0,translate:[0,-500],timingFunc:"ease-in"},{percent:0.5,translate:[0,0],timingFunc:"ease-out"},{percent:0.75,translate:[0,-20],timingFunc:"ease-in"},{percent:1,translate:[0,0],timingFunc:"ease-out"}],shadowAnis:[{percent:0,translate:[375,-375],timingFunc:"ease-in"},{percent:0.5,translate:[0,0],timingFunc:"ease-out"},{percent:0.75,translate:[15,-15],timingFunc:"ease-in"},{percent:1,translate:[0,0],timingFunc:"ease-out"}]};b0[2]={options:{duration:700,loop:g.INFINITE},iconAnis:[{percent:0,translate:[0,0],timingFunc:"ease-out"},{percent:0.5,translate:[0,-20],timingFunc:"ease-in"},{percent:1,translate:[0,0],timingFunc:"ease-out"}],shadowAnis:[{percent:0,translate:[0,0],timingFunc:"ease-out"},{percent:0.5,translate:[15,-15],timingFunc:"ease-in"},{percent:1,translate:[0,0],timingFunc:"ease-out"}]};b0[3]={options:{duration:200,useJS:true},iconAnis:[{percent:0,translate:[0,0],timingFunc:"ease-in"},{percent:1,translate:[0,-20],timingFunc:"ease-out"}],shadowAnis:[{percent:0,translate:[0,0],timingFunc:"ease-in"},{percent:1,translate:[15,-15],timingFunc:"ease-out"}]};b0[4]={options:{duration:500,useJS:true},iconAnis:[{percent:0,translate:[0,-20],timingFunc:"ease-in"},{percent:0.5,translate:[0,0],timingFunc:"ease-out"},{percent:0.75,translate:[0,-10],timingFunc:"ease-in"},{percent:1,translate:[0,-0],timingFunc:"ease-out"}],shadowAnis:[{percent:0,translate:[15,-15],timingFunc:"ease-in"},{percent:0.5,translate:[0,0],timingFunc:"ease-out"},{percent:0.75,translate:[8,-8],timingFunc:"ease-in"},{percent:1,translate:[0,0],timingFunc:"ease-out"}]};M.prototype.getHTML=function(){if(a8.browser.ie==6&&this.imageUrl.toLowerCase().indexOf(".png")>0){var T=["<div"];if(this.printImageUrl){T.push(\' class="BMap_noprint"\')}T.push(\' style="width: 1px; height: 1px;\');T.push("; left:"+this.imageOffset.width+"px");T.push("; top:"+this.imageOffset.height+"px");T.push("; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image,src=\'"+this.imageUrl+"\')");T.push(\'; position:absolute;"></div>\');if(this.printImageUrl){T.push(\'<img class="BMap_noscreen" style="border:none;left:\'+this.imageOffset.width+"px;");T.push("top:"+this.imageOffset.height+\'px;position:absolute" src="\'+this.printImageUrl+\'" />\')}return T.join("")}else{return[\'<img src="\',this.imageUrl,\'" style="border:none;left:\'+this.imageOffset.width+"px","; top:"+this.imageOffset.height+"px",\'; position:absolute;" />\'].join("")}};a8.extend(ag.prototype,{_addDom:function(){var cL=this._config;var cN=this.content;var T=aa("label",{"class":"BMapLabel",unselectable:"on"});if(cL.title){T.title=cL.title}var cM=T.style;cM.position="absolute";cM.MozUserSelect="none";if(cL.width==0||cL.width=="auto"){cM.display="inline"}else{cM.width=cL.width+"px";cM.display="block";cM.overflow="hidden"}if(cL.clickable=="true"){cM.cursor="pointer"}else{if(!a8.browser.ie){cM.cursor="inherit"}}T.innerHTML=cN;this.map.getPanes().labelPane.appendChild(T);this.domElement=T;this.setStyle(cL.styles);return T},setPosition:function(T){if(T instanceof cd&&!this.getMarker()){this.point=this._config.position=new cd(T.lng,T.lat);this.draw()}},draw:function(){if(this.domElement&&this.getPosition()&&!this.getMarker()){var cL=this._config.offset||new aH(0,0);var T=this.map.pointToOverlayPixel(this.getPosition());this.domElement.style.left=(T.x+cL.width)+"px";this.domElement.style.top=(T.y+cL.height)+"px";this._updateDomZIndex()}},_draw:function(){if(this.map&&!this._marker){this.domElement=this.initialize(this.map);this.draw()}},setContent:function(T){this.content=T;if(this.domElement){this.domElement.innerHTML=T}},setOpacity:function(cL){if(cL>=0&&cL<=1){this._config.opacity=cL}if(this.domElement){var T=this.domElement.style;T.opacity=cL;T.filter="alpha(opacity="+(cL*100)+")"}},setOffset:function(T){if(!(T instanceof aH)){return}this._config.offset=new aH(T.width,T.height);if(this.getMarker()&&this.domElement){this.domElement.style.left=T.width+"px";this.domElement.style.top=T.height+"px"}else{this.draw()}},setStyle:function(T){T=T||{};this._config.styles=a8.extend(this._config.styles,T);if(this.domElement){for(var cM in T){try{this.domElement.style[cM]=T[cM]}catch(cL){}}}},setTitle:function(T){this._config.title=T+"";if(this.domElement){this.domElement.title=this._config.title}}});');
_jsload&&_jsload('poly', 'a8.extend(cF.prototype,{initialize:function(T){if(T&&this._graphMouseEvent){T.addEventListener("onmousemove",this._graphMouseEvent)}return Y.prototype.initialize.call(this,T)},_addDom:function(){var T=this._drawer=cr.getDrawer(this.map);this.domElement=T.addLine()},_bind:function(){var T=this.domElement;var cL=this;function cM(cS,cQ){var cP=cS.srcElement||cS.target;var cO=cG();var cN=cS.pageX?cS.pageX:(cS.clientX+cO[1]);var cU=cS.pageY?cS.pageY:(cS.clientY+cO[0]);if(cS&&cQ&&cN&&cU&&cP){var cR=a8.lang.instance(cP.guid).map;var cT=a8.dom.getPosition(cR.container);cQ.pixel=new bu(cN-cT.left,cU-cT.top);cQ.point=cR.pixelToPoint(cQ.pixel);return cQ}else{return cQ}}if(cr.getDrawer(this.map).getType()!="canvas"){if(cL._config.clickable){T.style.cursor="pointer";a8.on(T,"click",function(cN){if(cL._msDownMapCenter&&cL._msDownMapCenter.equals(cL.map.getCenter())){cL.dispatchEvent(cM(cN,new bg("onclick").inherit(cN)))}});a8.on(T,"dblclick",function(cN){cL.dispatchEvent(cM(cN,new bg("ondblclick").inherit(cN)))});if(!a8.browser.firefox||a8.browser.firefox<4){a8.on(this.domElement,"contextmenu",function(cN){cL.dispatchEvent(cM(cN,new bg("onrightclick").inherit(cN)))})}}a8.on(T,"mousedown",function(cN){cL.dispatchEvent(cM(cN,new bg("onmousedown").inherit(cN)));cL._msDownMapCenter=cL.map.getCenter()});a8.on(T,"mouseup",function(cN){cL.dispatchEvent(cM(cN,new bg("onmouseup").inherit(cN)))});a8.on(this.domElement,"mouseup",function(cN){cL.dispatchEvent(cM(cN,new bg("onmouseup").inherit(cN)));if(a8.browser.firefox>=4&&cN.button==2&&cL._config.clickable){cL.dispatchEvent(cM(cN,new bg("onrightclick").inherit(cN)))}})}T=null;if(!this._binded){this._binded=true;this._graphMouseEvent=function(cR){if(!cL.map){return}if(cL.map.temp._draggingMarker){return}var cN=cR.point,cQ=cL._getProximity(cN),cP=parseFloat(cQ.dist),cO;if(cP<cL._config.mouseOverTolerance){if(!cL._temp.ismouseover){cO=new bg("onmouseover")}else{cO=new bg("onmousemove")}cL._temp.ismouseout=false;cL._temp.ismouseover=true}else{if(!cL._temp.ismouseout&&cL._temp.ismouseover){cO=new bg("onmouseout");cL._temp.ismouseover=false;cL._temp.ismouseout=true}}if(cO){if(!(cL instanceof f)&&cO.type=="onmousemove"&&cL._temp.ismouseover==true&&(cP==0||cP>cL._config.mouseOverTolerance)){cO.pixel=cR.pixel;cO.point=cR.point}else{cO.point=this.overlayPixelToPoint(cQ.pixel);cO.pixel=this.pointToPixel(cO.point)}cL.dispatchEvent(cO)}};this.map.addEventListener("onmousemove",this._graphMouseEvent);this.addEventListener("mouseover",function(cN){if(!this.map){return}if(this._config.enableEditing){this.addVertexs()}});this.addEventListener("mouseout",function(cN){if(!this.map){return}if(this._config.enableEditing&&!this._editstate){this.clearVertexs()}})}},draw:function(){if(!this.domElement){return}if(this._drawer){this._drawer.setPath(this.domElement,this._getDisplayPixels(this.points))}},_draw:function(){if(this.map){this.initialize(this.map);this.domElement.style.WebkitUserSelect="none";this.draw()}},_getDisplayPixels:function(cS){var T=this.map,cR=[];if(cS.length==0||!this.domElement||!this.isVisible()){return[cR]}if(!this._config.enableEditing){var cQ=this.getParseCacheIndex(T.getZoom());if(this._parseCache[cQ]){cS=this._parseCache[cQ]}else{var cT=ce(cS,this.getParseTolerance(T.getZoom()));cS=this._parseCache[cQ]=cT}}var cO=this._config.use3DCoords;cR.push(T.pointToOverlayPixel(cS[0],null,cO));for(var cN=1,cM=1,cL=cS.length;cN<cL;cN++){var cP=T.pointToOverlayPixel(cS[cN],null,cO);if(!cP.equals(cR[cM-1])){cR.push(cP);cM++}}return[cR]},getParseCacheIndex:function(T){if(this._config.getParseCacheIndex){return this._config.getParseCacheIndex(T)}if(T<6){return 0}if(T<10){return 1}if(T<15){return 2}return 3},getParseTolerance:function(T){if(this._config.getParseTolerance){return this._config.getParseTolerance(T)}return cF.parseTolerance[this.getParseCacheIndex(T)]},setPath:function(T){this._parseCache.length=0;this.points=cF.getGraphPoints(T).slice(0);this._calcBounds();this.draw();this.dispatchEvent(new bg("onlineupdate"))},setPositionAt:function(cL,T){if(!T||!this.points[cL]){return}this._parseCache.length=0;this.points[cL]=new cd(T.lng,T.lat);this._calcBounds();this.draw();this.dispatchEvent(new bg("onlineupdate"))},setStrokeColor:function(T){if(this._config){this._config.strokeColor=T}this._setDomAttribute("strokecolor",T)},setStrokeWeight:function(T){if(T>0){this._config.strokeWeight=T;this._setDomAttribute("strokeweight",T);if(this.getStrokeStyle()=="dashed"&&cr.getDrawer(this.map).getType()=="svg"){this._setDomAttribute("strokestyle","dashed")}}},setStrokeOpacity:function(T){if(!T||T>1||T<0){return}this._config.strokeOpacity=T;if(!this.map){return}this._setDomAttribute("strokeopacity",T)},setFillOpacity:function(T){if(T>1||T<0){return}this._config.fillOpacity=T;this._setDomAttribute("fillopacity",T)},setStrokeStyle:function(T){if(T!="solid"&&T!="dashed"){return}this._config.strokeStyle=T;this._setDomAttribute("strokestyle",T)},setFillColor:function(T){this._config.fillColor=T||"";this._setDomAttribute("fillcolor",T)},_setDomAttribute:function(T,cL){if(this._drawer){this._drawer.setAttribute(this.domElement,T,cL||"",this.getStrokeWeight());this.dispatchEvent(new bg("onlineupdate"))}},addVertexs:function(){var cQ=this;if(cQ.vertexMarkers.length){return}var cR=this.getVertexPoints();var cP;for(var cO=0,cM=cR.length;cO<cM;cO++){var T=cR[cO];if(T.t){}else{cP=cc.imgPath+"node.gif"}var cL=new M(cP,new aH(11,11),{offset:new aH(5,5)});var cN=new ad(T.p,{icon:cL});cN.enableDragging(true);cN.addEventListener("ondragging",function(cS){cQ._onMarkerDragging(cS)});cN.addEventListener("ondragstart",function(cS){cQ._onMarkerDragstart(cS)});cN.addEventListener("ondragend",function(cS){cQ._onMarkerDragend(cS)});cN.index=cO;cN.t=T.t;this.vertexMarkers.push(cN);this.map.addOverlay(cN)}},clearVertexs:function(){var T;while(T=this.vertexMarkers.pop()){this.map.removeOverlay(T);delete T}this.vertexMarkers.length=0},getVertexPoints:function(){var cO=[];for(var cN=0,cL=this.points.length;cN<cL;cN++){var cP=this.points[cN];cO.push({p:cP,t:0});if(cN<cL-1){var T=this.points[cN+1];var cM=new cd((cP.lng+T.lng)/2,(cP.lat+T.lat)/2);cO.push({p:cM,t:1})}}this.vertexPoints=cO;return cO},_onMarkerDragstart:function(T){this._editstate=false},_onMarkerDragend:function(cP){this.vertexPoints.length=0;this._editstate=false;if(this._temp.dashedLine){this.map.removeOverlay(this._temp.dashedLine);delete this._temp.dashedLine}if(this._temp.preTNode){this.map.removeOverlay(this._temp.preTNode);delete this._temp.preTNode}if(this._temp.nexTNode){this.map.removeOverlay(this._temp.nexTNode);delete this._temp.nexTNode}var cO=cP.currentTarget;var cQ=cP.point;var T=cO.index;var cN;if(T%2!=0){T=Math.ceil(T/2);cN=this.points.slice();var cM=this.points.length-T;var cL=cN.splice(T,cM);cN[cN.length]=cQ;cN=cN.concat(cL)}else{T=T/2;this.points.splice(T,1,cQ);if(this instanceof cn&&this.points.length-1==T){this.points.splice(0,1,cQ)}cN=this.points}this.clearVertexs();this.setPath(cN);this.addVertexs()},_getProximity:function(cX){var cL,cN,cY,cQ,cP,cW,cV,cU=[];var c2=this.map.pointToOverlayPixel(cX);cU=this._getDisplayPixels(this.points)[0];var c5=cU.length;if(c5>1){for(var c3=1;c3<c5;c3++){var cS=cU[c3-1];var c9=cU[c3];if(!cS||!c9){continue}if(cS.x!=c9.x){var c8=(c9.y-cS.y)/(c9.x-cS.x);var c6=c9.y-c8*c9.x;cV=Math.abs(c8*c2.x+c6-c2.y)/Math.sqrt(c8*c8+1)}else{cV=Math.abs(c2.x-c9.x)}var c4=Math.pow(c9.y-cS.y,2)+Math.pow(c9.x-cS.x,2);var cM=Math.pow(c9.y-c2.y,2)+Math.pow(c9.x-c2.x,2);var c7=Math.pow(cS.y-c2.y,2)+Math.pow(cS.x-c2.x,2);var cO=Math.pow(cV,2);var T=cM-cO+c7-cO;if(T>c4){cV=Math.sqrt(Math.min(cM,c7))}if((cL==null)||(cL>cV)){cN=Math.sqrt(c7-cO)/Math.sqrt(c4);cY=Math.sqrt(cM-cO)/Math.sqrt(c4);cL=cV;cW=c3}cL=Math.min(cL,cV)}if(!(this instanceof f)){var c0=0,cZ=0,c1=this.points;for(var c3=0;c3<c5;c3++){c0=(c3==c5-1)?0:c0+1;if((c1[c3].lat!=c1[c0].lat)&&(((cX.lat>=c1[c3].lat)&&(cX.lat<c1[c0].lat))||((cX.lat>=c1[c0].lat)&&(cX.lat<c1[c3].lat)))&&(cX.lng<(c1[c0].lng-c1[c3].lng)*(cX.lat-c1[c3].lat)/(c1[c0].lat-c1[c3].lat)+c1[c3].lng)){cZ++}}cL=Math.min(cL,cZ%2>0?0:cL)}if(cN>1){cN=1}if(cY>1){cN=0;cY=1}var cT=cU[cW-1].x-cU[cW].x;var cR=cU[cW-1].y-cU[cW].y;cQ=cU[cW-1].x-(cT*cN);cP=cU[cW-1].y-(cR*cN)}return{pixel:new bu(cQ,cP),dist:cL}},show:function(){Y.prototype.show.call(this);this.draw()}});function br(cP,cN,cW){var cT=false,cR=false,cU=false,cY=new bu(cP.x,cP.y),cX=new bu(cN.x,cN.y),cO=a9(cY,cW),cM=a9(cX,cW),cV;var c0,cZ;var cS=cW.minX,cQ=cW.minY,cL=cW.maxX,T=cW.maxY;do{if(cO.all==0&&cM.all==0){cT=true;cU=true}else{if((cO.all&cM.all)!=0){cU=true}else{if(cO.all!=0){cV=cO}else{cV=cM}if(cV.top){c0=cY.x+(cX.x-cY.x)*(cQ-cY.y)/(cX.y-cY.y);cZ=cQ}else{if(cV.bottom){c0=cY.x+(cX.x-cY.x)*(T-cY.y)/(cX.y-cY.y);cZ=T}else{if(cV.right){cZ=cY.y+(cX.y-cY.y)*(cL-cY.x)/(cX.x-cY.x);c0=cL}else{if(cV.left){cZ=cY.y+(cX.y-cY.y)*(cS-cY.x)/(cX.x-cY.x);c0=cS}}}}cR=true;if(cV.all==cO.all){cY.x=Math.round(c0);cY.y=Math.round(cZ);cO=a9(cY,cW)}else{cX.x=Math.round(c0);cX.y=Math.round(cZ);cM=a9(cX,cW)}}}}while(!cU);if(cT){return{pixel0:new bu(cY.x,cY.y),pixel1:new bu(cX.x,cX.y),clip:cR?true:false}}}function a9(cL,cO){var cM={top:0,bottom:0,right:0,left:0,all:0};var T=cL.x,cN=cL.y;if(cN<cO.minY){cM.top=8;cM.all+=cM.top}else{if(cN>cO.maxY){cM.bottom=4;cM.all+=cM.bottom}}if(T>cO.maxX){cM.right=2;cM.all+=cM.right}else{if(T<cO.minX){cM.left=1;cM.all+=cM.left}}return cM}function ce(cS,cT){if(cT==0){return cS}var cR=0;var cP=0;for(var cN=1,cL=cS.length-1;cN<cL;cN++){var cQ=a3(cS[cN],cS[0],cS[cS.length-1]);if(cQ>cR){cP=cN;cR=cQ}}var T=[];if(cR>=cT){var cV=cS.slice(0,cP);var cU=cS.slice(cP,cS.length);var cO=ce(cV,cT);var cM=ce(cU,cT);for(var cN=0,cL=cO.length;cN<cL;cN++){T.push(cO[cN])}for(var cN=0,cL=cM.length;cN<cL;cN++){T.push(cM[cN])}}else{T.push(cS[0]);T.push(cS[cS.length-1])}return T}function a3(cL,cQ,cP){var cO=cQ.lng-cP.lng;var cN=cQ.lat-cP.lat;if(cO==0){return Math.abs(cL.lng-cQ.lng)}if(cN==0){return Math.abs(cL.lat-cQ.lat)}var cM=cN/cO;var T=cQ.lat-cM*cQ.lng;return Math.abs(cM*cL.lng-cL.lat+T)/Math.sqrt(cM*cM+1)}a8.extend(f.prototype,{initialize:function(T){cF.prototype.initialize.call(this,T);this.setFillColor("");this.setStrokeColor(this._config.strokeColor);this.setStrokeWeight(this._config.strokeWeight);this.setStrokeStyle(this._config.strokeStyle);this.setStrokeOpacity(this._config.strokeOpacity);return this.domElement},_getDisplayPixels:function(cW){var c1=this.map,cN=[];if(cW.length==0||!this.domElement||!this.isVisible()){return[cN]}if(!(aA()&&cW.length>5000)&&!this._config.enableEditing){var cO=this.getParseCacheIndex(c1.getZoom());if(this._parseCache[cO]){cW=this._parseCache[cO]}else{var T=ce(cW,this.getParseTolerance(c1.getZoom()));cW=this._parseCache[cO]=T}}cN.push(c1.pointToOverlayPixel(cW[0]));for(var cY=1,cV=1,cU=cW.length;cY<cU;cY++){var cM=c1.pointToOverlayPixel(cW[cY]);if(!cM.equals(cN[cV-1])){cN.push(cM);cV++}}var c0=[],cS=c1.offsetX,cR=c1.offsetY,cQ=c1.config.drawMargin,cP={minX:-cS-cQ,minY:-cR-cQ,maxX:-cS+cQ+c1.width,maxY:-cR+cQ+c1.height};for(var cY=0,cU=cN.length-1;cY<cU;cY++){var cZ=cN[cY],cX=cN[cY+1];var cL=br(cZ,cX,cP);if(cL){c0.push(cL)}}var cT=[[]];for(var cY=0,cU=c0.length;cY<cU;cY++){if(c0[cY].clip){cT[cT.length-1].push(c0[cY].pixel0);cT[cT.length-1].push(c0[cY].pixel1);if(c0[cY+1]&&c0[cY+1].clip){cT.push([])}}else{cT[cT.length-1].push(c0[cY].pixel0);if(cY==c0.length-1){cT[cT.length-1].push(c0[cY].pixel1)}}}return cT},_onMarkerDragging:function(cS){this._editstate=true;var cL=cS.currentTarget;var cU=cS.point;var cT=cL.index;var T=this.vertexPoints;var cV;var cQ=null,cM=null;if(cT==0){var cR=T[cT+2].p;cV=[cU,cR];cQ=new cd((cR.lng+cU.lng)/2,(cR.lat+cU.lat)/2);if(this.vertexMarkers[cT+1]){this.vertexMarkers[cT+1].hide()}}else{if(cT==T.length-1){var cP=T[cT-2].p;cV=[cP,cU];cQ=new cd((cP.lng+cU.lng)/2,(cP.lat+cU.lat)/2);if(this.vertexMarkers[cT-1]){this.vertexMarkers[cT-1].hide()}}else{var cP=T[cT-1].p;var cR=T[cT+1].p;cV=[cP,cU,cR];if(!cL.t){cP=T[cT-2].p;cR=T[cT+2].p;cV=[cP,cU,cR];cQ=new cd((cP.lng+cU.lng)/2,(cP.lat+cU.lat)/2);cM=new cd((cR.lng+cU.lng)/2,(cR.lat+cU.lat)/2);if(this.vertexMarkers[cT-1]){this.vertexMarkers[cT-1].hide()}if(this.vertexMarkers[cT+1]){this.vertexMarkers[cT+1].hide()}}}}if(!this._temp.dashedLine){var cO=new f(cV,{strokeStyle:"dashed",strokeColor:this._config.strokeColor,strokeWeight:this._config.strokeWeight,strokeOpacity:this._config.strokeOpacity});this.map.addOverlay(cO);cO.hide();this._temp.dashedLine=cO}else{this._temp.dashedLine.setPath(cV);this._temp.dashedLine.show()}var cN=new M(cc.imgPath+"node.gif",new aH(11,11),{offset:new aH(5,5)});if(!this._temp.preTNode&&cQ){this._temp.preTNode=new ad(cQ,{icon:cN});this.map.addOverlay(this._temp.preTNode)}else{if(cQ){this._temp.preTNode.setPosition(cQ)}}if(!this._temp.nexTNode&&cM){this._temp.nexTNode=new ad(cM,{icon:cN});this.map.addOverlay(this._temp.nexTNode)}else{if(cM){this._temp.nexTNode.setPosition(cM)}}}});a8.extend(cn.prototype,{initialize:function(T){cF.prototype.initialize.call(this,T);this.setStrokeColor(this._config.strokeColor);this.setStrokeWeight(this._config.strokeWeight);this.setStrokeStyle(this._config.strokeStyle);this.setFillColor(this._config.fillColor);this.setStrokeOpacity(this._config.strokeOpacity);this.setFillOpacity(this._config.fillOpacity);return this.domElement},setPositionAt:function(cL,T){if(!this._userPoints[cL]){return}this._parseCache.length=0;this._userPoints[cL]=new cd(T.lng,T.lat);this.points[cL]=new cd(T.lng,T.lat);if(cL==0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new cd(T.lng,T.lat)}this._calcBounds();this.draw();this.dispatchEvent(new bg("onlineupdate"))},_onMarkerDragging:function(cT){this._editstate=true;var cM=cT.currentTarget;var cV=cT.point;var cU=cM.index;var T=this.vertexPoints;var cX;var cQ=T[1].p;var cW=T[T.length-1].p;var cR=null,cL=null;if(cU==0){var cS=T[cU+1].p;cX=[cW,cV,cS];if(!cM.t){cR=new cd((cW.lng+cV.lng)/2,(cW.lat+cV.lat)/2);cL=new cd((cS.lng+cV.lng)/2,(cS.lat+cV.lat)/2)}}else{if(cU==T.length-1){var cP=T[cU-1].p;cX=[cP,cV,cQ];if(!cM.t){cR=new cd((cP.lng+cV.lng)/2,(cP.lat+cV.lat)/2);cL=new cd((cQ.lng+cV.lng)/2,(cQ.lat+cV.lat)/2)}}else{var cP=T[cU-1].p;var cS=T[cU+1].p;cX=[cP,cV,cS];if(!cM.t){cP=T[cU-2].p;cS=T[cU+2].p;cX=[cP,cV,cS];cR=new cd((cP.lng+cV.lng)/2,(cP.lat+cV.lat)/2);cL=new cd((cS.lng+cV.lng)/2,(cS.lat+cV.lat)/2);if(this.vertexMarkers[cU-1]){this.vertexMarkers[cU-1].hide()}if(this.vertexMarkers[cU+1]){this.vertexMarkers[cU+1].hide()}}}}if(!this._temp.dashedLine){var cO=new f(cX,{strokeStyle:"dashed",strokeColor:this._config.strokeColor,strokeWeight:this._config.strokeWeight,strokeOpacity:this._config.strokeOpacity});this.map.addOverlay(cO);this._temp.dashedLine=cO}else{this._temp.dashedLine.setPath(cX)}var cN=new M(cc.imgPath+"node.gif",new aH(11,11),{offset:new aH(5,5)});if(!this._temp.preTNode&&cR){this._temp.preTNode=new ad(cR,{icon:cN});this.map.addOverlay(this._temp.preTNode)}else{if(cR){this._temp.preTNode.setPosition(cR)}}if(!this._temp.nexTNode&&cL){this._temp.nexTNode=new ad(cL,{icon:cN});this.map.addOverlay(this._temp.nexTNode)}else{if(cL){this._temp.nexTNode.setPosition(cL)}}}});a8.extend(a.prototype,{initialize:function(T){cn.prototype.initialize.call(this,T);this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();return this.domElement},setCenter:function(T,cL){if(!T){return}this._parseCache.length=0;if(!cL){this.vertexPoints=null}this.point=T;this.points=this._getPerimeterPoints(T,this.radius);this._calcBounds();this.draw();this.dispatchEvent(new bg("onlineupdate"))},setRadius:function(T,cL){if(isNaN(T)){return}this._parseCache.length=0;if(!cL){this.vertexPoints=null}this.radius=Math.abs(T);this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();this.draw();this.dispatchEvent(new bg("onlineupdate"))},getParseTolerance:function(T){if(this._config.getParseTolerance){return this._config.getParseTolerance(T)}return a.parseTolerance[this.getParseCacheIndex(T)]},_onMarkerDragging:function(cP){var cN,cR,cS,T=this.map;this._editstate=true;var cM=cP.currentTarget;var cQ=cM.index;var cL=this.vertexPoints;var cO=cL[0].p;var cT=cL[cL.length-1].p;if(cQ==0){cR=cM.getPosition();cS=cT}else{cR=cO;cS=cM.getPosition()}cN=ba.getDistanceByLL(cR,cS);this.setRadius(cN,true);this.setCenter(cR,true)},_onMarkerDragend:function(cM){this._editstate=false;var cL=cM.currentTarget;var T=cL.index;this.vertexPoints[0]={p:this.point,t:0};if(T==1){this.vertexPoints[1]={p:cL.point,t:0}}this.clearVertexs();this.addVertexs()},getVertexPoints:function(){if(!this.vertexPoints){var T=[];T.push({p:this.point,t:0});T.push({p:this.points[Math.floor(this.points.length*3/4)],t:0});this.vertexPoints=T}return this.vertexPoints}});function aO(T){this._map=T;this._canvasAttrName={strokeweight:"lineWidth",strokecolor:"strokeStyle",fillcolor:"fillStyle",strokeopacity:"globalAlpha",fillopacity:"globalAlpha"};this._type="canvas"}aO.prototype=new aI();var b8=aO.prototype;b8.addLine=function(){var cL=aa("canvas");this._map.getPanes().mapPane.appendChild(cL);cL.style.position="absolute";var T=cL.getContext("2d");T.lineCap="round";T.lineJoin="round";T.save();return cL};b8.setPath=function(cM,cL){if(!cM){return}var T=cM.getContext("2d");this._setCanvasPosition(cM);this._clearCanvas(T);var cO=parseInt(cM.style.top),cN=parseInt(cM.style.left);T.beginPath();a8.array.each(cL,function(cR){if(cR.length==0){return}T.moveTo(cR[0].x-cN,cR[0].y-cO);for(var cQ=1,cP=cR.length;cQ<cP;cQ++){T.lineTo(cR[cQ].x-cN,cR[cQ].y-cO)}});this._drawCanvas(cM)};b8.setAttribute=function(cN,cL,cO){if(!cN){return}var T=cN.getContext("2d");var cM=this._getAttributeName(cL);try{T[cM]=cO}catch(cP){}cN.setAttribute("_"+cL,cO||"");T.save();this._clearCanvas(T);this._drawCanvas(cN)};b8._getAttributeName=function(T){return this._canvasAttrName[T]||T};b8._setCanvasPosition=function(cO){var cL=this._map,cT=cL.config.drawMargin,cM=cL.width+2*cT,cQ=cL.height+2*cT,cN=-cL.offsetX-cT,cP=-cL.offsetY-cT,cS=cO.getContext("2d"),cR={strokeStyle:cS.strokeStyle,fillStyle:cS.fillStyle,globalAlpha:cS.globalAlpha,lineWidth:cS.lineWidth,lineCap:"round",lineJoin:"round"};cO.setAttribute("width",cM);cO.setAttribute("height",cQ);for(var T in cR){cS[T]=cR[T]}cS.save();var cU=cO.style;cU.top=cP+"px";cU.left=cN+"px"};b8._clearCanvas=function(T){T.clearRect(0,0,9999,9999)};b8._drawCanvas=function(cL){var T=cL.getContext("2d");T.globalAlpha=cL.getAttribute("_fillopacity");if(T.globalAlpha!=0&&cL.getAttribute("_fillcolor")){T.fill()}T.globalAlpha=cL.getAttribute("_strokeopacity");if(T.globalAlpha!=0&&cL.getAttribute("_strokecolor")){T.stroke()}};function aI(){}DrawerPrototype=aI.prototype;DrawerPrototype.setPalette=function(){};DrawerPrototype.addLine=function(){throw"addLine\u63a5\u53e3\u6ca1\u6709\u5b9e\u73b0"};DrawerPrototype.setAttribute=function(){throw"setAttribute\u63a5\u53e3\u6ca1\u6709\u5b9e\u73b0"};DrawerPrototype.setPath=function(){throw"setPath\u63a5\u53e3\u6ca1\u6709\u5b9e\u73b0"};DrawerPrototype.getType=function(){return this._type};var cr={getDrawer:function(T){if(!cr["_"+T.guid]){cr["_"+T.guid]={}}switch(T.config.drawer){case BMAP_SVG_DRAWER:return cr.getSvgDrawer(T);case BMAP_VML_DRAWER:return cr.getVmlDrawer(T);case BMAP_CANVAS_DRAWER:return cr.getCanvasDrawer(T);default:break}if(cr.isSupportSvg()){return cr.getSvgDrawer(T)}if(cr.isSupportVml()){return cr.getVmlDrawer(T)}if(cr.isSupportCanvas()){return cr.getCanvasDrawer(T)}},getSvgDrawer:function(T){if(!cr["_"+T.guid]._svgDrawer){cr["_"+T.guid]._svgDrawer=new bc(T)}return cr["_"+T.guid]._svgDrawer},getVmlDrawer:function(T){if(!cr["_"+T.guid]._vmlDrawer){cr["_"+T.guid]._vmlDrawer=new bT(T)}return cr["_"+T.guid]._vmlDrawer},getCanvasDrawer:function(T){if(!cr["_"+T.guid]._canvasDrawer){cr["_"+T.guid]._canvasDrawer=new aO(T)}return cr["_"+T.guid]._canvasDrawer},isSupportVml:function(){if(ch(cr.supportVml)){return cr.supportVml}var cM=document.body.appendChild(aa("div"));cM.innerHTML=\'<v:shape id="vml_tester1" adj="1" />\';var cL=cM.firstChild;if(!cL.style){return false}cL.style.behavior="url(#default#VML)";var T=cL?typeof cL.adj=="object":true;cM.parentNode.removeChild(cM);cr.supportVml=T;return T},isSupportSvg:function(){if(!ch(cr.supportSvg)){cr.supportSvg=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1")}return cr.supportSvg},isSupportCanvas:function(){if(!ch(cr.supportCanvas)){cr.supportCanvas=!!aa("canvas").getContext}return cr.supportCanvas}};BMap.DrawerSelector=cr;function bc(T){this._map=T;this.SVG_NS="http://www.w3.org/2000/svg";this._svgAttrName={strokeweight:"stroke-width",strokecolor:"stroke",fillcolor:"fill",strokeopacity:"stroke-opacity",fillopacity:"fill-opacity",strokestyle:"stroke-dasharray"};this._svg=this._createSvg();this._type="svg"}bc.prototype=new aI();var D=bc.prototype;D._createSvg=function(){var T=this._svg=aa("svg",{},this.SVG_NS);T.setAttribute("version","1.1");T.setAttribute("type","system");var cL=T.style;cL.position="absolute";this.setPalette();this._map.getPanes().mapPane.appendChild(T);a8.on(T,"mousedown",cC);return T};D.setPalette=function(){if(!this._svg){return}var cM=this._svg,cR=this._map,cL=cR.config.drawMargin,cO=cR.width+2*cL,T=cR.height+2*cL,cQ=-cR.offsetX-cL,cP=-cR.offsetY-cL;this.setAttribute(cM,"x",cO+"px");this.setAttribute(cM,"y",T+"px");this.setAttribute(cM,"viewBox",cQ+" "+cP+" "+cO+" "+T);var cN=cM.style;cN.top=cP+"px";cN.left=cQ+"px";cN.width=cO+"px";cN.height=T+"px"};D.getPalette=function(){return this._svg};D.setAttribute=function(cM,T,cN,cL){if(!cM){return}if(T=="strokestyle"){cN=cN=="solid"?0:cL*2}var cO=cN||"none";cM.setAttributeNS(null,this._getAttributeName(T),cO);return cM};D._getAttributeName=function(T){return this._svgAttrName[T]||T};D.addLine=function(){var T=aa("path",{},this.SVG_NS);this.setAttribute(T,"stroke-linejoin","round");this.setAttribute(T,"stroke-linecap","round");this.setAttribute(T,"fill-rule","evenodd");this._svg.appendChild(T);return T};D.setPath=function(cM,T){var cL=this._getPathString(T)||"M -9999,-9999";this.setAttribute(cM,"d",cL)};D._getPathString=function(T){if(T.length==0){return""}var cL=[];a8.array.each(T,function(cO){if(cO.length<2){return}cL.push("M "+cO[0].x+" "+cO[0].y+" L");for(var cN=1,cM=cO.length;cN<cM;cN++){cL.push(cO[cN].x);cL.push(cO[cN].y)}});return cL.join(" ")};function bT(T){this._map=T;this._vmlAttrName={strokeweight:"weight",strokecolor:"color",fillcolor:"color",strokeopacity:"opacity",fillopacity:"opacity",strokestyle:"dashstyle"};this._type="vml"}bT.colorMapping={orange:"#ffa500"};bT.prototype=new aI();var bB=bT.prototype;bB.setAttribute=function(cM,T,cN){if(cM){if(T.indexOf("stroke")==0){cM=cM.getElementsByTagName("stroke")[0]}else{if(T.indexOf("fill")==0){cM=cM.getElementsByTagName("fill")[0]}}if(T.indexOf("color")>0){if(!cN){cM.on=false}else{cM.on=true;if(bT.colorMapping[cN]){cN=bT.colorMapping[cN]}}}if(T=="strokestyle"){cN=cN=="solid"?"solid":"4 2 1 2"}if(T=="strokeweight"){cN=cN+"px"}var cL=this._getAttributeName(T);cM[cL]=cN||""}};bB._getAttributeName=function(T){return this._vmlAttrName[T]||T};bB.addLine=function(){var T=[\'<v:shape style="behavior:url(#default#VML);z-index:1;width:1px;height:1px;position:absolute;left:0;top:0;"\',\'coordsize="1,1" coordorigin="0,0" filled="t" fillcolor="white">\',\'<v:stroke style="behavior:url(#default#VML);" endcap="round" oned="true" />\',\'<v:fill style="behavior:url(#default#VML)" />\',"</v:shape>"].join("");return at(this._map.getPanes().mapPane,T)};bB.setPath=function(cL,T){this.setAttribute(cL,"path",this._getPathString(T));if(a8.browser.ie==6){cL.style.display="none";cL.style.display=""}};bB._getPathString=function(T){if(T.length==0){return""}var cL=[];a8.array.each(T,function(cO){if(cO.length<2){return}cL.push("m "+cO[0].x+" "+cO[0].y+" l");for(var cN=1,cM=cO.length;cN<cM;cN++){cL.push(cO[cN].x);cL.push(cO[cN].y)}cL.push("e")});return cL.join(" ")||" "};');
﻿_jsload&&_jsload('infowindow', 'a8.extend(bP.prototype,{initialize:function(cL){var cM=this.map=cL.map;this.overlay=cL;this.render();this._bind();if(this._config.enableMaximize){this.enableMaximize()}else{this.disableMaximize()}this.setTitle(this._config.title);this.setContent(this.content,true);if(this._config.ifMaxScene){this.setMaxScene(true)}this.redraw(null,true);var T=cM.infoWindowDoms;if(T){if(cL instanceof ad){T.marker=cL}else{T.marker=null}}},render:function(){var cQ=this.map,cN=this,cL=cQ.infoWindowDoms,cR=cN.IMG_PATH;if(!cL){cL=cQ.infoWindowDoms={};cQ.infoWindow=cQ.infoWindowDoms;var cM=[\'<div class="BMap_shadow" style="position: absolute;display:none" type="infowindow_shadow">\'];cM.push(\'<div><img onmousedown="return false" style="left: -323px; top: 0px;" src="\'+cR+\'iws3.png"/></div>\');cM.push(\'<div><img onmousedown="return false" style="left: -393px; top: 0px;" src="\'+cR+\'iws3.png"/></div>\');cM.push(\'<div><img onmousedown="return false" style="left: -1033px; top: 0px;" src="\'+cR+\'iws3.png"/></div>\');cM.push(\'<div><img onmousedown="return false" style="top: -30px;" src="\'+cR+\'iws3.png"/></div>\');cM.push(\'<div><img onmousedown="return false" style="left: -360px; top: -30px;" src="\'+cR+\'iws3.png"/></div>\');cM.push(\'<div><img onmousedown="return false" style="top: -30px;" src="\'+cR+\'iws3.png"/></div>\');cM.push(\'<div><img onmousedown="return false" style="left: -14px; top: -310px;" src="\'+cR+\'iws3.png"/></div>\');cM.push(\'<div><img onmousedown="return false" style="left: -255px; top: -310px;" src="\'+cR+\'iws3.png"/></div>\');cM.push(\'<div><img onmousedown="return false" style="left: -440px; top: -310px;" src="\'+cR+\'iws3.png"/></div>\');cM.push(\'<div><img onmousedown="return false" style="left: -255px; top: -310px;" src="\'+cR+\'iws3.png"/></div>\');cM.push(\'<div><img onmousedown="return false" style="left: -754px; top: -310px;" src="\'+cR+\'iws3.png"/></div>\');cM.push("</div>");cM.push(\'<div class="BMap_pop" style="position:absolute;display:none;cursor:default">\');cM.push(\'<div><div style="background:#fff;border-top:1px solid #ababab;border-left:1px solid #ababab;width:30px;height:30px;"></div></div>\');cM.push(\'<div class="BMap_top"></div>\');cM.push(\'<div><div style="position:absolute;top:0;left:-6px;background:#fff;border-top:1px solid #ababab;border-right:1px solid #ababab;width:30px;height:30px;"></div></div>\');cM.push(\'<div class="BMap_center"></div>\');cM.push(\'<div><div style="position:absolute;top:-6px;left:0;background:#fff;border-bottom:1px solid #ababab;border-left:1px solid #ababab;width:30px;height:30px;"></div></div>\');cM.push(\'<div class="BMap_bottom"></div>\');cM.push(\'<div><div style="position:absolute;top:-6px;left:-6px;background:#fff;border-right:1px solid #ababab;border-bottom:1px solid #ababab;width:30px;height:30px;"></div></div>\');cM.push(\'<div><img style="border:none;margin:0px;padding:0px;position:absolute;left:-186px;top:-691px;width:690px;height:786px;" src="\'+cR+\'iw3.png"/></div>\');cM.push(\'<div style="overflow-y:hidde;overflow-x:hidde;width:auto;height:auto;position:absolute;left:16px; top:16px;z-index:10;"></div>\');cM.push("</div>");cL.popDom=at(cQ.platform,cM.join(""));cL.shadowDom=cL.popDom.previousSibling;cL.popDivs=cL.popDom.children;cL.shadowDivs=cL.shadowDom.getElementsByTagName("div");cL.contentMain=cL.popDivs[8];cL.titleDiv=at(cL.popDivs[8],\'<div class="BMap_bubble_title" style="display:block;overflow:hidden;height:24px;line-height:24px;white-space:nowrap"></div>\');cL.contentDiv=at(cL.popDivs[8],\'<div class="BMap_bubble_content" style="display:block"></div>\');cL.maxContentDiv=at(cL.popDivs[8],\'<div class="BMap_bubble_max_content" style="display:none;position:relative"></div>\');var T=10;if(a8.platform.isIphone||a8.platform.isAndroid){T=20}var cO=\'<img style="position:absolute;top:12px;width:\'+T+"px;height:"+T+\'px;-moz-user-select:none;cursor:pointer;z-index:10000;" src="\'+cR+\'iw_close1d3.gif"/>\';cL.closeButton=at(cL.popDom,cO);var cP=\'<img style="position:absolute;top:12px;width:\'+T+"px;height:"+T+\'px;-moz-user-select:none;cursor:pointer;z-index:10000;display:none" src="\'+cR+\'iw_plus1d3.gif"/>\';cL.maxButton=at(cL.popDom,cP);this._mendIE6(cL)}cL.guid=cL.popDom.guid=this.guid},_mendIE6:function(cN){if(!a8.browser.ie||a8.browser.ie>6){return}var cM=cN.popDom.getElementsByTagName("IMG");for(var cL=0;cL<cM.length;cL++){if(cM[cL].src.indexOf(".png")<0){continue}cM[cL].style.cssText+=";FILTER: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+cM[cL].src+",sizingMethod=crop)";cM[cL].src=this.IMG_PATH+"blank.gif"}var T=cN.shadowDom.getElementsByTagName("IMG");for(var cL=0;cL<T.length;cL++){T[cL].style.cssText+=";FILTER: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+T[cL].src+",sizingMethod=crop)";T[cL].src=this.IMG_PATH+"blank.gif"}},_bind:function(){var cQ=this,cR=cQ.map,cN=cR.infoWindowDoms,cM=cN.closeButton,cO=cN.popDom;var cL=function(cS){cQ.dispatchEvent(new bg("onclickclose"));cQ.overlay&&cQ.overlay.closeInfoWindow();co(cS)};cM.onclick=cL;var cP=["touchstart","touchmove","gesturestart","gesturechange","mousedown","mouseout","mouseover","click","mousewheel","keydown","selectstart"];a8.array.each(cP,function(cS){a8.on(cO,cS,aP)});a8.on(cO,"dblclick",co);a8.on(cO,"contextmenu",co);if(a8.browser.firefox>=4){a8.on(cO,"mouseup",function(cS){if(cS.button==2){co(cS)}})}if(window.addEventListener){cO.addEventListener("DOMMouseScroll",aP,false)}var T=function(cT){var cS=cQ.map.infoWindowDoms.maxButton;if(!cQ.isWinMax){cQ.maximize()}else{cQ.restore()}co(cT)};cN.maxButton.onclick=T;if(aA()){a8.on(cM,"touchend",cL);a8.on(cN.maxButton,"touchend",T)}cO=cM=cN=null},_setWinSize:function(cT,cS){var c3=this._config;cT=cT||c3.width;cS=cS||c3.height;if(cS<0){cS=0}var cN=c3.offset.width;var cR=c3.offset.height;var c2=[25,-1,25,-1,25,-1,25,34];var cM=[25,-1,25,-1,25,-1,25,50];c2[1]=cT-c2[0]-c2[2];if(a8.browser.ie&&document.compatMode!="CSS1Compat"){c2[3]=cT}else{c2[3]=cT-2}c2[5]=cT-c2[4]-c2[6];cM[1]=cM[0];cM[3]=cS-cM[0]-cM[4];if(a8.browser.ie&&document.compatMode!="CSS1Compat"){cM[5]=cM[4]}else{cM[5]=cM[4]-1}var c4=[0,c2[0],cT-c2[2],0,0,c2[4],cT-c2[6],Math.ceil((cT-c2[7])/2)];var cY=[0,0,0,cM[0],cS-c2[4],cS-c2[4],cS-c2[4],cS-c2[4]];var cL=this._allPopLeft=cN-Math.round((cT-c2[7])/2);var cZ=this._allPopTop=cR-cS-24;var c5=Math.floor((cS+cM[7])/2.03)+30;var cP=[70,-1,70,-1,-1,-1,50,-1,140,-1,70];var cX=[30,30,30,25,25,25,60,60,60,60,60];cP[7]=Math.round((cT+80-(cP[6]+cP[8]+cP[10])-50)/2);cP[9]=cP[7]+50;var c1=cP[6]+cP[7]+cP[8]+cP[9]+cP[10];cP[1]=c1-cP[0]-cP[2]-29;cP[5]=cP[3]=c5-cX[0]-cX[6]+70;cX[3]=cX[4]=cX[5]=c5-cX[0]-cX[6];cP[4]=(cP[0]+cP[1]+cP[2]+cX[3]+29)-cP[5]-cP[3];var T=[c5-60-1,c5-60-1+cP[0],c5-60-1+cP[0]+cP[1],29,29+cP[3],29+cP[3]+cP[4],0,cP[6],cP[6]+cP[7],cP[6]+cP[7]+cP[8],cP[6]+cP[7]+cP[8]+cP[9]];var cW=[0,0,0,cX[0],cX[0],cX[0],cX[0]+cX[3],cX[0]+cX[3],cX[0]+cX[3],cX[0]+cX[3],cX[0]+cX[3]];this._allShadowLeft=cN-cP[6]-cP[7]-70;this._allShadowTop=cR-c5+30;var cO=323-c5+90;shadowRightImageLeft=740+cO;var c0=function(c6){return"overflow: hidden; z-index: 1; position: absolute;              left:"+c4[c6]+"px;              top:"+cY[c6]+"px;              width:"+c2[c6]+"px;              height:"+cM[c6]+"px"};var cU=function(c6){return"overflow: hidden; z-index: 1; position: absolute;              left:"+T[c6]+"px;              top:"+cW[c6]+"px;              width:"+cP[c6]+"px;              height:"+cX[c6]+"px;"};var cQ=this.map.infoWindowDoms;if(cQ&&cQ.popDivs){for(var cV=0;cV<8;cV++){cQ.popDivs[cV].style.cssText=c0(cV)}}if(cQ&&cQ.shadowDivs){for(var cV=0;cV<cQ.shadowDivs.length;cV++){cQ.shadowDivs[cV].style.cssText=cU(cV)}cQ.shadowDivs[3].firstChild.style.left="-"+cO+"px";cQ.shadowDivs[5].firstChild.style.left="-"+shadowRightImageLeft+"px"}this.setPosition()},setWidth:function(T){T=T*1;if(!T&&T!=0||isNaN(T)||T<0){return}if(T!=0){if(T<220){T=220}if(T>730){T=730}}this._config.width=T;if(this._isMyDom()&&this.isOpen()){var cL=this;this.redraw(function(){cL.setPanToWithDelay()})}},setHeight:function(T){T=T*1;if(!T&&T!=0||isNaN(T)||T<0){return}if(T!=0){if(T<60){T=60}if(T>650){T=650}}this._config.height=T;var cM=this.map;if(this._isMyDom()&&this.isOpen()){if(this._config.width!=0){cM.infoWindowDoms.contentDiv.style.width=this._config.width+"px"}var cL=this;this.redraw(function(){cL.setPanToWithDelay()})}},setMaxWidth:function(T){T=T*1;if(!T&&T!=0||isNaN(T)||T<0){return}if(T!=0){if(T<220){T=220}if(T>730){T=730}}this._config.maxWidth=T;if(this.isWinMax){this.redraw()}},setTitle:function(cN){this._config.title=cN;if(!this._isMyDom()){return}var cM=this.map;var cL=cM.infoWindowDoms.titleDiv;if(!cN){a8.dom.hide(cL)}else{if(b3(cN)){cL.innerHTML=cN}else{cL.innerHTML="";cL.appendChild(cN)}a8.dom.show(cL)}var T=this;this.redraw(function(){T.setPanToWithDelay()})},setContent:function(cN,cP){this.content=cN;if(!this._isMyDom()){return}if(this.isWinMax){return}var cO=this.map;var cL=cO.infoWindowDoms.contentDiv;var T=cO.infoWindowDoms.maxContentDiv;if(b3(cN)){cL.innerHTML=cN}else{cL.innerHTML="";cL.appendChild(cN)}if(this._config.width!=0){cL.style.width=this._config.width+"px"}T.style.display="none";cL.style.display="";if(!cP){var cM=this;this.redraw(function(){cM.setPanToWithDelay()})}},setMaxContent:function(cL){if(!cL){cL=this._config.maxContent}else{this._config.maxContent=cL}var cM=this.map;if(!this._isMyDom()){return}var T=cM.infoWindowDoms;T.maxContentDiv.innerHTML=cL;if(!this.isWinMax){return}T.contentDiv.style.display="none";T.maxContentDiv.style.display=""},redraw:function(cU,cQ){if(!this._isMyDom()){return}if(!cQ&&!this.isOpen()){return}var cM=this,cP=1,cN=cM.map.infoWindowDoms,cL=0;cU=cU||function(){};if(cN.titleDiv.style.display!="none"){cL=24}var cO=7,cT=20;if(a8.platform.isIphone||a8.platform.isAndroid){cO=-1;cT=25}if(this.isWinMax){cS=cM._config.maxWidth;setTimeout(function(){var cW=cL+cN.maxContentDiv.scrollHeight;cW=cW>cM.map.height?cM.map.height-60:cW;cS=cS<220?220:cS;cS=cS>600?600:cS;cW=cW<55?55:cW;cW=cW>440?440:cW;cM._setWinSize(cS+32,cW+32);cN.contentMain.style.width=cS+"px";cN.contentMain.style.height=cW+"px";cN.closeButton.style.left=cS+cO+"px";cN.maxButton.style.left=cS-cT+cO+"px";cN.contentMain.style.overflow="hidden";cM.dispatchEvent(new bg("onresize"));cU()},cP)}else{var cV=cN.contentDiv.style,cR=cN.titleDiv.style,T=cN.contentMain.style;cV.width=T.width=cR.width="auto";cV.height=T.height=cR.height="auto";cV.whiteSpace="nowrap";if(cN.popDom.style.display=="none"){this.show()}cN.popDom.style.visibility="hidden";cN.shadowDom.style.visibility="hidden";var cS=cN.contentMain.clientWidth||0;cS=cM._config.width==0?cS:cM._config.width;cS=cS<220?220:cS;cS=cS>600?600:cS;T.width=cS+"px";h=cN.contentMain.scrollHeight||0;h=cM._config.height==0?h:cM._config.height;cM._setWinSize(cS+32,h+32);setTimeout(function(){cV.whiteSpace="";if(cM._config.width==0){T.overflowX="hidden"}else{T.overflowX="auto"}if(cM._config.height==0){T.overflowY="hidden"}else{T.overflowY="auto"}h=cN.contentMain.scrollHeight||0;h=cM._config.height==0?h:cM._config.height;h=h<55?55:h;h=h>440?440:h;cM._setWinSize(cS+32,h+32);cN.popDom.style.visibility="";cN.shadowDom.style.visibility="";T.height=h+"px";cN.closeButton.style.left=cS+cO+"px";cN.maxButton.style.left=cS-cT+cO+"px";cM.dispatchEvent(new bg("onresize"));cU()},cP)}},setPosition:function(){if(!this._isMyDom()){return}var T=this.map.infoWindowDoms,cL=this.overlay,cN=this.map.pointToOverlayPixel(cL.getPosition()),cM=cL.getIcon(),cO=new bu(cN.x-cM.anchor.width+cM.infoWindowAnchor.width+cL.getOffset().width,cN.y-cM.anchor.height+cM.infoWindowAnchor.height+cL.getOffset().height);T.popDom.style.left=this._allPopLeft+cO.x+"px";T.popDom.style.top=this._allPopTop+cO.y+"px";T.shadowDom.style.left=this._allShadowLeft+cO.x+"px";T.shadowDom.style.top=this._allShadowTop+cO.y+"px"},setPanToWithDelay:function(T){var cL=this;setTimeout(function(){cL.setPanTo()},T||200)},setPanTo:function(){if(!this.overlay||!this.overlay.getPosition()||!this._config.enableAutoPan||!this._isMyDom()){return}var c0=this.map;var cS=c0.infoWindowDoms;var cM=cS.popDivs;var c1=cS.popDom;if(!cM||!c1){return}var cN=parseInt(cM[3].style.width)+2;var cX=parseInt(cM[1].style.height)+parseInt(cM[3].style.height)+parseInt(cM[7].style.height);var cV=parseInt(c1.style.left)+this.map.offsetX;var cP=parseInt(c1.style.top)+this.map.offsetY;var cR=new bu(cV,cP);var cQ=new bu(cN+cV,cX+cP);if(this._config.height!=0&&document.all){if(!c0.temp.infoKey){c0.temp.infoKey=-1}var cY=-c0.temp.infoKey;c0.temp.infoKey=-c0.temp.infoKey}var cY=0;var cW=0;var T=10;var cL=this._config.margin[0];var cO=this._config.margin[1];var cZ=this._config.margin[2];var cT=this._config.margin[3];if(cR.x<cT){cY=-cR.x+cT}if(cR.y<cL){cW=-cR.y+cL}if(cQ.x>c0.width-cO){cY=c0.width-cQ.x-cO}if(cQ.y>c0.height-cZ){cW=c0.height-cQ.y-cZ}this._loadCollisions();var cU=this._config.collisions;if(cR.x<cU[0][0]&&cR.y<cU[0][1]){if(Math.abs(-cR.x+cU[0][0])<Math.abs(-cR.y+cU[0][1])){cY=-cR.x+cU[0][0]}else{if(c0.height-cU[0][1]-cU[3][1]<cX){cY=-cR.x+cU[0][0]}else{cW=-cR.y+cU[0][1]}}if(c0.width-cU[0][0]-cU[1][0]<cN&&cR.y<cU[1][1]){cW=-cR.y+cU[1][1]}}if(cQ.x>c0.width-cU[1][0]&&cR.y<cU[1][1]){if(Math.abs(-cQ.x+c0.width-cU[1][0])<Math.abs(-cR.y+cU[1][1])&&c0.width-cU[0][0]-cU[1][0]>=cN){cY=-cQ.x+c0.width-cU[1][0]}else{cW=-cR.y+cU[1][1];if(c0.width-cU[0][0]-cU[1][0]<cN&&c0.width-cU[0][0]<cN){cY=-cR.x+cU[0][0]}}}if(cR.x<cU[3][0]&&cQ.y>c0.height-cU[3][1]){if(Math.abs(-cR.x+cU[3][0])<Math.abs(-cQ.y+c0.height-cU[3][1])&&(Math.abs(-cR.x+cU[3][0])<Math.abs(cW)&&cW!=0||cW==0)&&c0.width-cU[3][0]>=cN){cY=-cR.x+cU[3][0]}else{cW=-cQ.y+c0.height-cU[3][1]}if(c0.height-cU[0][1]-cU[3][1]<cX&&cR.x<cU[0][0]){cY=-cR.x+cU[0][0]}}if(cQ.x>c0.width-cU[2][0]&&cQ.y>c0.height-cU[2][1]){if(Math.abs(-cQ.x+c0.width-cU[2][0])<Math.abs(-cQ.y+c0.height-cU[2][1])&&(Math.abs(-cQ.x+c0.width-cU[2][0])<Math.abs(cW)&&cW!=0||cW==0)&&c0.width-cU[0][0]-cU[1][0]>=cN){cY=-cQ.x+c0.width-cU[2][0]}else{if(c0.height-cU[1][1]-cU[2][1]>=cX){cW=-cQ.y+c0.height-cU[2][1]}else{cW=-cR.y+cU[1][1]}if(c0.width-cU[0][0]-cU[2][0]<cN){cY=-cR.x+cU[0][0]}}}if(cY!=0||cW!=0){c0.panBy(cY,cW)}},_loadCollisions:function(){if(!this.map){return}var cL=this.map;this._config.collisions=[[10,10],[10,10],[10,10],[10,10]];var cU=this.map.container;for(var cS=0,cM=cU.children.length;cS<cM;cS++){var cP,cV,cY=!!(ch(cU.children[cS]._anchor)&&cU.children[cS]._offset);if(cU.children[cS]._jsobj&&cU.children[cS]._jsobj instanceof cp&&cU.children[cS]._jsobj.blockInfoWindow==true){cP=cU.children[cS]}else{if(cY){cP=cU.children[cS]}else{continue}}var cW=cP.offsetWidth,cT=cP.offsetHeight,T=cP._jsobj,cO,cR;if(!T||cY){if(ch(cP._anchor)&&cP._offset&&aJ(cP).display!="none"&&aJ(cP).visibility!="hidden"){cO=cP._offset;cR=cP._anchor}else{continue}}else{if(T.isVisible()==false){continue}cO=T.getOffset();cR=T.getAnchor()}switch(cR){case BMAP_ANCHOR_TOP_LEFT:cV=0;break;case BMAP_ANCHOR_TOP_RIGHT:cV=1;break;case BMAP_ANCHOR_BOTTOM_LEFT:cV=3;break;case BMAP_ANCHOR_BOTTOM_RIGHT:cV=2;break;default:break}var cQ=cW+cO.width+10,cN=cT+cO.height+10,cX=this._config.collisions[cV];this._config.collisions[cV]=[cQ>cX[0]?cQ:cX[0],cN>cX[1]?cN:cX[1]]}},enableMaximize:function(){this._config.enableMaximize=true;if(this._isMyDom()){this.map.infoWindowDoms.maxButton.style.display="block"}},disableMaximize:function(){this._config.enableMaximize=false;if(this._isMyDom()){this.map.infoWindowDoms.maxButton.style.display="none"}},show:function(){if(!this._isMyDom()){return}var cL=this.map.infoWindowDoms;if(cL.popDom.style.display!="none"){return}if(cJ(this.content)){cL.contentDiv.appendChild(this.content)}if(cJ(this._config.title)){cL.titleDiv.appendChild(this._config.title)}a8.dom.show(cL.popDom);a8.dom.show(cL.shadowDom);var T=new bg("onopen");T.point=this.getPosition();this.dispatchEvent(T);this.redraw()},hide:function(){if(!this._isMyDom()){return false}var cL=this.map.infoWindowDoms;if(cL.popDom.style.display=="none"){return false}if(this._config.onClosing()==false){return false}if(cJ(this.content)){cL.contentDiv.removeChild(this.content)}if(cJ(this._config.title)){cL.titleDiv.removeChild(this._config.title)}a8.dom.hide(cL.popDom);a8.dom.hide(cL.shadowDom);if(this.isWinMax){this.isWinMax=false;cL.maxContentDiv.style.display="none";cL.contentDiv.style.display="";cL.maxButton.src=this.IMG_PATH+"iw_plus1d3.gif"}var T=new bg("onclose");T.point=this.getPosition();this.dispatchEvent(T);if(this.map.temp._clickCloseBindTimer){clearTimeout(this.map.temp._clickCloseBindTimer);this.map.temp._clickCloseBindTimer=null}else{this.map.removeEventListener("click",this.map.temp._clickCloseHandler);this.map.temp._clickCloseBinded=false}a8.lang.decontrol(this.guid);return true},maximize:function(){if(!this.map||!this.isOpen()||!this._config.enableMaximize||this.isWinMax){return}if(!this._isMyDom()){return}var cL=this.map.infoWindowDoms.maxButton;var T=this;T.isWinMax=true;cL.src=T.IMG_PATH+"iw_minus1d3.gif";T.setMaxContent();T.map.infoWindowDoms.maxContentDiv.style.display="block";T.redraw();T.dispatchEvent(new bg("onmaximize"));T.setPanToWithDelay()},restore:function(){if(!this.map||!this.isOpen()||!this.isWinMax){return}if(!this._isMyDom()){return}this.isWinMax=false;var T=this;var cL=T.map.infoWindowDoms.maxButton;cL.src=T.IMG_PATH+"iw_plus1d3.gif";T.setContent(this.content,true);T.map.infoWindowDoms.maxContentDiv.style.display="none";T.redraw();T.dispatchEvent(new bg("onrestore"));T.setPanToWithDelay()},_revert:function(){if(!this._isMyDom()){return}this.isWinMax=false;var T=this.map.infoWindowDoms;T.titleDiv.innerHTML="";T.contentDiv.innerHTML="";T.maxContentDiv.innerHTML="";T.maxButton.src=this.IMG_PATH+"iw_plus1d3.gif"},_setOverflow:function(){var cM=this.map;if(!this._isMyDom()){return}var cL=cM.infoWindowDoms,T=cL.contentMain.style;cL._overflowX=T.overflowX;cL._overflowY=T.overflowY;T.overflowX="hidden";T.overflowY="hidden"},_resetOverflow:function(){var cM=this.map;if(!this._isMyDom()||!cM.infoWindowDoms._overflowX||!cM.infoWindowDoms._overflowY){return}var cL=cM.infoWindowDoms,T=cL.contentMain.style;T.overflowX=cL._overflowX;T.overflowY=cL._overflowY;delete cL._overflowX;delete cL._overflowY},isOpen:function(){if(!this.map){return false}var T=this.map.temp.infoWin;if(!T){return false}if(!this._isMyDom()){return false}if(T&&T.overlay===this.overlay&&this.map.infoWindowDoms&&this.map.infoWindowDoms.popDom.style.display=="none"){return false}else{return true}},setMaxScene:function(cL){var cM=this;if(!this._isMyDom()){return}var T=cM.map.infoWindowDoms;T.maxButton.style.display="block";var cN=T.maxButton;if(!!cL==!!this.isWinMax){return}if(cL){cM.isWinMax=true;cN.src=cM.IMG_PATH+"iw_minus1d3.gif";cM.setMaxContent();T.maxContentDiv.style.display="block"}else{cM.isWinMax=false;cN.src=cM.IMG_PATH+"iw_plus1d3.gif";cM.setContent(this.content,true);T.maxContentDiv.style.display="none"}this.redraw()},_draw:function(){if(this._visible==true&&this.overlay){this.overlay.openInfoWindow(this)}},_isMyDom:function(){return(this.map&&this.map.infoWindowDoms&&this.map.infoWindowDoms.guid==this.guid)}});Y.prototype.openInfoWindow=function(cN){var cM=this.map;if(!cM||!this.domElement||this.isVisible()==false||!cN instanceof bP){return}var cL=cM.temp;if(cL.infoWin&&cL.infoWin.overlay&&cL.infoWin.overlay._fromMap){cM.closeInfoWindow()}if(cL.infoWin===cN&&cL.infoWin.isOpen()&&cL.infoWin.overlay===this){cN.setPanToWithDelay();return}cM.closeInfoWindow();this.infoWindow=cN;if(cL.infoWin==null||cL.infoWin!=cN){if(cM.infoWindowDoms){cM.infoWindowDoms.closeButton.onclick=null;cM.infoWindowDoms.maxButton.onclick=null}cL.infoWin=cN;cN.initialize(this)}else{cN.redraw(null,true)}a8.lang.Class.call(cN,cN.guid);if(!cL._clickCloseHandler){cL._clickCloseHandler=function(cO){if(!cO.overlay){if(cM.temp.infoWin&&cM.temp.infoWin._config.enableCloseOnClick){cM.closeInfoWindow();cM.removeEventListener("click",arguments.callee);cL._clickCloseBinded=false}}}}if(!cL._clickCloseBinded){cL._clickCloseBindTimer=setTimeout(function(){cM.addEventListener("click",cL._clickCloseHandler);cL._clickCloseBinded=true;cL._clickCloseBindTimer=null},200)}if(cL._infoWin){delete cL._infoWin}cN.overlay=this;var T=cM.infoWindowDoms;this.map.getPanes().floatPane.appendChild(T.popDom);this.map.getPanes().floatShadow.appendChild(T.shadowDom);cN.setPanToWithDelay();this.dispatchEvent(new bg("oninfowindowopen"))};Y.prototype.closeInfoWindow=function(){if(!this.map||!this.map.infoWindowDoms){return}var cL=this;if(cL.infoWindow&&cL.infoWindow.guid==cL.map.infoWindowDoms.guid){try{if(cL.infoWindow.hide()==true){cL.dispatchEvent(new bg("oninfowindowclose"));cL.map.temp.infoWin=cL.infoWindow=null}}catch(T){}}};');
_jsload&&_jsload('menu', 'a8.object.extend(cz.prototype,{initialize:function(cO,cL){if(this._container){return false}this._map=cO;this._overlay=cL||null;this._render();var cN=this;var cP=cO.config.defaultCursor;if(cL&&cL._config.clickable){cP="pointer"}this._container.style.cursor=cP;if(this._shadow){this._shadow.style.cursor=cP}a8.on(document,"mousedown",function(cR){if(!cN._container){return}cN.hide()});a8.on(this._container,"click",function(cR){cN.hide();aP(cR)});var cQ=this._opts.container;if(!cQ){cQ=cO.container}if(!this._overlay){cO.addEventListener("rightclickex",function(cR){if(!cN._container||cR.overlay||cR.infoWindow){return}cN._showMenu(cR)})}else{this._overlay.addEventListener("rightclick",function(cR){if(!cN._container){return}cN._showMenu(cR)})}for(var cM=0,T=this._items.length;cM<T;cM++){if(this._items[cM]._type=="menuitem"){this._items[cM].initialize(cO,this)}if(this._items[cM]._type=="divider"){this._dividers[this._items[cM]._dIndex].dom=at(this._container,"<div class=\'BMap_cmDivider\'></div>")}}this._updateShadowSize()},_draw:function(){if(this._map){this.initialize(this._map,this._overlay);if(this._isOpen){this._isOpen=false;this.show()}}},remove:function(){if(this._container){this._container.parentNode.removeChild(this._container);this._container=null}if(this._shadow){this._shadow.parentNode.removeChild(this._shadow);this._shadow=null}for(var cL=0,T=this._items.length;cL<T;cL++){if(this._items[cL]._type=="menuitem"){this._items[cL]._container=null}}this._map=this._overlay=null},_render:function(){this._container=at(this._map.container,"<div unselectable=\'on\'></div>");this._container.className="BMap_contextMenu";var T=this._container.style;T.font="12px "+cc.fontFamily;if(a8.browser.ie<9){this._shadow=at(this._map.container,"<div class=\'BMap_cmShadow\'></div>")}else{T.boxShadow=T.MozBoxShadow=T.WebkitBoxShadow="1px 2px 6px #666"}return this._container},addItem:function(cM){if(!cM||cM._type!="menuitem"||cM._text==""||cM._width<=0){return}for(var cL=0,T=this._items.length;cL<T;cL++){if(this._items[cL]===cM){return}}this._items.push(cM);this._rItems.push(cM);if(!this._map){return}cM.initialize(this._map,this);a8.dom.addClass(cM.getDom(),"BMap_cmLstItem");if(this._items.length>1){this._items[this._items.length-2]._type=="menuitem"&&a8.dom.removeClass(this._items[this._items.length-2].getDom(),"BMap_cmLstItem")}else{this._items[0]._type=="menuitem"&&a8.dom.addClass(this._items[0].getDom(),"BMap_cmFstItem")}this._updateShadowSize()},removeItem:function(cM){if(!cM||cM._type!="menuitem"){return}for(var cL=0,T=this._items.length;cL<T;cL++){if(this._items[cL]===cM){this._items[cL].remove();this._items.splice(cL,1);T--}}for(var cL=0,T=this._rItems.length;cL<T;cL++){if(this._rItems[cL]===cM){this._rItems[cL].remove();this._rItems.splice(cL,1);T--}}if(!this._container){return}if(this._items.length>0){this._items[this._items.length-1]._type=="menuitem"&&a8.dom.addClass(this._items[this._items.length-1].getDom(),"BMap_cmLstItem")}this._updateShadowSize()},addSeparator:function(){this._items.push({_type:"divider",_dIndex:this._dividers.length});this._dividers.push({dom:null});if(!this._container){return}var T="<div class=\'BMap_cmDivider\'></div>";this._dividers[this._dividers.length-1].dom=at(this._container,T);this._updateShadowSize()},removeSeparator:function(cL){if(!this._dividers[cL]){return}if(this._dividers[cL].dom&&this._dividers[cL].dom.parentNode){this._dividers[cL].dom.parentNode.removeChild(this._dividers[cL].dom)}for(var cM=0,T=this._items.length;cM<T;cM++){if(this._items[cM]&&this._items[cM]._type=="divider"&&this._items[cM]._dIndex==cL){this._items.splice(cM,1);T--}if(this._items[cM]&&this._items[cM]._type=="divider"&&this._items[cM]._dIndex>cL){this._items[cM]._dIndex--}}this._dividers.splice(cL,1);this._updateShadowSize()},setPosition:function(T,cL){this._left=T;this._top=cL;this._container.style.left=T+"px";this._container.style.top=cL+"px";if(this._shadow){this._shadow.style.left=T+1+"px";this._shadow.style.top=cL+2+"px"}},show:function(){if(this._isOpen==true){return}if(this._rItems.length==0){return}this._isOpen=true;if(this._container){this._container.style.visibility="visible"}if(this._shadow){this._shadow.style.visibility="visible"}var T=new bg("onopen");T.point=this.curPoint;T.pixel=this.curPixel;this.dispatchEvent(T)},hide:function(){if(this._isOpen==false){return}this._isOpen=false;if(this._container){this._container.style.visibility="hidden"}if(this._shadow){this._shadow.style.visibility="hidden"}var T=new bg("onclose");T.point=this.curPoint;T.pixel=this.curPixel;this.dispatchEvent(T)},setCursor:function(T){if(!T){return}this._opts.cursor=T;if(this._container){this._container.style.cursor=this._opts.cursor}if(this._shadow){this._shadow.style.cursor=this._opts.cursor}},_updateShadowSize:function(){if(this._container&&this._shadow){this._shadow.style.width=this._container.offsetWidth+"px";this._shadow.style.height=this._container.offsetHeight+"px"}},_showMenu:function(cP){if(this._rItems.length==0){return}var cM=this;cM.curPixel=cP.pixel;cM.curPoint=cM._map.pixelToPoint(cM.curPixel);var cL=cM.getDom().offsetHeight;var T=cM.getDom().offsetWidth;var cO=cP.pixel.x;var cN=cP.pixel.y;if(cP.pixel.x+T>this._map.width){cO=cP.pixel.x-T}if(cP.pixel.y+cL>this._map.height){cN=cP.pixel.y-cL}cM.setPosition(cO,cN);cM.show()}});a8.object.extend(be.prototype,{initialize:function(T,cL){if(this._container){return false}this._map=T;this._contextmenu=cL;if(cL.getDom()){this._render();this._bind();if(!this._enabled){this._enabled=true;this.disable()}}return true},remove:function(){var T=this;if(this._container){this._container.parentNode.removeChild(this._container);this._container=null}this._contextmenu=null;this._map=null},_draw:function(){if(this._contextmenu&&this._map){this.initialize(this._map,this._contextmenu)}},_render:function(){var T="<div"+(this._opts.id?" id=\'"+this._opts.id+"\'":"")+" unselectable=\'on\'><span>"+this._text+"</span></div>";this._container=at(this._contextmenu.getDom(),T);var cL=this._container.style;cL.padding="2px 6px";cL.margin="0 2px";cL.fontSize="12px";cL.MozUserSelect="none";cL.lineHeight="17px";cL.width=this._opts.width+"px";if(this._enabled){cL.color="#000";cL.cursor="pointer"}else{cL.color="#aaa";cL.cursor=this._map.config.defaultCursor}return this._container},_bind:function(){var T=this;a8.on(this._container,"click",function(cL){if(!T._enabled){aP(cL);return}if(T._callback&&T._callback.call){T._callback.call(T,T._contextmenu.curPoint,T._contextmenu.curPixel,T._contextmenu._overlay)}});a8.on(this._container,"mousedown",function(cL){aP(cL)});a8.on(this._container,"mouseover",function(){if(!T._enabled){return}T._container.style.color="#6688cc"});a8.on(this._container,"mouseout",function(){if(!T._enabled){return}T._container.style.color="#000"})},setText:function(T){if(!T){return}this._text=T+"";if(this._container){this._container.innerHTML="<span>"+this._text+"</span>"}},enable:function(){this._enabled=true;if(this._container){this._container.style.color="#000";this._container.style.cursor="pointer"}},disable:function(){this._enabled=false;if(this._container){this._container.style.color="#aaa";this._container.style.cursor=this._map.config.defaultCursor}}});');
﻿_jsload&&_jsload('oppc', 'function cH(){this._container=null}BMap.register(function(cL){if(cL.config.isOverviewMap){return}var T=new cH();at(cL.container,T.render(cL.config.defaultCursor));T._container=cL.container.lastChild;cL.temp.zoomer=T});cH.prototype.render=function(cL){var T=[\'<div id=zoomer style="position:absolute;z-index:0;top:0px;left:0px;overflow:hidden;visibility:hidden;cursor:\'+cL+\'">\'];T.push(\'<div class="BMap_zoomer" style="top:0;left:0;"></div>\');T.push(\'<div class="BMap_zoomer" style="top:0;right:0;"></div>\');T.push(\'<div class="BMap_zoomer" style="bottom:0;left:0;"></div>\');T.push(\'<div class="BMap_zoomer" style="bottom:0;right:0;"></div>\');T.push("</div>");return T.join("")};cH.prototype.action=function(cS,cT){if(cH._timeline){return}var cR=this._container;if(!cR){return}var c0=cT;var cM=60;var cZ=120;var cU=4/3,cO=Math.ceil((c0?cM:cZ)/2),cP=Math.max(15,cO/cU),cQ=cR.style;cQ.width=cO*2+"px";cQ.height=cP*2+"px";cQ.visibility="visible";var cW=cR.children;if(c0){cW[0].style.backgroundPosition="0 0";cW[1].style.backgroundPosition="-7px 0";cW[2].style.backgroundPosition="0 -7px";cW[3].style.backgroundPosition="-7px -7px"}else{cW[0].style.backgroundPosition="-7px -7px";cW[1].style.backgroundPosition="0 -7px";cW[2].style.backgroundPosition="-7px 0";cW[3].style.backgroundPosition="0 0"}cW=null;var cY=cS.x-cO;var cX=cS.y-cP;if(isNaN(cY)||isNaN(cX)){return}cQ.left=cY+"px";cQ.top=cX+"px";var cL=Math.ceil((c0?cZ:cM)/2);var cN=Math.max(15,cL/cU);cL=cL-cO;cN=Math.ceil(cN-cP);var cV=this;var T=cV._container.style;if(cH._timeline){cH._timeline.end()}cH._timeline=new g({fps:20,duration:240,transition:aw.easeInQuad,delay:100,render:function(c2){if(c2<0.1){return}var c3=Math.ceil(cL*c2);var c1=Math.ceil(cN*c2);T.width=(cO+c3)*2+"px";T.height=(cP+c1)*2+"px";T.left=cY-c3+"px";T.top=cX-c1+"px"},finish:function(){cH._timeline=false;setTimeout(function(){cQ.visibility="hidden"},300)}})};BMap.register(function(cP){var cO=cP;var cN=cP.platform;function cQ(c0,cW){var cS=c0.srcElement||c0.target,cZ=c0.offsetX||c0.layerX||0,cY=c0.offsetY||c0.layerY||0,cV=null,cU=null;if(cS.nodeType!=1){cS=cS.parentNode}while(cS&&cS!=cO.container){if(cS.guid){if(a8.lang.instance(cS.guid) instanceof Y){cV=a8.lang.instance(cS.guid)}if(a8.lang.instance(cS.guid) instanceof bP){cU=a8.lang.instance(cS.guid)}}if(!(cS.clientWidth==0&&cS.clientHeight==0&&cS.offsetParent&&cS.offsetParent.nodeName=="TD")&&cS.namespaceURI!="http://www.w3.org/2000/svg"){cZ+=cS.offsetLeft||0;cY+=cS.offsetTop||0}else{if(cS.namespaceURI=="http://www.w3.org/2000/svg"&&BMap.DrawerSelector){var cT=BMap.DrawerSelector.getDrawer(cO);var cR=cT.getPalette();if(navigator.userAgent.indexOf("Opera")>-1&&cS.tagName!="svg"){var c1=a8.lang.instance(cS.guid);if(c1){var cX=c1.getBounds();cZ=cZ+cO.pointToPixel(cX.getSouthWest()).x;cY=cY+cO.pointToPixel(cX.getNorthEast()).y}break}if(cR&&(!a8.browser.ie||(a8.browser.ie==9&&cS.nodeName.toLowerCase()=="svg"))){cZ+=parseFloat(cR.style.left)+cO.offsetX;cY+=parseFloat(cR.style.top)+cO.offsetY}if(a8.browser.ie==9&&cS.nodeName.toLowerCase()!="svg"){cZ+=cO.offsetX;cY+=cO.offsetY;break}if(!a8.browser.ie){break}}}cS=cS.offsetParent}cW.offsetX=cZ;cW.offsetY=cY;cW.pixel=new bu(cZ,cY);cW.point=cO.pixelToPoint(cW.pixel);cW.overlay=cV;cW.infoWindow=cU;return cW}cP.container.onselectstart=function(){return false};a8.on(cO.platform,"mousemove",function(cR){if(cO.currentOperation==0){cO.dispatchEvent(cQ(cR,new bg("onmousemove").inherit(cR)))}});a8.on(cO.platform,"mousedown",function(cV){if(!cO.config.enableMouseDown){return}var cV=window.event||cV;if(!a8.browser.ie){cC(cV)}var cT=cO.temp;cT.operating=true;var cS=cV.srcElement||cV.target;if(cT.dragAni){cT.dragAni.stop()}cT.tpx=cV.clientX||cV.pageX||0;cT.tpy=cV.clientY||cV.pageY||0;var cR=cS;while(cR){if(cR==cO.container){break}if(a8.dom.hasClass(cR,"BMap_Marker")){cT.operating=false;var cU=a8.lang.instance(cR.guid);if(cU instanceof ad&&cU._config.clickable==true||cU._config.enableDragging==true){return}}cR=cR.parentNode}if(cS.nodeType!=1){cS=cS.parentNode}if(a8.browser.ie&&cO.maskLayer.setCapture){cO.maskLayer.setCapture()}cO.dispatchEvent(cQ(cV,new bg("onmousedown").inherit(cV)));if(cO.config.enableDragging&&!(cO.currentOperation&bn.drag)&&cV.button!=2){cT.mx=cT.tpx;cT.my=cT.tpy;cT.pl=cO.offsetX;cT.pt=cO.offsetY;cO.currentOperation|=bn.drag;if(cO.temp.curSpots.length==0){cO.platform.style.cursor=cO.config.draggingCursor}else{cO.platform.style.cursor="pointer"}}});a8.on(document,"mousemove",function(cU){var cU=window.event||cU;if(!a8.browser.ie){cC(cU)}var cT=cO.temp;var cR=cU.clientX||cU.pageX||0;var cX=cU.clientY||cU.pageY||0;if(cT.tpx||cT.tpy){cT.mox=cR-cT.tpx;cT.moy=cX-cT.tpy}var cV=aE(),cW=(cV-cT.lastLoadTileTime)>40;if(cV-cT.lastDomMoveTime<18){return}if(cW){cT.lastLoadTileTime=cV}cT.lastDomMoveTime=cV;if(cO.currentOperation&bn.drag&&cO.config.enableDragging){var cS=cO.platform.style;if(cS.cursor.replace(/"|\s/g,"")!=cO.config.draggingCursor){cS.cursor=cO.config.draggingCursor}if(!cT._moved){cO.dispatchEvent(cQ(cU,new bg("ondragstart").inherit(cU)));cO.dispatchEvent(new bg("onmovestart"));cT.dragStartPos=new bu(cR,cX);cT.dragStartTime=cV}if(cT.mx==0&&cT.my==0&&cO.temp.keyboardDrag){cT.mx=cR;cT.my=cX;cT.pl=cO.offsetX;cT.pt=cO.offsetY}if(cR-cT.mx!=0||cX-cT.my!=0){cO.temp._moved=true;cO.dispatchEvent(cQ(cU,new bg("ondragging").inherit(cU)));cO._setPlatformPosition(cT.pl+cR-cT.mx,cT.pt+cX-cT.my,null,cW)}}});a8.on(document,"mouseup",function(cU){if(a8.browser.ie&&cO.maskLayer.releaseCapture){cO.maskLayer.releaseCapture()}var cS=cO.temp;if(cS.preEnableClickPan){cO.enableClickPan(true)}var cU=window.event||cU,cR=cU.clientX||cU.pageX,cV=cU.clientY||cU.pageY;if(cO.currentOperation&bn.drag&&cO.config.enableDragging){cO.currentOperation^=bn.drag;if(cS.curSpots.length==0){cO.platform.style.cursor=cO.config.defaultCursor}else{cO.platform.style.cursor="pointer"}if(cO.temp._moved){var cT=cQ(cU,new bg("ondragend").inherit(cU));cO.dispatchEvent(cT);cO._processInertialDragging(new bu(cR,cV))}cS._moved=false}cS.operating=false;if(cU.button==2){cS.tpx=null;cS.tpy=null;cS.mox=0;cS.moy=0}});function cM(cU){var cT=cO.temp,cS=!cT.mox&&!cT.moy;if(cT.rightDblclickTimer){clearTimeout(cT.rightDblclickTimer);cT.rightDblclickTimer=null;if(cS){cO.dispatchEvent(cQ(cU,new bg("onrightclick").inherit(cU)));cO.currentOperation|=bn.dblclick;cO.dispatchEvent(cQ(cU,new bg("onrightdblclick").inherit(cU)));cO.currentOperation^=bn.dblclick}}else{if(cS){cO.dispatchEvent(cQ(cU,new bg("onrightclick").inherit(cU)))}var cR=cQ(cU,new bg("onrightclickex").inherit(cU));cT.rightDblclickTimer=setTimeout(function(){cT.rightDblclickTimer=null;if(cS){cO.dispatchEvent(cR)}},cO.config.clickInterval)}}if(a8.browser.firefox>=4){a8.on(cO.container,"mouseup",function(cR){if(cR.button==2){cM(cR)}});a8.on(cO.container,"contextmenu",function(cR){co(cR)})}else{a8.on(cO.container,"contextmenu",function(cR){cM(cR);co(cR)})}var T=new Date();function cL(cU){if(cO.config.enableWheelZoom){var cT=cO.temp;if(cT.dragAni){cT.dragAni.stop()}cO.currentOperation|=bn.mousewheel;var cU=window.event||cU;cO.lastLevel=cO.zoomLevel;var cS=new bg("onmousewheel");cS.trend=cU.wheelDelta>=0||cU.detail<0;var cR=new Date();if(cS.trend==true&&cO.zoomLevel==cO.getMapType().getMaxZoom()||cS.trend==false&&cO.zoomLevel==cO.getMapType().getMinZoom()||cR-T<220){cO.currentOperation^=bn.mousewheel;cC(cU);return}T=cR;cQ(cU,cS.inherit(cU));cO.dispatchEvent(cS);cO.currentOperation^=bn.mousewheel;cC(cU)}}a8.on(cO.container,"mousewheel",cL);if(window.addEventListener){cO.container.addEventListener("DOMMouseScroll",cL,false)}a8.on(cO.platform,"click",function(cV){var cT=new bg("onclick"),cU=new bg("onclickex"),cS=cO.temp;cQ(cV,cT.inherit(cV));cQ(cV,cU.inherit(cV));if(!cO.currentOperation){var cR=!cS.mox&&!cS.moy;if(cR){cO.dispatchEvent(cT)}if(!cS._clickTimer){cS._clickTimer=setTimeout(function(){cS._clickTimer=null;if(cR){cO.dispatchEvent(cU)}},cO.config.clickInterval)}}cS.tpx=null;cS.tpy=null;cS.mox=0;cS.moy=0});a8.on(cO.platform,"dblclick",function(cS){if(!cO.currentOperation){cO.currentOperation|=bn.dblclick;if(a8.browser.ie){cO.dispatchEvent(cQ(cS,new bg("onclick").inherit(cS)))}var cR=cO.temp;if(cR._clickTimer){clearTimeout(cR._clickTimer);cR._clickTimer=null}cO.dispatchEvent(cQ(cS,new bg("ondblclick").inherit(cS)));cO.currentOperation^=bn.dblclick}});a8.on(document,"mousedown",function(cT){var cT=window.event||cT;var cS=cT.srcElement||cT.target;var cR=cO.temp;if(cR.canKeyboard){cR.canKeyboard=a8.dom.contains(cP.container,cS)}else{cR.canKeyboard=a8.dom.contains(cP.platform,cS)}})});bz.prototype._processInertialDragging=function(c2){var c5=this;if(!c5.config.enableInertialDragging){c5.dispatchEvent(new bg("onmoveend"));return}var cT=c5.temp;var cL=aE();if(cL-cT.lastDomMoveTime>100){c5.dispatchEvent(new bg("onmoveend"));cT._moved=false;return}else{var c3=cT.dragStartPos,cW=c2,T=ct(c3,cW),c0=[cW.x-c3.x>0?1:-1,cW.y-c3.y>0?1:-1],cN=(cL-cT.dragStartTime)/1000,cR=T/cN/2,cS=0.5,c1=cR/(2*cS),cZ=0.4*c1*cR/1000,cQ=Math.abs(c3.x-cW.x),cP=Math.abs(c3.y-cW.y),cX=0,cU=0;if(cP==0){cX=cQ}else{var cO=Math.abs(c3.x-cW.x)/Math.abs(c3.y-cW.y);cU=Math.round(Math.sqrt(cZ*cZ/(1+cO*cO)));cX=Math.round(cO*cU)}if(c0[0]==-1){cX=-cX}if(c0[1]==-1){cU=-cU}if(cT.dragAni){cT.dragAni.stop()}var cM=cR/1000,cY=c5.offsetX,cV=c5.offsetY,c4=false;cT.dragAni=new g({duration:c1,fps:30,transition:function(c6){var c6=c6*cM/(2*cS);return cM*c6-cS*c6*c6},render:function(c6){c6=c6*(4*cS)/(cM*cM);c4=!c4;c5._setPlatformPosition(cY+Math.round(c6*cX),cV+Math.round(c6*cU),null,c4)},finish:function(){cT.dragAni=null;c5._setPlatformPosition(cY+Math.round(cX),cV+Math.round(cU));c5.dispatchEvent(new bg("onmoveend"))},onStop:function(c6){cT.dragAni=null;c6=c6*(4*cS)/(cM*cM);c5._setPlatformPosition(cY+Math.round(c6*cX),cV+Math.round(c6*cU));setTimeout(function(){c5.dispatchEvent(new bg("onmoveend"))},1)}})}};BMap.register(function(cL){var T=cL;a8.on(document,"keydown",function(cM){if(T.temp.stopArrow==true){T.temp.stopArrow=false}if(T.config.enableKeyboard&&T.temp.canKeyboard){var cM=window.event||cM;switch(cM.keyCode||cM.which){case 43:case 189:case 109:T.temp.operating=true;T.dispatchEvent(new bg("onminuspress"));break;case 43:case 61:case 187:case 107:T.temp.operating=true;T.dispatchEvent(new bg("onpluspress"));break;case 33:T.temp.operating=false;T.temp.stopArrow=true;T.panBy(0,Math.round(T.height*0.8));co(cM);break;case 34:T.temp.operating=false;T.temp.stopArrow=true;T.panBy(0,-Math.round(T.height*0.8));co(cM);break;case 35:T.temp.operating=false;T.temp.stopArrow=true;T.panBy(-Math.round(T.width*0.8),0);co(cM);break;case 36:T.temp.operating=false;T.temp.stopArrow=true;T.panBy(Math.round(T.width*0.8),0);co(cM);break;case 37:T.temp.operating=true;T.temp.arrow|=1;T._arrow();co(cM);break;case 38:T.temp.operating=true;T.temp.arrow|=2;T._arrow();co(cM);break;case 39:T.temp.operating=true;T.temp.arrow|=4;T._arrow();co(cM);break;case 40:T.temp.operating=true;T.temp.arrow|=8;T._arrow();co(cM);break}}});a8.on(document,"keyup",function(cM){if(T.config.enableKeyboard){var cM=window.event||cM;switch(cM.keyCode||cM.which){case 37:T.temp.arrow=T.temp.arrow&~1;if(T.temp.arrow!=0){T._arrow()}break;case 38:T.temp.arrow=T.temp.arrow&~2;if(T.temp.arrow!=0){T._arrow()}break;case 39:T.temp.arrow=T.temp.arrow&~4;if(T.temp.arrow!=0){T._arrow()}break;case 40:T.temp.arrow=T.temp.arrow&~8;if(T.temp.arrow!=0){T._arrow()}break}}T.temp.operating=false});bz.prototype._arrow=function(){if(this._arrow.occurrent&&this._arrow._lastArrow==this.temp.arrow&&this.temp.stopArrow==true){return}var cM=this;var cO=cM.temp.arrow;cM._arrow._lastArrow=cO;cM._arrow.interval=30;cM._arrow.duration=999;cM._arrow.dx=cM._arrow.dy=0;if(cO&1){cM._arrow.dx=1}if(cO&2){cM._arrow.dy=1}if(cO&4){cM._arrow.dx=-1}if(cO&8){cM._arrow.dy=-1}if(cO&1&&cO&4){cM._arrow.dx=0}if(cO&2&&cO&8){cM._arrow.dy=0}if(!cM._arrow.occurrent){cM._arrow.occurrent=true;cM._arrow.time=aE();cM._arrow.beginTime=cM._arrow.time;cM.dispatchEvent(new bg("onmovestart"));var cN=new g({fps:cM._arrow.interval,duration:cM._arrow.duration,transition:aw.linear,render:function(cV){var cQ=cM._arrow;var cT=cM.temp.arrow;if(cM._arrow._lastArrow!=cT){cM._arrow._lastArrow=cT;if(cT&1){cQ.dx=1}if(cT&2){cQ.dy=1}if(cT&4){cQ.dx=-1}if(cT&8){cQ.dy=-1}if(cT&1&&cT&4){cQ.dx=0}if(cT&2&&cT&8){cQ.dy=0}}if(cM.temp.stopArrow==true){cQ.dx=0;cQ.dy=0}var cU=aE();var cS=Math.pow((cU-cQ.beginTime)/cQ.duration,2);if(!cM.temp.arrow){cQ.occurrent=false;cN.terminative=true;cM._arrow.time=aE();setTimeout(function(){cM.dispatchEvent(new bg("onmoveend"))},40)}var cW=(cU-cQ.time);var cR=cQ.dx*cW*cS>=0?Math.ceil(cQ.dx*cW*cS):Math.floor(cQ.dx*cW*cS);var cP=cQ.dy*cW*cS>=0?Math.ceil(cQ.dy*cW*cS):Math.floor(cQ.dy*cW*cS);if(cR!=0&&cP!=0){cR=Math.round(cR*0.7);cP=Math.round(cP*0.7)}cQ.time=cU;cM._setPlatformPosition(cM.offsetX+cR,cM.offsetY+cP)},finish:function(){cM._arrow.time=aE();setTimeout(function(){cM._arrowPan()},cM._arrow.interval)}})}};bz.prototype._arrowPan=function(){var cP=this;var cN=cP._arrow;if(cP.temp.stopArrow){cN.dx=0;cN.dy=0}if(!cP.temp.arrow){cN.occurrent=false;cP.dispatchEvent(new bg("onmoveend"));return}var cQ=aE();var cR=(cQ-cN.time);var cO=Math.ceil(cN.dx*cR);var cM=Math.ceil(cN.dy*cR);cN.time=cQ;cP._setPlatformPosition(cP.offsetX+cO,cP.offsetY+cM);setTimeout(function(){cP._arrowPan()},cN.interval)}});');
﻿_jsload&&_jsload('tile', 'a8.extend(bR.prototype,{initialize:function(){var T=this,cL=T.map;cL.addEventListener("loadcode",function(){T.loadTiles()});cL.addEventListener("addtilelayer",function(cM){T.addTileLayer(cM)});cL.addEventListener("removetilelayer",function(cM){T.removeTileLayer(cM)});cL.addEventListener("setmaptype",function(cM){T.setMapType(cM)});cL.addEventListener("zoomstartcode",function(cM){T._zoom(cM)});T._addOtherEvt(cL)},loadTiles:function(){var T=this;if(a8.browser.ie){try{document.execCommand("BackgroundImageCache",false,true)}catch(cL){}}if(T.zoomsDiv){a8.dom.hide(T.zoomsDiv)}if(!this.loaded){T.initMapTypeTiles();this.loaded=true}T.moveGridTiles()},_asyncLoadTiles:function(){var T=this,cL=T.map;T._addOtherEvt(cL);T.loadTiles()},_addOtherEvt:function(cL){var T=this;cL.addEventListener("mousewheel",function(cM){T.mouseWheel(cM)});cL.addEventListener("dblclick",function(cM){T.dblClick(cM)});cL.addEventListener("rightdblclick",function(cM){T.dblClick(cM)});cL.addEventListener("minuspress",function(cM){T.keypress(cM)});cL.addEventListener("pluspress",function(cM){T.keypress(cM)});cL.addEventListener("moving",function(cM){T.moveGridTiles()});cL.addEventListener("resize",function(cM){T.moveGridTiles()})},addTileLayer:function(cN){var cM=this;var T=cN.target;for(var cL=0;cL<cM.tileLayers.length;cL++){if(cM.tileLayers[cL]==T){return}}cM.tileLayers.push(T);T.initialize(this.map,this._normalLayerContainer);if(cM.map.loaded){cM.moveGridTiles()}},removeTileLayer:function(cQ){var cR=this;var cO=cQ.target;var cM=cO.mapType;var cL=cR.mapTiles;var cT=cR.bufferTiles;for(var T in cT){var cS=T.split("-")[1];if(cS==cO.guid){delete cT[T]}}for(var T in cL){var cS=T.split("-")[1];if(cS==cO.guid){delete cL[T]}}for(var cP=0,cN=cR.tileLayers.length;cP<cN;cP++){if(cO==cR.tileLayers[cP]){cR.tileLayers.splice(cP,1)}}cO.remove();cR.moveGridTiles()},mouseWheel:function(cO){var cN=this.map;if(!cN.config.enableWheelZoom){return}var cP=cN.zoomLevel+(cO.trend==true?1:-1);var cM=cN._getProperZoom(cP);if(cM.exceeded){return}cN.dispatchEvent(new bg("onzoomstart"));cN.lastLevel=cN.zoomLevel;cN.zoomLevel=cM.zoom;var T=cO.pixel;var cL=this._getMercatorCenter(T);zoomUnits=cN.getMapType().getZoomUnits(cN.getZoom());cN.mercatorCenter=new cd(cL.lng+(cN.width/2-T.x)*zoomUnits,cL.lat-(cN.height/2-T.y)*zoomUnits);cN.centerPoint=cN.projection.mercatorToLngLat(cN.mercatorCenter,cN.currentCity);this.zoom(T)},dblClick:function(cR){var cN=this.map;if(!cN.config.enableDblclickZoom){return}var cS=cR.pixel;var cO=1;var cL=cS;var cP=new aH(0,0);if(cR.type=="onrightdblclick"){cO=-1;cL=new bu(cN.width/2,cN.height/2)}var cM=cN.zoomLevel+cO;var cQ=cN._getProperZoom(cM);if(!cQ.exceeded){cN.dispatchEvent(new bg("onzoomstart"));cN.lastLevel=cN.zoomLevel;cN.zoomLevel=cQ.zoom;if(cO==1){cN.mercatorCenter=this._getMercatorCenter(cS);cN.centerPoint=cN.projection.mercatorToLngLat(cN.mercatorCenter,cN.currentCity);var T=cN.getMapType().getZoomUnits(cN.lastLevel)/cN.getMapType().getZoomUnits(cQ.zoom)*0.5;cP.width=cS.x-Math.round(cN.width/2)*T;cP.height=cS.y-Math.round(cN.height/2)*T}this.zoom(cL,cP)}else{if(cO==1){var cT=cN.pixelToPoint(cS);cN.panTo(cT)}}},keypress:function(cO){var cN=this.map;if(!cN.config.enableContinuousZoom){cO.type=="onpluspress"?cN.zoomIn():cN.zoomOut();return}if(this._zTimeLine){return}var cP=cN.zoomLevel+(cO.type=="onpluspress"?1:-1);var cM=cN._getProperZoom(cP);if(cM.exceeded){return}cN.dispatchEvent(new bg("onzoomstart"));var T=new bu(cN.width/2,cN.height/2);cN.lastLevel=cN.zoomLevel;cN.zoomLevel=cM.zoom;if(cN.getInfoWindow()){T=cN.pointToPixel(cN.getInfoWindow().getPosition(),cN.lastLevel);var cL=cN.pixelToPoint(T,cN.lastLevel);cN._updateCenterPoint(cN.width/2-T.x,cN.height/2-T.y,cL,true)}this.zoom(T)},_getMercatorCenter:function(T){var cP=this.map;var cN=cP.mercatorCenter;var cL=cP.getMapType().getZoomUnits(cP.lastLevel);var cM=cN.lng+cL*(T.x-cP.width/2);var cO=cN.lat-cL*(T.y-cP.height/2);return new cd(cM,cO)},zoom:function(cN,cM){var cP=cM?cM.width:0;var cO=cM?cM.height:0;var cZ=this.map;var c1=cZ.config;var c0=this;var cY={x:cN.x-parseInt(c0.tilesDiv.style.left)-cZ.offsetX,y:cN.y-parseInt(c0.tilesDiv.style.top)-cZ.offsetY};if(cZ.overlayDiv){a8.dom.hide(cZ.overlayDiv)}var T;c0._normalLayerContainer.style.visibility="hidden";this._showAvatarDivs();c0._mapTypeLayerContainer.style.visibility="hidden";var cX=[];var cQ=cZ.zoomLevel-cZ.lastLevel;if(!c0._diff){c0._diff=cQ}else{if(cZ.zoomLevel-cZ.lastLevel>0){c0._diff++}else{c0._diff--}}if(this._zTimeLine&&this._zTimeLine.schedule==0){this._zTimeLine.stop();this._zTimeLine=null;cQ=c0._diff}if((!cM||cM.width==0&&cM.height==0)&&c1.enableContinuousZoom){cZ.temp.zoomer.action(cN,cQ>0?true:false)}var cR=Math.pow(2,cQ);var cL=this.zoomsDiv;var cS=cL.style;cS.visibility="";var cW=cL.children.length;for(var cV=cW-1;cV>-1;cV--){var cT={};var cU=cL.children[cV].style;cT.top=parseInt(cU.top)||0;cT.left=parseInt(cU.left)||0;cT.width=parseInt(cU.width);cT.height=parseInt(cU.height);cT.dw=cT.width*cR-cT.width;cT.dh=cT.height*cR-cT.height;cT.dx=(cT.left-cY.x)*cR-(cT.left-cY.x);cT.dy=(cT.top-cY.y)*cR-(cT.top-cY.y);cX[cV]=cT}cL._ol=parseInt(cL.style.left);cL._ot=parseInt(cL.style.top);if(this._zTimeLine){this._zTimeLine.stop();this._zTimeLine=null}this._zTimeLine=new g({fps:20,duration:c1.enableContinuousZoom?c1.zoomerDuration:1,transition:aw.easeInQuad,render:function(c4){if(c4<0.1){return}for(var c3=cX.length-1;c3>-1;c3--){var c5=cX[c3];if(cL.children[c3]){var c2=cL.children[c3].style;c2.top=Math.round(c5.top+c5.dy*c4)+"px";c2.left=Math.round(c5.left+c5.dx*c4)+"px";c2.width=Math.ceil(c5.width+c5.dw*c4)+"px";c2.height=Math.ceil(c5.height+c5.dh*c4)+"px"}}if(cP||cO){cS.left=cL._ol-(cP*c4)+"px";cS.top=cL._ot-(cO*c4)+"px"}},finish:function(){c0.moveGridTiles();if(cZ.overlayDiv){if(a8.browser.ie&&a8.browser.ie<8||document.compatMode=="BackCompat"){a8.dom.show(cZ.overlayDiv)}else{setTimeout(function(){a8.dom.show(cZ.overlayDiv)},100)}}c0._normalLayerContainer.style.visibility="";c0._mapTypeLayerContainer.style.visibility="";delete c0._diff;cZ.dispatchEvent(new bg("onzoomend"));cL=null;c0._zTimeLine=null}})},setMapType:function(cQ){var cN=this;var cP=cN.map;this._showAvatarDivs(true);cP.addEventListener("tilesloaded",function(){setTimeout(function(){cN._removeAvatarDivs()},200);cP.removeEventListener("tilesloaded",arguments.callee)});for(var cM in this.mapTiles){this.hideTile(this.mapTiles[cM])}for(var cM in this.bufferTiles){this.hideTile(this.bufferTiles[cM])}var cO=this.mapTypeLayers;for(var cL=0,T=cO.length;cL<T;cL++){cO[cL].remove()}delete this.tilesDiv;this.mapTypeLayers=[];this.bufferTiles=this.mapTiles={};this.initMapTypeTiles();this.moveGridTiles()},_showAvatarDivs:function(cM){var cL=this.map;cM=cM||false;if(!this.zoomsDiv){if(!cM){this.zoomsDiv=this.tilesDiv.cloneNode(true)}else{this.zoomsDiv=this._mapTypeLayerContainer.cloneNode(true)}}else{if(this.zoomsDiv.parentNode&&!this._zTimeLine){this.zoomsDiv.parentNode.removeChild(this.zoomsDiv);this.zoomsDiv=null;if(!cM){this.zoomsDiv=this.tilesDiv.cloneNode(true)}else{this.zoomsDiv=this._mapTypeLayerContainer.cloneNode(true)}}}var T=this.zoomsDiv,cN=T.style;cN.display="";cN.zIndex=cN.zIndex-100;cL.platform.insertBefore(T,cL.platform.firstChild)},_removeAvatarDivs:function(){var T=this;if(T.zoomsDiv){J(T.zoomsDiv);if(T.zoomsDiv.parentNode){T.zoomsDiv.parentNode.removeChild(T.zoomsDiv);T.zoomsDiv.innerHTML="";T.zoomsDiv=null}}}});');
﻿_jsload&&_jsload('opmb', 'BMap.register(function(T){T.config.doubleTouchInterval=500;var cS=false,cN,cU=false,cR=false,cL;var cP=function(c1,cZ){var cW=new bg(c1);var cV=cZ.target;var cY=null;var cX=null;while(cV&&cV!=T.container){if(cV.hashCode){var c4=a8.lang.instance(cV.hashCode);if(c4 instanceof Y&&cV.nodeName.toLowerCase()!="canvas"){cY=c4}if(c4 instanceof bP){cX=c4}}cV=cV.offsetParent}var c3=cZ.changedTouches[0].pageX;var c2=cZ.changedTouches[0].pageY;var c0=T.container;while(c0&&c0!=document.body){c3-=c0.offsetLeft;c2-=c0.offsetTop;c0=c0.offsetParent}cW.offsetX=c3;cW.offsetY=c2;cW.pixel=new bu(cW.offsetX,cW.offsetY);cW.point=T.pixelToPoint(cW.pixel);cW.overlay=cY;cW.infoWindow=cX;return cW};var cT=function(cV){cS=true;cL=new bg("ontouch").inherit(cV);cN=new bu(cV.changedTouches[0].clientX,cV.changedTouches[0].clientY);var cW=cP("onclickex",cV);setTimeout(function(){cQ();T.dispatchEvent(cW)},T.config.doubleTouchInterval);T.dispatchEvent(cP("onclick",cV))};var cQ=function(){if(cS){cS=false;cN=null;if(!cU){T.dispatchEvent(cL)}}};var cO=function(cV){cU=true};var cM=function(){cU=false};a8.on(T.platform,"touchstart",function(cV){cR=false;T.dispatchEvent(cP("ontouchstart",cV).inherit(cV));cC(cV)});a8.on(T.platform,"touchmove",function(cV){cR=true;T.dispatchEvent(cP("ontouchmove",cV).inherit(cV));cC(cV)});a8.on(T.platform,"touchend",function(cW){cW.preventDefault();if(!cR){if(cS){cO(cW);T.dispatchEvent(cP("onclick",cW));var cX=new bu(cW.changedTouches[0].clientX,cW.changedTouches[0].clientY);var cV=ct(cN,cX);if(cV<20){T.dispatchEvent(cP("ondblclick",cW));T.dispatchEvent(new bg("ondbltouch").inherit(cW))}else{T.dispatchEvent(cP("ontouchend",cW).inherit(cW))}cQ();cM()}else{cT(cW)}}T.dispatchEvent(new bg("ontouchend").inherit(cW))});a8.on(T.platform,"gesturestart",function(cV){cV.preventDefault();T.dispatchEvent(new bg("ongesturestart").inherit(cV))});a8.on(T.platform,"gesturechange",function(cV){cV.preventDefault();T.dispatchEvent(new bg("ongesturechange").inherit(cV))});a8.on(T.platform,"gestureend",function(cV){cV.preventDefault();T.dispatchEvent(new bg("ongestureend").inherit(cV))})});BMap.register(function(T){var cQ={x:0,y:0,scale:1};var cW=[{x:0,y:0},{x:0,y:0}];var cT=0,cR=0,cU=false,cL=false,cM=false;var cS=function(cZ,cY){var cX=new bg(cZ);cX.offsetX=cY.changedTouches[0].clientX;cX.offsetY=cY.changedTouches[0].clientY;cX.pixel=new bu(cX.offsetX,cX.offsetY);cX.point=T.pixelToPoint(cX.pixel);return cX};var cV=T.platform.style;cV.WebkitBackfaceVisibility="hidden";var cN=function(){var cY=T.container;var cX=0,cZ=0;while(cY!=document.body){cX+=cY.offsetLeft;cZ+=cY.offsetTop;cY=cY.offsetParent}if(bH){cX=0;cZ=0}if(T.config.enableDragging){cV.WebkitTransformOrigin=((cW[0].x+cW[1].x)/2-T.offsetX-cX)+"px "+((cW[0].y+cW[1].y)/2-T.offsetY-cZ)+"px"}else{cV.WebkitTransformOrigin=Math.round(T.width/2)+"px "+Math.round(T.height/2)+"px"}};var cO=function(){cV.WebkitTransform=(T.config.enableDragging?"translate3d("+cQ.x+"px, "+cQ.y+"px,0) ":"")+(T.config.enablePinchToZoom?"scale("+cQ.scale+") ":"")};var cP=function(cX){if(cX){cV.WebkitTransform=""}cQ.x=0;cQ.y=0;cQ.scale=1;cQ.rotation=0;cW[0].x=cW[0].y=cW[1].x=cW[1].y=0;cM=false};T.addEventListener("touchstart",function(cZ){if(cZ.overlay instanceof ad){return}var cX=cZ.targetTouches.length;cT+=cX;if(cT>2){cT=2}var cY=T.temp;if(cX==2){cY._lenIsTwo=true}if(cY.dragAni){cY.dragAni.stop()}if(cT==1){this.temp._startX=cQ.x;this.temp._startY=cQ.y;cW[0].x=cZ.targetTouches[0].clientX;cW[0].y=cZ.targetTouches[0].clientY}else{if(cT==2){cW[1].x=cZ.targetTouches[cX-1].clientX;cW[1].y=cZ.targetTouches[cX-1].clientY}}});T.addEventListener("touchmove",function(c0){var cZ=c0.targetTouches.length;if(cT==1&&cR!=2){cQ.x+=(c0.targetTouches[0].clientX-cW[0].x);cQ.y+=(c0.targetTouches[0].clientY-cW[0].y);cW[0].x=c0.targetTouches[0].clientX;cW[0].y=c0.targetTouches[0].clientY;cO();cM=true}if(cT==2){var c5={x:cW[0].x,y:cW[0].y};var c4={x:cW[1].x,y:cW[1].y};if(!cM){var cX=new bu(c0.targetTouches[0].clientX,c0.targetTouches[0].clientY);var c1=new bu(cW[0].x,cW[0].y);if(cZ==1){if(ct(c1,cX)<30){cW[0].x=c0.targetTouches[0].clientX;cW[0].y=c0.targetTouches[0].clientY}else{cM=true;cW[1].x=c0.targetTouches[0].clientX;cW[1].y=c0.targetTouches[0].clientY}}if(cZ==2){var c3=new bu(c0.targetTouches[1].clientX,c0.targetTouches[1].clientY);if(ct(cX,c3)<30){cW[0].x=c0.targetTouches[1].clientX;cW[0].y=c0.targetTouches[1].clientY}else{if(ct(c1,cX)<ct(c1,c3)){cW[0].x=c0.targetTouches[0].clientX;cW[0].y=c0.targetTouches[0].clientY;cW[1].x=c0.targetTouches[1].clientX;cW[1].y=c0.targetTouches[1].clientY;cM=true}else{cW[1].x=c0.targetTouches[0].clientX;cW[1].y=c0.targetTouches[0].clientY;cW[0].x=c0.targetTouches[1].clientX;cW[0].y=c0.targetTouches[1].clientY;cM=true}}}}else{for(var cY=0;cY<cZ;cY++){var c1=new bu(c0.targetTouches[cY].clientX,c0.targetTouches[cY].clientY);if(ct(c1,new bu(cW[0].x,cW[0].y))<ct(c1,new bu(cW[1].x,cW[1].y))){cW[0].x=c1.x;cW[0].y=c1.y}else{cW[1].x=c1.x;cW[1].y=c1.y}}cQ.x+=(cW[0].x-c5.x+cW[1].x-c4.x)/2;cQ.y+=(cW[0].y-c5.y+cW[1].y-c4.y)/2;cO()}}if(cT==1&&cR==2){for(var cY=0;cY<cZ;cY++){var c1=new bu(c0.targetTouches[cY].clientX,c0.targetTouches[cY].clientY);if(ct(c1,new bu(cW[0].x,cW[0].y))<ct(c1,new bu(cW[1].x,cW[1].y))){cQ.x+=(c1.x-cW[0].x);cQ.y+=(c1.y-cW[0].y);cW[0].x=c1.x;cW[0].y=c1.y}else{cQ.x+=(c1.x-cW[1].x);cQ.y+=(c1.y-cW[1].y);cW[1].x=c1.x;cW[1].y=c1.y}}cO()}if(cT==1&&this.config.enableDragging){var c6=this.temp;if(!c6._moved){c6._moved=true;var c2=cS("ondragstart",c0);T.dispatchEvent(c2);T.dispatchEvent(new bg("onmovestart"));c6.dragStartPos=c2.pixel;c6.dragStartTime=aE();cU=true}c6.lastDomMoveTime=aE();T.dispatchEvent(new bg("ondragging"))}});T.addEventListener("touchend",function(c1){cR=cT;if(this.temp._lenIsTwo){cT=c1.targetTouches.length;delete this.temp._lenIsTwo}else{cT--}if(cT==-1){cT=0}if(a8.platform.isAndroid){cT=0}var c3=this;if(cT==0){if(cL){var c0=0,cZ=T.getZoom();if(c3.config.enablePinchToZoom){c0=Math.round(Math.log(cQ.scale)/Math.log(2)),cZ=Math.max(Math.min(T.getZoom()+c0,T.config.maxZoom),T.config.minZoom)}var c2=T.pointToPixel(T.getCenter()),cY=new bu((c2.x-cQ.x/Math.pow(2,c0)),(c2.y-cQ.y/Math.pow(2,c0))),c5=T.config.enableDragging?T.pixelToPoint(cY):T.getCenter();T.centerAndZoom(c5,cZ)}var c4=cQ.x!=c3.temp._startX||cQ.y!=c3.temp._startY;if(c4){if(cU&&!cL){var cX=cS("ondragend",c1);c3.dispatchEvent(cX);T._processInertialDraggingForTouch(cX.pixel,{x:cQ.x,y:cQ.y});cU=false}if(cL){cP(true)}else{cP(false)}}T.temp._moved=false;cL=false;cR=0}});T.addEventListener("gesturechange",function(cX){cQ.scale=cX.scale;cL=true;cN()})});bz.prototype._processInertialDraggingForTouch=function(c4,cN){var c6=this,T=c6.platform.style;if(!c6.config.enableInertialDragging){setTimeout(function(){T.WebkitTransform=""},0);setTimeout(function(){c6._setPlatformPosition(c6.offsetX+cN.x,c6.offsetY+cN.y)},0);c6.dispatchEvent(new bg("onmoveend"));return}var cV=c6.temp;var cM=aE();if(cM-cV.lastDomMoveTime>140){setTimeout(function(){T.WebkitTransform=""},0);setTimeout(function(){c6._setPlatformPosition(c6.offsetX+cN.x,c6.offsetY+cN.y)},0);c6.dispatchEvent(new bg("onmoveend"));cV._moved=false;return}else{var c5=cV.dragStartPos,cZ=c4,cL=ct(c5,cZ),c2=[cZ.x-c5.x>0?1:-1,cZ.y-c5.y>0?1:-1],cP=(cM-cV.dragStartTime)/1000,cT=cL/cP/2,cU=0.5,c3=cT/(2*cU),c1=0.5*c3*cT/1000,cS=Math.abs(c5.x-cZ.x),cR=Math.abs(c5.y-cZ.y),cY=0,cW=0;if(cR==0){cY=cS}else{var cQ=Math.abs(c5.x-cZ.x)/Math.abs(c5.y-cZ.y);cW=Math.round(Math.sqrt(c1*c1/(1+cQ*cQ)));cY=Math.round(cQ*cW)}if(c2[0]==-1){cY=-cY}if(c2[1]==-1){cW=-cW}if(cV.dragAni){cV.dragAni.stop()}var cO=cT/1000,c0=c6.offsetX,cX=c6.offsetY;cV.dragAni=new g({duration:c3,fps:25,transition:function(c7){var c7=c7*cO/(2*cU);return cO*c7-cU*c7*c7},render:function(c7){c7=c7*(4*cU)/(cO*cO);T.WebkitTransform="translate("+(cN.x+Math.round(c7*cY))+"px ,"+(cN.y+Math.round(c7*cW))+"px)"},finish:function(){cV.dragAni=null;setTimeout(function(){T.WebkitTransform=""},0);setTimeout(function(){c6._setPlatformPosition(c0+cN.x+Math.round(cY),cX+cN.y+Math.round(cW))},0);c6.dispatchEvent(new bg("onmoveend"))},onStop:function(c7){cV.dragAni=null;c7=c7*(4*cU)/(cO*cO);setTimeout(function(){T.WebkitTransform=""},0);setTimeout(function(){c6._setPlatformPosition(c0+cN.x+Math.round(c7*cY),cX+cN.y+Math.round(c7*cW))},0);c6.dispatchEvent(new bg("onmoveend"))}})}};var bH=(navigator.userAgent.indexOf("iPhone OS 5_")>-1)?true:false;');
﻿_jsload&&_jsload('scommon', 'var b=1;var aD=2;var bF=3;var ca=new aH(23,25);var bZ=new aH(9,25);var t=new aH(9,0);an.addSearchPoi=function(cP,T,cL,cQ){var cO=Z(T);if(!cO){return}if(cL<0||cL>9){return}var cN=new M(x+"img/markers.png",ca,{anchor:bZ,imageOffset:new aH(0,-25*cL),infoWindowAnchor:t});var cM=new ad(cO,{icon:cN});cP.addOverlay(cM);if(cQ){cM.setTitle(cQ)}return cM};an.addCenterPoi=function(cO,T,cP){var cN=Z(T);if(!cN){return}var cM=new M(x+"img/markers.png",ca,{anchor:bZ,imageOffset:new aH(0,-250),infoWindowAnchor:t});var cL=new ad(cN,{icon:cM});cO.addOverlay(cL);if(cP){cL.setTitle(cP)}return cL};an.addSearchInBoundsPoi=function(cO,T,cP){var cN=Z(T);if(!cN){return}var cM=new M(x+"img/markers.png",ca,{anchor:bZ,imageOffset:new aH(0,-300),infoWindowAnchor:t});var cL=new ad(cN,{icon:cM});cO.addOverlay(cL);if(cP){cL.setTitle(cP)}return cL};function Z(T){var cM=[];var cL=null;if(T instanceof cd){cL=T}else{if(typeof T=="string"){cM=a8.trim(T).split(",");if(cM.length<2){return}cM[0]=parseFloat(a8.trim(cM[0]));cM[1]=parseFloat(a8.trim(cM[1]))}else{cM=T.slice(0);if(cM.length<2){return}}cL=new cd(cM[0],cM[1])}return cL}an.createSearchInfoWnd=function(cM,T){var cU=cM.title;var cT=cM.addr;var cP=cM.tel;var cR=cM.uid||"";var cL=cM.url;var cS=cM.poiType||BMAP_POI_TYPE_NORMAL;T=T||{};if(!cU){return null}var cQ=cU;if(cS==BMAP_POI_TYPE_BUSSTOP){cQ=cQ+"-\u516c\u4ea4\u8f66\u7ad9"}else{if(cS==BMAP_POI_TYPE_SUBSTOP){cQ=cQ+"-\u5730\u94c1\u7ad9"}}if(cQ.replace(/[\u0100-\uffff]/g,"##").length>27){cQ=cQ.substring(0,13)+"&#8230"}var cO="<p style=\'width:210px;font:bold 14px/16px "+cc.fontFamily+";margin:0;color:#cc5522;white-space:nowrap;overflow:hidden\' title=\'"+cU+"\'>"+cQ+"</p>";var cW=[];cW.push("<div style=\'font:12px "+cc.fontFamily+";margin-top:10px\'>");if(cT){var cV="\u5730\u5740\uff1a";if(cS==BMAP_POI_TYPE_BUSSTOP||cS==BMAP_POI_TYPE_SUBSTOP){cV="\u8f66\u6b21\uff1a"}cW.push(\'<table cellspacing="0" style="overflow:hidden;table-layout:fixed;width:100%;font:12px \'+cc.fontFamily+\'" >\');cW.push(\'<tr><td style="vertical-align:top;width:38px;white-space:nowrap;word-break:keep-all">\'+cV+\'&nbsp;</td><td style="line-height:16px">\');cW.push(cT+"&nbsp;</td></tr>");if(cP){cW.push(\'<tr><td style="vertical-align:top;">\u7535\u8bdd\uff1a</td><td>\'+cP+"</td></tr>")}cW.push("</table>")}else{if(cP){cW.push(\'<table cellspacing="0" style="table-layout:fixed;width:100%;font:12px \'+cc.fontFamily+\'">\');cW.push(\'<tr><td style="vertical-align:top;width:36px;white-space:nowrap;word-break:keep-all">\u7535\u8bdd\uff1a</td><td>\'+cP+"</td></tr></table>")}}cW.push("</div>");var cN=new bP(cW.join(""),{title:cO,height:0,width:230,margin:[10,10,20,10]});return cN};an.addDestPoi=function(cP,T,cQ,cM){var cO=Z(T);if(!cO){return}var cN=new M(x+"img/dest_markers.png",new aH(42,34),{anchor:new aH(14,32),imageOffset:new aH(0,-34*cM),infoWindowAnchor:new aH(14,0)});var cL=new ad(cO,{icon:cN,baseZIndex:3500000,draggingCursor:"pointer"});cP.addOverlay(cL);if(cQ){cL.setTitle(cQ)}return cL};an.addLine=function(cL,T){return an.addRoute(cL,T,bh)};an.ROUTE_STYLE_CONFIG=[{stroke:6,color:"#0030ff",opacity:0.45,style:"solid"},{stroke:6,color:"#0030ff",opacity:0.45,style:"solid"},{stroke:4,color:"#30a208",opacity:0.55,style:"dashed"},{stroke:5,color:"#0030ff",opacity:0.45,style:"solid"},{stroke:4,color:"#ff0103",opacity:0.65,style:"dashed"},{stroke:5,color:"#ff0103",opacity:0.65,style:"solid"}];an.addRoute=function(cR,cO,cN){var cM=an.ROUTE_STYLE_CONFIG;if(typeof cN=="undefined"){cN=0}if(!cM[cN]){return}var T=cO;var cL=cM[cN];var cQ=new f(T,{strokeWeight:cL.stroke,strokeColor:cL.color,strokeOpacity:cL.opacity,strokeStyle:cL.style,clickable:false});cR.addOverlay(cQ);cQ._routeType=cN;if(cN==bh){var cP=new f(T,{strokeWeight:cL.stroke-2,strokeColor:"#fff",strokeOpacity:0.3,clickable:false});cQ._p=cP;cR.addOverlay(cP)}return cQ};an.createTransInfoWnd=function(cL){var cP=cL.content;var T=cL.curIndex;var cQ=cL.total;var cN=cL.nextTransCbk;var cO=cL.obj;var cR=cL.hideStep;var cS=["<div style=\'font:12px "+cc.fontFamily+"\'>"];if(cP){cS.push("<div style=\'margin:0 1em 24px 0\'>"+cP+"</div>")}if(!cR){cS.push(an.genStepNavHtml(cQ,T))}cS.push("</div>");var cM=new bP(cS.join(""),{title:"",height:0,width:220,margin:[10,10,20,10]});if(cR){return cM}cM.addEventListener("open",function(){if(a8.G("trans_prev")){a8.on(a8.G("trans_prev"),"click",function(){if(cN&&typeof cN=="function"){cN(T-1,cO)}})}if(a8.G("trans_next")){a8.on(a8.G("trans_next"),"click",function(){if(cN&&typeof cN=="function"){cN(T+1,cO)}})}});return cM};an.genStepNavHtml=function(cM,T){var cL=[];cL.push(\'<table width="99%" cols="2" style="background:#eaf2ff;font:12px \'+cc.fontFamily+\'"><tbody><tr>\');cL.push(\'<td nowrap="nowrap" width="50%" align="left">\');if(T==0){cL.push(\'<span unselectable="on" style="color:#9c9d99;-moz-user-select:none" >\u4e0a\u4e00\u6b65</span>\')}else{cL.push(\'<a id="trans_prev" style="color:#7777cc;-moz-user-select:none" href="javascript:void(0)">\u4e0a\u4e00\u6b65</a>\')}cL.push("</td>");cL.push(\'<td nowrap="nowrap" width="50%" align="right">\');if(T==cM+1){cL.push(\'<span unselectable="on" style="color:#9c9d99;-moz-user-select:none" >\u4e0b\u4e00\u6b65</span>\')}else{cL.push(\'<a style="color:#7777cc" id="trans_next" href="javascript:void(0)">\u4e0b\u4e00\u6b65</a>\')}cL.push("</td></tr></tbody></table>");return cL.join("")};an.addTransPoi=function(cP,T,cM,cQ){var cO=Z(T);if(!cO){return}cM=cM||BMAP_LINE_TYPE_BUS;var cR=-55;if(cM==BMAP_LINE_TYPE_SUBWAY){cR=-76}var cN=new M(x+"img/trans_icons.png",new aH(21,21),{imageOffset:new aH(0,cR),infoWindowAnchor:new aH(10,0)});var cL=new ad(cO,{icon:cN});cP.addOverlay(cL);if(cQ){cL.setTitle(cQ)}return cL};an.getInfoWindowDom=function(T){if(T&&T.infoWindowDoms&&T.infoWindowDoms.contentDiv){return T.infoWindowDoms.contentDiv.childNodes[0]}return null};an.addStationPoi=function(cM,T,cN){var cL=new ad(T,{icon:new M(bm._stopUrl,new aH(11,11))});if(cN){cL.setTitle(cN)}cM.addOverlay(cL);return cL};an.addDragMkr=function(cM,T){var cL=new ad(T,{icon:new M(cc.imgPath+"drag.png",new aH(11,11)),draggingCursor:"pointer"});cM.addOverlay(cL);cL.setZIndex(10);return cL};an.createTipLbl=function(cL){var T=new ag(cL,{offset:new aH(30,-10)});T.setStyle({border:"solid 1px gray",padding:"2px",whiteSpace:"nowrap",background:"#fff"});return T};an.getDistanceByPixel=function(cL,T){if(!cL||!T){return}return Math.round(Math.sqrt(Math.pow(cL.x-T.x,2)+Math.pow(cL.y-T.y,2)))};w.CBK_SEARCH_COMPLETE=1;w.CBK_MARKERS_SET=2;w.CBK_INFO_HTML_SET=3;w.CBK_POLYLINES_SET=4;w.CBK_RESULTS_HTML_SET=5;w.CBK_BUSLIST_COMPLETE=6;w.CBK_BUSLINE_COMPLETE=7;w.CBK_BUSLISTHTML_SET=8;w.CBK_BUSLINEHTML_SET=9;w._getPoiUrl=function(T,cL){if(T){return cI+"?s="+encodeURIComponent("inf&uid="+T+"&c="+cL)+"&i=0&sr=1"}return""};w._getLocType=function(T){if(!T){return a0}if(typeof T=="string"){return a6}if(T instanceof cd){return cq}if(T instanceof bz){return ab}if(typeof T=="number"){return B}return a0};a8.extend(w.prototype,{_getIdByLoc:function(cO,T){var cL=w._getLocType(cO.src);if(cL==a0){return}var cM=this;if(cL==B){T&&T(cO.src);return}if(cL==a6){if(cO.curLocType==cL&&cO.curSrc==cO.src&&cO.curId){T&&T(cO.curId);return}cO.curLocType=cL;cO.curSrc=cO.src;bb.request(function(cQ){if(cQ&&cQ.result&&cQ.result.type==s){cM._loc.curId=cQ.content.code;T&&T(cM._loc.curId)}},{qt:cv,wd:cO.src})}else{var cN;var cP=18;if(cL==ab){cN=cO.src.getCenter();cP=cO.src.getZoom()}else{cN=cO.src}if(cL==cO.curLocType&&cO.curSrc.equals(cN)&&cO.curId){T&&T(cO.curId);return}if(cL==ab){cN=ba.convertLL2MC(cN)}if(cL==cq){cN=ba.convertLL2MC(cN)}cO.curLocType=cL;cO.curSrc=new cd(cN.lng,cN.lat);bb.request(function(cQ){if(cQ&&cQ.result&&cQ.result.type==a5){cM._loc.curId=cQ.content?cQ.content.uid:1;T&&T(cM._loc.curId)}},{qt:c,b:cN.lng+","+cN.lat+";"+cN.lng+","+cN.lat,l:cP})}},_setStatus:function(T){if(typeof T=="number"){this._status=T}else{delete this._status}},_triggerCbk:function(cL,cN,cM){var T;switch(cL){case w.CBK_SEARCH_COMPLETE:T=this._opts.onSearchComplete;break;case w.CBK_MARKERS_SET:T=this._opts.onMarkersSet;break;case w.CBK_POLYLINES_SET:T=this._opts.onPolylinesSet;break;case w.CBK_INFO_HTML_SET:T=this._opts.onInfoHtmlSet;break;case w.CBK_RESULTS_HTML_SET:T=this._opts.onResultsHtmlSet;break;case w.CBK_BUSLIST_COMPLETE:T=this._opts.onGetBusListComplete;break;case w.CBK_BUSLINE_COMPLETE:T=this._opts.onGetBusLineComplete;break;case w.CBK_BUSLISTHTML_SET:T=this._opts.onBusListHtmlSet;break;case w.CBK_BUSLINEHTML_SET:T=this._opts.onBusLineHtmlSet;break;default:break}T&&T(cN,cM)}});var aR=0;var bw=1;var aM=2;S.unique=function(cL){var cO=false;var cN=[],cP={};for(var cM=0,T=cL.length;cM<T;cM++){if(!cP[cL[cM]]){cP[cL[cM]]=true;cN.push(cL[cM])}}return cN};S.getBestLevel=function(cM,cL){if(cL){var T=Math.min(cL.width/1100,cL.height/660);cM=Math.round(cM+(Math.log(T)/Math.log(2)))}if(cM<1){cM=1}if(cM>18){cM=18}return cM};S.parseGeo=function(cP,cS){if(typeof cP!="string"||!cP){return}var cU=cP.split("|");var T;var cN;var cL;if(cU.length==1){T=W(cP)}else{T=W(cU[2]);cN=W(cU[0]);cL=W(cU[1]);if(!cS){return T}}var cQ={type:T.geoType};if(cS){switch(cQ.type){case aM:var cR=new cd(T.geo[0][0],T.geo[0][1]);var cT=ba.convertMC2LL(cR);cQ.point=cT;cQ.points=[cT];break;case bw:cQ.points=[];var cV=T.geo[0];for(var cO=0,cM=cV.length-1;cO<cM;cO+=2){var cW=new cd(cV[cO],cV[cO+1]);cW=ba.convertMC2LL(cW);cQ.points.push(cW)}cN=new cd(cN.geo[0][0],cN.geo[0][1]);cL=new cd(cL.geo[0][0],cL.geo[0][1]);cN=ba.convertMC2LL(cN);cL=ba.convertMC2LL(cL);cQ.bounds=new bN(cN,cL);break;default:break}}return cQ};S.parseGeoExt=function(c5,cW){if(!cW){cW=0}else{if(cW<0.25){cW=0}else{if(cW>0.25&&cW<1){cW=1}else{if(cW>32){cW=32}}}}var cR=c5.split("|");if(cR.length==1){var cM=W(cR[0]);return{type:cM.type,bound:"",points:cM.geo.join(",")}}else{if(cR.length>1){var cX=c5.split(";.=");var cT=[];var cN=[];var cY=0;var c2=cX.length;for(var cZ=0;cZ<c2;cZ++){var c4=cX[cZ];if(c2>1){if(cZ==0){c4=c4+";"}if(cZ>0&&cZ<c2-1){c4=".="+c4+";"}if(cZ==c2-1){c4=".="+c4}}var cO=c4.split("|");var c1=W(cO[0]);var c0=W(cO[1]);cT.push(c1.geo.join(","));cT.push(c0.geo.join(","));var cM=W(cO[2]);cY=cM.type;var c3=cM.geo.join(",");c3=S.parseGeoExtReg1(c3);if(cW>0){c3=S.parseGeoExtReg2(c3,cW)}cN.push(c3)}if(c2<=1){cN=cN.join(";")}if(c2==2){var cL=cN[0]+";"+cN[1];var cP=cL.split(";");var T=[];for(var cZ=0;cZ<cP.length;cZ++){var cS=cP[cZ].split(",")[0];var cQ=cP[cZ].split(",")[1];var cU=new cd(cS,cQ);var cV=ba.convertMC2LL(cU);T.push(cV)}cN=T}return{type:cY,bound:cT.join(";"),points:cN}}}};S.parseGeoStr=function(cM){var cL=cM.split(",");var T=new cd(cL[0],cL[1]);return ba.convertMC2LL(T)};var az=["=",".","-","*"];var bX=1<<23;function W(cS){var cR=ao(cS.charAt(0));var cL=cS.substr(1);var cU=0;var T=cL.length;var cV=[];var cP=[];var cQ=[];while(cU<T){if(cL.charAt(cU)==az[0]){if((T-cU)<13){return 0}cQ=cB(cL.substr(cU,13),cV);if(cQ<0){return 0}cU+=13}else{if(cL.charAt(cU)==";"){cP.push(cV.slice(0));cV.length=0;++cU}else{if((T-cU)<8){return 0}cQ=aS(cL.substr(cU,8),cV);if(cQ<0){return 0}cU+=8}}}for(var cO=0,cM=cP.length;cO<cM;cO++){for(var cN=0,cT=cP[cO].length;cN<cT;cN++){cP[cO][cN]/=100}}return{geoType:cR,geo:cP}}function ao(cL){var T=-1;if(cL==az[1]){T=aM}else{if(cL==az[2]){T=bw}else{if(cL==az[3]){T=aR}}}return T}function cB(cN,cL){var T=0;var cP=0;var cO=0;for(var cM=0;cM<6;cM++){cO=ac(cN.substr(1+cM,1));if(cO<0){return -1-cM}T+=cO<<(6*cM);cO=ac(cN.substr(7+cM,1));if(cO<0){return -7-cM}cP+=cO<<(6*cM)}cL.push(T);cL.push(cP);return 0}function aS(cO,cM){var cL=cM.length;if(cL<2){return -1}var T=0;var cQ=0;var cP=0;for(var cN=0;cN<4;cN++){cP=ac(cO.substr(cN,1));if(cP<0){return -1-cN}T+=cP<<(6*cN);cP=ac(cO.substr(4+cN,1));if(cP<0){return -5-cN}cQ+=cP<<(6*cN)}if(T>bX){T=bX-T}if(cQ>bX){cQ=bX-cQ}cM.push(cM[cL-2]+T);cM.push(cM[cL-1]+cQ);return 0}function ac(cL){var T=cL.charCodeAt(0);if(cL>="A"&&cL<="Z"){return T-"A".charCodeAt(0)}else{if(cL>="a"&&cL<="z"){return(26+T-"a".charCodeAt(0))}else{if(cL>="0"&&cL<="9"){return(52+T-"0".charCodeAt(0))}else{if(cL=="+"){return 62}else{if(cL=="/"){return 63}}}}}return -1}');
﻿_jsload&&_jsload('local', 'function aB(T,cO,cL){a8.lang.Class.call(this);if(!T){return}this.container=(typeof(T)=="object")?T:a8.G(T);this.page=1;this.pageCount=100;this.argName="pg";this.pagecap=4;this.callback=cO;this.update=true;var cM={page:1,totalCount:100,pageCount:100,pagecap:4,argName:"pg",update:true};if(!cL){cL=cM}for(var cN in cL){if(typeof(cL[cN])!="undefined"){this[cN]=cL[cN]}}this.render()}a8.extend(aB.prototype,{render:function(){this.initialize()},initialize:function(){this.checkPages();this.container.innerHTML=this.createHtml()},checkPages:function(){if(isNaN(parseInt(this.page))){this.page=1}if(isNaN(parseInt(this.pageCount))){this.pageCount=1}if(this.page<1){this.page=1}if(this.pageCount<1){this.pageCount=1}if(this.page>this.pageCount){this.page=this.pageCount}this.page=parseInt(this.page);this.pageCount=parseInt(this.pageCount)},getPage:function(){var cL=location.search;var cM=new RegExp("[?&]?"+this.argName+"=([^&]*)[&$]?","gi");var T=cL.match(cM);this.page=RegExp.$1},createHtml:function(){var cS=[],cM=this.page-1,cP=this.page+1;cS.push(\'<p style="margin:0;padding:0;white-space:nowrap">\');if(cM<1){}else{if(this.page>=this.pagecap){var cL=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp1}">\u9996\u9875</a></span>\';cS.push(cL.replace("{temp1}","BMap.I(\'"+this.guid+"\').toPage(1);"))}var cL=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp2}">\u4e0a\u4e00\u9875</a></span>\';cS.push(cL.replace("{temp2}","BMap.I(\'"+this.guid+"\').toPage("+cM+");"))}if(this.page<this.pagecap){if(this.page%this.pagecap==0){var cN=this.page-this.pagecap-1}else{var cN=this.page-this.page%this.pagecap+1}var cQ=cN+this.pagecap-1}else{var cR=Math.floor(this.pagecap/2);var cO=this.pagecap%2-1;if(this.pageCount>this.page+cR){var cQ=this.page+cR;var cN=this.page-cR-cO}else{var cQ=this.pageCount;var cN=this.page-cR-cO}}if(this.page>this.pageCount-this.pagecap&&this.page>=this.pagecap){var cN=this.pageCount-this.pagecap+1;var cQ=this.pageCount}for(var T=cN;T<=cQ;T++){if(T>0){if(T==this.page){cS.push(\'<span style="margin-right:3px">\'+T+"</span>")}else{if(T>=1&&T<=this.pageCount){var cL=\'<span><a style="color:#7777cc;margin-right:3px" href="javascript:void(0)" onclick="{temp3}">[\'+T+"]</a></span>";cS.push(cL.replace("{temp3}","BMap.I(\'"+this.guid+"\').toPage("+T+");"))}}}}if(cP>this.pageCount){}else{var cL=\'<span><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp4}">\u4e0b\u4e00\u9875</a></span>\';cS.push(cL.replace("{temp4}","BMap.I(\'"+this.guid+"\').toPage("+cP+");"))}cS.push("</p>");return cS.join("")},toPage:function(cL){var T=cL?cL:1;if(typeof(this.callback)=="function"){this.callback(T);this.page=T}if(this.update){this.render()}}});a4.isReqDataMap=function(cL,T){if(!cL||typeof T=="undefined"){return false}if(cL==cj&&T!=X&&T!=bt&&T!=s&&T!=ap&&T!=bE){return false}if(cL==cb&&T!=aN){return false}if(cL==al&&T!=R){return false}if(cL==aG&&T!=ax){return false}if(cL==ai&&T!=ae){return false}if(cL==a1&&T!=bS){return false}return true};a8.extend(a4.prototype,{_check:function(){for(var cL=0,T=this._queryList.length;cL<T;cL++){var cM=this._queryList[cL];this[cM.method].apply(this,cM.arguments)}delete this._queryList;this.initialize()},initialize:function(){var T=this;this.renderMap=new aq(T);this.renderList=new P(T)},search:function(T,cL){if(!T||(T instanceof Array&&(T.length<1||T.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE);return}cL=cL||{};if(cL.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:T,customData:cL.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}var cN=arguments[2]||{};var cM=this;this._getIdByLoc(this._loc,function(cS){cS=cS||1;cM._isMultiKey=cM._isKeywordArray(T);var cR;if(!cM._isMultiKey){cR={qt:cL.forceLocal?Q:cj,c:cS,wd:T,rn:cM.getPageCapacity()}}else{var cQ=T.join("$$");var cO=T.length;cR={qt:ai,c:cS,wd:cQ,wdn:cO,rn:cM.getPageCapacity()}}if(cM._opts.reqFrom){a8.extend(cR,{from:cM._opts.reqFrom})}a8.extend(cR,cN.params);var cP={params:cR,options:cL,userKw:cN.userKw||T};a8.extend(cP,cN);bb.request(function(cU,cT){cM._rawDataCbk(cU,cT)},cR,cP)})},_isKeywordArray:function(T){if(T&&T instanceof Array){return true}else{return false}},searchInBounds:function(T,cO,cL){if(!T||!cO||(T instanceof Array&&(T.length<1||T.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE);return}var cL=cL||{};var cN=this;if(cL.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:T,bounds:cO,customData:cL.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}var cM=arguments[2]||{};this._getIdByLoc(this._loc,function(cW){cW=cW||1;var cV=cO.getSouthWest();var cU=cO.getNorthEast();cV=ba.convertLL2MC(cV);cU=ba.convertLL2MC(cU);var cQ="("+cV.lng+","+cV.lat+";"+cU.lng+","+cU.lat+")";cN._isMultiKey=cN._isKeywordArray(T);var cT;if(!cN._isMultiKey){cT={qt:al,c:cW,wd:T,ar:cQ,rn:cN._opts.pageCapacity,l:18}}else{var cS=T.join("$$");var cP=T.length;cT={qt:aG,c:cW,wd:cS,wdn:cP,ar:cQ,rn:cN.getPageCapacity(),l:18}}if(cN._opts.reqFrom){a8.extend(cT,{from:cN._opts.reqFrom})}a8.extend(cT,cM.params);var cR;if(cM&&cM.center&&cM.radius){cR={params:cT,bounds:cO,center:cM.center,radius:cM.radius,userKw:cM.userKw||T}}else{cR={params:cT,bounds:cO,userKw:cM.userKw||T}}bb.request(function(cY,cX){cN._rawDataCbk(cY,cX)},cT,cR)})},searchNearby:function(cO,cM,cP,cV){if(!cO||!cM||(!(cM instanceof cd)&&typeof cM=="object"&&!cM.uid)||(cO instanceof Array&&(cO.length<1||cO.length>10))){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE);return}var cV=cV||{};if(cV.customData){this._createCustomSearchInstance();this.customSearch.search({keyword:cO,center:cM,radius:cP,customData:cV.customData});this._useCustomdata=true;return}else{this._useCustomdata=false}cP=cP||a4.DEFAULT_RADIUS;cP=cP<0?a4.DEFAULT_RADIUS:(cP>a4.MAX_RADIUS?a4.MAX_RADIUS:cP);var cS=this;var cL=arguments[3]||{};if(cM instanceof cd){var cN=ba.convertLL2MC(cM);var cR=new cd(cN.lng-cP,cN.lat-cP);var cQ=new cd(cN.lng+cP,cN.lat+cP);var cU=ba.convertMC2LL(cR);var cT=ba.convertMC2LL(cQ);var T=new bN(new cd(cU.lng,cU.lat),new cd(cT.lng,cT.lat));cL.center=cM;cL.radius=cP;this.searchInBounds(cO,T,cL);return}this._getIdByLoc(this._loc,function(c0){c0=c0||1;cS._isMultiKey=cS._isKeywordArray(cO);var cY;if(!cS._isMultiKey){cY={qt:cb,c:c0,wd:cO,rn:cS.getPageCapacity(),uid:cM.uid,r:cP}}else{cY={qt:a1,c:c0,wd:cO.join("$$"),wdn:cO.length,rn:cS.getPageCapacity(),uid:cM.uid,r:cP}}if(typeof cM=="string"){if(!cS._isMultiKey){cY.qt=cj;cY.wd=cM+" "+cO}else{cY.qt=ai;var cW=[];for(var cX=0;cX<cO.length;cX++){var cZ=cM+" "+cO[cX];cW.push(cZ)}cY.wd=cW.join("$$");cY.wdn=cW.length}delete cY.r;delete cY.uid}if(cS._opts.reqFrom){a8.extend(cY,{from:cS._opts.reqFrom})}a8.extend(cY,cL.params);bb.request(function(c2,c1){cS._rawDataCbk(c2,c1)},cY,{params:cY,center:cM,radius:cP,userKw:cL.userKw||cO})})},_rawDataCbk:function(cU,cM){var cT=this;if(cU.result.type==ax||cU.result.type==ae||cU.result.type==bS){cT._isMultiKey=true}else{cT._isMultiKey=false}this.clearResults();cT._json=cU;this._ud=cM;var T=cU.result;var cS=cM.params.qt;if(!cT._isMultiKey){if(T.error!=0||!a4.isReqDataMap(cS,T.type)){var cN=cU.current_city;this._results=new cl({keyword:cM.userKw,city:cN.name,province:cN.up_province_name||"",ccode:cN.code,pc:cT.getPageCapacity(),center:cM.center,radius:cM.radius,bounds:((cM.center&&cM.radius)?undefined:cM.bounds),moreUrl:this._getMoreUrl(cM,cN)});this._results._qt=cM.params.qt;this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results);this._renderList();return}}else{if(T.error!=0||!a4.isReqDataMap(cS,T.type)){var cN=cU.current_city;this._arrResults=[];var cL=cM.userKw;for(var cR=0,cO=cL.length;cR<cO;cR++){var cQ=new cl({keyword:cL[cR],city:cN.name,province:cN.up_province_name||"",ccode:cN.code,pc:cT.getPageCapacity(),center:cM.center,radius:cM.radius,bounds:((cM.center&&cM.radius)?undefined:cM.bounds),moreUrl:""});cQ._qt=cM.params.qt;this._arrResults.push(cQ)}this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._arrResults);this._renderList();return}}cT._processRaw(cM);cT._renderMap();cT._renderList();var cP;if(!this._isMultiKey){cP=this._results}else{cP=this._getMaxResults()}if(this._opts.renderOptions.selectFirstResult&&cP&&cP.getNumPois()>0){var cT=this;setTimeout(function(){cT._select(0)},240)}},_processRaw:function(cQ){var da=this._json.result,dl=this._json.content,c6=this._json.current_city,dm=da.type,cU=this,cR=da.page_num||0,c3=0,db=0,cX=[],c8=[],T=[],dk=[],c5=[],cZ=[];if(this._json.psrs&&this._json.psrs.SEResult){var cN=this._json.psrs.SEResult;if(cN.length>0){for(var di=0,cV=cN.length;di<cV;++di){cZ.push(cN[di])}}}var dd=this._json.suggest_query;if(dd){for(var di=0,cV=dd.length;di<cV;++di){dd[di]&&dd[di].query&&cZ.push(dd[di].query)}}cZ=S.unique(cZ);if(dm!=bt&&dm!=ap){var c1;if(!this._isMultiKey){db=da.count-(cR==0?(da.spec_dispnum||0):0);c3=da.total<760?da.total:760;c1=cR==0?(da.spec_dispnum||0):0}if(dm!=s){if(!this._isMultiKey){for(var di=c1;di<da.count;di++){if(dl&&dl[di]){var cO=dl[di];var cY=this._formatAddr(cO.addr,cO.poiType);var c2=[];if(cO.cla&&cO.cla.length>0){var cM=cO.cla.length;while(cM--){var c9=cO.cla[cM][1];c9=c9.replace("<b>","").replace("</b>","");c2.unshift(c9)}}var c7={title:cO.name,uid:cO.uid,point:S.parseGeo(cO.geo,true).point,url:w._getPoiUrl(cO.uid,c6.code),address:cY,city:c6.name,province:c6.up_province_name||"",phoneNumber:cO.tel,postcode:cO.zip,type:cO.poiType||BMAP_POI_TYPE_NORMAL,isAccurate:(cO.acc_flag&&cO.acc_flag==1)?true:false};if(c2.length>0){c7.tags=c2}cX.push(c7);c8.push(c7.point)}}}else{var cT=da.result_array;var dc=cQ.userKw.length;for(var di=0;di<dc;di++){dk[di]=[];c5[di]=[];T[di]=[];if(!cT[di]){continue}if(cT[di].type==bt){if(dl&&dl[di]){for(var dg=0;dg<dl[di].length;dg++){var cL=dl[di][dg];T[di].push({city:cL.name,_code:cL.code,numResults:cL.num})}}if(this._json.more_city&&this._json.more_city[di]){var cW=this._json.more_city[di];for(var dg=0,de=cW.length;dg<de;dg++){for(var df=0,c4=cW[dg].city.length;df<c4;df++){var cL=cW[dg].city[df];T[di].push({city:cL.name,_code:cL.code,numResults:cL.num})}}}continue}var c0=cT[di].count;var cS=cT[di].page_num||0;var dj=cT[di].total>760?760:cT[di].total;var cP={count:c0,pagenum:cS,total:dj};c5[di].push(cP);for(var dg=0;dg<c0;dg++){if(dl&&dl[di]&&dl[di][dg]){var cO=dl[di][dg];var cY=this._formatAddr(cO.addr,cO.poiType);var c2=[];if(cO.cla&&cO.cla.length>0){var cM=cO.cla.length;while(cM--){var c9=cO.cla[cM][1];c9=c9.replace("<b>","").replace("</b>","");c2.unshift(c9)}}var c7={title:cO.name,uid:cO.uid,point:S.parseGeo(cO.geo,true).point,url:w._getPoiUrl(cO.uid,c6.code),address:cY,city:c6.name,province:c6.up_province_name||"",phoneNumber:cO.tel,postcode:cO.zip,type:cO.poiType||BMAP_POI_TYPE_NORMAL,isAccurate:(cO.acc_flag&&cO.acc_flag==1)?true:false,tags:c2};dk[di].push(c7)}}}}}else{db=c3=1;var c7={title:dl.cname,uid:dl.uid,point:S.parseGeo(dl.geo,true).point,address:dl.cname,url:cI+"?s="+encodeURIComponent("s&wd="+da.wd)};cX.push(c7);c8.push(c7.point)}}else{if(dm==ap){db=c3=1;var c7={title:da.wd,point:S.parseGeoStr(dl[0]),url:cI+"?s="+encodeURIComponent("s&wd="+da.wd)};cX.push(c7);c8.push(c7.point)}if(dm==bt){db=c3=0;for(var di=0;di<dl.length;di++){T.push({city:dl[di].name,_code:dl[di].code,numResults:dl[di].num})}if(this._json.more_city){var cW=this._json.more_city;for(var di=0,de=cW.length;di<de;di++){for(var dg=0,c4=cW[di].city.length;dg<c4;dg++){var dl=cW[di].city[dg];T.push({city:dl.name,_code:dl.code,numResults:dl.num})}}}}}if(!this._isMultiKey){this._results=new cl({keyword:cQ.userKw,count:db,total:c3,pageIdx:da.page_num,city:c6.name,province:c6.up_province_name||"",ccode:c6.code,pois:cX,cityList:T,pc:cU.getPageCapacity(),center:cQ.center,radius:cQ.radius,bounds:((cQ.center&&cQ.radius)?undefined:cQ.bounds),moreUrl:this._getMoreUrl(cQ,c6),suggestions:cZ});this._results._qt=cQ.params.qt;if(c3==0&&dm!=bt){this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}else{if(dm!=bt){this._setStatus(BMAP_STATUS_SUCCESS)}else{this._setStatus(BMAP_STATUS_CITY_LIST)}}this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results)}else{this._arrResults=[];var dc=cQ.userKw.length;var dh=true;for(var di=0;di<dc;di++){if(c5[di].length>0&&c5[di][0].total>0){dh=false}var cX=new cl({keyword:cQ.userKw[di]||"",count:c5[di].length>0?c5[di][0].count:0,total:c5[di].length>0?c5[di][0].total:0,pageIdx:c5[di].length>0?c5[di][0].pagenum:0,city:c6.name,province:c6.up_province_name||"",ccode:c6.code,pois:dk[di]||[],cityList:T[di]||[],pc:cU.getPageCapacity(),center:cQ.center,radius:cQ.radius,bounds:((cQ.center&&cQ.radius)?undefined:cQ.bounds),moreUrl:"",suggestions:cZ});cX._qt=cQ.params.qt;this._arrResults.push(cX)}if(dh){this._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}else{this._setStatus(BMAP_STATUS_SUCCESS)}this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._arrResults)}},_getMoreUrl:function(cL,cM){var cQ="";var cO=typeof cL.center=="string"?(cL.center+" "+cL.userKw):cL.userKw;var cP="s",cN="",cS="";if(typeof cL.center=="object"&&!(cL.center instanceof cd)){cP="nb";var cR=cL.center.point;cR=ba.convertLL2MC(cR);cN=encodeURIComponent("&uid="+cL.center.uid+"&r="+cL.radius)+"&l=13&c="+cR.lng+","+cR.lat}if(cL.bounds&&!cL.center){cP="bd";var cR=cL.bounds.getCenter();cR=ba.convertLL2MC(cR);cS="&c="+cR.lng+","+cR.lat+"&l=13"}if(cL.center&&cL.center instanceof cd){var cR=cL.center;cR=ba.convertLL2MC(cR);cS="&c="+cR.lng+","+cR.lat+"&l=13";var T=cL.radius;cP="tpl:PoiSearch?nb&ar=("+(cR.lng-T)+","+(cR.lat-T)+";"+(cR.lng+T)+","+(cR.lat+T)+")"}cQ=cI+"?sr=1"+cS+"&s="+encodeURIComponent(cP+"&wd="+cO+"&c="+cM.code)+cN;return cQ},_formatAddr:function(cL,T){T=T||BMAP_POI_TYPE_NORMAL;if(T==BMAP_POI_TYPE_BUSSTOP||T==BMAP_POI_TYPE_SUBSTOP){return S.unique(cL.split(";")).join("; ")}return cL},_chkMultiKeyResults:function(cN){for(var cM=0,T=cN.length;cM<T;cM++){var cL=cN[cM];if(cL.getCurrentNumPois()>0){return true}}return false},_renderMap:function(){if(this._opts.renderOptions.map&&((this._results&&this._results.getCurrentNumPois()>0)||(this._arrResults&&this._chkMultiKeyResults(this._arrResults)))){var cV=this,cL=this._opts.renderOptions.map,cX=[];if(!cV._isMultiKey){for(var cS=0;cS<this._results.getCurrentNumPois();cS++){var cW=this._results.getPoi(cS);cX.push(cW.point);var cT=this._addPoi(cW.point,cS,cW.title);if(!cT){continue}cW.marker=cT;(function(){var cZ=cS;cT.addEventListener("click",function(){cV._select(cZ)})})();this._overlays.push(cT)}}else{var cY=0;for(var cS=0,cP=this._arrResults.length;cS<cP;cS++){var cQ=this._arrResults[cS];for(var cR=0,cO=cQ.getCurrentNumPois();cR<cO;cR++){var cW=cQ.getPoi(cR);cX.push(cW.point);var cT=an.addSearchInBoundsPoi(cL,cW.point,cW.title);if(!cT){continue}cW.marker=cT;cW._kwIndex=cS;(function(){var cZ=cY;cT.addEventListener("click",function(){cV._select(cZ)})})();this._overlays.push(cT);this._arrPois.push(cW);cY++}}}var T=this._ud.center;if(T&&typeof T!="string"&&!(T instanceof cd)){var cN=this._centerMkr=an.addCenterPoi(cL,T.point,T.title);cN.addEventListener("click",function(){cV._select(-1);cV._curIndex="c";var cZ=an.createSearchInfoWnd({title:T.title,addr:T.address,tel:T.phoneNumber,url:T.url,poiType:T.type});cZ.addEventListener("open",function(){cV._triggerCbk(w.CBK_INFO_HTML_SET,T,an.getInfoWindowDom(cL))});cN.openInfoWindow(cZ)})}var cU=this._json.result&&this._json.result.type;var cM={};switch(cU){case X:case aN:case R:case ax:case ae:case bS:cM.points=cX;break;case s:cM.center=this._results.getPoi(0).point;cM.level=this._json.content.level;break;case bE:cM.center=this._results.getPoi(0).point;cM.level=13;break;case ap:cM.center=this._results.getPoi(0).point;cM.level=parseInt(this._json.content[1]);break;default:break}this._getBestViewport(cM);if(!cV._isMultiKey){this._triggerCbk(w.CBK_MARKERS_SET,this._results._pois)}else{this._triggerCbk(w.CBK_MARKERS_SET,this._arrPois)}}},_addPoi:function(cL,T,cM){if(this._opts.pageCapacity<=a4.DEFAULT_PAGE_CAPACITY){return an.addSearchPoi(this._opts.renderOptions.map,cL,T,cM)}else{return an.addSearchInBoundsPoi(this._opts.renderOptions.map,cL,cM)}},_select:function(cN){var cM=this._curIndex,cQ=this._opts.renderOptions.map,T=this._opts.renderOptions.panel;if(cQ&&cN>-1&&this._overlays[cN]){var cO=this._overlays[cN];cQ.closeInfoWindow();var cR;if(!this._isMultiKey){cR=this._results.getPoi(cN)}else{cR=this._arrPois[cN]}if(!cR){return}var cL=an.createSearchInfoWnd({title:cR.title,addr:cR.address,tel:cR.phoneNumber,url:cR.url,poiType:cR.type});var cP=this;cL.addEventListener("close",function(){if(T){if(typeof cP._curIndex=="number"&&cP._curIndex!=-1&&T.getElementsByTagName("li")[cP._curIndex]){T.getElementsByTagName("li")[cP._curIndex].style.backgroundColor=""}}cP._curIndex=-1});cL.addEventListener("open",function(){cP._triggerCbk(w.CBK_INFO_HTML_SET,cR,an.getInfoWindowDom(cQ))});cO.openInfoWindow(cL)}if(T){if(typeof cM=="number"&&cM!=-1&&T.getElementsByTagName("li")[cM]){T.getElementsByTagName("li")[cM].style.backgroundColor=""}if(typeof cN=="number"&&cN!=-1&&T.getElementsByTagName("li")[cN]){T.getElementsByTagName("li")[cN].style.backgroundColor="#f0f0f0"}}this._curIndex=cN},_clearOverlays:function(){for(var cL=0,T=this._overlays.length;cL<T;cL++){this._overlays[cL].remove();this._overlays[cL]=null}this._overlays.length=0;for(var cL=0,T=this._arrPois.length;cL<T;cL++){this._arrPois[cL]=null}this._arrPois.length=0;if(this._centerMkr){this._centerMkr.remove();this._centerMkr=null}},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&(this._results||this._arrResults)){var cM=aa("div",{style:"font:12px "+cc.fontFamily+";border:1px solid #999;"});var cS=this.getStatus();var cT=aa("div",{style:"background:#fff"});var cV=aa("ol",{style:"list-style:none;padding:0;margin:0"});if(cS==BMAP_STATUS_SUCCESS){if(!this._isMultiKey){for(var cU=0,cP=this._results.getCurrentNumPois();cU<cP;cU++){var c0=this._createItem(cU);cV.appendChild(c0)}}else{var cX=0;for(var cU=0,cP=this._arrResults.length;cU<cP;cU++){var cQ=this._arrResults[cU];for(var cR=0,cO=cQ.getCurrentNumPois();cR<cO;cR++){var c0=this._createItem(cX);cV.appendChild(c0);cX++}}}}if(cS==BMAP_STATUS_CITY_LIST){if(!this._isMultiKey){for(var cU=0,cP=Math.min(6,this._results.getCityList().length);cU<cP;cU++){var c0=this._createCityItem(cU);cV.appendChild(c0)}}}if(cS==BMAP_STATUS_UNKNOWN_LOCATION){var c0=aa("li",{style:"margin:2px 0;padding:0 5px 0 3px;overflow:hidden;line-height:17px"});c0.innerHTML="\u62b1\u6b49\uff0c\u672a\u627e\u5230\u76f8\u5173\u5730\u70b9\u3002";cV.appendChild(c0)}cT.appendChild(cV);cM.appendChild(cT);var cY=this;var cL=aa("div",{style:"white-space:nowrap;text-align:right;background:#e5ecf9;margin-top:5px;padding:2px"});var T;if(!this._isMultiKey){T=aa("a",{style:"color:#7777cc",href:this._results.moreResultsUrl,target:"_blank",title:"\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b\u66f4\u591a\u7ed3\u679c"});T.innerHTML="\u66f4\u591a\u7ed3\u679c&#187;"}else{T=aa("a",{style:"color:#7777cc"});T.innerHTML="&nbsp;"}var cN=aa("div",{style:"float:left;margin-right:5px"});if(!this._isMultiKey){if(this._results.getNumPages()>1){var cW=new aB(cN,function(c1){cY.gotoPage(c1-1)},{pageCount:cY._results.getNumPages(),page:cY._results.getPageIndex()+1,update:false})}}else{var cZ=this._getMaxResults();if(cZ&&cZ.getNumPages()>1){var cW=new aB(cN,function(c1){cY.gotoPage(c1-1)},{pageCount:cZ.getNumPages(),page:cZ.getPageIndex()+1,update:false})}}cL.appendChild(cN);cL.appendChild(T);cM.appendChild(cL);this._opts.renderOptions.panel.appendChild(cM);this._triggerCbk(w.CBK_RESULTS_HTML_SET,cM)}},_getMaxResults:function(){var cO,T=-1;for(var cN=0,cL=this._arrResults.length;cN<cL;cN++){var cM=this._arrResults[cN];if(cM.getNumPages()>T){cO=cM;T=cM.getNumPages()}}return cO},_createItem:function(cO){var cS,cL;if(!this._isMultiKey){cS=this._results;if(!cS||!cS.getPoi(cO)){return}cL=cS.getPoi(cO)}else{var cP=0,cN=false;for(var cW=0,cU=this._arrResults.length;cW<cU;cW++){var cQ=this._arrResults[cW];for(var cV=0,cT=cQ.getCurrentNumPois();cV<cT;cV++){if(cP==cO){cL=cQ.getPoi(cV);cL._kwIndex=cW;cN=true;break}cP++}if(cN){break}}}var cY=aa("li",{style:"margin:2px 0;padding:0 5px 0 3px;cursor:pointer;overflow:hidden;line-height:17px"});if(this._curIndex>-1&&cO==this._curIndex){cY.style.backgroundColor="#f0f0f0"}var cX=cO==0?cO+2+"px":"-"+(cO*20-2)+"px";if(!this._isMultiKey){if(this._opts.pageCapacity>a4.DEFAULT_PAGE_CAPACITY){cX="-218px"}}else{cX="-218px"}var T=["<span style=\'background:url("+x+"bmap/red_labels.gif) 0 "+cX+" no-repeat;padding-left:10px;margin-right:3px\'>&nbsp;</span>"];var c1,cR;if(!this._isMultiKey){var cZ=this._results.keyword;var cM=new RegExp(cZ,"ig");if(cL.title){c1=cL.title.replace(cM,"<b>$&</b>")}if(cL.address){cR=cL.address.replace(cM,"<b>$&</b>")}}else{if(typeof cL._kwIndex!="undefined"&&this._ud.userKw instanceof Array){var cZ=this._ud.userKw[cL._kwIndex];if(cZ){var cM=new RegExp(cZ,"ig");if(cL.title){c1=cL.title.replace(cM,"<b>$&</b>")}if(cL.address){cR=cL.address.replace(cM,"<b>$&</b>")}}}else{c1=cL.title;cR=cL.address}}if(cL.type==BMAP_POI_TYPE_BUSSTOP){c1+="-\u516c\u4ea4\u8f66\u7ad9"}else{if(cL.type==BMAP_POI_TYPE_SUBSTOP){c1+="-\u5730\u94c1\u7ad9"}}T.push("<span style=\'color:#00c;text-decoration:underline\'>"+c1+"</span>");if(cL.address){T.push("<span style=\'color:#666;\'> - "+cR+"</span>")}cY.innerHTML=T.join("");var c0=this;cY.onclick=function(){c0._select(cO)};return cY},_createCityItem:function(T){var cM=aa("li",{style:"margin:2px 0;padding:0 5px 0 3px;cursor:pointer;overflow:hidden;line-height:17px"});cM._index=T;var cN=this._results.getCityList();cM.innerHTML="<span style=\'color:#00c;text-decoration:underline\'>"+cN[T].city+"</span> <span style=\'color:#666\'>(\u5171"+cN[T].numResults+"\u6761\u7ed3\u679c)</span>";var cL=this;cM.onclick=function(){cL.setLocation(cL._results.getCityList()[T].city);cL.search(cL._results.keyword)};return cM},clearResults:function(){delete this._json;delete this._status;delete this._results;if(this._isMultiKey){delete this._arrResults}delete this._ud;this._curIndex=-1;this._setStatus();this._clearOverlays();if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.innerHTML=""}},gotoPage:function(cL){if(this._useCustomdata){this.customSearch.gotoPage(cL);return}if(this._ud){var T;if(!this._isMultiKey){T=this._results}else{T=this._getMaxResults()}if(typeof cL=="number"&&!isNaN(cL)&&cL>=0&&cL<=T.getNumPages()-1){this._ud.params.pn=cL;var cM=this._ud.params.qt;switch(cM){case cj:case Q:this.search(this._ud.params.wd,this._ud.options,this._ud);break;case al:this.searchInBounds(this._ud.params.wd,this._ud.bounds,this._ud);break;case cb:this.searchNearby(this._ud.params.wd,this._ud.center,this._ud.radius,this._ud);break;case aG:this.searchInBounds(this._ud.userKw,this._ud.bounds,this._ud);break;case ai:this.search(this._ud.userKw,this._ud.options,this._ud);break;case a1:this.searchNearby(this._ud.userKw,this._ud.center,this._ud.radius,this._ud);break;default:break}}else{this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE)}}},_getBestViewport:function(cL){var T=this._opts.renderOptions,cP=T.map;if(cP){if(cL.points){var cQ=cL.points;var cN=!T.autoViewport,cO=!T.selectFirstResult&&T.autoViewport,cM=cP.getViewport(cQ,{margins:[30,30,30,30]});if(!cN){cP.setViewport(cM,{enableAnimation:cO})}}else{cL.level=S.getBestLevel(cL.level,cP);if(this._opts.renderOptions.autoViewport){cP.centerAndZoom(cL.center,cL.level)}}}},_createCustomSearchInstance:function(){if(!this.customSearch){var T=this;this.customSearch=new aF(T)}},select:function(T){this.renderMap.select(T);this.renderList.select(T);this._curIndex=T}});function cl(T){this.keyword=T.keyword||"";this._pageIndex=T.pageIdx||0;this._currentNumPois=T.count||0;this._numPois=T.total||0;this._numPages=Math.ceil(T.total/T.pc);this.center=T.center;this.radius=T.radius;this.bounds=T.bounds;this.city=T.city;this.province=T.province;this.viewport=T.viewport;this.moreResultsUrl=T.moreUrl;this._pois=T.pois&&T.pois.slice(0)||[];this._cityList=T.cityList&&T.cityList.slice(0);this.suggestions=T.suggestions||[]}a8.extend(cl.prototype,{getPoi:function(T){if(this._pois[T]){return this._pois[T]}},getNumPois:function(){return this._numPois},getNumPages:function(){return this._numPages},getCurrentNumPois:function(){return this._currentNumPois},getPageIndex:function(){return this._pageIndex},getCityList:function(){return this._cityList},toString:function(){return"LocalResult"}});function aF(T){a8.lang.Class.call(this);this.localSearch=T;this.localSearch._curIndex=-1}a8.lang.inherits(aF,a8.lang.Class,"CustomSearch");a8.extend(aF.prototype,{search:function(T){this.localSearch._isMultiKey=false;if(!this._check(T)){return}var cL=this;this.localSearch._getIdByLoc(this.localSearch._loc,function(cO){T.region=cO;var cN=cL._getParams(T);var cM={params:cN,options:T};cL.searchRequest(cN,cM)})},_check:function(){var T=true;if(!bJ){this.localSearch._setStatus(BMAP_STATUS_INVALID_KEY);this.localSearch._triggerCbk(w.CBK_SEARCH_COMPLETE);T=false}return T},_getParams:function(cM){var cP={region:cM.region,page_size:this.localSearch.getPageCapacity(),ak:bJ};if(cM.page_index){cP.page_index=cM.page_index}if(cM.keyword){cP.q=cM.keyword}if(cM.bounds){var cL=cM.bounds.getSouthWest();var cO=cM.bounds.getNorthEast();var cN=cO.lat+","+cL.lng+";"+cL.lat+","+cO.lng;cP.bounds=cN}if(cM.center&&(cM.center instanceof cd||cM.center.point instanceof cd)){var T=null;if(cM.center instanceof cd){T=cM.center}else{if(cM.center.point instanceof cd){T=cM.center.point}}cP.location=T.lat+","+T.lng}if(typeof cM.center=="string"){cP.q=cM.center+" "+cM.keyword}if(cM.radius){cP.radius=cM.radius}if(cM.customData&&cM.customData.databoxId){cP.filter="databox:"+cM.customData.databoxId}return cP},searchRequest:function(cM,T){var cL=this;bb.request(function(cO,cN){cL._rawDataCbk(cO,cN)},cM,T,"geosearch/poi")},_rawDataCbk:function(cN,cL){this.localSearch.clearResults();this.localSearch._ud=cL;if(cN.status!=0){this._results=new cl({keyword:cL.options.keyword,pc:this.localSearch.getPageCapacity(),center:cL.options.center||"",radius:cL.options.radius||"",bounds:cL.options.bounds||"",moreUrl:""});if(cN.status==5){this.localSearch._setStatus(BMAP_STATUS_INVALID_KEY)}else{this.localSearch._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}this.localSearch._results=this._results;this.localSearch._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results);this.localSearch.renderList.dispatchEvent("render");return}this._processRaw(cN,cL);this.localSearch.renderMap.dispatchEvent("render");this.localSearch.renderList.dispatchEvent("render");var T=cL.options.center;if(T&&typeof T!="string"&&!(T instanceof cd)&&this.localSearch.getStatus()==BMAP_STATUS_SUCCESS){this.localSearch.renderMap.addCenterPoi(T)}var cM=this.localSearch._results;if(this.localSearch._opts.renderOptions.selectFirstResult&&cM&&cM.getNumPois()>0){var cO=this;setTimeout(function(){cO.localSearch.select(0)},240)}},_processRaw:function(cU,T){var cP=cU.content||{},cQ=this,cM=[],cT=[],cO=cP.length;for(var cN=0,cV=cU.size;cN<cV&&cP[cN];cN++){var cS=cP[cN];var cR=new cd(cS.longitude,cS.latitude);var cL={title:cS.name,uid:cS.uid,point:cR,url:"",address:cS.addr,city:cS.city,province:cS.province,phoneNumber:cS.tel,postcode:cS.zip,type:cS.cla};cM.push(cL);cT.push(cR)}this._results=new cl({keyword:T.options.keyword,count:cU.size,total:cU.total,pageIdx:T.params.page_index,city:"",province:"",ccode:"",pois:cM,pc:this.localSearch.getPageCapacity(),center:T.options.center,radius:T.options.radius,bounds:T.options.bounds,moreUrl:""});if(cU.total==0){this.localSearch._setStatus(BMAP_STATUS_UNKNOWN_LOCATION)}else{this.localSearch._setStatus(BMAP_STATUS_SUCCESS)}this.localSearch._results=this._results;this.localSearch._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results)},gotoPage:function(cL){var T=this.localSearch._results;if(typeof cL=="number"&&!isNaN(cL)&&cL>=0&&cL<=T.getNumPages()-1){this.localSearch._ud.params.page_index=cL;this.searchRequest(this.localSearch._ud.params,this.localSearch._ud)}else{this.localSearch._setStatus(BMAP_STATUS_INVALID_REQUEST);this.localSearch._triggerCbk(w.CBK_SEARCH_COMPLETE)}}});function aq(T){a8.lang.Class.call(this);this.localSearch=T;this.map=T._opts.renderOptions.map;this._overlays=T._overlays;this.initialize()}a8.lang.inherits(aq,a8.lang.Class,"RenderMap");a8.extend(aq.prototype,{initialize:function(){this.addEventListener("render",this._render)},_render:function(){var cP=this,cQ=this.localSearch._results._pois,cO=[];for(var cN=0,T=cQ.length;cN<T;cN++){var cR=cQ[cN];cO.push(cR.point);var cM=this._addPoi(cR.point,cN,cR.title);if(!cM){continue}cR.marker=cM;(function(){var cS=cN;cM.addEventListener("click",function(){cP.localSearch.select(cS)})})();this._overlays.push(cM)}var cL={};cL.points=cO;this._getBestViewport(cL);this.localSearch._triggerCbk(w.CBK_MARKERS_SET,cQ)},addCenterPoi:function(cN){var T=cN;var cL=this;if(T&&typeof T!="string"&&!(T instanceof cd)){var cM=this.localSearch._centerMkr=an.addCenterPoi(this.map,T.point,T.title);cM.addEventListener("click",function(){cL.localSearch.select(-1);cL.localSearch._curIndex="c";var cO=cL._createInfoWindowByPoi(cN);cM.openInfoWindow(cO)})}},_addPoi:function(cL,T,cM){if(this.localSearch._opts.pageCapacity<=a4.DEFAULT_PAGE_CAPACITY){return an.addSearchPoi(this.map,cL,T,cM)}else{return an.addSearchInBoundsPoi(this.map,cL,cM)}},select:function(cL){if(this.map&&cL>-1&&this._overlays[cL]){this.map.closeInfoWindow();var cN=this.localSearch._results.getPoi(cL);if(!cN){return}var T=this._createInfoWindowByPoi(cN);var cM=this._overlays[cL];cM.openInfoWindow(T)}},_createInfoWindowByPoi:function(cM){var T=an.createSearchInfoWnd({title:cM.title,addr:cM.address,tel:cM.phoneNumber,url:cM.url,poiType:cM.type});var cL=this;T.addEventListener("close",function(){cL.localSearch.renderList.clearSelected()});T.addEventListener("open",function(){cL.localSearch._triggerCbk(w.CBK_INFO_HTML_SET,cM,an.getInfoWindowDom(cL.map))});return T},_getBestViewport:function(cL){var T=this.localSearch._opts.renderOptions;if(this.map){var cP=cL.points;var cN=!T.autoViewport,cO=!T.selectFirstResult&&T.autoViewport,cM=this.map.getViewport(cP,{margins:[30,30,30,30]});if(!cN){this.map.setViewport(cM,{enableAnimation:cO})}}}});function P(T){a8.lang.Class.call(this);this.localSearch=T;this.panel=T._opts.renderOptions.panel;this.initialize()}a8.lang.inherits(P,a8.lang.Class,"RenderList");a8.extend(P.prototype,{initialize:function(){this.addEventListener("render",this._render)},_render:function(){if(!this.panel){return}var cL=aa("div",{style:"font:12px "+cc.fontFamily+";border:1px solid #999;"}),cO=aa("div",{style:"background:#fff"}),cQ=aa("ol",{style:"list-style:none;padding:0;margin:0"}),cN=this.localSearch.getStatus(),T=null;if(cN==BMAP_STATUS_SUCCESS){for(var cP=0,cM=this.localSearch._results.getCurrentNumPois();cP<cM;cP++){var cS=this._createItem(cP);cQ.appendChild(cS)}}else{var cR="";switch(cN){case BMAP_STATUS_UNKNOWN_LOCATION:cR="\u62b1\u6b49\uff0c\u672a\u627e\u5230\u76f8\u5173\u5730\u70b9\u3002";break;case BMAP_STATUS_INVALID_KEY:cR="\u62b1\u6b49\uff0c\u60a8\u6240\u63d0\u4f9b\u7684key\u65e0\u6548\u3002";break}var cS=aa("li",{style:"margin:2px 0;padding:0 5px 0 3px;overflow:hidden;line-height:17px"});cS.innerHTML=cR;cQ.appendChild(cS)}cO.appendChild(cQ);cL.appendChild(cO);T=this._createResultsControl();cL.appendChild(T);this.panel.appendChild(cL);this.localSearch._triggerCbk(w.CBK_RESULTS_HTML_SET,cL)},_createItem:function(cN){var T=this.localSearch._results;if(!T||!T.getPoi(cN)){return}var cL=T.getPoi(cN),cU=aa("li",{style:"margin:2px 0;padding:0 5px 0 3px;cursor:pointer;overflow:hidden;line-height:17px"});if(this.localSearch._curIndex>-1&&cN==this.localSearch._curIndex){cU.style.backgroundColor="#f0f0f0"}var cM=cN==0?cN+2+"px":"-"+(cN*20-2)+"px";if(this.localSearch._opts.pageCapacity>a4.DEFAULT_PAGE_CAPACITY){cM="-218px"}var cT=["<span style=\'background:url("+x+"bmap/red_labels.gif) 0 "+cM+" no-repeat;padding-left:10px;margin-right:3px\'>&nbsp;</span>"];var cS,cQ;var cO=this.localSearch._results.keyword;var cR=new RegExp(cO,"ig");if(cL.title){cS=cL.title.replace(cR,"<b>$&</b>")}cT.push("<span style=\'color:#00c;text-decoration:underline\'>"+cS+"</span>");if(cL.address){cQ=cL.address.replace(cR,"<b>$&</b>");cT.push("<span style=\'color:#666;\'> - "+cQ+"</span>")}cU.innerHTML=cT.join("");var cP=this;cU.onclick=function(){cP.localSearch.select(cN)};return cU},_createResultsControl:function(){var cL=this,cM=aa("div",{style:"white-space:nowrap;text-align:right;background:#e5ecf9;margin-top:5px;padding:2px;overflow:hidden;zoom:1;"});var T=aa("div",{style:"float:left;margin-right:5px"});if(this.localSearch._results.getNumPages()>1){var cN=new aB(T,function(cO){cL.localSearch.gotoPage(cO-1)},{pageCount:cL.localSearch._results.getNumPages(),page:cL.localSearch._results.getPageIndex()+1,update:false})}cM.appendChild(T);return cM},clearSelected:function(){if(this.panel){if(typeof this.localSearch._curIndex=="number"&&this.localSearch._curIndex!=-1&&this.panel.getElementsByTagName("li")[this.localSearch._curIndex]){this.panel.getElementsByTagName("li")[this.localSearch._curIndex].style.backgroundColor=""}}this.localSearch._curIndex=-1},select:function(cL){if(this.panel){var T=this.localSearch._curIndex;if(typeof T=="number"&&T!=-1&&this.panel.getElementsByTagName("li")[T]){this.panel.getElementsByTagName("li")[T].style.backgroundColor=""}if(typeof cL=="number"&&cL!=-1&&this.panel.getElementsByTagName("li")[cL]){this.panel.getElementsByTagName("li")[cL].style.backgroundColor="#f0f0f0"}}}});');
﻿_jsload&&_jsload('route', 'function v(T){this.city=T.city;this._start=T.start;this._end=T.end;this._plans=T.plans;this.moreResultsUrl=T.url;this.taxiFare=T.taxiFare||null}a8.extend(v.prototype,{getStart:function(){return this._start},getEnd:function(){return this._end},getNumPlans:function(){return this._plans.length},getPlan:function(T){if(this._plans[T]){return this._plans[T]}}});function a7(T){v.call(this,T);this.policy=T.policy}a8.inherits(a7,v,"DrivingRouteResult");function bW(T){v.call(this,T)}a8.inherits(bW,v,"WalkingRouteResult");function C(T){v.call(this,T);this.policy=T.policy}a8.inherits(C,v,"TransitRouteResult");function l(T){this._routes=T.routes.slice(0);this._distance=T.distance||0;this._duration=T.duration||0;this._dragPois=T.dragPois||[]}a8.extend(l.prototype,{getRoute:function(T){if(this._routes[T]){return this._routes[T]}},getNumRoutes:function(){return this._routes.length},getDistance:function(T){if(T===false){return this._distance}else{return aV(this._distance)}},getDuration:function(T){if(T===false){return this._duration}else{return k(this._duration,"nav")}},getDragPois:function(){return this._dragPois}});function ck(T){l.call(this,T);this._lines=T.lines;this._description=T.description;this._duration=T.duration||0}a8.inherits(ck,l,"TransitRoutePlan");a8.extend(ck.prototype,{getNumLines:function(){return this._lines.length},getLine:function(T){if(this._lines[T]){return this._lines[T]}},getDescription:function(T){if(T===false){return S.removeHtml(this._description)}else{return this._description}},getDuration:function(T){if(T===false){return this._duration}else{return k(this._duration,"bustime")}}});function bL(T){this._steps=T.steps&&T.steps.slice(0)||[];this._distance=T.distance||0;this._index=T.index||0;this._points=T.points.slice(0);this._planIndex=T.planIndex||0;this._rt=T.rt;if(this._distance===0&&this._points.length>2){this._points.length=2}}a8.extend(bL.prototype,{getNumSteps:function(){return this._steps.length},getStep:function(T){if(this._steps[T]){return this._steps[T]}},getDistance:function(T){if(T===false){return this._distance}else{return aV(this._distance)}},getIndex:function(){return this._index},getPolyline:function(){return this._polyline},getPath:function(){return this._points},getRouteType:function(){return this._rt},getPlanIndex:function(){return this._planIndex}});function cg(T){this.title=T.title;this.uid=T.uid;this.type=T.type;this._stops=T.stops.slice(0);this._points=T.points.slice(0);this._distance=T.distance||0;this._numViaStops=T.numViaStops||0}a8.extend(cg.prototype,{getNumViaStops:function(){return this._numViaStops},getGetOnStop:function(){return this._stops[0]},getGetOffStop:function(){return this._stops[1]},getPath:function(){return this._points},getPolyline:function(){return this._polyline},getDistance:function(T){if(T===false){return this._distance}else{return aV(this._distance)}}});function aW(T){this._point=T.point;this._index=T.index;this._description=T.description;this._distance=T.distance||0;this._routeIndex=T.routeIndex||0;this._planIndex=T.planIndex||0}a8.extend(aW.prototype,{getPosition:function(){return this._point},getIndex:function(){return this._index},getDescription:function(T){if(T===false){return S.removeHtml(this._description)}else{return this._description}},getDistance:function(T){if(T===false){return this._distance}else{return aV(this._distance)}},getRouteIndex:function(){return this._routeIndex},getPlanIndex:function(){return this._planIndex}});b5._genTitle=function(cO,cP,cN){var cL="border-bottom:1px solid #ccc";var T="-21px";if(cN===0){cL+=";border-top:1px solid #ccc";T="5px"}var cM=["<div style=\'"+cL+"\'><div style=\'cursor:pointer;background:url("];cM.push(x+"img/trans_icons.png) no-repeat 5px "+T+";padding:8px 0 8px 33px;line-height:15px\' ");cM.push("onclick=\'"+cP+"\'><span style=\'white-space:nowrap\'>");cM.push(cO);cM.push("</span></div></div>");return cM.join("")};b5._genResultTitle=function(cM,cL,T){return\'<h1 style="margin:0;border-top:1px solid #ccc;\'+(T?"border-bottom:1px solid #ccc;padding:10px 0 10px 7px;":"padding:10px 0 9px 7px;")+"font:bold 16px "+cc.fontFamily+\'"> \'+cL+"\u524d\u5f80 "+cM+" \u7684\u8def\u7ebf</h1>"};a8.extend(b5.prototype,{search:function(cL,T){if(!cL||!T){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE);return false}return true},clearResults:function(){delete this._results;delete this._ud;delete this._json;delete this._boundsPoints;delete this._segPolylinePoints;var T=this._opts.renderOptions;this._setStatus();if(T.panel){T.panel.innerHTML=""}if(T.map){T.map.closeInfoWindow()}this._clearOverlays();this._curIndex=-1},_formatDestQuery:function(cL,cM){var T;cM=cM||{};if(typeof cL=="string"){T=[2,"","",cL,"",""]}else{if(cL instanceof BMap.Point){var cN=ba.convertLL2MC(cL);T=[1,"",cN.lng+","+cN.lat,(cM.wd||""),"",""]}else{var cN=ba.convertLL2MC(cL.point);T=[1,cL.uid,cN.lng+","+cN.lat,cL.title,"",""]}}return T.join("$$")}});var bo=0;var bp=1;function aV(T){if(typeof T=="string"){T=parseFloat(T)}var cL;if(!T||T<0){cL="0\u7c73"}else{if(T<=10){cL="10\u7c73"}else{cL=T<1000?Math.round(T/10)*10+"\u7c73":(T/1000).toFixed(1)+"\u516c\u91cc"}}if(cL=="1000\u7c73"){cL="1.0\u516c\u91cc"}return cL}function k(cS,cN){if(!cS||isNaN(cS)){return""}var T="",cL=60,cO=cL*24;var cM=Math.ceil(cS/cL);if(cN=="bustime"){var cR=cM%10,cP=parseInt(cM/10);cM=cR!=0?(cR>5?(++cP*10):cP?(cP*10):5):cM}var cT=parseInt(cM/cO);cM%=cO;var cQ=parseInt(cM/cL);cM%=cL;if(cT>=1){T+=cT+"\u5929"}if(cQ>=1){T+=cQ+"\u5c0f\u65f6"}if(cM>=1){if(cN&&cN=="nav"&&cT>=1){return T}else{T+=cM+"\u5206\u949f"}}return T}function ay(T){var cM=T.getSouthWest();var cL=T.getNorthEast();return[cM,cL]}a8.extend(aU.prototype,{_asyncSearch:function(){for(var cL=0,T=this._queryList.length;cL<T;cL++){var cM=this._queryList[cL];this[cM.method].apply(this,cM.arguments)}delete this._queryList},_internalSearch:function(cN,T){var cL=this;function cM(cQ){var cO=cQ.split("$$"),cP=cO[0],cR=null;if(/[0-2]/.test(cP)&&cO.length===7){cR=cO[+cP+1]}return cR}this._getIdByLoc(this._loc,function(cR){var cP={qt:cL.QUERY_TYPE,c:cR,sn:cN,en:T,sy:cL._opts.policy||0,ext:1};if(cP.sy==BMAP_TRANSIT_POLICY_AVOID_SUBWAYS){cP.f="[0,2,4,7,5,8,9,10,11]"}var cQ=cM(cN),cO=cM(T);bb.request(function(cT,cS){cL._rawDataCbk(cT,cS)},cP,{start:cQ,end:cO})})},search:function(cM,T){if(b5.prototype.search.call(this,cM,T)==true){var cL=this;this._getIdByLoc(this._loc,function(cO){if(!cO){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(w.CBK_SEARCH_COMPLETE)}var cN;if((typeof cM=="object"&&typeof T=="string")||(typeof cM=="string"&&typeof T=="object")){if(typeof cM=="string"){cN={qt:aQ,c:cO,isSingle:true,wd:cM,en:cL._formatDestQuery(T),sy:cL._opts.policy||0,ex:1}}else{if(typeof T=="string"){cN={qt:aQ,c:cO,isSingle:true,wd:T,sn:cL._formatDestQuery(cM),sy:cL._opts.policy||0,ex:1}}}}else{cN={qt:cL.QUERY_TYPE,c:cO,sn:cL._formatDestQuery(cM),en:cL._formatDestQuery(T),sy:cL._opts.policy||0,ex:1}}if(cN.sy==BMAP_TRANSIT_POLICY_AVOID_SUBWAYS){cN.f="[0,2,4,7,5,8,9,10,11]"}bb.request(function(cQ,cP){cL._rawDataCbk(cQ,cP)},cN,{start:cM,end:T})})}},_rawDataCbk:function(cL,T){this.clearResults();this._json=cL;var cM=cL.result;this._ud=T;if(cM.error!=0||cM.type!=this.RETURN_TYPE||!cL.content){this._results=new C({city:cL.current_city.name,plans:[],policy:cM.sy});this._setStatus(BMAP_STATUS_UNKNOWN_ROUTE);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results);return}this._processRaw();this._renderList();this._selectPlan(0)},_processRaw:function(){var cX=this._json.result;var db=this._json.content;var cZ=this._json.current_city;var cQ={};var cO={};if(typeof this._ud.start=="object"&&!(this._ud.start instanceof BMap.Point)){a8.extend(cQ,this._ud.start)}else{cQ.title=cX.start.wd||"\u8d77\u70b9";cQ.uid=cX.start.uid;cQ.url=w._getPoiUrl(cQ.uid,cZ.code);cQ.point=S.parseGeo(cX.start.pt,true).point;cQ.city=cZ.name}if(typeof this._ud.end=="object"&&!(this._ud.end instanceof BMap.Point)){a8.extend(cO,this._ud.end)}else{cO.title=cX.end.wd||"\u7ec8\u70b9";cO.uid=cX.end.uid;cO.url=w._getPoiUrl(cO.uid,cZ.code);cO.point=S.parseGeo(cX.end.pt,true).point;cO.city=cZ.name}var c8=[],cV=0;this._boundsPoints=[];for(var c5=0;c5<db.length;c5++){if(cV>this._opts.pageCapacity-1){break}for(var cU=0,de=db[c5].stops.length;cU<de;cU++){if(cV>this._opts.pageCapacity-1){break}this._boundsPoints[cV]=[];var cR=db[c5].stops[cU];var cM=db[c5].lines[cU];var c6=0;for(var c1=0,c2=cM.length;c1<c2;c1++){if(typeof cM[c1]=="object"){c6++}}var T=cM[c6+1],c9=[],c4=[],c0=0,c7="";for(var c3=0;c3<cR.length-1;c3++){var cT=cR[c3].getOn;var cS={title:cT.name,uid:cT.uid,url:w._getPoiUrl(cT.uid,cZ.code),city:cZ.name,point:S.parseGeo(cT.geo,true).point};var dd=cR[c3+1].getOff;var cN={title:dd.name,uid:dd.uid,url:w._getPoiUrl(dd.uid,cZ.code),city:cZ.name,point:S.parseGeo(dd.geo,true).point};var cL=[];if(c3==0){if(cR[c3].walk.distance>0){cL=S.parseGeo(cR[c3].walk.geo,true).points.concat(cS.point)}c4.push(new bL({distance:cR[c3].walk.distance,points:cL.slice(0),rt:BMAP_ROUTE_TYPE_WALKING,index:c3,planIndex:c5}))}else{if(cR[c3].walk.distance>0){var dc=S.parseGeo(cR[c3].getOff.geo,true).point;var da=S.parseGeo(cR[c3].getOn.geo,true).point;cL=([dc].concat(S.parseGeo(cR[c3].walk.geo,true).points)).concat(da)}c4.push(new bL({distance:cR[c3].walk.distance,points:cL.slice(0),rt:BMAP_ROUTE_TYPE_WALKING,index:c3,planIndex:c5}))}c0+=cR[c3].walk.distance;if(c3==cR.length-2){if(cR[c3+1].walk.distance>0){cL=[cN.point].concat(S.parseGeo(cR[c3+1].walk.geo,true).points)}c4.push(new bL({distance:cR[c3+1].walk.distance,points:cL.slice(0),rt:BMAP_ROUTE_TYPE_WALKING,index:c3+1,planIndex:c5}));c0+=cR[c3+1].walk.distance}var cW=S.parseGeo(cM[c3].geo,true);c9.push(new cg({title:cM[c3].name,uid:cM[c3].uid,distance:cM[c3].distance,points:cW.points,stops:[cS,cN],type:this._getLineType(cM[c3].type),numViaStops:cM[c3].station_num}));var cY=ay(cW.bounds);this._boundsPoints[cV].push(cY[0],cY[1]);c0+=cM[c3].distance;if(cR[c3].walk.distance){c7+="<b>\u6b65\u884c</b>\u7ea6"+aV(cR[c3].walk.distance)+"\uff0c\u5230\u8fbe<b>"+cS.title+"</b>\uff0c"}c7+="\u4e58\u5750<b>"+this._shortTitle(cM[c3].name)+"</b>\uff0c\u7ecf\u8fc7"+cM[c3].station_num+"\u7ad9\uff0c\u5230\u8fbe<b>"+cN.title+"</b>";if(c3<cR.length-2){c7+="\uff0c"}else{if(cR[c3+1].walk.distance){c7+="\uff0c<b>\u6b65\u884c</b>\u7ea6"+aV(cR[c3+1].walk.distance)+"\uff0c\u5230\u8fbe<b>"+cR[c3+1].getOn.name+"</b>"}}}c8.push(new ck({routes:c4,distance:c0,duration:T,lines:c9,description:c7}));cV++}}var cP=cI+"?s="+encodeURIComponent(this.QUERY_TYPE+"&c="+cZ.code+"&sy="+cX.sy+"&sn="+this._formatDestQuery(this._ud.start)+"&en="+this._formatDestQuery(this._ud.end)+"&sq="+(this._ud.start.title?this._ud.start.title:this._ud.start)+"&eq="+(this._ud.end.title?this._ud.end.title:this._ud.end))+"&sr=1";if(this._ud.start instanceof cd&&this._ud.end instanceof cd){cP=""}if((typeof this._ud.start=="object"&&typeof this._ud.end=="string")||(typeof this._ud.start=="string"&&typeof this._ud.end=="object")){cP=""}this._results=new C({city:cZ.name,plans:c8,start:cQ,end:cO,url:cP,policy:cX.sy});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results)},_renderPlan:function(cN){var c1=this._opts.renderOptions.map;if(!c1){return}var cL=this._results.getPlan(cN);if(!cL){return}var cM=this._results.getStart();var cZ=this._results.getEnd();var cW=an.addDestPoi(c1,cM.point,cM.title,bo);cM.marker=cW;cW.addEventListener("click",function(){c3._select(0)});this._overlays.push(cW);var cU=an.addDestPoi(c1,cZ.point,cZ.title,bp);cZ.marker=cU;this._overlays.push(cU);cU.addEventListener("click",function(){c3._selectLast()});var cS=cM.point;var cY=cZ.point;this._boundsPoints[cN].push(cS,cY);var T=[];var c3=this;for(var cX=0,cV=cL.getNumLines();cX<cV;cX++){var cQ=cL.getLine(cX);var cT=an.addLine(c1,cQ.getPath());cQ._polyline=cT;this._overlays.push(cT);var cP=cQ.getGetOnStop();T.push(cP);var cR=an.addTransPoi(c1,cP.point,cQ.type,cP.title);cP.marker=cR;this._overlays.push(cR);var c2=cQ.getGetOffStop();T.push(c2);var cO=an.addTransPoi(c1,c2.point,cQ.type,c2.title);c2.marker=cO;(function(){var c4=cX;cR.addEventListener("click",function(){c3._select((c4+1)*2-1)});cO.addEventListener("click",function(){c3._select((c4+1)*2)})})();this._overlays.push(cO);var c0=cL.getRoute(cX);if(c0.getDistance(false)>0){cT=an.addRoute(c1,c0.getPath(),c0.getRouteType());c0._polyline=cT;this._overlays.push(cT)}}var c0=cL.getRoute(cX);cT=an.addRoute(c1,c0.getPath(),c0.getRouteType());c0._polyline=cT;this._overlays.push(cT);var c3=this;if(this._opts.renderOptions.autoViewport){c1.setViewport(this._boundsPoints[cN],{margins:[30,30,30,30]})}this._triggerCbk(w.CBK_POLYLINES_SET,cL._lines,cL._routes);this._triggerCbk(w.CBK_MARKERS_SET,[cM,cZ],T)},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var cL=aa("div",{style:"font:12px "+cc.fontFamily+";background:#fff"});var cV=b5._genResultTitle(this._results.getEnd().title,"\u4e58\u516c\u5171\u4ea4\u901a\u5de5\u5177");var cP=b5._genTitle(this._results.getStart().title,\'Instance("\'+this.guid+\'")._select(0)\',0);var cW=["<table style=\'font:12px "+cc.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>"];for(var cT=0,cQ=this._results.getNumPlans();cT<cQ;cT++){var cU=this._results.getPlan(cT),cO=cU.getDistance().replace(/(\d+(?:.\d+)?)/,"$1 "),T=cU.getDuration().replace(/(\d+)/,"$1 "),cS="";if(this._curIndex==cT){cS=";background:#f0f0f0"}var cN="border-bottom:1px solid #ccc;vertical-align:top;";cW.push(\'<tr style="cursor:pointer\'+cS+\'" onclick=\\\'Instance("\'+this.guid+\'")._selectPlan(\'+cT+")\'>");cW.push("<td style=\'"+cN+"width:20px;text-align:right;padding:4px 3px\' >"+(cT+1)+".</td>");cW.push("<td style=\'"+cN+"padding:2px;line-height:18px\' >"+cU.getDescription()+"</td>");cW.push("<td style=\'"+cN+"text-align:right;padding:4px 3px;white-space:nowrap\' >"+cO+" / "+T+"</td></tr>");cW.push("</tr>")}cW.push("</table>");var cM=b5._genTitle(this._results.getEnd().title,\'Instance("\'+this.guid+\'")._selectLast()\',1);var cR="<div style=\'border-bottom:1px solid #ccc;margin-bottom:10px;color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right\'>";if(this._results.moreResultsUrl){cR+="<a style=\'color:#7777cc\' href=\'"+this._results.moreResultsUrl+"\' target=\'_blank\'>\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b&#187;</a>"}cR+="&nbsp;</div>";cL.innerHTML=cV+cP+cW.join("")+cM+cR;this._opts.renderOptions.panel.appendChild(cL);this._triggerCbk(w.CBK_RESULTS_HTML_SET,cL)}},_select:function(cO){var cL=this._opts.renderOptions.map;if(cL){var cS=this._results.getPlan(this._curIndex);if(!cS){return}var cR=this;var cT=cS.getNumLines()*2;if(cO==0||cO==cT+1){var cQ=cO===0?this._results.getStart():this._results.getEnd();var cM=an.createTransInfoWnd({content:"<b>"+cQ.title+"</b>",total:cT,curIndex:cO,nextTransCbk:function(cV){cR._select(cV)}});cM.addEventListener("open",function(){cR._triggerCbk(w.CBK_INFO_HTML_SET,cQ,an.getInfoWindowDom(cL))});var cP=cO===0?0:1;this._overlays[cP].openInfoWindow(cM)}else{var T=cS.getLine(Math.floor((cO+1)/2)-1);var cU;var cN;if(cO%2===1){cU=T.getGetOnStop();cN="<b>"+cU.title+"\u7ad9\u4e0a\u8f66</b>"}else{cU=T.getGetOffStop();cN="<b>"+cU.title+"\u7ad9\u4e0b\u8f66</b>"}var cM=an.createTransInfoWnd({content:cN,total:cT,curIndex:cO,nextTransCbk:function(cV){cR._select(cV)}});cM.addEventListener("open",function(){cR._triggerCbk(w.CBK_INFO_HTML_SET,cU,an.getInfoWindowDom(cL))});cU.marker.openInfoWindow(cM)}}},_selectLast:function(){if(this._results&&this._curIndex>-1){var cL=this._results.getPlan(this._curIndex);if(!cL){return}var T=cL.getNumLines()*2;this._select(T+1)}},_selectPlan:function(cL){if(!this._results&&!this._result.getPlan(cL)){return}var cO=this._results.getPlan(cL);var cN=this._opts.renderOptions.map;if(cN){cN.closeInfoWindow();this._clearOverlays();this._renderPlan(cL)}if(this._opts.renderOptions.panel){var cM=this._opts.renderOptions.panel.getElementsByTagName("table")[0];if(!cM){return}var T=cM.getElementsByTagName("tr");if(this._curIndex>=0&&T[this._curIndex]){T[this._curIndex].style.background=""}if(cL>=0&&T[cL]){T[cL].style.background="#f0f0f0"}}this._curIndex=cL},_clearOverlays:function(){for(var T=0;T<this._overlays.length;T++){if(this._overlays[T]._p){this._overlays[T]._p.remove();this._overlays[T]._p=null}this._overlays[T].remove();this._overlays[T]=null}this._overlays.length=0},_getLineType:function(T){return aU.LINE_TYPE_MAPPING[T]}});bl.MAX_THRESHOLD=20;bl.DRAG_REQ_FREQUENCE=50;bl.DRAG_MAXPOINTS=10;a8.extend(bl.prototype,{_d:{plys:[],viaPts:[],viaPtsInfo:[],dragOverlays:[],tipLbl:null,sliderMkr:null,dragReqFlag:false,cbkDragPt:null,cbkPly:null,isSearchByDrag:false,curDragPly:null,dragSrcCityCode:1,dragEndCityCode:1,cbkStartPoiName:"\u8d77\u70b9",cbkEndPoiName:"\u7ec8\u70b9",mouseOnViaMkr:false,cxtMenu:[]},_asyncSearch:function(){for(var cL=0,T=this._queryList.length;cL<T;cL++){var cM=this._queryList[cL];this[cM.method].apply(this,cM.arguments)}delete this._queryList},search:function(cM,T){this._d.isSearchByDrag=false;if(b5.prototype.search.call(this,cM,T)==true){var cL=this;this._getIdByLoc(this._loc,function(cP){cP=cP||1;var cO;if((typeof cM=="object"&&typeof T=="string")||(typeof cM=="string"&&typeof T=="object")){if(typeof cM=="string"){cO={qt:e,c:cP,isSingle:true,wd:cM,en:cL._formatDestQuery(T),sy:cL._opts.policy||0}}else{if(typeof T=="string"){cO={qt:e,c:cP,isSingle:true,wd:T,sn:cL._formatDestQuery(cM),sy:cL._opts.policy||0}}}this.QUERY_TYPE=e}else{cO={qt:cL.QUERY_TYPE,c:cP,sn:cL._formatDestQuery(cM),en:cL._formatDestQuery(T),sy:cL._opts.policy||0}}var cN={start:cM,end:T};bb.request(function(cR,cQ){cL._rawDataCbk(cR,cQ)},cO,cN)})}},_dragSearch:function(cM,T){var cL=this;cL._d.isSearchByDrag=true;cL._getIdByLoc(cL._loc,function(cO){cO=cO||1;var cS=ba.convertLL2MC(cL._d.viaPts[0]);var cN="1$$$$"+cS.lng+","+cS.lat+"$$$$";var cW=cL._d.dragSrcCityCode||cO;var cV="",cP="";for(var cT=1,cQ=cL._d.viaPts.length;cT<cQ;cT++){var cU=ba.convertLL2MC(cL._d.viaPts[cT]);if(cT==cQ-1){cV+="1$$$$"+cU.lng+","+cU.lat+"$$$$";cP+=(cL._d.dragEndCityCode||cO)}else{cV+="1$$$$"+cU.lng+","+cU.lat+"$$$$+to:";cP+="0 +to:"}}var cR={qt:cL.QUERY_TYPE,c:cO,drag:1,sc:cW,ec:cP,sn:cN,en:cV,sy:cL._opts.policy||0};var cX={start:cM,end:T};a8.extend(cX,{useEncodeURI:true});bb.request(function(cZ,cY){cL._rawDataCbk(cZ,cY)},cR,cX)})},_rawDataCbk:function(cL,T){this.clearResults();this._json=cL;var cM=cL.result;this._ud=T;if(cM.error!=0||cM.type!=this.RETURN_TYPE){this._results=this._createResults({city:cL.current_city.name,plans:[],policy:cM.sy});this._setStatus(BMAP_STATUS_UNKNOWN_ROUTE);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results);return}this._processRaw();this._renderMap();this._renderList()},_stopDragging:function(){var cN=this;if(cN._d.sliderMkr){cN._d.sliderMkr.disableDragging()}for(var cM=0,T=this._d.dragOverlays.length;cM<T;cM++){var cL=this._d.dragOverlays[cM];if(cL instanceof ad){cL.disableDragging()}}},_processRaw:function(){var di=this._json.result;var dw=this._json.content;var de=this._json.current_city;var dm=dw.kps;var cL=dw.rss;var c3={};var cZ={};if(typeof this._ud.start=="object"&&!(this._ud.start instanceof cd)){a8.extend(c3,this._ud.start)}else{c3.title=di.start.wd||"\u8d77\u70b9";c3.uid=di.start.uid;c3.url=w._getPoiUrl(c3.uid,di.start_city.code);c3.point=S.parseGeo(di.start.pt,true).point;c3.city=di.start_city.cname}this._d.dragSrcCityCode=di.start_city.code;if(typeof this._ud.end=="object"&&!(this._ud.end instanceof cd)){a8.extend(cZ,this._ud.end)}else{var cO,cX;if(this._d.isSearchByDrag){cO=di.end[di.end.length-1];cX=di.end_city[di.end_city.length-1]}else{cO=di.end[0];cX=di.end_city[0]}this._d.dragEndCityCode=cX.code;cZ.title=cO.wd||"\u7ec8\u70b9";cZ.uid=cO.uid;if(cZ.uid=="null"){cZ.uid=""}cZ.url=w._getPoiUrl(cO.uid,cX.code);cZ.point=S.parseGeo(cO.pt,true).point;cZ.city=cX.cname}var df=[];var c8=[];var T=[];var c6=0;var dh=[];this._segPolylinePoints=[];var cV=[],da=[],dp=[];var dj=0;this._d.viaPtsInfo.length=0;var dg=1;for(var dq=0,dn=dm.length-1;dq<dn;dq++){var c0=dm[dq];var cM=dm[dq+1];var db=cL[dq];var dl=cL[dq-1]||{};var cY=cL[dq+1];var cS=S.parseGeo(c0.pt,true).point;var du=parseInt(db.d);var cP=S.parseGeo(db.g,true);if(cP){dp=dp.concat(cP.points)}c6+=cY.d;if(c0.rt==3){cV.push(cS);da.push(dp.slice(0));dp=[];df.push(c8.slice(0));c8=[];T.push(c6);c6=0;var c1=dl.n||cY.n||"\u672a\u77e5\u8def\u6bb5";var dx=dg;this._d.viaPtsInfo.push({title:c1,curNo:dg,point:cS});dg++}else{var cU=this._getDescription(c0,db,cY,dq,dn,dl,cM);var dv=c8.length;var dc=new aW({point:cS,index:dv,description:cU,distance:cY.d});c8.push(dc);if(cP){if(dq>1){this._segPolylinePoints[dj]=[dh[dh.length-1]].concat(cP.points)}else{this._segPolylinePoints[dj]=cP.points}dh=dh.concat(cP.points)}dj++}}if(dp.length>0){da.push(dp)}if(c8.length>0){df.push(c8)}if(c6>0){T.push(c6)}var dt=[];for(var dq=0,dn=da.length;dq<dn;dq++){var ds=new bL({steps:df[dq],distance:T[dq],index:dq,points:da[dq],rt:this.ROUTE_TYPE});dt.push(ds)}var dk=dw.time;if(this.QUERY_TYPE==bv){dk=Math.round(dw.dis/1.35)}var c9=new l({routes:dt,distance:dw.dis,duration:dk,dragPois:this._d.viaPtsInfo});var cN="",cQ={},dr=null,dd=null,cW="string",c4="string",c5=this._opts.renderOptions.map;if(this._ud.start instanceof cd){cW="point"}if(this._ud.end instanceof cd){c4="point"}if(cW==="point"&&c4==="string"||cW==="string"&&c4==="point"){dr=e;dd=c5.getBounds();a8.extend(cQ,{c:de.code,isSingle:true,sy:di.sy,newmap:1,nstep:1,ie:"utf-8",l:c5.getZoom()});if(cW==="string"){cQ.wd=this._ud.start;cQ.en=this._formatDestQuery(this._ud.end,{wd:"\u7ec8\u70b9"})}else{cQ.wd=this._ud.end;cQ.sn=this._formatDestQuery(this._ud.start,{wd:"\u8d77\u70b9"})}cQ.tn=c5.getMapType()===BMAP_NORMAL_MAP?"B_NORMAL_MAP":"B_DIMENSIONAL_MAP"}else{dr=bM;cQ.c=de.code;cQ.sc=di.start_city.code;cQ.ec=di.end_city[0].code;cQ.sy=di.sy;cQ.sn=this._formatDestQuery(this._ud.start);cQ.en=this._formatDestQuery(this._ud.end);cQ.sq=this._ud.start.title?this._ud.start.title:this._ud.start;cQ.eq=this._ud.end.title?this._ud.end.title:this._ud.end}if(dr!==null){cN=cI+"?s="+encodeURIComponent(dr+"&"+O(cQ))+"&sr=1"}this._results=this._createResults({city:de.name,plans:[c9],start:c3,end:cZ,url:cN,policy:di.sy,taxiFare:this._getTaxiFare()});this._d.viaPts.length=0;this._d.plys.length=0;var c2=c3.point;this._d.viaPts.push(c2);for(var dq=0,dn=cV.length;dq<dn;dq++){var cT=cV[dq];this._d.viaPts.push(cT)}var c7=cZ.point;this._d.viaPts.push(c7);for(var dq=0,dn=da.length;dq<dn;dq++){var cR=da[dq];cR.stNo=dq;cR.edNo=dq+1;this._d.plys.push(cR)}this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(w.CBK_SEARCH_COMPLETE,this._results)},_getAllStepCount:function(){var cN=0;var cO=this._results.getPlan(0);for(var cM=0,T=cO.getNumRoutes();cM<T;cM++){var cL=cO.getRoute(cM);cN+=cL.getNumSteps()}return cN},_getCurStep:function(cP){var cO=0;var cQ=this._results.getPlan(0);for(var cN=0,cL=cQ.getNumRoutes();cN<cL;cN++){var cS=cQ.getRoute(cN);for(var cM=0,cR=cS.getNumSteps();cM<cR;cM++){var T=cS.getStep(cM);if(cO==cP){return T}cO++}}},_getDescription:function(cQ,cP,cZ,cW,cV,cM,c3){var cO="";var cU=parseInt(cP.d);var cR=cP.poi;if(cR){cU=cU-cR.pd}var cY=aV(cU);var cL=this._getRoadName(cM.t,cM.n);var cN=this._getRoadName(cP.t,cP.n);var c2=this._getRoadName(cP.t,cZ.n);var cS=this._getDwType(cQ.dw)||"";var cT=cQ.dr?(cS+"<b>"+cQ.dr+"</b>\uff0c"):"";if(c3.rt==3){cT+="\u5230\u8fbe<b>"+this._getRetType(c3.rt)+"</b>\uff0c"}var c0=((cN!=""&&cL==cN)?"\u7ee7\u7eed":"")+this._getRoadAct(cP.t,cP.n);var T=this._getPoiInfo(cP);var cX=this._getTicInfo(cQ);var c1=(cN==c2)?"":(this._getRetAct(cZ.t,cZ.n)+"<b>"+c2+"</b>");cO=c0+"<b>"+cN+"</b>"+this._getRetType(cQ.rt)+cY+"\uff0c"+T+cX+cT;if(cW==0){cO="\u4ece<b>\u8d77\u70b9</b>\u5411"+this._getTurnType(cQ.ett||cQ.tt)+"\u51fa\u53d1"}else{if(cW>0&&cW<cV-1){cO=cO+"<b>"+this._getTurnType(cQ.ett||cQ.tt)+"</b>"+c1}else{cO=cO+"\u5230\u8fbe<b>\u7ec8\u70b9</b>"}}return cO},_isInThreshold:function(cQ,cL,cP){if(cL&&cP&&cP.length>0){for(var cO=0,T=cP.length;cO<T;cO++){var cN=cP[cO];var cM=cQ.pointToPixel(cN);if(an.getDistanceByPixel(cL,cM)<=bl.MAX_THRESHOLD){return true}}}return false},_renderMap:function(){var T=this._opts.renderOptions.map;if(T&&this._results){this._renderViaMkr();this._renderPly()}},_renderPly:function(){var cL=this._opts.renderOptions.map;var cS=this._results.getPlan(0);var cU=cS.getRoute(0);var T=this._results.getStart();var cQ=this._results.getEnd();var cR=this;var cO=this._d.viaPts.length;var cT=[];for(var cN=0,cM=this._d.plys.length;cN<cM;cN++){var cW=this._d.plys[cN];var cP=an.addRoute(cL,cW,cU.getRouteType());cS._routes[cN]._polyline=cP;cP.stNo=cW.stNo;cP.edNo=cW.edNo;var cV=cP.getBounds();cT.push(cV.getSouthWest());cT.push(cV.getNorthEast());if(this._enableDragging){if(cO<bl.DRAG_MAXPOINTS+2){cP.addEventListener("mousemove",function(cX){if(cR._d.mouseOnViaMkr){if(cR._d.sliderMkr){cR._d.sliderMkr.hide()}return}cR._d.curDragPly=this;if(cR._d.sliderMkr){if(cR._isInThreshold(cL,cX.pixel,cR._d.viaPts)){cR._d.sliderMkr.hide()}else{cR._d.sliderMkr.show();cR._d.sliderMkr.setPosition(cX.point);cR._d.tipLbl.setContent("\u62d6\u52a8\u4ee5\u66f4\u6539\u8def\u7ebf");cR._d.tipLbl.show();cR._d.sliderMkr.setLabel(cR._d.tipLbl)}}else{cR._d.sliderMkr=an.addDragMkr(cL,cX.point);cR._d.sliderMkr.enableDragging();cR._d.sliderMkr.addEventListener("dragging",function(cZ){var c0=cR._d.curDragPly.stNo;var cY=cR._d.curDragPly.edNo;cR._requestDragging(this,cL,c0,cY)});cR._d.sliderMkr.addEventListener("dragend",function(c0){var cZ=cR._d.cbkDragPt;var cY=cR._d.curDragPly.edNo;cR._d.viaPts.splice(cY,0,cZ);this.setPosition(cZ);cR._stopDragging();cR._dragSearch(T,cQ)});if(!cR._d.tipLbl){cR._d.tipLbl=an.createTipLbl("\u62d6\u52a8\u4ee5\u66f4\u6539\u8def\u7ebf")}cL.addOverlay(cR._d.sliderMkr)}});cP.addEventListener("mouseout",function(cX){if(cR._d.sliderMkr){cR._d.sliderMkr.hide()}})}}cR._d.dragOverlays.push(cP)}if(this._opts.renderOptions.autoViewport){cL.setViewport(cT,{margins:[30,30,30,30]})}this._triggerCbk(w.CBK_POLYLINES_SET,cS._routes)},_renderViaMkr:function(){var cL=this._opts.renderOptions.map;var cU=this._results.getPlan(0);var T=this._results.getStart();var cS=this._results.getEnd();var cT=this;for(var cQ=0,cM=this._d.viaPts.length;cQ<cM;cQ++){var cR=this._d.viaPts[cQ];var cO;if(cQ==0){cO=an.addDestPoi(cL,cR,T.title,bo);T.marker=cO;cO.addEventListener("click",function(){cT._select(0)});this._overlays.push(cO)}else{if(cQ==this._d.viaPts.length-1){cO=an.addDestPoi(cL,cR,cS.title,bp);cS.marker=cO;cO.addEventListener("click",function(){cT._select(cT._getAllStepCount()+1)});this._overlays.push(cO)}else{cO=an.addDragMkr(cL,cR);this._d.viaPtsInfo[cQ-1].marker=cO;var cP=new cz();cP.addItem(new be("\u5220\u9664\u8be5\u70b9",function(cX,cW,cV){cT._delVia(cV.curNo)},{width:60}));cO.addContextMenu(cP);cT._d.cxtMenu.push(cP)}}cO.curNo=cQ;if(this._enableDragging){cO.enableDragging();cO.addEventListener("mouseover",function(cV){cT._d.mouseOnViaMkr=true;if(cT._d.tipLbl){cT._d.tipLbl.setContent("\u62d6\u52a8\u4ee5\u66f4\u6539\u8def\u7ebf");cT._d.tipLbl.show();this.setLabel(cT._d.tipLbl)}else{cT._d.tipLbl=an.createTipLbl("\u62d6\u52a8\u4ee5\u66f4\u6539\u8def\u7ebf");this.setLabel(cT._d.tipLbl)}});cO.addEventListener("mouseout",function(cV){this.getLabel().hide();cT._d.mouseOnViaMkr=false});cO.addEventListener("dragging",function(cV){cT._requestDragging(this,cL)});cO.addEventListener("dragend",function(cW){var cV=cT._d.cbkDragPt;var cX=this.curNo;cT._d.viaPts[cX]=cV;this.setPosition(cV);var cZ=cT._d.viaPts[0];var cY=cT._d.viaPts[cT._d.viaPts.length-1];if(cX==0){T.point=cZ;T.title=cT._d.cbkStartPoiName}if(cX==cT._d.viaPts.length-1){cS.point=cY;cS.title=cT._d.cbkEndPoiName}cT._stopDragging();cT._dragSearch(T,cS)})}cT._d.dragOverlays.push(cO)}var cN=[T];cN=cN.concat(this._d.viaPtsInfo);cN=cN.concat([cS]);this._triggerCbk(w.CBK_MARKERS_SET,cN)},_requestDragging:function(cR,cL,cN,cS){var cU=this;if(cU._d.dragReqFlag==true){return}cU._d.dragReqFlag=true;window.setTimeout(function(){cU._d.dragReqFlag=false},bl.DRAG_REQ_FREQUENCE);var cP;var cV=ba.convertLL2MC(cR.getPosition());var T=cL.getZoom();var cT=cR.curNo;if(typeof cN!="undefiend"&&typeof cS!="undefined"){var cO=cU._d.viaPts[cN];cO=ba.convertLL2MC(cO);var cQ=cU._d.viaPts[cS];cQ=ba.convertLL2MC(cQ);cP={qt:ci,pt:cV.lng+","+cV.lat,sn:cO.lng+","+cO.lat,en:cQ.lng+","+cQ.lat,r:5000,st:1,et:1,sy:0,l:T}}else{if(cT==0){var cQ=cU._d.viaPts[cT+1];cQ=ba.convertLL2MC(cQ);cP={qt:ci,pt:cV.lng+","+cV.lat,sn:"",en:cQ.lng+","+cQ.lat,r:5000,st:1,et:1,sy:0,l:T}}else{if(cT==this._d.viaPts.length-1){var cO=cU._d.viaPts[cT-1];cO=ba.convertLL2MC(cO);cP={qt:ci,pt:cV.lng+","+cV.lat,sn:cO.lng+","+cO.lat,en:"",r:5000,st:1,et:1,sy:0,l:T}}else{var cO=cU._d.viaPts[cT-1];cO=ba.convertLL2MC(cO);var cQ=cU._d.viaPts[cT+1];cQ=ba.convertLL2MC(cQ);cP={qt:ci,pt:cV.lng+","+cV.lat,sn:cO.lng+","+cO.lat,en:cQ.lng+","+cQ.lat,r:5000,st:1,et:1,sy:0,l:T}}}}var cM={curDragMkr:cR,map:cL,stNo:cN,edNo:cS};bb.request(function(cX,cW){cU._requestDraggingCbk(cX,cW)},cP,cM)},_requestDraggingCbk:function(cW,cM){var cS=this;if(cW&&cW.content){cS._d.cbkDragPt=S.parseGeo(cW.content.dragpt,true).point;var cV;var cL=cM.map;var cO=cM.stNo;var cQ=cM.edNo;var cP=cM.curDragMkr;var cR=cP.curNo;if(typeof cO!="undefiend"&&typeof cQ!="undefined"){cV=S.parseGeoExt(cW.content.geo).points}else{if(cR==0){cV=S.parseGeo(cW.content.geo,true).points;cS._d.cbkStartPoiName=cW.content.name?cW.content.name:"\u8d77\u70b9"}else{if(cR==cS._d.viaPts.length-1){cV=S.parseGeo(cW.content.geo,true).points;cS._d.cbkEndPoiName=cW.content.name?cW.content.name:"\u7ec8\u70b9"}else{cV=S.parseGeoExt(cW.content.geo).points}}}if(cV){cS._clearOldLine(cR,cL,cO,cQ);if(cS._d.cbkPly){cS._d.cbkPly.setPath(cV)}else{var cT=cS._results.getPlan(0);var cU=cT.getRoute(0);cS._d.cbkPly=an.addRoute(cL,cV,cU.getRouteType())}}var T=cW.content.name?cW.content.name:"\u672a\u77e5\u8def\u6bb5";var cN="("+aV(cW.content.dis)+")";cS._d.tipLbl.show();cS._d.tipLbl.setContent(T+cN)}},_clearOldLine:function(cP,cQ,cO,cL){for(var cN=0,T=this._d.dragOverlays.length;cN<T;cN++){var cM=this._d.dragOverlays[cN];if(cM instanceof f){if(typeof cO!="undefiend"&&typeof cL!="undefined"){if(cM.stNo==cO&&cM.edNo==cL){cQ.removeOverlay(cM);break}}else{if(cM.stNo==cP||cM.edNo==cP){cQ.removeOverlay(cM)}}}}if(this._hlRoute){this._hlRoute.hide()}},_select:function(cM){var cQ=this._curIndex;var cO=this._opts.renderOptions;if(cO.panel){var cP=cO.panel.getElementsByTagName("table");var cV=cP[cP.length-1];var cS=cV.getElementsByTagName("tr");if(cQ-1>=0&&cS[cQ-1]){cS[cQ-1].style.background=""}if(cM-1>=0&&cS[cM-1]){cS[cM-1].style.background="#f0f0f0"}}var cZ=cO.map;if(cZ){var T=this._results.getPlan(0);var cX=T.getRoute(0);var c1=this._getAllStepCount();var c0=this;cZ.closeInfoWindow();if(cM==0||cM==c1+1){var cW=cM===0?this._results.getStart():this._results.getEnd();var cL=an.createTransInfoWnd({content:"<b>"+cW.title+"</b>",total:c1,curIndex:cM,nextTransCbk:function(c2){c0._select(c2)},hideStep:(cO.highlightMode==BMAP_HIGHLIGHT_STEP?false:true)});cL.addEventListener("open",function(){c0._triggerCbk(w.CBK_INFO_HTML_SET,cW,an.getInfoWindowDom(cZ))});cL.addEventListener("close",function(){if(c0._opts.renderOptions.panel){var c3=cO.panel.getElementsByTagName("table");var c4=c3[c3.length-1];if(c4){var c2=c4.getElementsByTagName("tr");if(c0._curIndex-1>=0&&c2[c0._curIndex-1]){c2[c0._curIndex-1].style.background=""}}}c0._curIndex=-1});var cY=cM===0?0:1;this._overlays[cY].openInfoWindow(cL);if(this._hlRoute){this._hlRoute.hide()}}else{var cU=cO.highlightMode;if(cU==BMAP_HIGHLIGHT_STEP){var cN=this._getCurStep(cM-1);var cL=an.createTransInfoWnd({content:cN.getDescription(),total:c1,curIndex:cM,nextTransCbk:function(c2){c0._select(c2)}});cL.addEventListener("open",function(){c0._triggerCbk(w.CBK_INFO_HTML_SET,cN,an.getInfoWindowDom(cZ))});cL.addEventListener("close",function(){if(c0._opts.renderOptions.panel){var c3=cO.panel.getElementsByTagName("table");var c4=c3[c3.length-1];if(c4){var c2=c4.getElementsByTagName("tr");if(c0._curIndex-1>=0&&c2[c0._curIndex-1]){c2[c0._curIndex-1].style.background=""}}}c0._curIndex=-1});var cT=cN.getPosition();cZ.openInfoWindow(cL,cT)}else{if(cU==BMAP_HIGHLIGHT_ROUTE){if(cM==1){var cN=this._getCurStep(0);cZ.setCenter(cN.getPosition());if(cO.autoViewport){cZ.setZoom(17)}if(this._hlRoute){this._hlRoute.hide()}}else{if(this._segPolylinePoints[cM-1]){if(!this._hlRoute){this._hlRoute=an.addRoute(cZ,this._segPolylinePoints[cM-1],cX.getRouteType()+2)}else{this._hlRoute.setPath(this._segPolylinePoints[cM-1]);this._hlRoute.show()}if(cO.autoViewport){var cR=cZ.getViewport(this._hlRoute.getBounds());if(cR.zoom>17){cR.zoom=17}cZ.setViewport(cR)}}}}}}}this._curIndex=cM},_clearOverlays:function(){var cM=this._opts.renderOptions.map;if(!cM){return}for(var cL=0,T=this._overlays.length;cL<T;cL++){cM.removeOverlay(this._overlays[cL]);this._overlays[cL]=null}this._overlays.length=0;cM.removeOverlay(this._hlRoute);this._hlRoute=null;if(this._d.sliderMkr){cM.removeOverlay(this._d.sliderMkr);this._d.sliderMkr=null}if(this._d.tipLbl){cM.removeOverlay(this._d.tipLbl);this._d.tipLbl=null}for(var cL=0,T=this._d.dragOverlays.length;cL<T;cL++){cM.removeOverlay(this._d.dragOverlays[cL]);this._d.dragOverlays[cL]=null}this._d.dragOverlays.length=0;if(this._d.cbkPly){cM.removeOverlay(this._d.cbkPly);this._d.cbkPly=null}for(var cL=0,T=this._d.cxtMenu.length;cL<T;cL++){cM.removeContextMenu(this._d.cxtMenu[cL]);this._d.cxtMenu[cL]=null}this._d.cxtMenu.length=0;this._d.mouseOnViaMkr=false},_delVia:function(cM){if(this._results){var cL=this._results.getStart();var T=this._results.getEnd();this._d.viaPts.splice(cM,1);this._stopDragging();this._dragSearch(cL,T)}},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var cN=this._results.getPlan(0);var cU=aa("div",{style:"font:12px "+cc.fontFamily+";background:#fff"});var cM=this._d.viaPtsInfo;var T=cM.length;var cQ=[];var cX=this.QUERY_TYPE===bM;var c1=b5._genResultTitle(this._results.getEnd().title,(cX?"\u9a7e\u8f66":"\u6b65\u884c"),T>0);if(T>0){cQ.push("<table style=\'margin-left:4px;font:12px "+cc.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>");for(var cY=0;cY<T;cY++){cQ.push("<tr>");if(cY==0){if(T==1){cQ.push(\'<td style="padding:2px 5px;line-height:18px">\u9014\u7ecf\u70b9</td>\')}else{cQ.push(\'<td valign="top" rowspan="\'+T+\'" style="padding:2px 5px;line-height:18px">\u9014\u7ecf\u70b9</td>\')}}cQ.push(\'<td style="padding:2px 5px;line-height:18px">\'+cM[cY].title+"</td>");cQ.push(\'<td style="padding:2px 10px;line-height:18px;cursor:pointer;color:#0000ff" onclick=\\\'Instance("\'+this.guid+\'")._delVia(\'+cM[cY].curNo+")\'>\u5220\u9664</td>");cQ.push("</tr>")}cQ.push("</table>")}var cZ=b5._genTitle(this._results.getStart().title,\'Instance("\'+this.guid+\'")._select(0)\',0);var cR=["<table style=\'font:12px "+cc.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>"];var cW=0;for(var cT=0,cP=cN.getNumRoutes();cT<cP;cT++){var c0=cN.getRoute(cT);for(var cY=0,cV=c0.getNumSteps();cY<cV;cY++){var cO="";if(this._curIndex==cW+1){cO=";background:#f0f0f0"}cR.push(\'<tr style="cursor:pointer\'+cO+\'" onclick=\\\'Instance("\'+this.guid+\'")._select(\'+(cW+1)+")\'>");cR.push("<td style=\'border-bottom:1px solid #ccc;width:20px;vertical-align:top;text-align:right;padding:4px 3px\' >"+(cW+1)+".</td>");cR.push("<td style=\'border-bottom:1px solid #ccc;padding:2px;line-height:18px\' >"+this._getCurStep(cW).getDescription()+"</td>");cR.push("</tr>");cW++}}cR.push("</table>");var cL=b5._genTitle(this._results.getEnd().title,\'Instance("\'+this.guid+\'")._select(\'+(cW+1)+")",1);var cS="<div style=\'border-bottom:1px solid #ccc;margin-bottom:10px;color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right\'><span style=\'float:left;padding-left:6px\'>\u5168\u7a0b\uff1a"+cN.getDistance().replace(/(\d+(?:.\d+)?)/,"$1 ")+" / "+cN.getDuration().replace(/(\d+)/,"$1 ")+"</span>";if(this._results.moreResultsUrl){cS+="<a style=\'color:#7777cc\' href=\'"+this._results.moreResultsUrl+"\' target=\'_blank\'>\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b&#187;</a>"}cS+="&nbsp;</div>";cU.innerHTML=c1+cQ.join("")+cZ+cR.join("")+cL+cS;this._opts.renderOptions.panel.appendChild(cU);this._triggerCbk(w.CBK_RESULTS_HTML_SET,cU)}},_getRoadName:function(cL,T){if(T==""||!T){if(cL==9||cL==12||cL==1||cL==16){T=bl.ROAD_TYPE[cL]}}return T},_getPoiInfo:function(cP){var T="";var cO=cP.poi;if(cO){var cN=this._getPsType(cO.ps)||"",cL=this._getPwType(cO.pw)||"";var cM=cO.pd<((cP.t==13||cP.t==4)?1000:50)?"":"\u7ea6"+aV(cO.pd)+"\u540e";T=cL+cN+"<b>"+cO.pn+"</b>"+cM+(cN==""?"":"\uff0c")}return T},_getTicInfo:function(cL){var T=cL.iw;return !cL.ic?"":((this._getIwGo(T)||"")+"<b>"+cL.ic+"</b>"+(this._getIwTo(T)||""))},_getRoadAct:function(cM,cL){var T="\u6cbf";if(cM==0||(!cL&&cM!=1&&cM!=16&&cM!=9&&cM!=12)){T=""}return T},_getRetAct:function(cM,cL){var T="\u8fdb\u5165";if(!cL&&(cM==9||cM==12)){T="\u4e0a"}else{if(cM==0||(!cL&&cM!=1&&cM!=16)){T=""}}return T},_getTaxiFare:function(){if(this._json&&this._json.content&&this._json.content.taxi){var cN=this._json.content.taxi;var T={distance:cN.dis,remark:cN.remark};if(cN.detail[0]){var cM=cN.detail[0];T.day={initialFare:parseFloat(cM.startPrice),unitFare:parseFloat(cM.kmPrice),totalFare:parseFloat(cM.totalPrice)}}if(cN.detail[1]){var cL=cN.detail[1];T.night={initialFare:parseFloat(cL.startPrice),unitFare:parseFloat(cL.kmPrice),totalFare:parseFloat(cL.totalPrice)}}return T}return null}});q.TURN_TYPE=["","\u76f4\u884c","\u53f3\u524d\u65b9\u8f6c\u5f2f","\u53f3\u8f6c","\u53f3\u540e\u65b9\u8f6c\u5f2f","\u8c03\u5934","\u5de6\u540e\u65b9\u8f6c\u5f2f","\u5de6\u8f6c","\u5de6\u524d\u65b9\u8f6c\u5f2f","\u7a0d\u5411\u5de6\u8f6c","\u76f4\u884c","\u7a0d\u5411\u53f3\u8f6c","\u6b63\u5317\u65b9\u5411","\u4e1c\u5317\u65b9\u5411","\u6b63\u4e1c\u65b9\u5411","\u4e1c\u5357\u65b9\u5411","\u6b63\u5357\u65b9\u5411","\u897f\u5357\u65b9\u5411","\u6b63\u897f\u65b9\u5411","\u897f\u5317\u65b9\u5411"];q.RET_TYPE=["","\u4ece\u8d77\u70b9\u51fa\u53d1","\u5230\u8fbe\u76ee\u7684\u5730","\u9014\u7ecf\u70b9","\u884c\u9a76"];q.IWGO=["\u5728","\u4ece","\u4ece"];q.IWTO=["","","\u79bb\u5f00"];q.PWTYPE=["\u8fc7","\u5728"];q.PSTYPE=["\u5de6\u4fa7\u7684","\u53f3\u4fa7\u7684",""];q.DWTYPE=["","\u671d"];a8.extend(q.prototype,{_createResults:function(T){return new a7(T)},_getTurnType:function(T){return q.TURN_TYPE[T]},_getRetType:function(T){return q.RET_TYPE[T]},_getIwGo:function(T){return q.IWGO[T]},_getIwTo:function(T){return q.IWTO[T]},_getPwType:function(T){return q.PWTYPE[T]},_getPsType:function(T){return q.PSTYPE[T]},_getDwType:function(T){return q.DWTYPE[T]}});cD.TURN_TYPE=["","\u76f4\u8d70","\u5411\u53f3\u524d\u65b9\u8f6c","\u53f3\u8f6c","\u5411\u53f3\u540e\u65b9\u8f6c","\u5411\u540e\u8f6c","\u5411\u5de6\u540e\u65b9\u8f6c","\u5de6\u8f6c","\u5411\u5de6\u524d\u65b9\u8f6c","\u5de6\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u7ee7\u7eed\u5411\u524d","\u53f3\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u7ee7\u7eed\u5411\u524d","\u5de6\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u5f80\u56de\u8d70","\u53f3\u8f6c\u7a7f\u8fc7\u9a6c\u8def\u5e76\u5f80\u56de\u8d70","\u6b63\u5317\u65b9\u5411","\u4e1c\u5317\u65b9\u5411","\u6b63\u4e1c\u65b9\u5411","\u4e1c\u5357\u65b9\u5411","\u6b63\u5357\u65b9\u5411","\u897f\u5357\u65b9\u5411","\u6b63\u897f\u65b9\u5411","\u897f\u5317\u65b9\u5411","","","",""];cD.RET_TYPE=["","\u4ece\u8d77\u70b9\u51fa\u53d1","\u5230\u8fbe\u76ee\u7684\u5730","\u9014\u7ecf\u70b9","\u8d70"];cD.IWGO=["\u5728","\u4ece","\u4ece"];cD.IWTO=["","","\u79bb\u5f00"];cD.PWTYPE=["\u8fc7","\u5728"];cD.PSTYPE=["\u5de6\u4fa7\u7684","\u53f3\u4fa7\u7684",""];cD.DWTYPE=["","\u671d"];a8.extend(cD.prototype,{_createResults:function(T){delete T.url;return new bW(T)},_getTurnType:function(T){return cD.TURN_TYPE[T]},_getRetType:function(T){return cD.RET_TYPE[T]},_getIwGo:function(T){return cD.IWGO[T]},_getIwTo:function(T){return cD.IWTO[T]},_getPwType:function(T){return cD.PWTYPE[T]},_getPsType:function(T){return cD.PSTYPE[T]},_getDwType:function(T){return cD.DWTYPE[T]}});');
﻿_jsload&&_jsload('othersearch', 'a8.extend(aX.prototype,{_asyncSearch:function(){for(var cL=0,T=this._queryList.length;cL<T;cL++){var cM=this._queryList[cL];this[cM.method].apply(this,cM.arguments)}delete this._queryList},getPoint:function(T,cO,cN){var cM=this;cN=cN||"\u5317\u4eac\u5e02";var cL=/^[ \s]*$/;if(cL.test(T)){return}bb.request(function(cT){if(cT&&cT.result&&cT.result.type==bq){var cR=cT.result,cU=cT.content,cQ=null,cS=null;if(cR){if(cR.error==0){var cP=cU.coord.x,cV=cU.coord.y;cQ=new BMap.Point(cP,cV);cQ=ba.convertMC2LL(cQ);cM.point=cQ;cM.city=cU.cn;cM.citycode=cU.sc;cM.address=cU.wd;cM.precise=cU.prc;cM.confidence=cU.fuzzy_score;cM.level=cU.catalog;cS={city:cU.cn,address:cU.wd,citycode:cU.sc,precise:cU.prc,confidence:cU.fuzzy_score,level:cU.catalog}}}cO&&cO(cQ,cS)}},{qt:bA,wd:T,cn:cN})},getLocation:function(cL,cR,cO){if(!(cL instanceof cd)&&cR){cR(null);return}var cN=this,cL=ba.convertLL2MC(cL),T=cL.lng,cQ=cL.lat,cO=cO||{},cM=cO.poiRadius||100,cP=cO.numPois||10;bb.request(function(c8){var cV=null;if(c8&&c8.result&&c8.result.type==bC){var cY=c8.result,c5=c8.content,cX,cZ={},c0=[],c2;if(cY.error==0){var c9=c5.address_detail,c6=c9.city;if(c9){cZ.streetNumber=c9.street_number;cZ.street=c9.street;cZ.district=c9.district;cZ.city=c6;cZ.province=c9.province}c2=c5.point;var c4=new BMap.Point(c2.x,c2.y);c4=ba.convertMC2LL(c4);var cU=c5.surround_poi;if(cU&&cU.length){for(var c7=0,c3=cU.length;c7<c3;c7++){var cT={},cW=cU[c7];cT.title=cW.name;cT.uid=cW.uid;var c1=new BMap.Point(cW.point.x,cW.point.y);c1=ba.convertMC2LL(c1);cT.point=c1;cT.city=c6;cT._poiType=cW.poiType;cT.type=BMAP_POI_TYPE_NORMAL;cT.address=cW.addr;cT.postcode=cW.zip||null;cT.phoneNumber=cW.tel||null;var cS=cT._poiType;if(cS.length!==0){cT.tags=cS.split(",")}c0.push(cT)}}cV={point:c4,address:c5.address,addressComponents:cZ,surroundingPois:c0,business:c5.business}}}cR&&cR(cV)},{qt:d,x:T,y:cQ,dis_poi:cM,poi_num:cP})}});a8.extend(ak.prototype,{_asyncSearch:function(){for(var cL=0,T=this._queryList.length;cL<T;cL++){var cM=this._queryList[cL];this[cM.method].apply(this,cM.arguments)}delete this._queryList},getCurrentPosition:function(cM,cL){this._callback=cM||function(){};if(!navigator.geolocation){this._onErrorCallback(BMAP_STATUS_SERVICE_UNAVAILABLE);return}var T=this;navigator.geolocation.getCurrentPosition(function(cN){T._onSuccessCallback(cN)},function(cN){T._onErrorCallback(cN.code+5)},cL)},_onSuccessCallback:function(T){var cN=T.coords,cM=this,cL={x:cN.longitude,y:cN.latitude,from:"0",to:"4"};bb.request(function(cQ){var cP=(cQ&&cQ.error==0)?new BMap.Point(cQ.x,cQ.y):new BMap.Point(cN.longitude,cN.latitude);cM._status=BMAP_STATUS_SUCCESS;var cO={point:cP,accuracy:cN.accuracy};cM._callback(cO)},cL,null,"ag/coord/convert")},_onErrorCallback:function(T){this._status=T;this._callback(null)}});a8.extend(b9.prototype,{_asyncSearch:function(){for(var cL=0,T=this._queryList.length;cL<T;cL++){var cM=this._queryList[cL];this[cM.method].apply(this,cM.arguments)}delete this._queryList},get:function(cL){var T=this;bb.request(function(cP){if(cP&&cP.result&&cP.result.type==s){var cN=cP.result,cR=cP.content;if(cN){if(cN.error==0){var cS=T._opts.renderOptions.map;var cT=cR.level;var cO=cR.cname;var cQ=cR.code;var cM=S.parseGeo(cR.geo,true).point;cT=S.getBestLevel(cT,cS);if(cS){cS.centerAndZoom(cM,cT)}}}cL&&cL({center:cM,level:cT,name:cO,code:cQ})}},{qt:U})}});a8.extend(V.prototype,{_asyncSearch:function(){for(var cL=0,T=this._queryList.length;cL<T;cL++){var cM=this._queryList[cL];this[cM.method].apply(this,cM.arguments)}delete this._queryList},get:function(cL,T){var cM={};cM.boundaries=[];var cN=this;bb.request(function(cO){if(cO&&cO.content&&cO.content.uid){var cP=cO.content.uid;bb.request(function(cY){if(cY&&cY.content&&cY.content.geo){if(cL.indexOf("\u798f\u5efa")>-1||cL.indexOf("\u6d59\u6c5f")>-1){var cZ=cN._parseGeoSpecial(cY.content.geo);cM.boundaries=cZ}else{var cS=S.parseGeo(cY.content.geo,false);if(cS.geo&&cS.geo.length&&cS.geo.length>0){var cQ=cS.geo.length;for(i=0;i<cQ;i++){var cR=cS.geo[i];if(cR&&cR.length&&cR.length>0){var cW=cR.length-1;var cU=[];for(var cT=0;cT<cW;cT+=2){var cX=cR[cT];var cV=cR[cT+1];var c0=new BMap.Point(cX,cV);c0=ba.convertMC2LL(c0);cU.push(c0.lng+", "+c0.lat)}cM.boundaries.push(cU.join(";"))}}}}}T&&T(cM)},{qt:b4,num:1000,l:10,uid:cP})}else{T&&T(cM)}},{qt:cj,wd:cL})},_parseGeoSpecial:function(cP){var cS=this;var cM=[];if(typeof(cP)!="string"){return cM}var cL=cP.split("|");var cW=cL[2];var cO=cW.split(";");for(var cQ=0;cQ<cO.length-1;cQ++){var cV=cO[cQ];var cR=[];var T=cV.split(",");for(var cN=0;cN<T.length;cN+=2){var cU=T[cN];var cT=T[cN+1];var cX=new BMap.Point(cU,cT);cX=ba.convertMC2LL(cX);cR.push(cX.lng+", "+cX.lat)}cM.push(cR.join(";"))}return cM}});');
﻿_jsload&&_jsload('autocomplete', 'a8.dom.getComputedStyle=function(cL,T){cL=a8.dom._g(cL);var cN=a8.dom.getDocument(cL),cM;if(cN.defaultView&&cN.defaultView.getComputedStyle){cM=cN.defaultView.getComputedStyle(cL,null);if(cM){return cM[T]||cM.getPropertyValue(T)}}return""};a8.dom.remove=function(T){T=a8.dom._g(T);var cL=T.parentNode;cL&&cL.removeChild(T)};a8.lang.isArray=function(T){return"[object Array]"==Object.prototype.toString.call(T)};a8.event=a8.event||{};a8.event.stopPropagation=function(T){if(T.stopPropagation){T.stopPropagation()}else{T.cancelBubble=true}};a8.event.preventDefault=function(T){if(T.preventDefault){T.preventDefault()}else{T.returnValue=false}};a8.event.stop=function(T){var cL=a8.event;cL.stopPropagation(T);cL.preventDefault(T)};a8.array.indexOf=function(cO,cL,cN){var T=cO.length,cM=cL;cN=cN|0;if(cN<0){cN=Math.max(0,T+cN)}for(;cN<T;cN++){if(cN in cO&&cO[cN]===cL){return cN}}return -1};a8.array.contains=function(T,cL){return(a8.array.indexOf(T,cL)>=0)};a8.ui=a8.ui||{version:"1.3.9"};a8.ui.getUI=function(cM){var cM=cM.split("-"),cL=a8.ui,T=cM.length,cN=0;for(;cN<T;cN++){cL=cL[cM[cN].charAt(0).toUpperCase()+cM[cN].slice(1)]}return cL};a8.ui.create=function(cL,T){if(a8.lang.isString(cL)){cL=a8.ui.getUI(cL)}return new cL(T)};a8.event._listeners=a8.event._listeners||[];a8.event.on=function(cL,cO,cQ){cO=cO.replace(/^on/i,"");cL=a8.dom._g(cL);var cP=function(cS){cQ.call(cL,cS)},T=a8.event._listeners,cN=a8.event._eventFilter,cR,cM=cO;cO=cO.toLowerCase();if(cN&&cN[cO]){cR=cN[cO](cL,cO,cP);cM=cR.type;cP=cR.listener}if(cL.addEventListener){cL.addEventListener(cM,cP,false)}else{if(cL.attachEvent){cL.attachEvent("on"+cM,cP)}}T[T.length]=[cL,cO,cQ,cP,cM];return cL};a8.on=a8.event.on;a8.event.un=function(cM,cP,cL){cM=a8.dom._g(cM);cP=cP.replace(/^on/i,"").toLowerCase();var cS=a8.event._listeners,cN=cS.length,cO=!cL,cR,cQ,T;while(cN--){cR=cS[cN];if(cR[1]===cP&&cR[0]===cM&&(cO||cR[2]===cL)){cQ=cR[4];T=cR[3];if(cM.removeEventListener){cM.removeEventListener(cQ,T,false)}else{if(cM.detachEvent){cM.detachEvent("on"+cQ,T)}}cS.splice(cN,1)}}return cM};a8.un=a8.event.un;a8.ui.Base={id:"",getId:function(T){var cM=this,cL;cL="tangram-"+cM.uiType+"--"+(cM.id?cM.id:cM.guid);return T?cL+"-"+T:cL},getClass:function(cL){var cN=this,cM=cN.classPrefix,T=cN.skin;if(cL){cM+="-"+cL;T+="-"+cL}if(cN.skin){cM+=" "+T}return cM},getMain:function(){return a8.g(this.mainId)},getBody:function(){return a8.g(this.getId())},uiType:"",getCallRef:function(){return"window[\'$BAIDU$\']._instances[\'"+this.guid+"\']"},getCallString:function(cN){var cM=0,cL=Array.prototype.slice.call(arguments,1),T=cL.length;for(;cM<T;cM++){if(typeof cL[cM]=="string"){cL[cM]="\'"+cL[cM]+"\'"}}return this.getCallRef()+"."+cN+"("+cL.join(",")+");"},on:function(T,cL,cM){a8.on(T,cL,cM);this.addEventListener("ondispose",function(){a8.un(T,cL,cM)})},renderMain:function(cL){var cN=this,cM=0,T;if(cN.getMain()){return}cL=a8.g(cL);if(!cL){cL=document.createElement("div");document.body.appendChild(cL);cL.style.position="absolute";cL.className=cN.getClass("main")}if(!cL.id){cL.id=cN.getId("main")}cN.mainId=cL.id;cL.setAttribute("data-guid",cN.guid);return cL},dispose:function(){this.dispatchEvent("dispose");a8.lang.Class.prototype.dispose.call(this)}};a8.ui.createUI=function(cM,cS){cS=cS||{};var cQ=cS.superClass||a8.lang.Class,cP=cQ==a8.lang.Class?1:0,cN,cL,cR=function(cU,cT){var cV=this;cU=cU||{};cQ.call(cV,!cP?cU:(cU.guid||""),true);a8.object.extend(cV,cR.options);a8.object.extend(cV,cU);cV.classPrefix=cV.classPrefix||"tangram-"+cV.uiType.toLowerCase();for(cN in a8.ui.behavior){if(typeof cV[cN]!="undefined"&&cV[cN]){a8.object.extend(cV,a8.ui.behavior[cN]);if(a8.lang.isFunction(cV[cN])){cV.addEventListener("onload",function(){a8.ui.behavior[cN].call(cV[cN].apply(cV))})}else{a8.ui.behavior[cN].call(cV)}}}cM.apply(cV,arguments);for(cN=0,cL=cR._addons.length;cN<cL;cN++){cR._addons[cN](cV)}if(cU.parent&&cV.setParent){cV.setParent(cU.parent)}if(!cT&&cU.autoRender){cV.render(cU.element)}},T=function(){};T.prototype=cQ.prototype;var cO=cR.prototype=new T();for(cN in a8.ui.Base){cO[cN]=a8.ui.Base[cN]}cR.extend=function(cT){for(cN in cT){cR.prototype[cN]=cT[cN]}return cR};cR._addons=[];cR.register=function(cT){if(typeof cT=="function"){cR._addons.push(cT)}};cR.options={};return cR};a8.dom.getAttr=function(cL,T){cL=a8.dom.g(cL);if("style"==T){return cL.style.cssText}T=a8.dom._NAME_ATTRS[T]||T;return cL.getAttribute(T)};a8.getAttr=a8.dom.getAttr;a8.ui.get=function(T){var cL;if(a8.lang.isString(T)){return a8.lang.instance(T)}else{do{if(!T||T.nodeType==9){return null}if(cL=a8.dom.getAttr(T,"data-guid")){return a8.lang.instance(cL)}}while((T=T.parentNode)!=document.body)}};a8.ui.Suggestion=a8.ui.createUI(function(T){var cL=this;cL.addEventListener("onload",function(){cL.on(document,"mousedown",cL.documentMousedownHandler);cL.on(window,"blur",cL.windowBlurHandler)});cL.documentMousedownHandler=cL._getDocumentMousedownHandler();cL.windowBlurHandler=cL._getWindowBlurHandler();cL.enableIndex=[];cL.currentIndex=-1}).extend({uiType:"suggestion",onbeforepick:new Function,onpick:new Function,onconfirm:new Function,onhighlight:new Function,onshow:new Function,onhide:new Function,getData:function(){return[]},prependHTML:"",appendHTML:"",currentData:{},tplDOM:"<div id=\'#{0}\' class=\'#{1}\' style=\'position:relative; top:0px; left:0px\'></div>",tplPrependAppend:"<div id=\'#{0}\' class=\'#{1}\'>#{2}</div>",tplBody:\'<table cellspacing="0" cellpadding="2"><tbody>#{0}</tbody></table>\',tplRow:\'<tr><td id="#{0}" onmouseover="#{2}" onmouseout="#{3}" onmousedown="#{4}" onclick="#{5}" class="#{6}">#{1}</td></tr>\',getString:function(){var T=this;return a8.format(T.tplDOM,T.getId(),T.getClass(),T.guid)},render:function(cM){var cL=this,T,cM=a8.g(cM);if(cL.getMain()||!cM){return}if(cM.id){cL.targetId=cM.id}else{cL.targetId=cM.id=cL.getId("input")}T=cL.renderMain();T.style.display="none";T.innerHTML=cL.getString();this.dispatchEvent("onload")},_isShowing:function(){var cL=this,T=cL.getMain();return T&&T.style.display!="none"},pick:function(T){var cN=this,cL=cN.currentData,cO=cL&&typeof T=="number"&&typeof cL[T]!="undefined"?cL[T].value:T,cM={data:{item:cO==T?{value:T,content:T}:cL[T],index:T}};if(cN.dispatchEvent("onbeforepick",cM)){cN.dispatchEvent("onpick",cM)}},show:function(cP,cO,cM){var cL=0,T=cO.length,cN=this;cN.enableIndex=[];cN.currentIndex=-1;if(T==0&&!cM){cN.hide()}else{cN.currentData=[];for(;cL<T;cL++){if(typeof cO[cL].value!="undefined"){cN.currentData.push(cO[cL])}else{cN.currentData.push({value:cO[cL],content:cO[cL]})}if(typeof cO[cL]["disable"]=="undefined"||cO[cL]["disable"]==false){cN.enableIndex.push(cL)}}cN.getBody().innerHTML=cN._getBodyString();cN.getMain().style.display="block";cN.dispatchEvent("onshow")}},hide:function(){var cO=this;if(!cO._isShowing()){return}if(cO.currentIndex>=0&&cO.holdHighLight){var cN=cO.currentData,cL=-1;for(var cM=0,T=cN.length;cM<T;cM++){if(typeof cN[cM].disable=="undefined"||cN[cM].disable==false){cL++;if(cL==cO.currentIndex){cO.pick(cM)}}}}cO.getMain().style.display="none";cO.dispatchEvent("onhide")},highLight:function(T){var cM=this,cN=cM.enableIndex,cL=null;if(!cM._isEnable(T)){return}cM.currentIndex>=0&&cM._clearHighLight();cL=cM._getItem(T);a8.addClass(cL,cM.getClass("current"));cM.currentIndex=a8.array.indexOf(cN,T);cM.dispatchEvent("onhighlight",{index:T,data:cM.getDataByIndex(T)})},clearHighLight:function(){var cM=this,T=cM.currentIndex,cL=cM.enableIndex[T];cM._clearHighLight()&&cM.dispatchEvent("onclearhighlight",{index:cL,data:cM.getDataByIndex(cL)})},_clearHighLight:function(){var cM=this,T=cM.currentIndex,cN=cM.enableIndex,cL=null;if(T>=0){cL=cM._getItem(cN[T]);a8.removeClass(cL,cM.getClass("current"));cM.currentIndex=-1;return true}return false},confirm:function(T,cM){var cL=this;if(cM!="keyboard"){if(!cL._isEnable(T)){return}}cL.pick(T);cL.dispatchEvent("onconfirm",{data:cL.getDataByIndex(T)||T,source:cM});cL.currentIndex=-1;cL.hide()},getDataByIndex:function(T){return{item:this.currentData[T],index:T}},getTargetValue:function(){return this.getTarget().value},getTarget:function(){return a8.g(this.targetId)},_getItem:function(T){return a8.g(this.getId("item"+T))},_getBodyString:function(){var cP=this,cO="",cN=[],cQ=cP.currentData,T=cQ.length,cM=0;function cL(cR){return a8.format(cP.tplPrependAppend,cP.getId(cR),cP.getClass(cR),cP[cR+"HTML"])}cO+=cL("prepend");for(;cM<T;cM++){cN.push(a8.format(cP.tplRow,cP.getId("item"+cM),cQ[cM].content,cP.getCallRef()+"._itemOver(event, "+cM+")",cP.getCallRef()+"._itemOut(event, "+cM+")",cP.getCallRef()+"._itemDown(event, "+cM+")",cP.getCallRef()+"._itemClick(event, "+cM+")",(typeof cQ[cM]["disable"]=="undefined"||cQ[cM]["disable"]==false)?"":cP.getClass("disable")))}cO+=a8.format(cP.tplBody,cN.join(""));cO+=cL("append");return cO},_itemOver:function(cM,T){var cL=this;a8.event.stop(cM||window.event);cL._isEnable(T)&&cL.highLight(T);cL.dispatchEvent("onmouseoveritem",{index:T,data:cL.getDataByIndex(T)})},_itemOut:function(cM,T){var cL=this;a8.event.stop(cM||window.event);if(!cL.holdHighLight){cL._isEnable(T)&&cL.clearHighLight()}cL.dispatchEvent("onmouseoutitem",{index:T,data:cL.getDataByIndex(T)})},_itemDown:function(cM,T){var cL=this;a8.event.stop(cM||window.event);cL.dispatchEvent("onmousedownitem",{index:T,data:cL.getDataByIndex(T)})},_itemClick:function(cM,T){var cL=this;a8.event.stop(cM||window.event);cL.dispatchEvent("onitemclick",{index:T,data:cL.getDataByIndex(T)});cL._isEnable(T)&&cL.confirm(T,"mouse")},_isEnable:function(T){var cL=this;return a8.array.contains(cL.enableIndex,T)},_getDocumentMousedownHandler:function(){var T=this;return function(cN){cN=cN||window.event;var cL=cN.target||cN.srcElement,cM=a8.ui.get(cL);if(cL==T.getTarget()||(cM&&cM.uiType==T.uiType)){return}T.hide()}},_getWindowBlurHandler:function(){var T=this;return function(){T.hide()}},dispose:function(){var T=this;T.dispatchEvent("dispose");a8.dom.remove(T.mainId);a8.lang.Class.prototype.dispose.call(this)}});a8.ui.behavior=a8.ui.behavior||{};a8.dom.children=function(cL){cL=a8.dom.g(cL);for(var T=[],cM=cL.firstChild;cM;cM=cM.nextSibling){if(cM.nodeType==1){T.push(cM)}}return T};a8.dom.insertBefore=function(cN,cM){var cL,T;cL=a8.dom._g;cN=cL(cN);cM=cL(cM);T=cM.parentNode;if(T){T.insertBefore(cN,cM)}return cN};a8.dom.setStyle=function(cM,cL,cN){var cO=a8.dom,T;cM=cO.g(cM);cL=a8.string.toCamelCase(cL);if(T=cO._styleFilter){cN=T.filter(cL,cN,"set")}T=cO._styleFixer[cL];(T&&T.set)?T.set(cM,cN):(cM.style[T||cL]=cN);return cM};a8.setStyle=a8.dom.setStyle;a8.dom.setStyles=function(cL,cM){cL=a8.dom.g(cL);for(var T in cM){a8.dom.setStyle(cL,T,cM[T])}return cL};a8.setStyles=a8.dom.setStyles;a8.dom._styleFilter[a8.dom._styleFilter.length]={set:function(T,cL){if(cL.constructor==Number&&!/zIndex|fontWeight|opacity|zoom|lineHeight/i.test(T)){cL=cL+"px"}return cL}};a8.dom.setBorderBoxSize=function(cM,cL){var T={};cL.width&&(T.width=parseFloat(cL.width));cL.height&&(T.height=parseFloat(cL.height));function cN(cP,cO){return parseFloat(a8.getStyle(cP,cO))||0}if(a8.browser.isStrict){if(cL.width){T.width=parseFloat(cL.width)-cN(cM,"paddingLeft")-cN(cM,"paddingRight")-cN(cM,"borderLeftWidth")-cN(cM,"borderRightWidth");T.width<0&&(T.width=0)}if(cL.height){T.height=parseFloat(cL.height)-cN(cM,"paddingTop")-cN(cM,"paddingBottom")-cN(cM,"borderTopWidth")-cN(cM,"borderBottomWidth");T.height<0&&(T.height=0)}}return a8.dom.setStyles(cM,T)};(function(){var T=a8.ui.behavior.coverable=function(){};T.Coverable_isShowing=false;T.Coverable_iframe;T.Coverable_container;T.Coverable_iframeContainer;T.Coverable_show=function(){var cR=this;if(cR.Coverable_iframe){cR.Coverable_update();a8.setStyle(cR.Coverable_iframe,"display","block");return}var cP=cR.coverableOptions||{},cM=cR.Coverable_container=cP.container||cR.getMain(),cO=cP.opacity||"0",cN=cP.color||"",cQ=cR.Coverable_iframe=document.createElement("iframe"),cL=cR.Coverable_iframeContainer=document.createElement("div");a8.dom.children(cM).length>0?a8.dom.insertBefore(cL,cM.firstChild):cM.appendChild(cL);a8.setStyles(cL,{position:"absolute",top:"0px",left:"0px"});a8.dom.setBorderBoxSize(cL,{width:cM.offsetWidth,height:cM.offsetHeight});a8.dom.setBorderBoxSize(cQ,{width:cL.offsetWidth});a8.dom.setStyles(cQ,{zIndex:-1,display:"block",border:0,backgroundColor:cN,filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity="+cO+")"});cL.appendChild(cQ);cQ.src="javascript:void(0)";cQ.frameBorder="0";cQ.scrolling="no";cQ.height="97%";cR.Coverable_isShowing=true};T.Coverable_hide=function(){var cM=this,cL=cM.Coverable_iframe;if(!cM.Coverable_isShowing){return}a8.setStyle(cL,"display","none");cM.Coverable_isShowing=false};T.Coverable_update=function(cN){var cP=this,cN=cN||{},cM=cP.Coverable_container,cL=cP.Coverable_iframeContainer,cO=cP.Coverable_iframe;a8.dom.setBorderBoxSize(cL,{width:cM.offsetWidth,height:cM.offsetHeight});a8.dom.setBorderBoxSize(cO,a8.extend({width:a8.getStyle(cL,"width")},cN))}})();a8.extend(a8.ui.Suggestion.prototype,{coverable:true,coverableOptions:{}});a8.ui.Suggestion.register(function(T){if(T.coverable){T.addEventListener("onshow",function(){T.Coverable_show()});T.addEventListener("onhide",function(){T.Coverable_hide()})}});a8.ui.Suggestion.extend({setData:function(cN,cM,cL){var T=this;T.dataCache[cN]=cM;if(!cL){T.show(cN,T.dataCache[cN])}}});a8.ui.Suggestion.register(function(T){T.dataCache={},T.addEventListener("onneeddata",function(cM,cN){var cL=T.dataCache;if(typeof cL[cN]=="undefined"){T.getData(cN)}else{T.show(cN,cL[cN])}})});a8.dom.setOuterWidth=a8.dom.setBorderBoxWidth=function(T,cL){return a8.dom.setBorderBoxSize(T,{width:cL})};a8.dom.getWindow=function(T){T=a8.dom.g(T);var cL=a8.dom.getDocument(T);return cL.parentWindow||cL.defaultView||null};a8.dom.setPosition=function(cL,T){return a8.dom.setStyles(cL,{left:T.left-(parseFloat(a8.dom.getStyle(cL,"margin-left"))||0),top:T.top-(parseFloat(a8.dom.getStyle(cL,"margin-top"))||0)})};a8.page=a8.page||{};a8.page.getViewWidth=function(){var cL=document,T=cL.compatMode=="BackCompat"?cL.body:cL.documentElement;return T.clientWidth};a8.page.getViewHeight=function(){var cL=document,T=cL.compatMode=="BackCompat"?cL.body:cL.documentElement;return T.clientHeight};a8.page.getScrollTop=function(){var T=document;return window.pageYOffset||T.documentElement.scrollTop||T.body.scrollTop};a8.page.getScrollLeft=function(){var T=document;return window.pageXOffset||T.documentElement.scrollLeft||T.body.scrollLeft};a8.fn=a8.fn||{};a8.fn.bind=function(cL,T){var cM=arguments.length>2?[].slice.call(arguments,2):null;return function(){var cO=a8.lang.isString(cL)?T[cL]:cL,cN=(cM)?cM.concat([].slice.call(arguments,0)):arguments;return cO.apply(T||cO,cN)}};(function(){var cL=a8.ui.behavior.posable=function(){};cL.setPosition=function(cQ,cO,cN){cO=a8.g(cO)||this.getMain();cN=cN||{};var cP=this,cM=[cO,cQ,cN];cP.__execPosFn(cO,"_positionByCoordinate",cN.once,cM)};cL._positionByCoordinate=function(cM,c1,c2,cO){c1=c1||[0,0];c2=c2||{};var cY=this,cZ={},cV=a8.page.getViewHeight(),c0=a8.page.getViewWidth(),cS=a8.page.getScrollLeft(),cQ=a8.page.getScrollTop(),cP=cM.offsetWidth,cR=cM.offsetHeight,cN=cM.offsetParent,cX=(!cN||cN==document.body)?{left:0,top:0}:a8.dom.getPosition(cN);c2.position=(typeof c2.position!=="undefined")?c2.position.toLowerCase():"bottomright";c1=T(c1||[0,0]);c2.offset=T(c2.offset||[0,0]);c1.x+=(c2.position.indexOf("right")>=0?(c1.width||0):0);c1.y+=(c2.position.indexOf("bottom")>=0?(c1.height||0):0);cZ.left=c1.x+c2.offset.x-cX.left;cZ.top=c1.y+c2.offset.y-cX.top;switch(c2.insideScreen){case"surround":cZ.left+=cZ.left<cS?cP+(c1.width||0):((cZ.left+cP)>(cS+c0)?-cP-(c1.width||0):0);cZ.top+=cZ.top<cQ?cR+(c1.height||0):((cZ.top+cR)>(cQ+cV)?-cR-(c1.height||0):0);break;case"fix":cZ.left=Math.max(0-parseFloat(a8.dom.getStyle(cM,"marginLeft"))||0,Math.min(cZ.left,a8.page.getViewWidth()-cP-cX.left));cZ.top=Math.max(0-parseFloat(a8.dom.getStyle(cM,"marginTop"))||0,Math.min(cZ.top,a8.page.getViewHeight()-cR-cX.top));break;case"verge":var cU={width:(c2.position.indexOf("right")>-1?c1.width:0),height:(c2.position.indexOf("bottom")>-1?c1.height:0)},cT={width:(c2.position.indexOf("bottom")>-1?c1.width:0),height:(c2.position.indexOf("right")>-1?c1.height:0)};cZ.left-=(c2.position.indexOf("right")>=0?(c1.width||0):0);cZ.top-=(c2.position.indexOf("bottom")>=0?(c1.height||0):0);cZ.left+=cZ.left+cU.width+cP-cS>c0-cX.left?cT.width-cP:cU.width;cZ.top+=cZ.top+cU.height+cR-cQ>cV-cX.top?cT.height-cR:cU.height;break}a8.dom.setPosition(cM,cZ);if(!cO&&(cV!=a8.page.getViewHeight()||c0!=a8.page.getViewWidth())){cY._positionByCoordinate(cM,c1,{},true)}cO||cY.dispatchEvent("onpositionupdate")};cL.__execPosFn=function(cN,cQ,cO,cM){var cP=this;if(typeof cO=="undefined"||!cO){a8.event.on(a8.dom.getWindow(cN),"resize",a8.fn.bind.apply(cP,[cQ,cP].concat([].slice.call(cM))))}cP[cQ].apply(cP,cM)};function T(cM){cM.x=cM[0]||cM.x||cM.left||0;cM.y=cM[1]||cM.y||cM.top||0;return cM}})();a8.ui.Suggestion.extend({posable:true,fixWidth:true,getWindowResizeHandler:function(){var T=this;return function(){T.adjustPosition(true)}},adjustPosition:function(cL){var cN=this,cO=cN.getTarget(),cM,T=cN.getMain(),cP;if(!cN._isShowing()&&cL){return}cM=a8.dom.getPosition(cO),cP={top:(cM.top+cO.offsetHeight-1),left:cM.left,width:cO.offsetWidth};cP=typeof cN.view=="function"?cN.view(cP):cP;cN.setPosition([cP.left,cP.top],null,{once:true});a8.dom.setOuterWidth(T,cP.width)}});a8.ui.Suggestion.register(function(T){T.windowResizeHandler=T.getWindowResizeHandler();T.addEventListener("onload",function(){T.adjustPosition();if(T.fixWidth){T.fixWidthTimer=setInterval(function(){var cL=T.getMain(),cM=T.getTarget();if(cL.offsetWidth!=0&&cM&&cM.offsetWidth!=cL.offsetWidth){T.adjustPosition();cL.style.display="block"}},100)}T.on(window,"resize",T.windowResizeHandler)});T.addEventListener("onshow",function(){T.adjustPosition()});T.addEventListener("ondispose",function(){clearInterval(T.fixWidthTimer)})});a8.ui.Suggestion.register(function(cO){var cR,cM="",cQ,cN,cL=false,cP=false;function T(){setTimeout(function(){cQ=cO.getTarget().value},20)}cO.addEventListener("onload",function(){cR=this.getTarget();T();cO.on(window,"onload",T);cO.targetKeydownHandler=cO.getTargetKeydownHandler();cO.on(cR,"keydown",cO.targetKeydownHandler);cR.setAttribute("autocomplete","off");cO.circleTimer=setInterval(function(){if(cP){return}if(a8.g(cR)==null){cO.dispose()}var cS=cR.value;if(cS==cM&&cS!=""&&cS!=cQ&&cS!=cN){if(cO.requestTimer==0){cO.requestTimer=setTimeout(function(){cO.dispatchEvent("onneeddata",cS)},100)}}else{clearTimeout(cO.requestTimer);cO.requestTimer=0;if(cS==""&&cM!=""){cN="";cO.hide()}cM=cS;if(cS!=cN){cO.defaultIptValue=cS}if(cQ!=cR.value){cQ=""}}},10);cO.on(cR,"beforedeactivate",cO.beforedeactivateHandler)});cO.addEventListener("onitemclick",function(){cP=false;cO.defaultIptValue=cM=cO.getTargetValue()});cO.addEventListener("onpick",function(cS){if(cL){cR.blur()}cR.value=cN=cS.data.item.value;if(cL){cR.focus()}});cO.addEventListener("onmousedownitem",function(cS){cL=true;cP=true;setTimeout(function(){cP=false;cL=false},500)});cO.addEventListener("ondispose",function(){clearInterval(cO.circleTimer)})});a8.ui.Suggestion.extend({beforedeactivateHandler:function(){return function(){if(mousedownView){window.event.cancelBubble=true;window.event.returnValue=false}}},getTargetKeydownHandler:function(){var cL=this;function T(cM){if(!cL._isShowing()){cL.dispatchEvent("onneeddata",cL.getTargetValue());return}var cO=cL.enableIndex,cN=cL.currentIndex;if(cO.length==0){return}if(cM){switch(cN){case -1:cN=cO.length-1;cL.pick(cO[cN]);cL.highLight(cO[cN]);break;case 0:cN=-1;cL.pick(cL.defaultIptValue);cL.clearHighLight();break;default:cN--;cL.pick(cO[cN]);cL.highLight(cO[cN]);break}}else{switch(cN){case -1:cN=0;cL.pick(cO[cN]);cL.highLight(cO[cN]);break;case cO.length-1:cN=-1;cL.pick(cL.defaultIptValue);cL.clearHighLight();break;default:cN++;cL.pick(cO[cN]);cL.highLight(cO[cN]);break}}cL.currentIndex=cN}return function(cO){var cM=false,cN;cO=cO||window.event;switch(cO.keyCode){case 9:case 27:cL.hide();break;case 13:a8.event.stop(cO);cL.confirm(cL.currentIndex==-1?cL.getTarget().value:cL.enableIndex[cL.currentIndex],"keyboard");break;case 38:cM=true;case 40:a8.event.stop(cO);T(cM);break;default:cL.currentIndex=-1}}},defaultIptValue:""});b2.undope=true;by.IS_INCLUDE_STYLE=false;by.STYLE_FILE_PATH=x+"res/12/bmap_autocomplete.css";by.TYPES_COLLECTION={ALL:"0",CITY:"1"};a8.extend(by.prototype,{_asyncSearch:function(){this._initialize()},_initialize:function(){this._exIndex=-1;this._json=null;this._typeIds=[];this._cityId=0;this._results=this._getAutocompleteResult();if(!!this._options.input){this._getStyles();this._renderSuggestion();this.setInputValue(this._inputValue)}var T=null;if(!!this._word){T={};T.method="search";T.arguments=[this._word]}this._getTypesId();this._getCityId(T)},_renderSuggestion:function(){var cL=this;var T=new a8.ui.Suggestion({getData:function(cM){cL._sendAutocompleteRequest(cM)},onhide:function(){cL._exIndex=-1;if(cL._suggestion.getTargetValue()===""){cL._word="";cL._results=cL._getAutocompleteResult()}},onhighlight:function(cM){if(!cL._json){return}var cO={},cN={};cN={index:cM.data.index,value:cL._json.items[cM.data.index].value};cO={index:cL._exIndex,value:cL._exIndex>=0?cL._json.items[cL._exIndex].value:{}};var cP=new bg("onhighlight");cP.fromitem=cO;cP.toitem=cN;cL.dispatchEvent(cP);cL._exIndex=cM.data.index},onbeforepick:function(cM){if(!cL._json){return}if(typeof(cM.data.index)==="number"){var cN=cL._json.items[cM.data.index].value;cM.data.item.content=cM.data.item.value=cN.province+cN.city+cN.district+cN.street+cN.business}},onconfirm:function(cM){if(!cL._json){return}_addStat(5012);var cN={};if(typeof(cM.data.index)==="number"){cN={index:cM.data.index,value:cL._json.items[cM.data.index].value};var cO=new bg("onconfirm");cO.item=cN;cL.dispatchEvent(cO)}}});T.render(a8.g(this._options.input));this._suggestion=T},show:function(){if(this._suggestion){this._suggestion.getMain().style.display="block"}},hide:function(){this._suggestion&&this._suggestion.hide();this._exIndex=-1},dispose:function(){this._suggestion&&this._suggestion.dispose();a8.lang.Class.prototype.dispose.call(this)},setTypes:function(T){this._options.types=T||[];this._getTypesId()},setLocation:function(T){this._loc.src=T;this._getCityId()},search:function(T){this._sendAutocompleteRequest(T)},setInputValue:function(T){if(this._suggestion){this._suggestion.pick(T)}},_sendAutocompleteRequest:function(cN){var cM=this,T=(Math.random()*100000).toFixed(0);BMap._rd["_cbk"+T]=function(cO){cM._getAutocompleteBack(cO);delete BMap._rd["_cbk"+T]};var cL="http://map.baidu.com/su?wd="+encodeURIComponent(cN)+"&callback=BMap._rd._cbk"+T+"&cid="+cM._cityId+"&type="+cM._typeIds+"&t="+new Date().getTime();cM._word=cN;cM._exIndex=-1;cM._results=this._getAutocompleteResult();_addStat(5010,{tp:cM._typeIds,wd:encodeURIComponent(cN)});cx.request(cL)},_getAutocompleteBack:function(T){if(T&&T.q){this._word=T.q}var cL=this._formatDataForTangram(T);this._showResultList(cL);this._results=this._getAutocompleteResult(this._json);this._options.onSearchComplete(this._results)},_formatDataForTangram:function(cO){var cP=[],cL=cO.s,T={};T.keyword=cO.q||"";T.count=cO.s.length||0;T.status=cO.e<0?BMAP_STATUS_SERVICE_UNAVAILABLE:BMAP_STATUS_SUCCESS;T.items=[];for(var cN=0,cQ=cL.length;cN<cQ;cN++){var cM=this._getItemValue(cL[cN],this._typeIds);T.items.push(cM.value);cP.push(cM.html)}this._json=T;return{data:cP,word:cO.q}},_showResultList:function(T){if(!this._suggestion){return}var cL=this._suggestion;cL.show(T.word,T.data);if(T.data.length<1){cL.hide()}},_getItemValue:function(cL,T){switch(T.toString()){case"1":return this._getItemValueForCity(cL);default:return this._getItemValueForPoi(cL)}},_getItemValueForPoi:function(cU){var cT=cU.split("$"),cN=this._word,T=new RegExp(cN,"g"),cM="<b>"+cN+"</b>",cS={province:"",city:cT[0],district:cT[1],street:cT[2],streetNumber:"",business:cT[3]},cP="",cL=3;for(var cR=cL;cR>=0;cR--){cP=cT[cR]+cP;if(cP.indexOf(cN)>-1){var cQ=cR-1,cO="";while(cQ>-1){cO=cT[cQ]+cO;cQ--}cP=cP.replace(T,cM);if(!!cO){cP+=\'&nbsp;<span class="tangram-suggestion-grey">\'+cO+"</span>"}break}else{continue}}if(!cO){for(var cR=cL;cR>=0;cR--){cO+=cT[cR]}}return{value:{value:cS},html:cP}},_getItemValueForCity:function(cQ){var cL=cQ.split("$"),cO=this._word,T=new RegExp(cO,"g"),cM="<b>"+cO+"</b>",cN={province:cL[0],city:cL[1],district:"",street:"",streetNumber:"",business:""},cP=(cL[0]+cL[1]).replace(T,cM);return{value:{value:cN},html:cP}},_getTypesId:function(){var cL=this._options.types,cM=[];if(a8.isString(cL)){cM.push(by.TYPES_COLLECTION[cL.toUpperCase()])}else{if(a8.lang.isArray(cL)){for(var T=0,cN=cL.length;T<cN;T++){cM.push(by.TYPES_COLLECTION[cL[T].toUpperCase()])}}}this._typeIds=cM.length>0?cM.join(","):"0"},_getCityId:function(cL){var T=this;T._getIdByLoc(T._loc,function(cM){T._cityId=cM;if(!!cL){T[cL.method].apply(T,cL.arguments)}})},_getStyles:function(){if(!by.IS_INCLUDE_STYLE){var cM=document,cL=cM.createElement("link");cL.setAttribute("rel","stylesheet");cL.setAttribute("type","text/css");cL.setAttribute("href",by.STYLE_FILE_PATH);var T=cM.getElementsByTagName("head");if(T.length){T[0].appendChild(cL)}else{cM.documentElement.appendChild(cL)}by.IS_INCLUDE_STYLE=true}},_getAutocompleteResult:function(T){if(!T){return new af({keyword:this._word,total:0,pois:[]})}var cM=[];for(var cL=0,cN=T.items.length;cL<cN;cL++){cM.push(T.items[cL].value)}return new af({keyword:T.keyword,total:T.count,pois:cM})}});function af(T){this.keyword=T.keyword||"";this._numPois=T.total||0;this._pois=T.pois&&T.pois.slice(0)||[]}a8.extend(af.prototype,{getPoi:function(T){if(this._pois[T]){return this._pois[T]}},getNumPois:function(){return this._numPois},toString:function(){return"AutocompleteResult"}});');
﻿_jsload&&_jsload('buslinesearch', 'a8.extend(bm.prototype,{_asyncSearch:function(){for(var cL=0,T=this._queryList.length;cL<T;cL++){var cM=this._queryList[cL];this[cM.method].apply(this,cM.arguments)}delete this._queryList},_getMoreUrl:function(cN,cM,T){cN=ba.convertLL2MC(cN);var cL=cI+"?c="+cN.lng+","+cN.lat+"&i="+cM+","+encodeURIComponent(T)+"&s="+encodeURIComponent("tpl:LinesQuery");return cL},getBusList:function(T){var cL=this;this._getIdByLoc(this._loc,function(cN){if(!cN){this._busListResult=new K({keyword:T,city:"",moreUrl:"",_cityCode:""});cL._setStatus(BMAP_STATUS_INVALID_REQUEST);cL._triggerCbk(w.CBK_BUSLIST_COMPLETE,this._busListResult);return}var cM={qt:cL.QUERY_TYPE_BUSLIST,c:cN,wd:T};bb.request(function(cP,cO){cL._busListDataCbk(cP,cO)},cM,{keyword:T})})},_busListDataCbk:function(cN,T){this.clearResults();var cP=cN.result;if(!cN.content||cP.error!=0||cP.type!=this.RETURN_TYPE_BUSLIST){this._busListResult=new K({keyword:T.keyword,city:cN.current_city.name,moreUrl:"",_cityCode:cN.current_city.code});this._setStatus(BMAP_STATUS_SERVICE_UNAVAILABLE);this._triggerCbk(w.CBK_BUSLIST_COMPLETE,this._busListResult);return}var cR=cN.content,cL=[];for(var cM=0,cO=cR.length;cM<cO;cM++){var cQ={name:cR[cM].name,_uid:cR[cM].uid,_cityCode:cN.current_city.code,_index:cM,_keyword:T.keyword,_poiType:cR[cM].poiType||2};cL.push(cQ)}this._busListResult=new K({keyword:T.keyword,city:cN.current_city.name,moreUrl:this._getMoreUrl(S.parseGeo(cN.current_city.geo,true).point,cN.current_city.code,T.keyword),listItems:cL,_cityCode:cN.current_city.code});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(w.CBK_BUSLIST_COMPLETE,this._busListResult);this._renderBusListPanel();this._jumpCity(cN.current_city.geo,cN.current_city.level,cN.current_city.code)},_renderBusListPanel:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._busListResult&&this._busListResult.getNumBusList()>0){var T=aa("div",{style:"font:12px "+cc.fontFamily+";background:#fff"});T.id="divResult"+this.guid;var cN=this._busListResult.getNumBusList(),cO=[];for(var cM=0;cM<cN;cM++){var cP=this._busListResult.getBusListItem(cM).name;cO.push(\'<dl style="margin:3px 3px"><dt><span style="cursor:pointer" onclick=Instance(\\\'\'+this.guid+"\')._selectBusListItem("+cM+")><img id=imgBLIcon"+cM+" src="+bm._iconOpen+\' style="border:none" /></span>&nbsp;&nbsp;<a style="color:blue" href="javascript:void(0)" onclick=Instance(\\\'\'+this.guid+"\')._selectBusListItem("+cM+")>"+cP+"</a></dt><dd id=ddBLInfo"+cM+\' style="display:none;margin:2px 0px"></dd></dl>\')}var cL="";if(this._busListResult.moreResultsUrl){cL+="<div style=\'color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right\'>";cL+="<a style=\'color:#7777cc\' href=\'"+this._busListResult.moreResultsUrl+"\' target=\'_blank\'>\u5230\u767e\u5ea6\u5730\u56fe\u67e5\u770b&#187;</a>";cL+="&nbsp;</div>"}T.innerHTML=cO.join("")+cL;this._opts.renderOptions.panel.appendChild(T);this._triggerCbk(w.CBK_BUSLISTHTML_SET,T)}},_jumpCity:function(cN,cO,cL){var cM=this._opts.renderOptions.map;if(cM){var T=S.parseGeo(cN,true).point;if(this._preCityCode){if(this._preCityCode!=cL){cM.centerAndZoom(T,cO);this._preCityCode=cL}}else{cM.centerAndZoom(T,cO);this._preCityCode=cL}}},_switchDDContainer:function(cM){var cP=this;if(this._busListResult){for(var cN=0,cL=this._busListResult.getNumBusList();cN<cL;cN++){var T=a8.G("ddBLInfo"+cN);var cO=a8.G("imgBLIcon"+cN);if(cN==cM){if(T.style.display=="none"){T.style.display="block";cO.src=bm._iconClose}else{T.style.display="none";cO.src=bm._iconOpen}}else{T.style.display="none";cO.src=bm._iconOpen}}}},_selectBusListItem:function(cN,cM){if(!cM){var T=a8.G("ddBLInfo"+cN);var cL=a8.G("imgBLIcon"+cN);if(T.style.display=="block"){T.style.display="none";cL.src=bm._iconOpen;return}}if(this._busListResult&&this._busListResult[cN]&&this._busListResult[cN].getNumBusStations()>0){this._busLine=this._busListResult[cN];this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(w.CBK_BUSLINE_COMPLETE,this._busLine);this._renderBusLinePanel(cN);this._renderBusLineMap(cN);return}var cO=this;var cQ=this._busListResult.getBusListItem(cN);var cP={qt:cO.QUERY_TYPE_BUSLINE,c:cQ._cityCode,uid:cQ._uid};bb.request(function(cS,cR){cO._busLineDataCbk(cS,cR,cN)},cP,{name:cQ.name,_poiType:cQ._poiType})},clearResults:function(){delete this._busListResult;delete this._busLine;delete this._stops;delete this._preA;this._clearOverlays();if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.innerHTML=""}},getBusLine:function(T){if(T&&typeof T=="object"&&T._uid&&T._uid!=""&&(typeof T._cityCode!="undefined")&&T._cityCode.toString()!=""&&(typeof T._index!="undefined")&&T._index.toString()!=""&&(typeof T._keyword!="undefined")&&T._keyword.toString()!=""){if(this._busListResult&&this._busListResult.getNumBusList()>0&&T._cityCode==this._busListResult._cityCode&&T._keyword==this._busListResult.keyword){this._selectBusListItem(T._index,true)}}},_busLineDataCbk:function(cY,cM,cT){var cL=cY.result;if(!cY.content||!cY.content[0]||cL.error!=0||cL.type!=this.RETURN_TYPE_BUSLINE){this._busLine=new A({name:cM.name});this._setStatus(BMAP_STATUS_SERVICE_UNAVAILABLE);this._triggerCbk(w.CBK_BUSLINE_COMPLETE,this._busLine);return}var cV=cY.content[0];var cW="",cX="",cR="",cQ={},cU=[];cW=cV.startTime;cX=cV.endTime;cR=cV.company;if(cV.geo){var cN=S.parseGeo(cV.geo,true);cQ=new f(cN.points)}if(cV.stations){for(var cO=0,cS=cV.stations.length;cO<cS;cO++){if(cV.stations[cO].geo){var T=S.parseGeo(cV.stations[cO].geo,true);var cP={name:cV.stations[cO].name,position:T.point,_uid:cV.stations[cO].uid};cU.push(cP)}}}this._busLine=new A({name:cM.name,startTime:cW,endTime:cX,company:cR,polyline:cQ,stations:cU,_poiType:cM._poiType});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(w.CBK_BUSLINE_COMPLETE,this._busLine);this._busListResult[cT]=this._busLine;this._renderBusLinePanel(cT);this._renderBusLineMap(cT)},_renderBusLinePanel:function(cO){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._busLine&&this._busLine.getNumBusStations()>0){this._switchDDContainer(cO);var cM=a8.G("ddBLInfo"+cO);if(cM){var cQ=[];cQ.push(\'<table style="width:100%;background:#CDCDCD;font:12px \'+cc.fontFamily+\'" cellspacing="1" cellpadding="1" ><tbody>\');cQ.push(\'<tr><td style="width:95px;line-height:22px;padding:0px 8px;text-align:left;vertical-align:top;background:#F4F4F4" >\u9996\u672b\u8f66\u65f6\u95f4</th><td  style="background:#FFFFFF;line-height:22px;padding:0px 8px" >\'+this._busLine.startTime+"-"+this._busLine.endTime+"</td></tr>");cQ.push(\'<tr><td style="width:95px;line-height:22px;padding:0px 8px;text-align:left;vertical-align:top;background:#F4F4F4" >\u6240\u5c5e\u516c\u53f8</th><td  style="background:#FFFFFF;line-height:22px;padding:0px 8px" >\'+this._busLine.company+"</td></tr>");cQ.push("</tbody></table>");if(this._busLine._poiType==4){cQ.push(\'<p style="margin:2px 0px;font:12px \'+cc.fontFamily+\';">\u6cbf\u7ebf\u5730\u94c1\u7ad9:</p>\')}else{cQ.push(\'<p style="margin:2px 0px;font:12px \'+cc.fontFamily+\';">\u6cbf\u7ebf\u516c\u4ea4\u7ad9\u70b9:</p>\')}cQ.push(\'<table style="width:100%;font:12px \'+cc.fontFamily+\';" ><tbody>\');for(var cP=0,T=this._busLine.getNumBusStations();cP<T;cP++){var cN=cP+1;cQ.push(\'<tr><td style="width:20px">\'+cN+"</th><td><a id=aStop_"+cO+"_"+cP+\' style="color:blue" href="javascript:void(0)" onclick=Instance(\\\'\'+this.guid+"\')._selectBusStop("+cO+","+cP+")>"+this._busLine.getBusStation(cP).name+"</a></td></tr>")}cQ.push("</tbody></table>");cM.innerHTML=cQ.join("")}var cL=a8.G("divResult"+this.guid);this._triggerCbk(w.CBK_BUSLINEHTML_SET,cL)}},_renderBusLineMap:function(cM){if(this._opts.renderOptions.map&&this._busLine&&this._busLine.getNumBusStations()>0){this._clearOverlays();an.addRoute(this._opts.renderOptions.map,this._busLine.getPath());var cQ=this._busLine.getPolyline();this._triggerCbk(w.CBK_POLYLINES_SET,cQ);this._stops=[];for(var cO=0,T=this._busLine.getNumBusStations();cO<T;cO++){var cP=this._busLine.getBusStation(cO).position;var cL=this._busLine.getBusStation(cO).name;var cN=an.addStationPoi(this._opts.renderOptions.map,cP,cL);(function(cT,cR,cS){cT.addEventListener("click",function(){var cU=new bP(cR);cU.addEventListener("open",function(){var cV=a8.G("aStop_"+cM+"_"+cS);if(cV){cV.style.backgroundColor="#cccccc"}});cU.addEventListener("close",function(){var cV=a8.G("aStop_"+cM+"_"+cS);if(cV){cV.style.backgroundColor="#ffffff"}});cT.openInfoWindow(cU)})})(cN,cL,cO);cN._stName=cL;this._stops.push(cN)}this._triggerCbk(w.CBK_MARKERS_SET,this._stops);if(this._opts.renderOptions.autoViewport){this._opts.renderOptions.map.setViewport(cQ.getPath(),{margins:[5,5,5,5]})}}},_selectBusStop:function(cM,cL){if(this._opts.renderOptions.map&&this._stops&&this._stops.length>0){var cN=this._stops[cL];if(cN._stName){var cO=new bP(cN._stName);cO.addEventListener("open",function(){var cP=a8.G("aStop_"+cM+"_"+cL);if(cP){cP.style.backgroundColor="#cccccc"}});cO.addEventListener("close",function(){var cP=a8.G("aStop_"+cM+"_"+cL);if(cP){cP.style.backgroundColor="#ffffff"}});cN.openInfoWindow(cO)}}else{if(this.preA){this.preA.style.backgroundColor="#ffffff"}var T=a8.G("aStop_"+cM+"_"+cL);if(T){T.style.backgroundColor="#cccccc"}this.preA=T}},_clearOverlays:function(){if(this._opts.renderOptions.map){this._opts.renderOptions.map.clearOverlays()}},_setStatus:function(T){if(typeof T=="number"){this._status=T}else{delete this._status}}});function K(T){this.keyword=T.keyword||"";this.city=T.city;this.moreResultsUrl=T.moreUrl;this._listItems=T.listItems&&T.listItems.slice(0)||[];this._cityCode=T._cityCode}a8.extend(K.prototype,{getBusListItem:function(T){if(this._listItems[T]){return this._listItems[T]}},getNumBusList:function(){return this._listItems.length}});function A(T){this.name=T.name||"";this.startTime=T.startTime||"";this.endTime=T.endTime||"";this.company=T.company||"";this._polyline=T.polyline||{};this._stations=T.stations&&T.stations.slice(0)||[];this._poiType=T._poiType||2}a8.extend(A.prototype,{getBusStation:function(T){if(this._stations[T]){return this._stations[T]}},getNumBusStations:function(){return this._stations.length},getPolyline:function(){return this._polyline},getPath:function(){if(this._polyline.getPath()){return this._polyline.getPath()}}});');
