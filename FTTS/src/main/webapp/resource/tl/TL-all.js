var MOUSE_STATE={NONE:0,MOUSEDOWN:1,DRAG:2};var POS={TOP:0,RIGHT:1,BOTTOM:2,LEFT:3};var lastTime=0;var prefixes="webkit moz ms o".split(" ");var requestAnimationFrame=window.requestAnimationFrame;var cancelAnimationFrame=window.cancelAnimationFrame;var prefix;for(var i=0;i<prefixes.length;i++){if(requestAnimationFrame&&cancelAnimationFrame){break;}prefix=prefixes[i];requestAnimationFrame=requestAnimationFrame||window[prefix+"RequestAnimationFrame"];cancelAnimationFrame=cancelAnimationFrame||window[prefix+"CancelAnimationFrame"]||window[prefix+"CancelRequestAnimationFrame"];}if(!requestAnimationFrame||!cancelAnimationFrame){requestAnimationFrame=function(callback,element){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};cancelAnimationFrame=function(id){window.clearTimeout(id);};}window.requestAnimationFrame=requestAnimationFrame;window.cancelAnimationFrame=cancelAnimationFrame;(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;this.Class=function(){this.name="Class";};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}function Class(){if(!initializing&&this.init){this.init.apply(this,arguments);}else{}}Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class;};})();var LinkManager=LinkManager||{};var LM=LinkManager;(function(){LinkManager.data=[];LinkManager.rawLinks=[];LinkManager.ports={f:[],u:[],U:[],p:[],F:[]};LinkManager.state={};LinkManager.init=function(stationId){LinkManager.data=[];Ext.Ajax.request({url:"external-connect!getConnectInfoByStationId.action",type:"post",params:{stationId:stationId},success:function(response,options){var obj=Ext.decode(response.responseText);LinkManager.data=obj.rows;TL.setStationName(obj.STATION_NAME);},failure:function(){Ext.Msg.alert("提示：","后台运行出错！");},error:function(){Ext.Msg.alert("提示：","后台运行出错！");}});};LinkManager.regPort=function(portType,port){if(portType=="f"||portType=="F"||portType=="u"||portType=="U"||portType=="p"){LinkManager.ports[portType].push(port);}else{}};LinkManager.getPort=function(portType,portId){var ports=LM.ports[portType];var rv=null;for(var i=0;i<ports.length;i++){var port=ports[i];if(port.id==portId){rv=port;port.occupied=true;break;}}return rv;};LinkManager.generateLinks=function(){TL.links=[];var links=LM.data;var aPortTypes=["-","u","p","f","p","f","p"];var zPortTypes=["-","U","F","U","F","F","U"];for(var i=0;i<links.length;i++){var linkData=links[i];var linkType=linkData.CONN_TYPE;var aId=linkData.A_END_ID;var zId=linkData.Z_END_ID;var aPort=LM.getPort(aPortTypes[linkType],aId);if(!!aPort){aPort.linkText=linkData.FIBER_INFO;}var zPort=LM.getPort(zPortTypes[linkType],zId);if(!!zPort){zPort.linkText=linkData.FIBER_INFO;}if(!!aPort&&!!zPort){var link=new ZLink(aPort,zPort);link.stationId=linkData.STATION_ID;link.text=linkData.FIBER_INFO;link.setConnType(linkData.CONN_TYPE);TL.links.push(link);}}};LinkManager.addLink=function(linkData){delete (linkData.rawLink);LM.data.push(linkData);var fs=LM.ports.f;for(var i=0;i<fs.length;i++){fs[i].occupied=LM.isFiberOccupied("f",fs[i].id);}var Fs=LM.ports.F;for(var i=0;i<Fs.length;i++){Fs[i].occupied=LM.isFiberOccupied("F",Fs[i].id);}};LinkManager.removeLink=function(link){TL.links.remove(link);link.start.occupied=false;link.end.occupied=false;link.start.link=null;link.end.link=null;for(var i=0;i<LM.data.length;i++){var dat=LM.data[i];if(dat.STATION_ID==link.stationId&&dat.A_END_ID==link.aEndId&&dat.Z_END_ID==link.zEndId&&dat.CONN_TYPE==link.connType){LM.data.remove(dat);break;}}var fs=LM.ports.f;for(var i=0;i<fs.length;i++){fs[i].occupied=LM.isFiberOccupied("f",fs[i].id);}var Fs=LM.ports.F;for(var i=0;i<Fs.length;i++){Fs[i].occupied=LM.isFiberOccupied("F",Fs[i].id);}};LinkManager.isFiberOccupied=function(portType,portId){if(portType=="f"||portType=="F"){var rv=false;for(var i=0;i<LM.data.length;i++){var dat=LM.data[i];switch(dat.CONN_TYPE){case 2:case 4:rv=rv||(dat.Z_END_ID==portId);break;case 3:rv=rv||(dat.A_END_ID==portId);break;case 5:rv=rv||(dat.A_END_ID==portId||dat.Z_END_ID==portId);break;}}return rv;}return false;};})();function Region(x,y,w,h){this.x=x;this.y=y;this.width=w;this.height=h;this.l=x;this.t=y;this.r=x+w;this.b=y+h;}Region.prototype.inRegion=function(x,y){return((x-this.l)*(x-this.r)<=0&&(y-this.t)*(y-this.b)<=0);};var IObject=Class.extend({name:"IObject",id:-1,x:0,y:0,width:0,height:0,region:null,isCursorInside:false,items:null,init:function(cfg){this.setCfg(cfg);this.region=new Region(this.x,this.y,this.width,this.height);},setCfg:function(cfg){if(cfg===undefined){return;}for(var prop in cfg){var v=cfg[prop];if(v===undefined){}else{if(prop in this){this[prop]=v;}}}},draw:function(ctx){this.update();if(!!ctx){ctx.strokeStyle="#0000FF";ctx.fillStyle="rgba(255,255,200,0.5)";ctx.fillRect(this.x,this.y,this.width,this.height);ctx.strokeRect(this.x,this.y,this.width,this.height);if(this.isCursorInside&&SHOW_HOVER){ctx.fillStyle="rgba(200,200,200,0.5)";ctx.fillRect(this.x,this.y,this.width,this.height);}}},update:function(dt){},inRegion:function(x,y){this.isCursorInside=this.region.inRegion(x,y);return this.isCursorInside;},onmousedown:function(curPos){return this.isCursorInside;},onmousemove:function(curPos,delta){return this.isCursorInside;},onmouseup:function(curPos){return this.isCursorInside;},lostFocus:function(){this.isCursorInside=false;for(var len=this.items.length,i=len-1;i>=0;i--){var child=this.items[i];child.lostFocus();}}});var Container=IObject.extend({name:"Container",cx:0,cy:0,cw:0,ch:0,padding:"1",offset:null,maxOffset:null,clientRegion:null,cursorInClient:false,items:null,init:function(cfg){var canvas=document.createElement("canvas");this._super(cfg);var td=bd=ld=rd=0;this.padding=this.padding.trim();if(!!this.padding){var args=this.padding.split(" ");var len=args.length;if(len>0){ld=rd=td=bd=args[0]>>0;}if(len>1){ld=rd=args[1]>>0;}if(len>2){bd=args[2]>>0;}if(len>3){ld=args[3]>>0;}}this.cx=ld+this.x;this.cy=td+this.y;this.cw=this.width-ld-rd;this.ch=this.height-td-bd;this.clientRegion=new Region(this.cx,this.cy,this.cw,this.ch);this.offset={x:0,y:0};this.maxOffset={x:0,y:0};this.items=[];},draw:function(ctx){this.drawBg(ctx);if(!!ctx){ctx.fillStyle="blue";ctx.clearRect(this.cx,this.cy,this.cw,this.ch);ctx.save();ctx.fillStyle="red";ctx.beginPath();ctx.rect(this.cx,this.cy,this.cw,this.ch);ctx.closePath();ctx.clip();ctx.translate(this.cx+this.offset.x,this.cy+this.offset.y);this.drawClient(ctx);ctx.restore();if(this.cursorInClient){}}},drawBg:function(ctx){},drawClient:function(ctx){for(var len=this.items.length,i=len-1;i>=0;i--){this.items[i].draw(ctx);}},inRegion:function(x,y){this.cursorInClient=this.clientRegion.inRegion(x,y);if(this.cursorInClient){for(var i=0,len=this.items.length;i<len;i++){this.items[i].inRegion(x-this.cx-this.offset.x,y-this.cy-this.offset.y);}}else{for(var i=0,len=this.items.length;i<len;i++){this.items[i].isCursorInside=false;}}return this._super(x,y);},onmousedown:function(curPos){if(this.isCursorInside){var continueFlag=true;for(var i=0;continueFlag&&i<this.items.length;i++){var o=this.items[i];if(o instanceof IObject){continueFlag=!o.onmousedown(curPos);}}}return this.isCursorInside;},onmousemove:function(curPos,delta){if(!!delta&&this.isCursorInside){if(this.offset.x+this.maxOffset.x+delta.x>0){}if(this.offset.y+this.maxOffset.y+delta.y>0){this.offset.y+=delta.y;}if(this.offset.x>0){this.offset.x=0;}if(this.offset.y>0){this.offset.y=0;}for(var i=0;i<this.items.length;i++){var o=this.items[i];o.updateLines();}}return this.isCursorInside;},onmouseup:function(curPos){if(this.isCursorInside){var continueFlag=true;for(var i=0;continueFlag&&i<this.items.length;i++){var o=this.items[i];if(o instanceof IObject){continueFlag=!o.onmouseup(curPos);}}}return this.isCursorInside;},updateClientSize:function(){var l,r,t,b;l=r=t=b=0;for(var i=0,len=this.items.length;i<len;i++){var bz=this.items[i].getBounds();r=Math.max(r,bz.right);b=Math.max(b,bz.bottom);}this.maxOffset.x=r-this.cw+5;this.maxOffset.y=b-this.ch+5;},add:function(wgt){this.items.push(wgt);this.updateClientSize();wgt.parent=this;wgt.index=this.items.length-1;},clear:function(){this.items=[];}});var ListView=Container.extend({name:"ListView",snap:0,bgColor:16777181,textColor:51,data:null,count:0,portPos:POS.LEFT,renderer:function(v){return v+"";},init:function(cfg){this.padding="1";this.data=[];this._super(cfg);},drawBg:function(ctx){if(!!ctx){ctx.fillStyle="#888888";ctx.fillRect(this.x,this.y,this.width,this.height);}},add:function(v){v.FIBER_NAME=v.FIBER_NAME||"<空>";v.NOTE=v.NOTE||"<空>";var itm=new ListItem({x:0,y:this.count*24,text:this.renderer(v),width:this.width,height:24,id:v.RESOURCE_FIBER_ID,portPos:this.portPos,portText:v.FIBER_NAME});this.count++;this._super(itm);},addAll:function(arr){this.data=this.data.concat(arr);this.measureClient();this.count+=arr.length;},clear:function(){this.count=0;this._super();}});var Link=IObject.extend({name:"Link",start:null,end:null,init:function(startNode,endNode){this.start=startNode||TL.startPos;this.end=endNode||TL.curPos;startNode.link=this;endNode.link=this;},inRegion:function(x,y){return false;},draw:function(ctx){var s=this.start.getAbsPos();var e=this.end.getAbsPos();ctx.strokeStyle="blue";ctx.beginPath();ctx.moveTo(s.x,s.y);ctx.lineTo(e.x,e.y);ctx.closePath();ctx.stroke();}});var ZLink=Link.extend({name:"ZLink",points:null,connType:0,stationId:-1,aEndId:-1,zEndId:-1,text:"#",selected:false,init:function(start,end){this._super(start,end);this.points=[];this.aEndId=start.id;this.zEndId=end.id;start.occupied=true;end.occupied=true;this.update();},inRegion:function(x,y){var len=this.points.length;var lines=[];var startPos=this.start.getAbsPos();var endPos=this.end.getAbsPos();lines.push([startPos.x,startPos.y,this.points[0].x,this.points[0].y,x,y]);for(var i=0;i<len-1;i++){var fN=this.points[i];var tN=this.points[i+1];lines.push([fN.x,fN.y,tN.x,tN.y,x,y]);}lines.push([tN.x,tN.y,endPos.x,endPos.y,x,y]);var hit=false;for(var i=0,len=lines.length;!hit&&i<len;i++){hit=hitTest.apply(null,lines[i]);}this.isCursorInside=hit;return hit;},draw:function(ctx){if((this.start.isVisible()&&this.end.isVisible())||this.connType==6){this.update();if(true||TL.mouseState==MOUSE_STATE.DRAG){var startPos=this.start.getAbsPos();var endPos=this.end.getAbsPos();ctx.beginPath();ctx.moveTo(startPos.x,startPos.y);for(var i=0;i<this.points.length;i++){var p=this.points[i];ctx.lineTo(p.x,p.y);}ctx.lineTo(endPos.x,endPos.y);if(this.isCursorInside||this.selected){ctx.lineWidth=3;ctx.strokeStyle=this.selected?"blue":"yellow";ctx.stroke();}ctx.strokeStyle="blue";ctx.lineWidth=1;ctx.stroke();}}},update:function(){this.points=[];var startPos=this.start.getAbsPos();var endPos=this.end.getAbsPos();switch(this.connType){case 6:if(this.start.type=="p"){p=this.start;u=this.end;}else{p=this.end;u=this.start;}startPos=p.getAbsPos();endPos=u.getAbsPos();var px=startPos.x;for(var i=0,len=p.parent.items.length;i<len;i++){var port=p.parent.items[i];if(port!=p&&!!port.link&&port.link.connType==6){px+=10;}if(port==p){break;}}var pAdjOffset=p.parent.index*2;this.points.push({x:px+20+pAdjOffset,y:startPos.y});var dir=1;if(startPos.y>endPos.y){dir=-1;}var yOffset=startPos.y-p.y;var uBound=u.parent.getBounds();var uBlank={y1:dir>0?uBound.top-50:uBound.bottom,y2:dir>0?uBound.top:uBound.bottom+50};uBlank.mid=(uBlank.y1+uBlank.y2)/2;uBlank.halfy=((uBlank.y1-uBlank.y2)/2);var dy=(p.y-(dir>0?uBlank.y1:uBlank.y2))/(p.y-uBlank.mid)*uBlank.halfy;var y=dy*dir+uBlank.mid+yOffset;this.points.push({x:px+20+pAdjOffset,y:y});this.points.push({x:endPos.x-20,y:(dir>0?uBlank.y2:uBlank.y1)+yOffset});this.points.push({x:endPos.x-20,y:endPos.y});if(this.start.type=="U"){this.points.reverse();}break;default:this.points.push({x:startPos.x+Math.min(40,(endPos.x-startPos.x)/3),y:startPos.y});this.points.push({x:endPos.x-Math.min(40,(endPos.x-startPos.x)/3),y:endPos.y});}},onmousedown:function(curPos){if(this.isCursorInside){if(!!TL.selectedLink&&this!=TL.selectedLink){TL.selectedLink.selected=false;}this.selected=!this.selected;}else{this.selected=false;}if(this.selected){TL.selectedLink=this;}return this.isCursorInside;},setConnType:function(connType){this.connType=connType;if(connType==2||connType==4||connType==6){this.text=this.end.text;}}});var HITDISTANCE=6;function hitTest(x1,y1,x2,y2,tx,ty){var dx=x2-x1;var dy=y2-y1;var length=Math.sqrt(dx*dx+dy*dy);var percent=(dx*(tx-x1)+dy*(ty-y1))/(length*length);var distance=(dx*(ty-y1)-dy*(tx-x1))/length;return(percent>0&&percent<1&&Math.abs(distance)<HITDISTANCE);}var SampleLink=Link.extend({name:"SampleLink",init:function(){},inRegion:function(x,y){return false;},draw:function(ctx){if(!!TL.startNode){this.update();ctx.beginPath();ctx.strokeStyle="blue";ctx.moveTo(this.start.x,this.start.y);ctx.lineTo(this.end.x,this.end.y);ctx.closePath();ctx.stroke();}},update:function(){if(!!TL.startNode){this.start=TL.startNode.getAbsPos();this.end=TL.curPos;}},onmousedown:function(curPos){}});var Widget=IObject.extend({name:"Widget",snap:0,bgColor:16777181,textColor:51,port:null,parent:null,absPos:null,init:function(cfg){this._super(cfg);this.absPos={x:0,y:0};this.items=[];},measureItem:function(v){var met=TL.fg.measureText(v);return{width:met.width,height:this.height};},draw:function(ctx){if(!!ctx){ctx.fillStyle="rgba(255,255,200,0.5)";ctx.fillRect(this.x,this.y,this.width,this.height);}},getBounds:function(){return{left:this.x,right:this.x+this.width,top:this.y,bottom:this.y+this.height};},addPort:function(cfg){var pt=new Port(cfg);this.items.push(pt);pt.parent=this;},drawPort:function(ctx){for(var i=0,len=this.items.length;i<len;i++){this.items[i].draw(ctx);}},onmousedown:function(curPos){if(this.isCursorInside){var cf=true;for(var i=0,len=this.items.length;cf&&i<len;i++){cf=!this.items[i].onmousedown(curPos);}}return this.isCursorInside;},onmousemove:function(curPos,delta){return this.isCursorInside;},onmouseup:function(curPos){if(this.isCursorInside){var cf=true;for(var i=0,len=this.items.length;cf&&i<len;i++){cf=!this.items[i].onmouseup(curPos);}}return this.isCursorInside;},inRegion:function(x,y){this._super(x,y);for(var i=0,len=this.items.length;i<len;i++){this.items[i].isCursorInside=false;}for(var i=0,len=this.items.length;!this.isCursorInside&&i<len;i++){this.isCursorInside|=this.items[i].inRegion(x,y);}return this.isCursorInside;},updateLines:function(){for(var i=0,len=this.items.length;i<len;i++){var port=this.items[i];if(port.link){port.link.update();}}}});Widget.create=function(cfg){switch(cfg.NAME){case"OTDR":return new OTDR(cfg);break;default:return new OSW(cfg);break;}};var Port=IObject.extend({name:"Port",pos:null,link:null,parent:null,occupied:false,text:"@",type:"p",init:function(cfg){cfg.width=12;cfg.height=12;this._super(cfg);this.region=new Region(this.x-6,this.y-6,cfg.width,cfg.height);LM.regPort(this.type,this);},isVisible:function(){return this.region.inRegion(this.pos.x,this.pos.y);},draw:function(ctx){this.update();if(!!ctx){ctx.save();if(this.isCursorInside||this==TL.startNode){ctx.fillStyle="rgba(100,100,255,0.7)";ctx.fillRect(this.x-7,this.y-7,this.width+2,this.height+2);ctx.fillStyle="white";ctx.fillRect(this.x-6,this.y-6,this.width,this.height);}var isPossible=(TL.startNode==this)||(!TL.possiblePortType)||TL.possiblePortType.indexOf(this.type)>-1;ctx.fillStyle=this.occupied?(this.isCursorInside?"red":"rgba(200,200,250,0.5)"):(isPossible?"rgba(100,250,100,0.5)":"red");ctx.fillRect(this.x-4,this.y-4,this.width-4,this.height-4);ctx.restore();}},getBounds:function(){return{left:this.x,right:this.x+this.width,top:this.y,bottom:this.y+this.height};},onmousedown:function(curPos){if(this.isCursorInside){if(!TL.startNode){if(!this.occupied){TL.startNode=this;var possibleTypes={f:["F","U"],u:["U"],U:["f","u","p"],p:["F","U"],F:["f","p"]};TL.possiblePortType=possibleTypes[this.type];}}else{var sn=TL.startNode;var en=this;TL.startNode=null;TL.possiblePortType=null;if(sn==en||sn.occupied||en.occupied||(sn.parent==en.parent)){return;}var rawConType=sn.type>en.type?en.type+sn.type:sn.type+en.type;var conTypes={Uf:3,Ff:5,Uu:1,Up:6,Fp:2};var realType=conTypes[rawConType]||0;if(realType==2&&!TL.isRTU){realType=4;}if(realType==5&&TL.isSameFiber()){return;}if((sn.type!="p"&&realType==6)||(sn.getAbsPos().x>en.getAbsPos().x)){var tmp=sn;sn=en;en=tmp;}if(!!realType){TL.addLink({startNode:sn,endNode:en,connType:realType});}}}return this.isCursorInside;},onmousemove:function(curPos,delta){return this.isCursorInside;},onmouseup:function(curPos){if(this.isCursorInside){}return this.isCursorInside;},getAbsPos:function(){var pp=this.parent.parent;sx=pp.cx+pp.offset.x+this.x;sy=pp.cy+pp.offset.y+this.y;return{x:sx,y:sy};},isVisible:function(){var pp=this.parent.parent;var y=pp.offset.y+this.y;return y>0&&y<pp.ch;}});var OTDR=Widget.extend({name:"OTDR",port:null,SLOT_NO:-1,init:function(cfg){cfg.width=64;cfg.height=48;cfg.x=cfg.y=5;cfg.id=cfg.UNIT_ID;this._super(cfg);this.addPort({x:this.x+this.width+16,y:this.y+this.height/2,id:this.id,type:"u"});},measureItem:function(v){var met=TL.fg.measureText(v);return{width:met.width,height:this.height};},draw:function(ctx){if(!!ctx){var align=ctx.textAlign;ctx.strokeStyle="#000";ctx.fillStyle="rgba(255,255,230,1)";ctx.lineWidth=1;ctx.textAlign="center";ctx.fillRect(this.x,this.y,this.width,this.height);ctx.strokeRect(this.x,this.y,this.width,this.height);ctx.strokeText("OTDR",this.x+this.width/2,this.y+this.height/2);ctx.strokeText(this.SLOT_NO,this.x+this.width/2,this.y+this.height/2+12);ctx.textAlign=align;ctx.fillStyle="#000";ctx.fillRect(this.x+this.width,this.y+this.height/2,16,1);this.drawPort(ctx);if(this.isCursorInside&&SHOW_HOVER){ctx.fillStyle="rgba(200,200,200,0.5)";ctx.fillRect(this.x,this.y,this.width,this.height);}}},getBounds:function(){return{left:this.x,right:this.x+this.width+40,top:this.y,bottom:this.y+this.height};}});var OSW=Widget.extend({name:"OSW",portCount:8,SLOT_NO:-1,text:"",init:function(cfg){cfg.portCount=cfg.PORT_COUNT;cfg.width=64;cfg.height=cfg.portCount*12+12;cfg.id=cfg.UNIT_ID;this._super(cfg);var portIds=cfg.PORT_IDS.split(",");for(var i=0;i<this.portCount;i++){this.addPort({x:this.x+this.width+60,y:this.y+i*12+18,id:~~portIds[i],type:"p"});}this.addPort({x:this.x-16,y:this.y+this.height/2,id:this.id,type:"U",text:cfg.NAME});},draw:function(ctx){if(!!ctx){var align=ctx.textAlign;ctx.strokeStyle="#000";ctx.fillStyle="rgba(255,255,230,1)";ctx.lineWidth=1;ctx.textAlign="center";ctx.fillRect(this.x,this.y,this.width,this.height);ctx.strokeRect(this.x,this.y,this.width,this.height);ctx.strokeText("OSW",this.x+this.width/2,this.y+this.height/2);ctx.strokeText(this.SLOT_NO,this.x+this.width/2,this.y+this.height/2+12);ctx.textAlign=align;ctx.fillStyle="#000";ctx.fillRect(this.x-16,this.y+this.height/2,16,1);for(var i=0;i<this.portCount;i++){ctx.fillRect(this.x+this.width,this.y+i*12+18,60,1);ctx.strokeText((i+1)+".",this.x+this.width+5,this.y+i*12+18);if(!!this.items[i].linkText){ctx.strokeText(this.items[i].linkText,this.x+this.width+20,this.y+i*12+18);}}this.drawPort(ctx);if(this.isCursorInside&&SHOW_HOVER){ctx.fillStyle="rgba(200,200,200,0.5)";ctx.fillRect(this.x,this.y,this.width,this.height);}}},getBounds:function(){return{left:this.x,right:this.x+this.width+80,top:this.y,bottom:this.y+this.height};}});var ListItem=Widget.extend({name:"ListItem",displayText:"",fiberId:-1,fiberIndex:-1,text:"",textOffset:24,rollPosition:24,rollDelay:24,textWidth:24,portPos:POS.LEFT,bgColor:16777181,textColor:51,parent:null,port:null,portText:"#",init:function(cfg){this.fiberId=cfg.id;this.fiberIndex=cfg.index;this._super(cfg);if(this.portPos==POS.RIGHT){this.textOffset=4;this.addPort({x:this.x+this.width-12,y:this.y+12,id:cfg.id,type:"f",text:cfg.portText,occupied:LM.isFiberOccupied("f",cfg.id)});}else{this.addPort({x:this.x+12,y:this.y+12,id:cfg.id,type:"F",text:cfg.portText,occupied:LM.isFiberOccupied("F",cfg.id)});}this.textWidth=this.measureText();},measureText:function(){var met=TL.fg.measureText(this.text);return met.width;},draw:function(ctx){ctx.save();ctx.fillStyle="black";ctx.strokeStyle="black";ctx.textBaseline="top";if(this.isCursorInside&&(this.textWidth+24>this.width)){ctx.fillText(this.text,this.x+this.textOffset-this.rollPosition,this.y+6);ctx.fillText(this.text,this.x+this.textOffset-this.rollPosition+this.textWidth+24,this.y+6);if(this.rollDelay>0){this.rollDelay--;}else{this.rollPosition++;}if(this.rollPosition>this.textWidth+24){this.rollPosition=0;this.rollDelay=50;}}else{ctx.fillText(this.text,this.x+this.textOffset,this.y+6);}if(this.portPos==POS.RIGHT){ctx.clearRect(this.x+this.width-24,this.y,24,24);}else{ctx.clearRect(this.x,this.y,24,24);}if(this.isCursorInside){ctx.fillStyle="rgba(200,200,200,0.3)";ctx.fillRect(this.x,this.y,this.width,this.height);}this.drawPort(ctx);ctx.restore();},inRegion:function(x,y){this._super(x,y);this.items[0].inRegion(x,y);return this.isCursorInside;}});var ui=ui||{};var css=function(){return{load:function(e,a){var a=a||document,c=a.createElement("link");c.type="text/css";c.rel="stylesheet";c.href=e;a.getElementsByTagName("head")[0].appendChild(c);},inject:function(e,a){var a=a||document,c=document.createElement("style");c.type="text/css";c.innerHTML=e;a.getElementsByTagName("head")[0].appendChild(c);}};}();function log(v){console.log(v);}var e=function(id){var el=document.getElementById(id);return{createChild:function(type,cfg){cfg=cfg||{};var child=document.createElement(type);for(var p in cfg){switch(p){case"id":child.id=cfg.id;break;case"css":var style=child.style;for(var s in cfg.css){style[s]=cfg.css[s];}break;default:child[p]=cfg[p];}}if(!!el){el.appendChild(child);}if(type=="canvas"){return child;}else{return this;}},getWidth:function(){return el.clientWidth||el.width||el.style.width;},getHeight:function(){return el.clientHeight||el.height||el.style.height;},createCombo:function(cfg){var w=document.getElementById(cfg.cmbId).style.width;w=w.substr(0,w.length-2)>>0;function loadDetail(url,field,id,callback){var param={};param[field]=id;Ext.Ajax.request({url:url,type:"post",params:param,success:function(response,options){var obj=Ext.decode(response.responseText);callback(obj);},failure:function(){Ext.Msg.alert("提示：","后台运行出错！");},error:function(){Ext.Msg.alert("提示：","后台运行出错！");}});}var store=new Ext.data.Store({url:cfg.url,reader:new Ext.data.JsonReader({totalProperty:"total",root:"rows"},[cfg.valueField,cfg.displayField])});var combo=new Ext.form.ComboBox({id:cfg.id,typeAhead:true,triggerAction:"all",lazyRender:true,mode:"local",width:w,store:store,valueField:cfg.valueField,displayField:cfg.displayField,renderTo:cfg.cmbId,listeners:{"select":function(me,rec,index){var id=rec.get(cfg.valueField);loadDetail(cfg.detailUrl,cfg.paramField,id,cfg.callback);}}});return this;},css:function(styleName,value){el.style[styleName]=value;},html:function(value){el.innerHTML=value;}};};ui=(function(){var _leftComboID="lc_"+Ext.id();var _rightComboID="rc_"+Ext.id();var _middleComboID="mc_"+Ext.id();var _canvasID="cvs_fg";var _bgCanvasID="bgcvs_"+Ext.id();var cw,ch,lw,lh,rw,rh,mw,mh,lx,ly,rx,ry,mx,my;var lc,rc,mc;var ls,rs,ms;function el(id){return document.getElementById(id);}if(!ui.initialized){ui.initialized=true;return{initDom:function(prtId){e(prtId).createChild("div",{id:_leftComboID,css:{width:"180px",height:"22px",position:"absolute",left:"10px",top:"5px",background:"#ffcccc"}}).createCombo({id:"_tutu_leftCombo_",cmbId:_leftComboID,url:"external-connect!getCableInfo.action",valueField:"CABLE_ID",displayField:"CABLE_NAME_FTTS",detailUrl:"external-connect!getFiberInfo.action",paramField:"cableId",callback:TL.loadLeftData});e(prtId).createChild("div",{id:_rightComboID,css:{width:"180px",height:"22px",position:"absolute",right:"10px",top:"5px",background:"#ffcccc"}}).createCombo({id:"_tutu_rightCombo_",cmbId:_rightComboID,url:"external-connect!getCableInfo.action",valueField:"CABLE_ID",displayField:"CABLE_NAME_FTTS",detailUrl:"external-connect!getFiberInfo.action",paramField:"cableId",callback:TL.loadRightData});e(prtId).createChild("div",{id:_middleComboID,css:{width:"240px",height:"22px",margin:"5px auto",background:"#ffffcc"}}).createCombo({id:"_tutu_midCombo_",cmbId:_middleComboID,url:"external-connect!getRcInfo.action",valueField:"RC_ID",displayField:"NUMBER",detailUrl:"external-connect!getUnitInfo.action",paramField:"rcId",callback:TL.loadMidData});var w=document.getElementById(prtId).clientWidth;var h=document.getElementById(prtId).clientHeight;h-=34;var cvs=document.getElementById("cvs_fg");cvs.width=w;cvs.height=h;var bgCvs=document.getElementById("cvs_bg");bgCvs.width=w;bgCvs.height=h;return{width:w,height:h,lx:10,rx:w-180-10,mx:w/2-120,ly:0,ry:0,my:0,lw:180,lh:h-10,rw:180,rh:h-10,mw:240,mh:h-10,cvs:cvs,ctx:cvs.getContext("2d"),bgCvs:bgCvs,bgCtx:bgCvs.getContext("2d")};},initData:function(stationId){if(!lc){lc=Ext.getCmp("_tutu_leftCombo_");ls=lc.getStore();}if(!rc){rc=Ext.getCmp("_tutu_rightCombo_");rs=rc.getStore();}if(!mc){mc=Ext.getCmp("_tutu_midCombo_");ms=mc.getStore();}ls.baseParams.stationId=stationId;ls.load();rs.baseParams.stationId=stationId;rs.load();ms.baseParams.stationId=stationId;ms.load();},debug:function(){console.log(lc);console.log(ls);console.log(rc);console.log(rs);console.log(mc);console.log(ms);}};}else{return ui;}})();function getElementPos(e){e=e||window.event;var obj=e.target||e.srcElement;var x=0,y=0;while(obj.offsetParent){x+=obj.offsetLeft;y+=obj.offsetTop;obj=obj.offsetParent;}return{x:x,y:y};}function getAbsMousePos(e){e=e||window.event;return{x:e.pageX||e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:e.pageY||e.clientY+document.body.scrollTop+document.documentElement.scrollTop};}function getMousePos(e){var element=getElementPos(e);var mouse=getAbsMousePos(e);TL.curPos.x=mouse.x-element.x;TL.curPos.y=mouse.y-element.y;}function rndString(){var len=(Math.random()*20+5)>>0;var s="";for(var i=0;i<len;i++){s+=String.fromCharCode(97+(Math.random()*26)>>0);}return s;}var SHOW_HOVER=true;var DEBUG=false;var lv=null;var aaa=null;var TL={objects:[],links:[],_lc:null,_mc:null,_rc:null,curStationId:-1,isRTU:false,listeners:{},width:800,height:600,moving:false,startNode:null,endNode:null,possiblePortType:null,fg:null,bg:null,bgCvs:null,curPos:{x:0,y:0},startPos:{x:0,y:0},lastPos:{x:0,y:0},mouseState:MOUSE_STATE.NONE,initDom:function(prtId){var param=ui.initDom(prtId);TL.width=param.width;TL.height=param.height;var lc=new ListView({x:param.lx,y:param.ly,width:param.lw,height:param.lh,portPos:POS.RIGHT,renderer:function(v){var pre=DEBUG?v.RESOURCE_FIBER_ID+"#":"";return pre+v.FIBER_NO+". "+v.FIBER_NAME+" - "+v.NOTE;}});TL._lc=lc;var rc=new ListView({x:param.rx-1,y:param.ry,width:param.rw,height:param.rh,portPos:POS.LEFT,renderer:function(v){var pre=DEBUG?v.RESOURCE_FIBER_ID+"#":"";return pre+v.FIBER_NO+". "+v.FIBER_NAME+" - "+v.NOTE;}});TL._rc=rc;var mc=new Container({x:param.mx-50,y:param.my,width:param.mw+100,height:param.mh});TL._mc=mc;TL.objects.push(lc);TL.objects.push(rc);TL.objects.push(mc);TL.objects.push(new SampleLink());TL.fg=param.ctx;TL.bg=param.bgCtx;TL.cvs=param.cvs;TL.bgCvs=param.bgCvs;TL.regEvents();TL.regBufferImages();},initData:function(stationId){TL.curStationId=stationId;ui.initData(stationId);},loadLeftData:function(dat){var len=dat.total;var lc=TL._lc;lc.clear();LM.ports.f=[];for(var i=0;i<len;i++){lc.add(dat.rows[i]);}TL.links=[];LM.generateLinks();},loadRightData:function(dat){var len=dat.total;var rc=TL._rc;rc.clear();LM.ports.F=[];for(var i=0;i<len;i++){rc.add(dat.rows[i]);}TL.links=[];LM.generateLinks();},loadMidData:function(dat){var len=dat.total;var mc=TL._mc;mc.clear();LM.ports.u=[];LM.ports.U=[];LM.ports.p=[];var hasOTDR=false;for(var i=0;i<len;i++){hasOTDR=hasOTDR||(dat.rows[i].NAME=="OTDR");}TL.isRTU=hasOTDR;var oswX=hasOTDR?160:100;var oswY=5;for(var i=0;i<len;i++){var cfg=dat.rows[i];cfg.x=oswX;cfg.y=oswY;var wgt=Widget.create(cfg);mc.add(wgt);if(cfg.NAME!="OTDR"){oswY+=wgt.height+50;}}TL.links=[];LM.generateLinks();},regEvents:function(){TL.cvs.onmousedown=TL.onmousedown;TL.cvs.onmouseup=TL.onmouseup;TL.cvs.onmousemove=TL.onmousemove;document.onkeydown=TL.onkeydown;},onclick:function(e){console.log("TL.onclick");for(var i=0;i<TL.objects.length;i++){var o=TL.objects[i];if(o instanceof IObject){}}for(var i=0;i<TL.links.length;i++){}},onmousedown:function(e){if(e.button!=0){return true;}getMousePos(e);var cp=TL.curPos;TL.startPos.x=cp.x;TL.startPos.y=cp.y;var x=cp.x;var y=cp.y;TL.lastPos.x=cp.x;TL.lastPos.y=cp.y;TL.mouseState=MOUSE_STATE.MOUSEDOWN;var continueFlag=true;TL.selectedLink=null;for(var i=TL.links.length-1;i>=0;i--){var o=TL.links[i];if(o instanceof ZLink){continueFlag&=!o.onmousedown(cp);}}for(var i=TL.objects.length-1;continueFlag&&i>=0;i--){var o=TL.objects[i];if(o instanceof IObject){continueFlag=!o.onmousedown(cp);}}for(var i=0;i<TL.links.length;i++){}if(e&&e.stopPropagation){e.stopPropagation();}else{e.cancelBubble=true;}TL.fireEvent("mouse_down",cp);return false;},onmouseup:function(e){TL.fireEvent("mouse_up",TL.curPos);TL.mouseState=MOUSE_STATE.NONE;var continueFlag=true;for(var i=TL.objects.length-1;continueFlag&&i>=0;i--){var o=TL.objects[i];if(o instanceof IObject){continueFlag=!o.onmouseup(TL.curPos);}}},onmousemove:function(evt){TL.lastPos.x=TL.curPos.x;TL.lastPos.y=TL.curPos.y;getMousePos(evt);var x=TL.curPos.x;var y=TL.curPos.y;TL.mouseState=(TL.mouseState!=MOUSE_STATE.NONE?MOUSE_STATE.DRAG:MOUSE_STATE.NONE);var continueFlag=true;for(var i=TL.links.length-1;continueFlag&&i>=0;i--){var o=TL.links[i];continueFlag=!o.inRegion(x,y);}for(i=TL.objects.length-1;continueFlag&&i>=0;i--){o=TL.objects[i];continueFlag=!o.inRegion(x,y);}var delta=TL.mouseState==MOUSE_STATE.DRAG?TL.getDelta():null;for(i=0;i<TL.objects.length;i++){o=TL.objects[i];if(o instanceof IObject){o.onmousemove(TL.curPos,delta);}}for(i=0;i<TL.links.length;i++){o=TL.objects[i];if(o instanceof IObject){o.onmousemove(TL.curPos,delta);}}e("inspector").html("["+x+", "+y+"]");if(evt&&evt.stopPropagation){evt.stopPropagation();}else{evt.cancelBubble=true;}},onkeydown:function(e){switch(e.keyCode){case 46:TL.deleteLink();break;default:}},draw:function(){var g=TL.bg;g.clearRect(0,0,TL.width,TL.height);for(var i=0,len=TL.objects.length;i<len;i++){TL.objects[i].draw(g);}for(i=0,len=TL.links.length;i<len;i++){TL.links[i].draw(g);}var fg=TL.fg;fg.clearRect(0,0,TL.width,TL.height);fg.drawImage(this.bgCvs,0,0);},showTip:function(pos,title,info){TL.tip.setGPS(pos.Lng,pos.Lat);TL.tip.visible=true;TL.tip.setTitle(title);TL.tip.setText(info);},render:function(){TL.draw();window.requestAnimationFrame(TL.render);},imgs:{},base64imgs:{up:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADP0lEQVQ4T5VTa0iTURh+vl2+Xd3FVrs4y8u0IjArKudMLcJa4dJpUdBFW5YFRtndoszC+hW0kEi6kJUZM5N+FRGtiAqLIUVRTVtbpqUubc52c1vfRIcR/eiF8+NweJ/zvs+FwN9Fy83NJVksFpfH43GpZzpVPqqGZTKZt76+PjCxhZhwIdRqNVsikcikUsmCGapUtUAUIyEQZvhHgp7unu+dHz92mN1u9wePxzNgNptHIr1RAK1WKxAKhXOzszVlxUXFOpZIxne6gBADEFBz8GkBvH/dbr3ReOuiw+FoEYvF9sg0owDUz5z4+PiMMkPJqcw87cLGR31offwNn/pI8IR8JCtCmJMQRJFmKuSkJ3Du3FmjxdJuNJlMXREAmk6nS6JO7brNhtVHr3Wi4XkA7nAICUI2iudz0d4ZBp30QSnywrAsFQr6d3f18RO7+/v7TZG9OelpaUU1x4/UNb8RCM60WOEFGzQOgcubE7BkFhemZy40v+wDj0kgQTyC7fpUvLjf+uBqw/WdRH5+viRLozlUXlFRWXLWAbMtBtNEQzAalFg0nR/l+M7LAdy1uMCjh1GgmQYV29ZbdfjIekKv1ytzsrNqlm8sK117rB0OTxz08xioL49HR48fyTISDmcAchETNa3d6HL6sDhNCm3ST9fefQe2RAFWGraVrj3chq+/4qCdy4ZiMgl6iED1minY1dAN7Wwu2mxedPW4kZOmQF7qoKtyz8Et0RVKK3ZVbjVa0faZDT7Hjy/uII6tkONAoQQ7rvTim2sYk/lh8PxB6LNSoIz51FtVRa0wSmJ6elEtReLNd2LByaYOMEkSg4Eg9ufJUVUgxp5LA/g65AWLUkIVG0K5Pgkv7o2ROC5jISVjvqF0de11O24+HYaXZGISg4NZciKiCUJECHJxGBuWT4WC2eM+WT0m47iREhMTM0o2bTytXrpswa0nLjQ96Yaz9wdiYxlQThJjpkqAVZlSxDGGAufr6oyvLJaokUalGrfy4pzsbQX6Qh1bKOH++BXJDR0CFgk+I4y3by22xsamC3a7/fYfVh4TOxomhUKakaRKyeTyYmJpNND9Pp93wOm0Wa0fHg4O/iNME1L5X3H+DWVEV/q2PdRcAAAAAElFTkSuQmCC",down:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADPklEQVQ4T5VTaUiTYRz/vTvene6w1Q5nqS0rArOics7UIqwVLp0aBh3asiwwym6LMgvrU9BCIukgKzPWIX0qIloSJRZDiqKatrZMS13anO1yW+9EhxF96P/t4eH/e57fReDvoWVnZ5MsFovL4/G41DWdGh81wzKZzFtfXx+YuEJMOBBqtZotkUhkCoU0LUk1I53Li4ml0UD3+3zeAafTZrV+eDw46P7g8XgGzGbzSGQ3CqDVagVCoXD+0qzMbXn6fB1bKOH++BV5jA4BiwSfEcbbtxZbY2PTBbvdfkcsFtsjvxkFoF7mJCYmppVs2nhavXzFolstLjS1dMPZ+wOxsQwoJ4kxWyXAmnQp4hhDgfN1dcZXFovRZDJ1RQBoOp0uKV+nq801lBbVXrfj5rNheEkmJjE4mCMnwAYNISIEuTiMDSunQsHscZ+sPrG7v7/fFOHNSU1NLag9fqTu5jux4GRTB5gkicFAEPtz5KjKE2PPpQF8HfKCRfqgig2hXJ+E1gfNj642XN9J5ObmSjI0mkOlFbsqtxqtaPvMBp/jxxd3EMdWyXEgX4IdV3rxzTWMyfwweP4g9BkzoIz51FtVdWQ9odfrlVmZGTWrDdtKiw+34euvOGjns6GYTIIeIlC9dgp2NXRDO5eLNpsXXT1uZKUokJM86Krcc3BLFGDlxrLS4mPtcHjioF/AQH15PDp6/JguI+FwBiAXMVHT3I0upw9LU6TQJv107d13YEuUQnlFRWXJWQfMthhMEw3BaFBiyUx+NCb3Xg7gvsUFHj2MPM00qNi23qrDFIVREVNSCmooEW+/EQjO3LXCG9GdQ+Dy5gQsm8OF6bkLt1/2gcckkCAewXZ9Mlofjok4biNlZe26zYaio9c60fAiAHc4hAQhG4ULuWjvDINOOaAUeWFYkQwF/bu7+viYjeNBio+PTyszlJxKz9EubnzSh+an3/CpjwRPyMd0RQjzEoIo0EyFnPQEzp07a7RY2qNBGuU5HuXMTE1ZYUGhjiWS8Z0uIMQABFSl+LQA3r9ut95ovHXR4XDc/SPKY0pFyySVShbNUiWrBaIYCYEwwz8S9HT3fO/8+LHD7Hb/o0wTWvlfdf4NzupX+v/vzKIAAAAASUVORK5CYII=",left:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADmElEQVQ4T2VTa0xbZRh+vnNpD/TC6toIQUatDLyRjVZTncGxShg1DhUF0W7LtuAFF7clZuIloxXQbSxO1CVzugvCUDdcDGrQ1crqbWFIM6byA3B0DcNi2wms0PbQy/EcIjrj9+f7vvfN+7y35yH476GqqqpUDMNk0TRyCGGWSG5BEKaTyeR4IpHwd3V1hUVTajGMLD5MJhNrMBiytFptmbW8vLqw8PYVCkU6R1ECwrPR2NDPv1740uk8GQgEnGNjY36PxxOXYhcASkpKGJ1Opzcajc9s2bLpaaLOVF7wpjAxHQMr5lqmTkdBPpCYmZztaGs/NDAw8G4wGLzkdrsTCwBi2Tq9Xr/Z7rA3j05z7GffXkRgTobZpAB5KgkFBGg0NKzFBtycEY43NTXv8nq9R8V2gkQqPT8/37xz5/NHVbkrl7/VPYq5qAyCOITspSzkDIXLVyKI8RSWyCnUVS5DzHfe29Kyb+PIyMg5UlFRoVpRWLj9JYe96e2vJtA3CsioJGpWaXB/kQbuoRkcck9BJnBIJRIw3SLDjlId9r7+qsMzOLifiOVnWlYX736k9rlN294fR2SOwfridFStyoAvFMebPUHMJxmkpVj8/mcEclkEb9QuR8eR1g/O/nD2RVJZWZlrXXvf3jXVzz5W0zIBq5FG46OZC8tJiQOkqH/3/NC+ccyG/Ti8YyV6uo6d+MbprJcAbigvt+wpfXir7QH7MKBk8c7G62G5TYHf/DyOfz+DNJZCktA49l0Y6vnLONVYhC9OtH14xuWql1q4znynqeHJbfXbbbt/gXuShlYBtD+Vg+ICFXZ98gdaTwfAsDQohoZRK+DUC3l470Drgf7+fjsROcAV5OU92PRa8+HuIUr5yskr4EgSS5U07jAoIG4SP46EwadozPNxNNbkYN2t0UhDg6N2eHj4U4kHEn1zLWtWN2+o2/qEvf0iPu+bRiiRCVqYB4sECE1ASBTV9yjhePxGfHTk4Mcu15mXRR74FomUJpfLzZs3rN9jLi0zd/RehfMnP3z+EGiSQHaWFmV334Tqe2UYdLn629qP1/M8f04EiC5qgdhsNpUoGlOpxVJXsc66llVmqCd5ATRDoBZJxUSmrnZ395z+urf3ICHE09nZKYlK+EdMf1M6TbyzRUHdpdfnFqXLOY1kj/GxqbFLvvOhUKhP/E5Imf+nxmtULc1EHovFFCzLcpI9Ho/HOI6bEwP5a6Us+f4CvPduztV//qsAAAAASUVORK5CYII=",right:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADmUlEQVQ4T2VTa0xbZRh+TnvKOS10wNZWKpCuTOAH6liKjMwbw9opUYhMNpWB7KJzyVTUjG0K2LJ4wWXJNjPxQrZlWxXB+4xlBDsmcdpoyxa8wbCWEQKmXTpKC23Pze8sssz4/vm+733zPt97eR4K/zVFbW2tlqZpo1KpzKUoKkMOSxJ/VRAwyfP8dG9v7xxxiYtp1OLFYrGo8vLyjAaDwfagzbah6PZbV2rT1KwoUojF5uMjI79cdPX19YRCoX6/3z/t9Xo5OfcaQHl5Oa3X65eXlJQ8U9/YsJ1Oz0obHQMuR+bBKYDsDBYrzQpIkZno0aPH3/P5fO8Gg8HA4OAgfw2AlK03m81bWltb9v0xq1W5hvwIhwXECH5CoUSakoIhNYmqe1cgPyPOOeyOlkAgcIy0E6Tk0gsKClY3N+86wZpWmTs/u4yrCREsIyJnmQYJXsTUFQ4UGUKqOonnq/MxN3Hh0v79B7aMjY15qKqqKq2luPjF3S+/aj84EIT39yQUNI0kFcf28kyUF6Xjm+Ewus+HkRSVKMsHnnsgG2/YHa0XR0YOUaT8rDV3rXmzfmvTky91XUIiqcHNSzVYUHBIUfJ4oVIPk06F3vOzODU0D00qj8NP5eLTrrePu88N7aVqampM99lsHZW1mzduO3gBaVojvtiVe325IlmYggxStrZPZuDyCehuzsbZnnc+dp35drcMkLPWau14aGPjE+vbhhFJycHme7RQSgIWOBGb7k7HLUYG7l9jePbE30CUw9eOQgx8fsTZ1+feI7ewtLS01PH0zqad698ahy9EQeQF8JyApnUG7Hv0JgyNzqHh/UmEYmTlWQKce2/DB4c7Dnl+8rZThANsYWHhI+3t9q7Tv6k1bd2TSGFUYBQC7iwglZBF/+yP4UpUQFxS4rUNy1BdJEZbX2nZNjo+/qXMA5m+Jqt17euPb93xmP2jv9DzfZTQVw1JkMCBhkClQEfP4OGyDDgaVuBk55EP3WfPtRAeTCwSSc0wzOrGhk0dxVZrac93SfT/8CempkMQJBomow62O4yor1gCz0C/59jJU3sSiYSHACwsaoGqq6vTSpJkub+iYkd1deU6XpO5JELII/ASshgKXHQ28tVp15kBt7uTiMzrdDplUUnXxfQvpdXkzNbpdGV5y02rWIbNlP3ziXg4EJgYJkL6kTyn5J//p8YbVC3PhInH46kqlYqV/RzHxVmWjZHExI1SlmP/ALUFfc7X7cZxAAAAAElFTkSuQmCC",port:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADFklEQVQ4T41Ta0iTYRQ+3/ftqqZDNxu1xSKpeR2EZOkywj/VCCmTXIoERZkUqT+SECEFichSKUELglqmRj+MZldDsIsgmmiZJquk1qK8bOk+d/lunbcLBCV04PDyXs5znnPe51Dw0+iEhAQ5TdPL1Gp1rCAIWoZhlkmSpBRFUcB1Ed/M4dks3vnGxsYCuBdIIEWCDQaDUqPRaBHAVFpammez7dgdER2nC/KMgqYkUS4F2DcTr4fq689dnpycHGVZ1jM1NeXHWJ4ymUyqyMjIeJlMlnij7fp5ndGceH/ET427gxDgJKAxRUwkAxsTIiDDRC02X2w4197eecvv939AkAUKqeuQdlJHe1uLQms2Nz+Ygel5AeQMUqMBJAlAROcECbITo6DYGsGdrKys6unp6eZ5/iOVmppqLisrK88vKD5U1zUL76fDoJKTyv42NiRCXoYGtqzyfb1+o6Pe4XB0UMnJyVnOO7dvjX/T61sezYBaiWmXMB5ZxKgZqNurlRZm3o3n59uLCIPtgwP9XWfvLSqevmGXzP4bMxAWoWpXPFhWCAuZmZm5VFpa2s7h4eGuCscXevRj8L8AKnboICdJEc7YkL6TAGzrf/6k63R3QPn4pR/UiqVLICwWsQ9n9unBspKft1qtuVRKSkpmZ0dbpyu0xnDq5meIUP67gSSY4yWIj5FD6wGdNOeeHCkoLNpPWSyWtXa7/fCRo2Xlx67OUANvWYj6RyPJd5JfOJG7HLL0bnfrpSu1TqfzLmU2m+NQouaLF5oajYnZ6ceveeA1ikjOUMD8qoZkxng4mBMHJdmyQElJSfnExEQvSvwTEZISJaxVqVTrmhobapPXWzc5ni3Qva/84GV5kKEUDVoF7MmIhs2rOV91dXVNX1/fw1Ao5Ha5XCwpmMhZiRaLbrTZbFuLCu1FOr3RGAKFihJEQQz7fC+GBvtqamqvBoNBF8dxX0gwGajfHSOCkuNBFLLRILVYXKNxr8BpFHFPHnvJRHq93nmPxxP6cxr/1B2NQDISSBxpMggkoea5MJrb7Q7juYhOWvLDvgNGAFwpttomFwAAAABJRU5ErkJggg==",close:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABWklEQVQ4T2NkoBAwUqifAcWAMzNN/oMM/P//P8O/f//AtEX2BbyWwCVBmo3TTiM5aDeYfXhCAYNd4TWchoAlQJr55WyBrIdYfCTP8OjyFoa/f/+CMchl//7/A7MDml4wgg04PcP4v0n6GZKCY221KINWzCFIGJycZvjfLDMDyGIm0pC/DCvKyhhUw/dCDDg+Rf+/RXYWkZohypYUFTFoRB2AGHB0ku5/q9wcBoafv4gzhJ2NYWF+PoN27GGIAYf6tf7bFuQzMHz4QJwBAgIM83NzGXTjj0IMONCr8d++qJCB4ekz4gyQlmKYm53NoJ94HGLA3i7V/06lJQwMd+4QZ4CKCsPszEwGw+STEAN2tSv9d60oZ2C4eo04A7S1GGZlZDAYp55GJOWtTbL/YQkElFhgCQeWeOCJCCqnHrmfQVhYGDUvXL58+f+PHz+IcgUHBweDrq4uJCVSAgBrOpWwN42yugAAAABJRU5ErkJggg==",leaf:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABQ0lEQVQ4T2NkoBAwUqifAWxA96pX/5EN+v2HgeHn7/8M33/9Z/j2E4iR6B+/GBh+AOV+//nPcLxPjhFugLiEKMPff0CJv/8Z/gAlfwHxb6BCkEE/Qfzf/4AYxGYAav7HcObCLYbzs40RBsBcANLwDWjLlx//GL58/w+kgfj7P6BLgK4CGgQD3z48Y7g4zwJiwPJtZ/5HeBoTDI6PQEPA4AcDg1tUKsOpbXMgBizedOJ/jK85AyOEiwL+/4fYiqz5w4+PDKGJxQynt8+F6Ji37vD/xEAbnC5A1wxSiGLArJX7/qeGOcINaGxsxOudhIQChtBMJBdMW7rrf2aUK0lh4BqZgvDC5EXb/+fEepAfBjADcDmBYBigG0ByGOB0ATDeP0LjHcT6AIx/UBr4AKRSkQMRZMCi5WsIBiK6Ang6IFknkgYA+YrcEXUbL2MAAAAASUVORK5CYII=",open:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABaklEQVQ4T2NkoBAwUqifAcWAMzNN/oMM/P//P8O/f//AtEX2BbyWwCVBmo3TTsMd9PvPXzD7xBQ9BrvCazgNAUsgNM/F4qNkhn3dagx///4FY5DL/v3/B2YHNL1gBBtweobxf5P0M0AWNgNgZiajGL62WpRBNXwvJAxOTjP8b5Z5joHh5xTiwpSdk2FFWTGDXMA2BsZjsyTBAUcskFE3Z5DVMmFY0tbOoBi8E2KAZWoDUD8zATP+Mtw+cJnhze21DJa22QwLp7cwqITtQTPg53fchgCd/ePjW4bzqyYwmFuHAw2YxqAWsQ8SBnBXfPiA3xUCMgynFtYwSAorMezafpBBI+oAmgEgbzx9jNsQaTWGGztnM/x49Yzh9LE7DFoxhxApEe6KO3fwuuIjJyvDtW0LGC6ffc6gE3cE1YD7N79gaIYla3ACQsKy/lsZxMTEUPPC2bNn/3//jicgkYzn5ORkMDY2hqRESgAAE1ek/FnBZLMAAAAASUVORK5CYII=",},regImage:function(nm,url){var image=new Image();image.src=url;TL.imgs[nm]=image;},regBase64Image:function(nm,enc){var image=new Image();image.src=enc;TL.imgs[nm]=image;},regBufferImages:function(){for(var o in this.base64imgs){var image=new Image();image.src=this.base64imgs[o];TL.imgs[o]=image;}},testImg:function(id){var script=document.createElement("img");script.src=TL.imgs[id];},getImage:function(imgName){if(imgName in TL.imgs){return TL.imgs[imgName];}else{if(imgName in TL.base64imgs){var img=new Image();img.src=TL.base64imgs[imgName];return img;}else{return null;}}},getDelta:function(){return{x:TL.curPos.x-TL.lastPos.x,y:TL.curPos.y-TL.lastPos.y};},createCanvasImage:function(nm,w,h){var cvs=document.createElement("canvas");cvs.width=w;cvs.height=h;},on:function(evtName,listener,scope){var listenerArray=TL.listeners[evtName];if(!listenerArray){TL.listeners[evtName]=[];listenerArray=TL.listeners[evtName];}if(!scope){scope=window;}listenerArray.push({callback:listener,scope:scope});},fireEvent:function(evtName,optionArgs){var evtArgs=Array.prototype.slice.call(arguments,1);var evtHandlers=TL.listeners[evtName];for(var i=0;i<evtArgs.length;i++){}if(!!evtHandlers){for(var i=0,len=evtHandlers.length;i<len;i++){var callback=evtHandlers[i].callback;var scope=evtHandlers[i].scope;callback.apply(scope,evtArgs);}}},un:function(evtName,callback){var evtHandlers=TL.listeners[evtName];if(!!evtHandlers){for(var i=0,len=evtHandlers.length;i<len;i++){if(callback==evtHandlers[i].callback){evtHandlers.splice(i,1,0);break;}}}},addLink:function(cfg){var link=new ZLink(cfg.startNode,cfg.endNode);link.stationId=TL.curStationId;link.setConnType(cfg.connType);var linkText="";if(link.connType==2||link.connType==4){var cableName=/\[.*\]/ig.exec(Ext.getCmp("_tutu_rightCombo_").getRawValue())[0];cableName=cableName.substr(1,cableName.length-2);var fiberId=parseInt(cfg.endNode.parent.text);linkText=cableName+"("+fiberId+")";}cfg.startNode.linkText=linkText;TL.fireEvent("create_link",{STATION_ID:link.stationId,A_END_ID:link.aEndId,Z_END_ID:link.zEndId,CONN_TYPE:link.connType,FIBER_INFO:linkText,rawLink:link});},deleteLink:function(){if(!TL.selectedLink){return;}TL.fireEvent("delete_link",{STATION_ID:TL.selectedLink.stationId,A_END_ID:TL.selectedLink.aEndId,Z_END_ID:TL.selectedLink.zEndId,CONN_TYPE:TL.selectedLink.connType,rawLink:TL.selectedLink});},removeLinkByType:function(conTypes){var newLinks=[];if(!conTypes.length){conTypes=[conTypes];}for(var i=0;i<TL.links.length;i++){var link=TL.links[i];if(conTypes.indexOf(link.connType)<0){newLinks.push(link);}}TL.links=newLinks;},addSuccessCallback:function(v){LM.data.push(v);},deleteSuccessCallback:function(v){LM.deleteData(v);},isSameFiber:function(){return Ext.getCmp("_tutu_leftCombo_").getValue()==Ext.getCmp("_tutu_rightCombo_").getValue();},setStationName:function(stationName){var tag=document.getElementById("title");tag.innerHTML="FTTS光纤连接图 - "+stationName;}};